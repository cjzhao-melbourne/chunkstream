{"version":3,"sources":["../entries/all.ts","../src/constants.ts","../src/mp4boxbuffer.ts","../src/DataStream.ts","../src/log.ts","../src/buffer.ts","../src/box.ts","../src/box-diff.ts","../src/registry.ts","../src/parser.ts","../src/containerBox.ts","../src/boxes/sampleentries/base.ts","../src/boxes/displays/parameterSetArray.ts","../src/boxes/avcC.ts","../src/boxes/defaults.ts","../src/boxes/dref.ts","../src/boxes/elng.ts","../src/boxes/ftyp.ts","../src/boxes/hdlr.ts","../src/boxes/hvcC.ts","../src/boxes/mdhd.ts","../src/boxes/mehd.ts","../src/boxes/infe.ts","../src/boxes/iinf.ts","../src/boxes/iloc.ts","../src/boxes/iref.ts","../src/boxes/pitm.ts","../src/boxes/meta.ts","../src/boxes/mfhd.ts","../src/boxes/mvhd.ts","../src/boxes/sampleentries/mett.ts","../src/boxes/sampleentries/metx.ts","../src/boxes/av1C.ts","../src/boxes/esds.ts","../src/boxes/vpcC.ts","../src/boxes/vvcC.ts","../src/boxes/colr.ts","../src/boxes/sampleentries/sampleentry.ts","../src/boxes/sampleentries/sbtt.ts","../src/boxes/sampleentries/stpp.ts","../src/boxes/sampleentries/stxt.ts","../src/boxes/sampleentries/tx3g.ts","../src/boxes/sampleentries/wvtt.ts","../src/boxes/sbgp.ts","../src/boxes/sdtp.ts","../src/boxes/sgpd.ts","../src/boxes/sidx.ts","../src/boxes/smhd.ts","../src/boxes/stco.ts","../src/boxes/sthd.ts","../src/boxes/stsc.ts","../src/boxes/stsd.ts","../src/boxes/stsz.ts","../src/boxes/stts.ts","../src/boxes/tfdt.ts","../src/boxes/tfhd.ts","../src/boxes/tkhd.ts","../src/boxes/trex.ts","../src/boxes/trun.ts","../src/boxes/url.ts","../src/boxes/vmhd.ts","../src/isofile.ts","../src/create-file.ts","../src/descriptor.ts","../src/text-mp4.ts","../entries/loaders.ts","../entries/all-boxes.ts","../src/boxes/a1lx.ts","../src/boxes/a1op.ts","../src/boxes/auxC.ts","../src/boxes/btrt.ts","../src/boxes/ccst.ts","../src/boxes/cdef.ts","../src/boxes/clap.ts","../src/boxes/clli.ts","../src/boxes/cmex.ts","../src/boxes/cmin.ts","../src/boxes/cmpd.ts","../src/boxes/co64.ts","../src/boxes/CoLL.ts","../src/boxes/covi.ts","../src/boxes/cprt.ts","../src/boxes/csch.ts","../src/boxes/cslg.ts","../src/boxes/ctts.ts","../src/boxes/dac3.ts","../src/boxes/dec3.ts","../src/boxes/dfLa.ts","../src/boxes/dimm.ts","../src/boxes/dmax.ts","../src/boxes/dmed.ts","../src/boxes/dOps.ts","../src/boxes/drep.ts","../src/boxes/elst.ts","../src/boxes/emsg.ts","../src/boxes/EntityToGroup/base.ts","../src/boxes/EntityToGroup/index.ts","../src/boxes/fiel.ts","../src/boxes/frma.ts","../src/boxes/imir.ts","../src/boxes/ipma.ts","../src/boxes/irot.ts","../src/boxes/ispe.ts","../src/boxes/itai.ts","../src/boxes/kind.ts","../src/boxes/leva.ts","../src/boxes/lhvC.ts","../src/boxes/lsel.ts","../src/boxes/maxr.ts","../src/boxes/displays/colorPoint.ts","../src/boxes/mdcv.ts","../src/boxes/mfro.ts","../src/boxes/mskC.ts","../src/boxes/npck.ts","../src/boxes/nump.ts","../src/boxes/padb.ts","../src/boxes/pasp.ts","../src/boxes/payl.ts","../src/boxes/payt.ts","../src/boxes/pdin.ts","../src/boxes/pixi.ts","../src/boxes/pmax.ts","../src/boxes/prdi.ts","../src/boxes/prfr.ts","../src/boxes/prft.ts","../src/boxes/pssh.ts","../src/boxes/qt/clef.ts","../src/boxes/qt/data.ts","../src/boxes/qt/enof.ts","../src/boxes/qt/ilst.ts","../src/boxes/qt/keys.ts","../src/boxes/qt/prof.ts","../src/boxes/qt/tapt.ts","../src/boxes/qt/wave.ts","../src/boxes/rtp.ts","../src/boxes/saio.ts","../src/boxes/saiz.ts","../src/boxes/displays/pixel.ts","../src/boxes/sbpm.ts","../src/boxes/schm.ts","../src/boxes/sdp.ts","../src/boxes/senc.ts","../src/boxes/SmDm.ts","../src/boxes/srat.ts","../src/boxes/ssix.ts","../src/boxes/stdp.ts","../src/boxes/stri.ts","../src/boxes/stsg.ts","../src/boxes/stsh.ts","../src/boxes/stss.ts","../src/boxes/stvi.ts","../src/boxes/styp.ts","../src/boxes/stz2.ts","../src/boxes/subs.ts","../src/boxes/taic.ts","../src/boxes/tenc.ts","../src/boxes/tfra.ts","../src/boxes/tmax.ts","../src/boxes/tmin.ts","../src/boxes/totl.ts","../src/boxes/tpay.ts","../src/boxes/tpyl.ts","../src/boxes/trackgroups/msrc.ts","../src/boxes/tref.ts","../src/boxes/trep.ts","../src/boxes/trpy.ts","../src/boxes/tsel.ts","../src/boxes/txtC.ts","../src/boxes/tyco.ts","../src/boxes/udes.ts","../src/boxes/uncC.ts","../src/boxes/urn.ts","../src/boxes/vttC.ts","../src/boxes/vvnC.ts","../src/boxes/samplegroups/alst.ts","../src/boxes/samplegroups/avll.ts","../src/boxes/samplegroups/avss.ts","../src/boxes/samplegroups/dtrt.ts","../src/boxes/samplegroups/mvif.ts","../src/boxes/samplegroups/prol.ts","../src/boxes/samplegroups/rap.ts","../src/boxes/samplegroups/rash.ts","../src/boxes/samplegroups/roll.ts","../src/boxes/samplegroups/scif.ts","../src/boxes/samplegroups/scnm.ts","../src/boxes/samplegroups/seig.ts","../src/boxes/samplegroups/stsa.ts","../src/boxes/samplegroups/sync.ts","../src/boxes/samplegroups/tele.ts","../src/boxes/samplegroups/tsas.ts","../src/boxes/samplegroups/tscl.ts","../src/boxes/samplegroups/vipr.ts","../src/boxes/uuid/index.ts"],"sourcesContent":["export * from '#/box';\nexport * from '#/box-diff';\nexport * from '#/boxes/sampleentries/base';\nexport * from '#/buffer';\nexport * from '#/create-file';\nexport * from '#/DataStream';\nexport * from '#/descriptor';\nexport * from '#/isofile';\nexport * from '#/log';\nexport * from '#/mp4boxbuffer';\nexport * from '#/text-mp4';\nexport * from './loaders';\nexport * from './types';\nimport * as DESCRIPTORS from '#/descriptor';\nimport { registerBoxes, registerDescriptors } from '#/registry';\nimport * as BOXES from './all-boxes';\n\nexport const BoxParser = registerBoxes(BOXES);\n\nregisterDescriptors(DESCRIPTORS);\n","export const MAX_SIZE = Math.pow(2, 32);\nexport const MAX_UINT32 = Math.pow(2, 32) - 1;\n\n// Flags\nexport const TKHD_FLAG_ENABLED = 0x000001;\nexport const TKHD_FLAG_IN_MOVIE = 0x000002;\nexport const TKHD_FLAG_IN_PREVIEW = 0x000004;\n\nexport const TFHD_FLAG_BASE_DATA_OFFSET = 0x01;\nexport const TFHD_FLAG_SAMPLE_DESC = 0x02;\nexport const TFHD_FLAG_SAMPLE_DUR = 0x08;\nexport const TFHD_FLAG_SAMPLE_SIZE = 0x10;\nexport const TFHD_FLAG_SAMPLE_FLAGS = 0x20;\nexport const TFHD_FLAG_DUR_EMPTY = 0x10000;\nexport const TFHD_FLAG_DEFAULT_BASE_IS_MOOF = 0x20000;\n\nexport const TRUN_FLAGS_DATA_OFFSET = 0x01;\nexport const TRUN_FLAGS_FIRST_FLAG = 0x04;\nexport const TRUN_FLAGS_DURATION = 0x100;\nexport const TRUN_FLAGS_SIZE = 0x200;\nexport const TRUN_FLAGS_FLAGS = 0x400;\nexport const TRUN_FLAGS_CTS_OFFSET = 0x800;\n\nexport const ERR_INVALID_DATA = -1;\nexport const ERR_NOT_ENOUGH_DATA = 0;\nexport const OK = 1;\n\n// Constants\nexport const SAMPLE_ENTRY_TYPE_VISUAL = 'Visual';\nexport const SAMPLE_ENTRY_TYPE_AUDIO = 'Audio';\nexport const SAMPLE_ENTRY_TYPE_HINT = 'Hint';\nexport const SAMPLE_ENTRY_TYPE_METADATA = 'Metadata';\nexport const SAMPLE_ENTRY_TYPE_SUBTITLE = 'Subtitle';\nexport const SAMPLE_ENTRY_TYPE_SYSTEM = 'System';\nexport const SAMPLE_ENTRY_TYPE_TEXT = 'Text';\n","export class MP4BoxBuffer extends ArrayBuffer {\n  fileStart: number;\n  usedBytes?: number;\n\n  constructor(byteLength: number) {\n    super(byteLength);\n    this.fileStart = 0;\n    this.usedBytes = 0;\n  }\n\n  static fromArrayBuffer(buffer: ArrayBufferLike, fileStart: number): MP4BoxBuffer {\n    const mp4BoxBuffer = new MP4BoxBuffer(buffer.byteLength);\n    const view = new Uint8Array(mp4BoxBuffer);\n    view.set(new Uint8Array(buffer));\n    mp4BoxBuffer.fileStart = fileStart;\n    return mp4BoxBuffer;\n  }\n}\n","import { MAX_SIZE } from '#/constants';\nimport type {\n  Charset,\n  ParsedType,\n  StructDataFromStructDefinition,\n  StructDefinition,\n  TupleType,\n  Type,\n  TypedArray,\n  ValueFromType,\n} from '@types';\nimport { MP4BoxBuffer } from '#/mp4boxbuffer';\nimport type { ISOFile } from './isofile';\n\ntype ReadTypeReturnValue =\n  | string\n  | number\n  | Uint8Array\n  | Uint16Array\n  | Uint32Array\n  | Int8Array\n  | Int16Array\n  | Int32Array\n  | Float32Array\n  | Float64Array\n  | Array<ReadTypeReturnValue>\n  | {\n      [key: string]: ReadTypeReturnValue;\n    };\n\nexport enum Endianness {\n  BIG_ENDIAN = 1,\n  LITTLE_ENDIAN,\n}\n\n// TODO: fix endianness for 24/64-bit fields\n// TODO: check range/support for 64-bits numbers in JavaScript\n\nexport class DataStream {\n  static ENDIANNESS: Endianness =\n    new Int8Array(new Int16Array([1]).buffer)[0] > 0\n      ? Endianness.LITTLE_ENDIAN\n      : Endianness.BIG_ENDIAN;\n\n  isofile?: ISOFile; // Reference to the ISOFile object if any\n\n  _buffer?: MP4BoxBuffer;\n  _byteOffset?: number;\n  _dataView?: DataView<ArrayBuffer>;\n\n  endianness: Endianness;\n  protected position: number;\n\n  /**\n   * DataStream reads scalars, arrays and structs of data from an ArrayBuffer.\n   * It's like a file-like DataView on steroids.\n   *\n   * @param arrayBuffer ArrayBuffer to read from.\n   * @param byteOffset Offset from arrayBuffer beginning for the DataStream.\n   * @param endianness Endianness of the DataStream (default: BIG_ENDIAN).\n   */\n  constructor(\n    arrayBuffer?: ArrayBuffer | DataView<ArrayBuffer> | number,\n    byteOffset?: number,\n    endianness?: Endianness,\n  ) {\n    this._byteOffset = byteOffset || 0;\n    if (arrayBuffer instanceof ArrayBuffer) {\n      this.buffer = MP4BoxBuffer.fromArrayBuffer(arrayBuffer, 0);\n    } else if (arrayBuffer instanceof DataView) {\n      this.dataView = arrayBuffer;\n      if (byteOffset) this._byteOffset += byteOffset;\n    } else {\n      this.buffer = new MP4BoxBuffer(arrayBuffer || 0);\n    }\n    this.position = 0;\n    this.endianness = endianness ? endianness : Endianness.BIG_ENDIAN;\n  }\n\n  getPosition() {\n    return this.position;\n  }\n\n  /**\n   * Internal function to resize the DataStream buffer when required.\n   * @param extra Number of bytes to add to the buffer allocation.\n   */\n  _realloc(extra: number) {\n    if (!this._dynamicSize) {\n      return;\n    }\n    const req = this._byteOffset + this.position + extra;\n    let blen = this._buffer.byteLength;\n    if (req <= blen) {\n      if (req > this._byteLength) {\n        this._byteLength = req;\n      }\n      return;\n    }\n    if (blen < 1) {\n      blen = 1;\n    }\n    while (req > blen) {\n      blen *= 2;\n    }\n    const buf = new MP4BoxBuffer(blen);\n    const src = new Uint8Array(this._buffer);\n    const dst = new Uint8Array(buf, 0, src.length);\n    dst.set(src);\n    this.buffer = buf;\n    this._byteLength = req;\n  }\n\n  /**\n   * Internal function to trim the DataStream buffer when required.\n   * Used for stripping out the extra bytes from the backing buffer when\n   * the virtual byteLength is smaller than the buffer byteLength (happens after\n   * growing the buffer with writes and not filling the extra space completely).\n   */\n  _trimAlloc() {\n    if (this._byteLength === this._buffer.byteLength) {\n      return;\n    }\n    const buf = new MP4BoxBuffer(this._byteLength);\n    const dst = new Uint8Array(buf);\n    const src = new Uint8Array(this._buffer, 0, dst.length);\n    dst.set(src);\n    this.buffer = buf;\n  }\n\n  /**\n   * Virtual byte length of the DataStream backing buffer.\n   * Updated to be max of original buffer size and last written size.\n   * If dynamicSize is false is set to buffer size.\n   */\n  _byteLength = 0;\n\n  /**\n   * Returns the byte length of the DataStream object.\n   * @type {number}\n   */\n  get byteLength() {\n    return this._byteLength - this._byteOffset;\n  }\n\n  /**\n   * Set/get the backing ArrayBuffer of the DataStream object.\n   * The setter updates the DataView to point to the new buffer.\n   * @type {Object}\n   */\n\n  get buffer() {\n    this._trimAlloc();\n    return this._buffer;\n  }\n  set buffer(value: MP4BoxBuffer) {\n    this._buffer = value;\n    this._dataView = new DataView(value, this._byteOffset);\n    this._byteLength = value.byteLength;\n  }\n\n  /**\n   * Set/get the byteOffset of the DataStream object.\n   * The setter updates the DataView to point to the new byteOffset.\n   * @type {number}\n   */\n  get byteOffset() {\n    return this._byteOffset;\n  }\n  set byteOffset(value) {\n    this._byteOffset = value;\n    this._dataView = new DataView(this._buffer, this._byteOffset);\n    this._byteLength = this._buffer.byteLength;\n  }\n\n  /**\n   * Set/get the byteOffset of the DataStream object.\n   * The setter updates the DataView to point to the new byteOffset.\n   * @type {number}\n   */\n  get dataView() {\n    return this._dataView;\n  }\n  set dataView(value: DataView<ArrayBuffer>) {\n    this._byteOffset = value.byteOffset;\n    this._buffer = MP4BoxBuffer.fromArrayBuffer(value.buffer, 0);\n    this._dataView = new DataView(this._buffer, this._byteOffset);\n    this._byteLength = this._byteOffset + value.byteLength;\n  }\n\n  /**\n   *   Sets the DataStream read/write position to given position.\n   *   Clamps between 0 and DataStream length.\n   *\n   *   @param pos Position to seek to.\n   *   @return\n   */\n  seek(pos: number) {\n    const npos = Math.max(0, Math.min(this.byteLength, pos));\n    this.position = isNaN(npos) || !isFinite(npos) ? 0 : npos;\n  }\n\n  /**\n   * Returns true if the DataStream seek pointer is at the end of buffer and\n   * there's no more data to read.\n   *\n   * @return True if the seek pointer is at the end of the buffer.\n   */\n  isEof() {\n    return this.position >= this._byteLength;\n  }\n\n  #isTupleType(type: unknown): type is TupleType {\n    return Array.isArray(type) && type.length === 3 && type[0] === '[]';\n  }\n\n  /**\n   * Maps a Uint8Array into the DataStream buffer.\n   *\n   * Nice for quickly reading in data.\n   *\n   * @param length Number of elements to map.\n   * @param e Endianness of the data to read.\n   * @return Uint8Array to the DataStream backing buffer.\n   */\n  mapUint8Array(length: number) {\n    this._realloc(length * 1);\n    const arr = new Uint8Array(this._buffer, this.byteOffset + this.position, length);\n    this.position += length * 1;\n    return arr;\n  }\n\n  /**\n   * Reads an Int32Array of desired length and endianness from the DataStream.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return The read Int32Array.\n   */\n  readInt32Array(length?: number, endianness?: Endianness) {\n    length = length === undefined ? this.byteLength - this.position / 4 : length;\n    const arr = new Int32Array(length);\n    DataStream.memcpy(\n      arr.buffer,\n      0,\n      this.buffer,\n      this.byteOffset + this.position,\n      length * arr.BYTES_PER_ELEMENT,\n    );\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += arr.byteLength;\n    return arr;\n  }\n\n  /**\n   * Reads an Int16Array of desired length and endianness from the DataStream.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return The read Int16Array.\n   */\n  readInt16Array(length?: number, endianness?: Endianness) {\n    length = length === undefined ? this.byteLength - this.position / 2 : length;\n    const arr = new Int16Array(length);\n    DataStream.memcpy(\n      arr.buffer,\n      0,\n      this.buffer,\n      this.byteOffset + this.position,\n      length * arr.BYTES_PER_ELEMENT,\n    );\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += arr.byteLength;\n    return arr;\n  }\n\n  /**\n   * Reads an Int8Array of desired length from the DataStream.\n   *\n   * @param length Number of elements to map.\n   * @param e Endianness of the data to read.\n   * @return The read Int8Array.\n   */\n  readInt8Array(length?: number) {\n    length = length === undefined ? this.byteLength - this.position : length;\n    const arr = new Int8Array(length);\n    DataStream.memcpy(\n      arr.buffer,\n      0,\n      this.buffer,\n      this.byteOffset + this.position,\n      length * arr.BYTES_PER_ELEMENT,\n    );\n    this.position += arr.byteLength;\n    return arr;\n  }\n\n  /**\n   * Reads a Uint32Array of desired length and endianness from the DataStream.\n   *\n   *  @param length Number of elements to map.\n   *  @param endianness Endianness of the data to read.\n   *  @return The read Uint32Array.\n   */\n  readUint32Array(length?: number, endianness?: Endianness) {\n    length = length === undefined ? this.byteLength - this.position / 4 : length;\n    const arr = new Uint32Array(length);\n    DataStream.memcpy(\n      arr.buffer,\n      0,\n      this.buffer,\n      this.byteOffset + this.position,\n      length * arr.BYTES_PER_ELEMENT,\n    );\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += arr.byteLength;\n    return arr;\n  }\n\n  /**\n   * Reads a Uint16Array of desired length and endianness from the DataStream.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return The read Uint16Array.\n   */\n  readUint16Array(length?: number, endianness?: Endianness) {\n    length = length === undefined ? this.byteLength - this.position / 2 : length;\n    const arr = new Uint16Array(length);\n    DataStream.memcpy(\n      arr.buffer,\n      0,\n      this.buffer,\n      this.byteOffset + this.position,\n      length * arr.BYTES_PER_ELEMENT,\n    );\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += arr.byteLength;\n    return arr;\n  }\n\n  /**\n   * Reads a Uint8Array of desired length from the DataStream.\n   *\n   * @param length Number of elements to map.\n   * @param e Endianness of the data to read.\n   * @return The read Uint8Array.\n   */\n  readUint8Array(length?: number) {\n    length = length === undefined ? this.byteLength - this.position : length;\n    const arr = new Uint8Array(length);\n    DataStream.memcpy(\n      arr.buffer,\n      0,\n      this.buffer,\n      this.byteOffset + this.position,\n      length * arr.BYTES_PER_ELEMENT,\n    );\n    this.position += arr.byteLength;\n    return arr;\n  }\n\n  /**\n   * Reads a Float64Array of desired length and endianness from the DataStream.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return The read Float64Array.\n   */\n  readFloat64Array(length?: number, endianness?: Endianness) {\n    length = length === undefined ? this.byteLength - this.position / 8 : length;\n    const arr = new Float64Array(length);\n    DataStream.memcpy(\n      arr.buffer,\n      0,\n      this.buffer,\n      this.byteOffset + this.position,\n      length * arr.BYTES_PER_ELEMENT,\n    );\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += arr.byteLength;\n    return arr;\n  }\n\n  /**\n   * Reads a Float32Array of desired length and endianness from the DataStream.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return The read Float32Array.\n   */\n  readFloat32Array(length?: number, endianness?: Endianness) {\n    length = length === undefined ? this.byteLength - this.position / 4 : length;\n    const arr = new Float32Array(length);\n    DataStream.memcpy(\n      arr.buffer,\n      0,\n      this.buffer,\n      this.byteOffset + this.position,\n      length * arr.BYTES_PER_ELEMENT,\n    );\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += arr.byteLength;\n    return arr;\n  }\n\n  /**\n   * Reads a 32-bit int from the DataStream with the desired endianness.\n   *\n   * @param endianness Endianness of the number.\n   * @return The read number.\n   */\n  readInt32(endianness?: Endianness) {\n    const v = this._dataView.getInt32(\n      this.position,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 4;\n    return v;\n  }\n\n  /**\n   * Reads a 16-bit int from the DataStream with the desired endianness.\n   *\n   * @param endianness Endianness of the number.\n   * @return The read number.\n   */\n  readInt16(endianness?: Endianness) {\n    const v = this._dataView.getInt16(\n      this.position,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 2;\n    return v;\n  }\n\n  /**\n   * Reads an 8-bit int from the DataStream.\n   *\n   * @return The read number.\n   */\n  readInt8() {\n    const v = this._dataView.getInt8(this.position);\n    this.position += 1;\n    return v;\n  }\n\n  /**\n   * Reads a 32-bit unsigned int from the DataStream with the desired endianness.\n   *\n   * @param endianness Endianness of the number.\n   * @return The read number.\n   */\n  readUint32(endianness?: Endianness) {\n    const v = this._dataView.getUint32(\n      this.position,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 4;\n    return v;\n  }\n\n  /**\n   * Reads a 16-bit unsigned int from the DataStream with the desired endianness.\n   *\n   * @param endianness Endianness of the number.\n   * @return The read number.\n   */\n  readUint16(endianness?: Endianness) {\n    const v = this._dataView.getUint16(\n      this.position,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 2;\n    return v;\n  }\n\n  /**\n   * Reads an 8-bit unsigned int from the DataStream.\n   *\n   * @return The read number.\n   */\n  readUint8() {\n    const v = this._dataView.getUint8(this.position);\n    this.position += 1;\n    return v;\n  }\n\n  /**\n   * Reads a 32-bit float from the DataStream with the desired endianness.\n   *\n   * @param endianness Endianness of the number.\n   * @return The read number.\n   */\n  readFloat32(endianness?: Endianness) {\n    const value = this._dataView.getFloat32(\n      this.position,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 4;\n    return value;\n  }\n\n  /**\n   * Reads a 64-bit float from the DataStream with the desired endianness.\n   *\n   * @param endianness Endianness of the number.\n   * @return The read number.\n   */\n  readFloat64(endianness?: Endianness) {\n    const value = this._dataView.getFloat64(\n      this.position,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 8;\n    return value;\n  }\n\n  /**\n   * Copies byteLength bytes from the src buffer at srcOffset to the\n   * dst buffer at dstOffset.\n   *\n   * @param dst Destination ArrayBuffer to write to.\n   * @param dstOffset Offset to the destination ArrayBuffer.\n   * @param src Source ArrayBuffer to read from.\n   * @param srcOffset Offset to the source ArrayBuffer.\n   * @param byteLength Number of bytes to copy.\n   */\n  static memcpy(\n    dst: ArrayBufferLike,\n    dstOffset?: number,\n    src?: ArrayBufferLike,\n    srcOffset?: number,\n    byteLength?: number,\n  ) {\n    const dstU8 = new Uint8Array(dst, dstOffset, byteLength);\n    const srcU8 = new Uint8Array(src, srcOffset, byteLength);\n    dstU8.set(srcU8);\n  }\n\n  /**\n   * Converts array to native endianness in-place.\n   *\n   * @param typedArray Typed array to convert.\n   * @param endianness True if the data in the array is\n   *                                      little-endian. Set false for big-endian.\n   * @return The converted typed array.\n   */\n  static arrayToNative(typedArray: TypedArray, endianness?: Endianness) {\n    if (endianness === DataStream.ENDIANNESS) {\n      return typedArray;\n    } else {\n      return this.flipArrayEndianness(typedArray);\n    }\n  }\n\n  /**\n   * Converts native endianness array to desired endianness in-place.\n   *\n   * @param typedArray Typed array to convert.\n   * @param littleEndian True if the converted array should be\n   *                               little-endian. Set false for big-endian.\n   * @return The converted typed array.\n   */\n  static nativeToEndian(typedArray: TypedArray, littleEndian: boolean) {\n    if (littleEndian && DataStream.ENDIANNESS === Endianness.LITTLE_ENDIAN) {\n      return typedArray;\n    } else {\n      return this.flipArrayEndianness(typedArray);\n    }\n  }\n\n  /**\n   * Flips typed array endianness in-place.\n   *\n   * @param typedArray Typed array to flip.\n   * @return The converted typed array.\n   */\n  static flipArrayEndianness(typedArray: TypedArray) {\n    const u8 = new Uint8Array(typedArray.buffer, typedArray.byteOffset, typedArray.byteLength);\n    for (let i = 0; i < typedArray.byteLength; i += typedArray.BYTES_PER_ELEMENT) {\n      for (let j = i + typedArray.BYTES_PER_ELEMENT - 1, k = i; j > k; j--, k++) {\n        const tmp = u8[k];\n        u8[k] = u8[j];\n        u8[j] = tmp;\n      }\n    }\n    return typedArray;\n  }\n\n  /**\n   * Seek position where DataStream#readStruct ran into a problem.\n   * Useful for debugging struct parsing.\n   *\n   * @type {number}\n   */\n  failurePosition = 0;\n\n  /**\n   * Read a string of desired length and encoding from the DataStream.\n   *\n   * @param length The length of the string to read in bytes.\n   * @param encoding The encoding of the string data in the DataStream.\n   *                           Defaults to ASCII.\n   * @return The read string.\n   */\n  readString(length: number, encoding?: Charset): string {\n    if (encoding === undefined || encoding === 'ASCII') {\n      return fromCharCodeUint8(\n        this.mapUint8Array(length === undefined ? this.byteLength - this.position : length),\n      );\n    } else {\n      return new TextDecoder(encoding).decode(this.mapUint8Array(length));\n    }\n  }\n\n  /**\n   * Read null-terminated string of desired length from the DataStream. Truncates\n   * the returned string so that the null byte is not a part of it.\n   *\n   * @param length The length of the string to read.\n   * @return The read string.\n   */\n  readCString(length?: number): string {\n    let i = 0;\n    const blen = this.byteLength - this.position;\n    const u8 = new Uint8Array(this._buffer, this._byteOffset + this.position);\n    const len = length !== undefined ? Math.min(length, blen) : blen;\n    for (; i < len && u8[i] !== 0; i++); // find first zero byte\n    const s = fromCharCodeUint8(this.mapUint8Array(i));\n    if (length !== undefined) {\n      this.position += len - i;\n    } else if (i !== blen) {\n      this.position += 1; // trailing zero if not at end of buffer\n    }\n    return s;\n  }\n\n  readInt64() {\n    return this.readInt32() * MAX_SIZE + this.readUint32();\n  }\n  readUint64() {\n    return this.readUint32() * MAX_SIZE + this.readUint32();\n  }\n\n  readUint24() {\n    return (this.readUint8() << 16) + (this.readUint8() << 8) + this.readUint8();\n  }\n\n  /**\n   * Saves the DataStream contents to the given filename.\n   * Uses Chrome's anchor download property to initiate download.\n   *\n   * @param filename Filename to save as.\n   * @return\n   * @bundle DataStream-write.js\n   */\n  save(filename: string) {\n    const blob = new Blob([this.buffer]);\n    // Modernized: Works in browser, and is a no-op (or throws) in Vitest/node\n    if (typeof window !== 'undefined' && typeof document !== 'undefined') {\n      if (window.URL && URL.createObjectURL) {\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        document.body.appendChild(a);\n        a.setAttribute('href', url);\n        a.setAttribute('download', filename);\n        a.setAttribute('target', '_self');\n        a.click();\n        window.URL.revokeObjectURL(url);\n        document.body.removeChild(a);\n      } else {\n        throw new Error(\"DataStream.save: Can't create object URL.\");\n      }\n    }\n    return blob;\n  }\n\n  /**\n   * Whether to extend DataStream buffer when trying to write beyond its size.\n   * If set, the buffer is reallocated to twice its current size until the\n   * requested write fits the buffer.\n   *\n   * @type {boolean}\n   * @bundle DataStream-write.js\n   */\n  _dynamicSize = 1;\n\n  /** @bundle DataStream-write.js */\n  get dynamicSize() {\n    return this._dynamicSize;\n  }\n\n  /** @bundle DataStream-write.js */\n  set dynamicSize(v) {\n    if (!v) {\n      this._trimAlloc();\n    }\n    this._dynamicSize = v;\n  }\n\n  /**\n   * Internal function to trim the DataStream buffer when required.\n   * Used for stripping out the first bytes when not needed anymore.\n   *\n   * @return\n   * @bundle DataStream-write.js\n   */\n  shift(offset: number) {\n    const buf = new MP4BoxBuffer(this._byteLength - offset);\n    const dst = new Uint8Array(buf);\n    const src = new Uint8Array(this._buffer, offset, dst.length);\n    dst.set(src);\n    this.buffer = buf;\n    this.position -= offset;\n  }\n\n  /**\n   * Writes an Int32Array of specified endianness to the DataStream.\n   *\n   * @param array The array to write.\n   * @param endianness Endianness of the data to write.\n   * @bundle DataStream-write.js\n   */\n  writeInt32Array(array: ArrayLike<number>, endianness?: Endianness) {\n    this._realloc(array.length * 4);\n    if (\n      array instanceof Int32Array &&\n      this.byteOffset + (this.position % array.BYTES_PER_ELEMENT) === 0\n    ) {\n      DataStream.memcpy(\n        this._buffer,\n        this.byteOffset + this.position,\n        array.buffer,\n        0,\n        array.byteLength,\n      );\n      this.mapInt32Array(array.length, endianness);\n    } else {\n      for (let i = 0; i < array.length; i++) {\n        this.writeInt32(array[i], endianness);\n      }\n    }\n  }\n\n  /**\n   * Writes an Int16Array of specified endianness to the DataStream.\n   *\n   * @param array The array to write.\n   * @param endianness Endianness of the data to write.\n   * @bundle DataStream-write.js\n   */\n  writeInt16Array(array: ArrayLike<number>, endianness?: Endianness) {\n    this._realloc(array.length * 2);\n    if (\n      array instanceof Int16Array &&\n      this.byteOffset + (this.position % array.BYTES_PER_ELEMENT) === 0\n    ) {\n      DataStream.memcpy(\n        this._buffer,\n        this.byteOffset + this.position,\n        array.buffer,\n        0,\n        array.byteLength,\n      );\n      this.mapInt16Array(array.length, endianness);\n    } else {\n      for (let i = 0; i < array.length; i++) {\n        this.writeInt16(array[i], endianness);\n      }\n    }\n  }\n\n  /**\n   * Writes an Int8Array to the DataStream.\n   *\n   * @param array The array to write.\n   * @bundle DataStream-write.js\n   */\n  writeInt8Array(array: ArrayLike<number>) {\n    this._realloc(array.length * 1);\n    if (\n      array instanceof Int8Array &&\n      this.byteOffset + (this.position % array.BYTES_PER_ELEMENT) === 0\n    ) {\n      DataStream.memcpy(\n        this._buffer,\n        this.byteOffset + this.position,\n        array.buffer,\n        0,\n        array.byteLength,\n      );\n      this.mapInt8Array(array.length);\n    } else {\n      for (let i = 0; i < array.length; i++) {\n        this.writeInt8(array[i]);\n      }\n    }\n  }\n\n  /**\n   * Writes a Uint32Array of specified endianness to the DataStream.\n   *\n   * @param array The array to write.\n   * @param endianness Endianness of the data to write.\n   * @bundle DataStream-write.js\n   */\n  writeUint32Array(array: ArrayLike<number>, endianness?: Endianness) {\n    this._realloc(array.length * 4);\n    if (\n      array instanceof Uint32Array &&\n      this.byteOffset + (this.position % array.BYTES_PER_ELEMENT) === 0\n    ) {\n      DataStream.memcpy(\n        this._buffer,\n        this.byteOffset + this.position,\n        array.buffer,\n        0,\n        array.byteLength,\n      );\n      this.mapUint32Array(array.length, endianness);\n    } else {\n      for (let i = 0; i < array.length; i++) {\n        this.writeUint32(array[i], endianness);\n      }\n    }\n  }\n\n  /**\n   * Writes a Uint16Array of specified endianness to the DataStream.\n   *\n   * @param array The array to write.\n   * @param endianness Endianness of the data to write.\n   * @bundle DataStream-write.js\n   */\n  writeUint16Array(array: ArrayLike<number>, endianness?: Endianness) {\n    this._realloc(array.length * 2);\n    if (\n      array instanceof Uint16Array &&\n      this.byteOffset + (this.position % array.BYTES_PER_ELEMENT) === 0\n    ) {\n      DataStream.memcpy(\n        this._buffer,\n        this.byteOffset + this.position,\n        array.buffer,\n        0,\n        array.byteLength,\n      );\n      this.mapUint16Array(array.length, endianness);\n    } else {\n      for (let i = 0; i < array.length; i++) {\n        this.writeUint16(array[i], endianness);\n      }\n    }\n  }\n\n  /**\n   * Writes a Uint8Array to the DataStream.\n   *\n   * @param array The array to write.\n   * @bundle DataStream-write.js\n   */\n  writeUint8Array(array: ArrayLike<number>) {\n    this._realloc(array.length * 1);\n    if (\n      array instanceof Uint8Array &&\n      this.byteOffset + (this.position % array.BYTES_PER_ELEMENT) === 0\n    ) {\n      DataStream.memcpy(\n        this._buffer,\n        this.byteOffset + this.position,\n        array.buffer,\n        0,\n        array.byteLength,\n      );\n      this.mapUint8Array(array.length);\n    } else {\n      for (let i = 0; i < array.length; i++) {\n        this.writeUint8(array[i]);\n      }\n    }\n  }\n\n  /**\n   * Writes a Float64Array of specified endianness to the DataStream.\n   *\n   * @param array The array to write.\n   * @param endianness Endianness of the data to write.\n   * @bundle DataStream-write.js\n   */\n  writeFloat64Array(array: ArrayLike<number>, endianness?: Endianness) {\n    this._realloc(array.length * 8);\n    if (\n      array instanceof Float64Array &&\n      this.byteOffset + (this.position % array.BYTES_PER_ELEMENT) === 0\n    ) {\n      DataStream.memcpy(\n        this._buffer,\n        this.byteOffset + this.position,\n        array.buffer,\n        0,\n        array.byteLength,\n      );\n      this.mapFloat64Array(array.length, endianness);\n    } else {\n      for (let i = 0; i < array.length; i++) {\n        this.writeFloat64(array[i], endianness);\n      }\n    }\n  }\n\n  /**\n   * Writes a Float32Array of specified endianness to the DataStream.\n   *\n   * @param array The array to write.\n   * @param endianness Endianness of the data to write.\n   * @bundle DataStream-write.js\n   */\n  writeFloat32Array(array: ArrayLike<number>, endianness?: Endianness) {\n    this._realloc(array.length * 4);\n    if (\n      array instanceof Float32Array &&\n      this.byteOffset + (this.position % array.BYTES_PER_ELEMENT) === 0\n    ) {\n      DataStream.memcpy(\n        this._buffer,\n        this.byteOffset + this.position,\n        array.buffer,\n        0,\n        array.byteLength,\n      );\n      this.mapFloat32Array(array.length, endianness);\n    } else {\n      for (let i = 0; i < array.length; i++) {\n        this.writeFloat32(array[i], endianness);\n      }\n    }\n  }\n\n  /**\n   * Writes a 64-bit int to the DataStream with the desired endianness.\n   *\n   * @param value Number to write.\n   * @param endianness Endianness of the number.\n   * @bundle DataStream-write.js\n   */\n  writeInt64(value: number, endianness?: Endianness) {\n    this._realloc(8);\n    this._dataView.setBigInt64(\n      this.position,\n      BigInt(value),\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 8;\n  }\n\n  /**\n   * Writes a 32-bit int to the DataStream with the desired endianness.\n   *\n   * @param value Number to write.\n   * @param endianness Endianness of the number.\n   * @bundle DataStream-write.js\n   */\n  writeInt32(value: number, endianness?: Endianness) {\n    this._realloc(4);\n    this._dataView.setInt32(\n      this.position,\n      value,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 4;\n  }\n\n  /**\n   * Writes a 16-bit int to the DataStream with the desired endianness.\n   *\n   * @param value Number to write.\n   * @param endianness Endianness of the number.\n   * @bundle DataStream-write.js\n   */\n  writeInt16(value: number, endianness?: Endianness) {\n    this._realloc(2);\n    this._dataView.setInt16(\n      this.position,\n      value,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 2;\n  }\n\n  /**\n   * Writes an 8-bit int to the DataStream.\n   *\n   * @param value Number to write.\n   * @bundle DataStream-write.js\n   */\n  writeInt8(value: number) {\n    this._realloc(1);\n    this._dataView.setInt8(this.position, value);\n    this.position += 1;\n  }\n\n  /**\n   * Writes a 32-bit unsigned int to the DataStream with the desired endianness.\n   *\n   * @param value Number to write.\n   * @param endianness Endianness of the number.\n   * @bundle DataStream-write.js\n   */\n  writeUint32(value: number, endianness?: Endianness) {\n    this._realloc(4);\n    this._dataView.setUint32(\n      this.position,\n      value,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 4;\n  }\n\n  /**\n   * Writes a 16-bit unsigned int to the DataStream with the desired endianness.\n   *\n   * @param value Number to write.\n   * @param endianness Endianness of the number.\n   * @bundle DataStream-write.js\n   */\n  writeUint16(value: number, endianness?: Endianness) {\n    this._realloc(2);\n    this._dataView.setUint16(\n      this.position,\n      value,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 2;\n  }\n\n  /**\n   * Writes an 8-bit unsigned  int to the DataStream.\n   *\n   * @param value Number to write.\n   * @bundle DataStream-write.js\n   */\n  writeUint8(value: number) {\n    this._realloc(1);\n    this._dataView.setUint8(this.position, value);\n    this.position += 1;\n  }\n\n  /**\n   * Writes a 32-bit float to the DataStream with the desired endianness.\n   *\n   * @param value Number to write.\n   * @param endianness Endianness of the number.\n   * @bundle DataStream-write.js\n   */\n  writeFloat32(value: number, endianness?: Endianness) {\n    this._realloc(4);\n    this._dataView.setFloat32(\n      this.position,\n      value,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 4;\n  }\n\n  /**\n   * Writes a 64-bit float to the DataStream with the desired endianness.\n   *\n   * @param value Number to write.\n   * @param endianness Endianness of the number.\n   * @bundle DataStream-write.js\n   */\n  writeFloat64(value: number, endianness?: Endianness) {\n    this._realloc(8);\n    this._dataView.setFloat64(\n      this.position,\n      value,\n      (endianness ?? this.endianness) === Endianness.LITTLE_ENDIAN,\n    );\n    this.position += 8;\n  }\n\n  /**\n   * Write a UCS-2 string of desired endianness to the DataStream. The\n   * lengthOverride argument lets you define the number of characters to write.\n   * If the string is shorter than lengthOverride, the extra space is padded with\n   * zeroes.\n   *\n   * @param value The string to write.\n   * @param endianness The endianness to use for the written string data.\n   * @param lengthOverride The number of characters to write.\n   * @bundle DataStream-write.js\n   */\n  writeUCS2String(value: string, endianness: Endianness, lengthOverride?: number) {\n    if (lengthOverride === undefined) {\n      lengthOverride = value.length;\n    }\n    let i: number;\n    for (i = 0; i < value.length && i < lengthOverride; i++) {\n      this.writeUint16(value.charCodeAt(i), endianness);\n    }\n    for (; i < lengthOverride; i++) {\n      this.writeUint16(0);\n    }\n  }\n\n  /**\n   * Writes a string of desired length and encoding to the DataStream.\n   *\n   * @param value The string to write.\n   * @param encoding The encoding for the written string data.\n   *                           Defaults to ASCII.\n   * @param length The number of characters to write.\n   * @bundle DataStream-write.js\n   */\n  writeString(value: string, encoding?: string, length?: number) {\n    let i = 0;\n    if (encoding === undefined || encoding === 'ASCII') {\n      if (length !== undefined) {\n        const len = Math.min(value.length, length);\n        for (i = 0; i < len; i++) {\n          this.writeUint8(value.charCodeAt(i));\n        }\n        for (; i < length; i++) {\n          this.writeUint8(0);\n        }\n      } else {\n        for (i = 0; i < value.length; i++) {\n          this.writeUint8(value.charCodeAt(i));\n        }\n      }\n    } else {\n      // @ts-expect-error FIXME: TextEncoder does not expect an encoding-parameter\n      this.writeUint8Array(new TextEncoder(encoding).encode(value.substring(0, length)));\n    }\n  }\n\n  /**\n   * Writes a null-terminated string to DataStream and zero-pads it to length\n   * bytes. If length is not given, writes the string followed by a zero.\n   * If string is longer than length, the written part of the string does not have\n   * a trailing zero.\n   *\n   * @param value The string to write.\n   * @param length The number of characters to write.\n   * @bundle DataStream-write.js\n   */\n  writeCString(value: string, length?: number) {\n    let i = 0;\n    if (length !== undefined) {\n      const len = Math.min(value.length, length);\n      for (i = 0; i < len; i++) {\n        this.writeUint8(value.charCodeAt(i));\n      }\n      for (; i < length; i++) {\n        this.writeUint8(0);\n      }\n    } else {\n      for (i = 0; i < value.length; i++) {\n        this.writeUint8(value.charCodeAt(i));\n      }\n      this.writeUint8(0);\n    }\n  }\n\n  /**\n   * Writes a struct to the DataStream. Takes a structDefinition that gives the\n   * types and a struct object that gives the values. Refer to readStruct for the\n   * structure of structDefinition.\n   *\n   * @param structDefinition Type definition of the struct.\n   * @param struct The struct data object.\n   * @bundle DataStream-write.js\n   */\n  writeStruct<const T extends StructDefinition>(\n    structDefinition: T,\n    struct: StructDataFromStructDefinition<T>,\n  ) {\n    for (let i = 0; i < structDefinition.length; i++) {\n      const [structName, structType] = structDefinition[i];\n      const structValue = struct[structName];\n      this.writeType(structType, structValue, struct);\n    }\n  }\n\n  /**\n   * Writes object v of type t to the DataStream.\n   *\n   * @param type Type of data to write.\n   * @param value Value of data to write.\n   * @param struct Struct to pass to write callback functions.\n   * @bundle DataStream-write.js\n   */\n  writeType<const T extends Type>(type: T, value: ValueFromType<T>, struct?: Record<string, Type>) {\n    if (typeof type === 'function') {\n      return type(this, value);\n    } else if (typeof type === 'object' && !(type instanceof Array)) {\n      return type.set(this, value, struct);\n    }\n\n    let lengthOverride: number;\n    let charset: Charset = 'ASCII';\n    const pos = this.position;\n\n    let parsedType = type as ParsedType;\n\n    if (typeof type === 'string' && /:/.test(type)) {\n      const tp = type.split(':');\n      parsedType = tp[0] as `cstring` | `string`;\n      lengthOverride = parseInt(tp[1]);\n    }\n    if (typeof parsedType === 'string' && /,/.test(parsedType)) {\n      const tp = parsedType.split(',');\n      parsedType = tp[0] as `cstring` | `string`;\n      // NOTE: this said `charset = parseInt(tp[1])` before;\n      charset = tp[1] as Charset;\n    }\n\n    switch (parsedType) {\n      case 'uint8':\n        this.writeUint8(value);\n        break;\n      case 'int8':\n        this.writeInt8(value);\n        break;\n      case 'uint16':\n        this.writeUint16(value, this.endianness);\n        break;\n      case 'int16':\n        this.writeInt16(value, this.endianness);\n        break;\n      case 'uint32':\n        this.writeUint32(value, this.endianness);\n        break;\n      case 'int32':\n        this.writeInt32(value, this.endianness);\n        break;\n      case 'float32':\n        this.writeFloat32(value, this.endianness);\n        break;\n      case 'float64':\n        this.writeFloat64(value, this.endianness);\n        break;\n      case 'uint16be':\n        this.writeUint16(value, Endianness.BIG_ENDIAN);\n        break;\n      case 'int16be':\n        this.writeInt16(value, Endianness.BIG_ENDIAN);\n        break;\n      case 'uint32be':\n        this.writeUint32(value, Endianness.BIG_ENDIAN);\n        break;\n      case 'int32be':\n        this.writeInt32(value, Endianness.BIG_ENDIAN);\n        break;\n      case 'float32be':\n        this.writeFloat32(value, Endianness.BIG_ENDIAN);\n        break;\n      case 'float64be':\n        this.writeFloat64(value, Endianness.BIG_ENDIAN);\n        break;\n      case 'uint16le':\n        this.writeUint16(value, Endianness.LITTLE_ENDIAN);\n        break;\n      case 'int16le':\n        this.writeInt16(value, Endianness.LITTLE_ENDIAN);\n        break;\n      case 'uint32le':\n        this.writeUint32(value, Endianness.LITTLE_ENDIAN);\n        break;\n      case 'int32le':\n        this.writeInt32(value, Endianness.LITTLE_ENDIAN);\n        break;\n      case 'float32le':\n        this.writeFloat32(value, Endianness.LITTLE_ENDIAN);\n        break;\n      case 'float64le':\n        this.writeFloat64(value, Endianness.LITTLE_ENDIAN);\n        break;\n      case 'cstring':\n        this.writeCString(value, lengthOverride);\n        break;\n      case 'string':\n        this.writeString(value, charset, lengthOverride);\n        break;\n      case 'u16string':\n        this.writeUCS2String(value, this.endianness, lengthOverride);\n        break;\n      case 'u16stringle':\n        this.writeUCS2String(value, Endianness.LITTLE_ENDIAN, lengthOverride);\n        break;\n      case 'u16stringbe':\n        this.writeUCS2String(value, Endianness.BIG_ENDIAN, lengthOverride);\n        break;\n      default:\n        if (this.#isTupleType(parsedType)) {\n          const [, ta] = parsedType;\n          for (let i = 0; i < value.length; i++) {\n            this.writeType(ta, value[i]);\n          }\n          break;\n        } else {\n          this.writeStruct(parsedType, value);\n          break;\n        }\n    }\n    if (lengthOverride) {\n      this.position = pos;\n      this._realloc(lengthOverride);\n      this.position = pos + lengthOverride;\n    }\n  }\n\n  /** @bundle DataStream-write.js */\n  writeUint64(value: number) {\n    const h = Math.floor(value / MAX_SIZE);\n    this.writeUint32(h);\n    this.writeUint32(value & 0xffffffff);\n  }\n\n  /** @bundle DataStream-write.js */\n  writeUint24(value: number) {\n    this.writeUint8((value & 0x00ff0000) >> 16);\n    this.writeUint8((value & 0x0000ff00) >> 8);\n    this.writeUint8(value & 0x000000ff);\n  }\n\n  /** @bundle DataStream-write.js */\n  adjustUint32(position: number, value: number) {\n    const pos = this.position;\n    this.seek(position);\n    this.writeUint32(value);\n    this.seek(pos);\n  }\n\n  /**\n   * Reads a struct of data from the DataStream. The struct is defined as\n   * an array of [name, type]-pairs. See the example below:\n   *\n   * ```ts\n   * ds.readStruct([\n   *   ['headerTag', 'uint32'], // Uint32 in DataStream endianness.\n   *   ['headerTag2', 'uint32be'], // Big-endian Uint32.\n   *   ['headerTag3', 'uint32le'], // Little-endian Uint32.\n   *   ['array', ['[]', 'uint32', 16]], // Uint32Array of length 16.\n   *   ['array2', ['[]', 'uint32', 'array2Length']] // Uint32Array of length array2Length\n   * ]);\n   * ```\n   *\n   * The possible values for the type are as follows:\n   *\n   * ## Number types\n   *\n   * Unsuffixed number types use DataStream endianness.\n   * To explicitly specify endianness, suffix the type with\n   * 'le' for little-endian or 'be' for big-endian,\n   * e.g. 'int32be' for big-endian int32.\n   *\n   * - `uint8` -- 8-bit unsigned int\n   * - `uint16` -- 16-bit unsigned int\n   * - `uint32` -- 32-bit unsigned int\n   * - `int8` -- 8-bit int\n   * - `int16` -- 16-bit int\n   * - `int32` -- 32-bit int\n   * - `float32` -- 32-bit float\n   * - `float64` -- 64-bit float\n   *\n   * ## String types\n   *\n   * - `cstring` -- ASCII string terminated by a zero byte.\n   * - `string:N` -- ASCII string of length N.\n   * - `string,CHARSET:N` -- String of byteLength N encoded with given CHARSET.\n   * - `u16string:N` -- UCS-2 string of length N in DataStream endianness.\n   * - `u16stringle:N` -- UCS-2 string of length N in little-endian.\n   * - `u16stringbe:N` -- UCS-2 string of length N in big-endian.\n   *\n   * ## Complex types\n   *\n   * ### Struct\n   * ```ts\n   * [[name, type], [name_2, type_2], ..., [name_N, type_N]]\n   * ```\n   *\n   * ### Callback function to read and return data\n   * ```ts\n   * function(dataStream, struct) {}\n   * ```\n   *\n   * ###  Getter/setter functions\n   * to read and return data, handy for using the same struct definition\n   * for reading and writing structs.\n   * ```ts\n   * {\n   *    get: function(dataStream, struct) {},\n   *    set: function(dataStream, struct) {}\n   * }\n   * ```\n   *\n   * ### Array\n   * Array of given type and length. The length can be either\n   * - a number\n   * - a string that references a previously-read field\n   * - `*`\n   * - a callback: `function(struct, dataStream, type){}`\n   *\n   * If length is `*`, reads in as many elements as it can.\n   * ```ts\n   * ['[]', type, length]\n   * ```\n   *\n   * @param structDefinition Struct definition object.\n   * @return The read struct. Null if failed to read struct.\n   * @bundle DataStream-read-struct.js\n   */\n  readStruct<T extends StructDefinition>(structDefinition: T) {\n    const struct = {} as StructDataFromStructDefinition<T>;\n    const p = this.position;\n    for (let i = 0; i < structDefinition.length; i += 1) {\n      const t = structDefinition[i][1];\n      const v = this.readType(t, struct);\n      if (!v) {\n        if (this.failurePosition === 0) {\n          this.failurePosition = this.position;\n        }\n        this.position = p;\n        return;\n      }\n      struct[structDefinition[i][0]] = v;\n    }\n    return struct;\n  }\n\n  /**\n   * Read UCS-2 string of desired length and endianness from the DataStream.\n   *\n   * @param length The length of the string to read.\n   * @param endianness The endianness of the string data in the DataStream.\n   * @return The read string.\n   * @bundle DataStream-read-struct.js\n   */\n  readUCS2String(length?: number, endianness?: Endianness): string {\n    return String.fromCharCode.apply(undefined, this.readUint16Array(length, endianness));\n  }\n\n  /**\n   * Reads an object of type t from the DataStream, passing struct as the thus-far\n   * read struct to possible callbacks that refer to it. Used by readStruct for\n   * reading in the values, so the type is one of the readStruct types.\n   *\n   * @param type Type of the object to read.\n   * @param struct Struct to refer to when resolving length references\n   *                         and for calling callbacks.\n   * @return  Returns the object on successful read, null on unsuccessful.\n   * @bundle DataStream-read-struct.js\n   */\n  readType<const T extends Type>(type: T, struct: Record<string, Type>): ReadTypeReturnValue {\n    if (typeof type === 'function') {\n      return type(this, struct);\n    }\n    if (typeof type === 'object' && !(type instanceof Array)) {\n      return type.get(this, struct);\n    }\n    if (type instanceof Array && type.length !== 3) {\n      // NOTE: this said `return this.readStruct(type, struct);` before\n      return this.readStruct(type);\n    }\n\n    let value: ReadTypeReturnValue;\n    let lengthOverride: number;\n    let charset: Charset = 'ASCII';\n    const pos = this.position;\n\n    let parsedType = type as ParsedType;\n    if (typeof parsedType === 'string' && /:/.test(parsedType)) {\n      const tp = parsedType.split(':');\n      parsedType = tp[0] as ParsedType;\n      lengthOverride = parseInt(tp[1]);\n    }\n    if (typeof parsedType === 'string' && /,/.test(parsedType)) {\n      const tp = parsedType.split(',');\n      parsedType = tp[0] as ParsedType;\n      // NOTE: this was `charset = parseInt(tp[1]);` before\n      charset = tp[1] as Charset;\n    }\n\n    switch (parsedType) {\n      case 'uint8':\n        value = this.readUint8();\n        break;\n      case 'int8':\n        value = this.readInt8();\n        break;\n      case 'uint16':\n        value = this.readUint16(this.endianness);\n        break;\n      case 'int16':\n        value = this.readInt16(this.endianness);\n        break;\n      case 'uint32':\n        value = this.readUint32(this.endianness);\n        break;\n      case 'int32':\n        value = this.readInt32(this.endianness);\n        break;\n      case 'float32':\n        value = this.readFloat32(this.endianness);\n        break;\n      case 'float64':\n        value = this.readFloat64(this.endianness);\n        break;\n      case 'uint16be':\n        value = this.readUint16(Endianness.BIG_ENDIAN);\n        break;\n      case 'int16be':\n        value = this.readInt16(Endianness.BIG_ENDIAN);\n        break;\n      case 'uint32be':\n        value = this.readUint32(Endianness.BIG_ENDIAN);\n        break;\n      case 'int32be':\n        value = this.readInt32(Endianness.BIG_ENDIAN);\n        break;\n      case 'float32be':\n        value = this.readFloat32(Endianness.BIG_ENDIAN);\n        break;\n      case 'float64be':\n        value = this.readFloat64(Endianness.BIG_ENDIAN);\n        break;\n      case 'uint16le':\n        value = this.readUint16(Endianness.LITTLE_ENDIAN);\n        break;\n      case 'int16le':\n        value = this.readInt16(Endianness.LITTLE_ENDIAN);\n        break;\n      case 'uint32le':\n        value = this.readUint32(Endianness.LITTLE_ENDIAN);\n        break;\n      case 'int32le':\n        value = this.readInt32(Endianness.LITTLE_ENDIAN);\n        break;\n      case 'float32le':\n        value = this.readFloat32(Endianness.LITTLE_ENDIAN);\n        break;\n      case 'float64le':\n        value = this.readFloat64(Endianness.LITTLE_ENDIAN);\n        break;\n      case 'cstring':\n        value = this.readCString(lengthOverride);\n        break;\n      case 'string':\n        value = this.readString(lengthOverride, charset);\n        break;\n      case 'u16string':\n        value = this.readUCS2String(lengthOverride, this.endianness);\n        break;\n      case 'u16stringle':\n        value = this.readUCS2String(lengthOverride, Endianness.LITTLE_ENDIAN);\n        break;\n      case 'u16stringbe':\n        value = this.readUCS2String(lengthOverride, Endianness.BIG_ENDIAN);\n        break;\n      default:\n        if (this.#isTupleType(parsedType)) {\n          const [, ta, len] = parsedType;\n          const length =\n            typeof len === 'function'\n              ? len(struct, this, parsedType)\n              : typeof len === 'string' && struct[len] !== undefined\n                ? // @ts-expect-error   FIXME: Struct[string] is currently of type Type\n                  parseInt(struct[len])\n                : typeof len === 'number'\n                  ? len\n                  : len === '*'\n                    ? undefined\n                    : parseInt(len);\n          if (typeof ta === 'string') {\n            const tap = ta.replace(/(le|be)$/, '');\n            let endianness: Endianness;\n            if (/le$/.test(ta)) {\n              endianness = Endianness.LITTLE_ENDIAN;\n            } else if (/be$/.test(ta)) {\n              endianness = Endianness.BIG_ENDIAN;\n            }\n            switch (tap) {\n              case 'uint8':\n                value = this.readUint8Array(length);\n                break;\n              case 'uint16':\n                value = this.readUint16Array(length, endianness);\n                break;\n              case 'uint32':\n                value = this.readUint32Array(length, endianness);\n                break;\n              case 'int8':\n                value = this.readInt8Array(length);\n                break;\n              case 'int16':\n                value = this.readInt16Array(length, endianness);\n                break;\n              case 'int32':\n                value = this.readInt32Array(length, endianness);\n                break;\n              case 'float32':\n                value = this.readFloat32Array(length, endianness);\n                break;\n              case 'float64':\n                value = this.readFloat64Array(length, endianness);\n                break;\n              case 'cstring':\n              case 'utf16string':\n              case 'string':\n                if (!length) {\n                  value = [];\n                  while (!this.isEof()) {\n                    const u = this.readType(ta, struct);\n                    if (!u) break;\n                    value.push(u);\n                  }\n                } else {\n                  value = new Array(length);\n                  for (let i = 0; i < length; i++) {\n                    value[i] = this.readType(ta, struct);\n                  }\n                }\n                break;\n            }\n          } else {\n            if (!length) {\n              value = [];\n              while (true) {\n                const pos = this.position;\n                try {\n                  const type = this.readType(ta, struct);\n                  if (!type) {\n                    this.position = pos;\n                    break;\n                  }\n                  value.push(type);\n                } catch {\n                  this.position = pos;\n                  break;\n                }\n              }\n            } else {\n              value = new Array(length);\n              for (let i = 0; i < length; i++) {\n                const type = this.readType(ta, struct);\n                if (!type) return;\n                value[i] = type;\n              }\n            }\n          }\n          break;\n        }\n    }\n    if (lengthOverride) {\n      this.position = pos + lengthOverride;\n    }\n\n    return value;\n  }\n\n  /**\n   * Maps an Int32Array into the DataStream buffer, swizzling it to native\n   * endianness in-place. The current offset from the start of the buffer needs to\n   * be a multiple of element size, just like with typed array views.\n   *\n   * Nice for quickly reading in data. Warning: potentially modifies the buffer\n   * contents.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return Int32Array to the DataStream backing buffer.\n   * @bundle DataStream-map.js\n   */\n  mapInt32Array(length: number, endianness?: Endianness) {\n    this._realloc(length * 4);\n    const arr = new Int32Array(this._buffer, this.byteOffset + this.position, length);\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += length * 4;\n    return arr;\n  }\n\n  /**\n   * Maps an Int16Array into the DataStream buffer, swizzling it to native\n   * endianness in-place. The current offset from the start of the buffer needs to\n   * be a multiple of element size, just like with typed array views.\n   *\n   * Nice for quickly reading in data. Warning: potentially modifies the buffer\n   * contents.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return Int16Array to the DataStream backing buffer.\n   * @bundle DataStream-map.js\n   */\n  mapInt16Array(length: number, endianness: Endianness) {\n    this._realloc(length * 2);\n    const arr = new Int16Array(this._buffer, this.byteOffset + this.position, length);\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += length * 2;\n    return arr;\n  }\n\n  /**\n   * Maps an Int8Array into the DataStream buffer.\n   *\n   * Nice for quickly reading in data.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return Int8Array to the DataStream backing buffer.\n   * @bundle DataStream-map.js\n   */\n  mapInt8Array(length: number, _endianness?: Endianness) {\n    this._realloc(length * 1);\n    const arr = new Int8Array(this._buffer, this.byteOffset + this.position, length);\n    this.position += length * 1;\n    return arr;\n  }\n\n  /**\n   * Maps a Uint32Array into the DataStream buffer, swizzling it to native\n   * endianness in-place. The current offset from the start of the buffer needs to\n   * be a multiple of element size, just like with typed array views.\n   *\n   * Nice for quickly reading in data. Warning: potentially modifies the buffer\n   * contents.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return Uint32Array to the DataStream backing buffer.\n   * @bundle DataStream-map.js\n   */\n  mapUint32Array(length: number, endianness?: Endianness) {\n    this._realloc(length * 4);\n    const arr = new Uint32Array(this._buffer, this.byteOffset + this.position, length);\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += length * 4;\n    return arr;\n  }\n\n  /**\n   * Maps a Uint16Array into the DataStream buffer, swizzling it to native\n   * endianness in-place. The current offset from the start of the buffer needs to\n   * be a multiple of element size, just like with typed array views.\n   *\n   * Nice for quickly reading in data. Warning: potentially modifies the buffer\n   * contents.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return Uint16Array to the DataStream backing buffer.\n   * @bundle DataStream-map.js\n   */\n  mapUint16Array(length: number, endianness?: Endianness) {\n    this._realloc(length * 2);\n    const arr = new Uint16Array(this._buffer, this.byteOffset + this.position, length);\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += length * 2;\n    return arr;\n  }\n\n  /**\n   * Maps a Float64Array into the DataStream buffer, swizzling it to native\n   * endianness in-place. The current offset from the start of the buffer needs to\n   * be a multiple of element size, just like with typed array views.\n   *\n   * Nice for quickly reading in data. Warning: potentially modifies the buffer\n   * contents.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return Float64Array to the DataStream backing buffer.\n   * @bundle DataStream-map.js\n   */\n  mapFloat64Array(length: number, endianness?: Endianness) {\n    this._realloc(length * 8);\n    const arr = new Float64Array(this._buffer, this.byteOffset + this.position, length);\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += length * 8;\n    return arr;\n  }\n\n  /**\n   * Maps a Float32Array into the DataStream buffer, swizzling it to native\n   * endianness in-place. The current offset from the start of the buffer needs to\n   * be a multiple of element size, just like with typed array views.\n   *\n   * Nice for quickly reading in data. Warning: potentially modifies the buffer\n   * contents.\n   *\n   * @param length Number of elements to map.\n   * @param endianness Endianness of the data to read.\n   * @return Float32Array to the DataStream backing buffer.\n   * @bundle DataStream-map.js\n   */\n  mapFloat32Array(length: number, endianness?: Endianness) {\n    this._realloc(length * 4);\n    const arr = new Float32Array(this._buffer, this.byteOffset + this.position, length);\n    DataStream.arrayToNative(arr, endianness ?? this.endianness);\n    this.position += length * 4;\n    return arr;\n  }\n}\n\nfunction fromCharCodeUint8(uint8arr: Uint8Array) {\n  const arr: Array<number> = [];\n  for (let i = 0; i < uint8arr.length; i++) {\n    arr[i] = uint8arr[i];\n  }\n  return String.fromCharCode.apply(undefined, arr);\n}\n","import type { ISOFile } from './isofile';\n\n/*\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\n * License: BSD-3-Clause (see LICENSE file)\n */\nconst start = new Date();\n\nconst LOG_LEVEL_ERROR = 4;\nconst LOG_LEVEL_WARNING = 3;\nconst LOG_LEVEL_INFO = 2;\nconst LOG_LEVEL_DEBUG = 1;\n\nlet log_level = LOG_LEVEL_ERROR;\n\nexport const Log = {\n  setLogLevel(level: (module: string, msg?: string) => void) {\n    if (level === this.debug) log_level = LOG_LEVEL_DEBUG;\n    else if (level === this.info) log_level = LOG_LEVEL_INFO;\n    else if (level === this.warn) log_level = LOG_LEVEL_WARNING;\n    else if (level === this.error) log_level = LOG_LEVEL_ERROR;\n    else log_level = LOG_LEVEL_ERROR;\n  },\n  debug(module: string, msg?: string) {\n    if (console.debug === undefined) {\n      console.debug = console.log;\n    }\n    if (LOG_LEVEL_DEBUG >= log_level) {\n      console.debug(\n        '[' + Log.getDurationString(new Date().getTime() - start.getTime(), 1000) + ']',\n        '[' + module + ']',\n        msg,\n      );\n    }\n  },\n  log(module: { msg: string }, _msg?: string) {\n    this.debug(module.msg);\n  },\n  info(module: string, msg?: string) {\n    if (LOG_LEVEL_INFO >= log_level) {\n      console.info(\n        '[' + Log.getDurationString(new Date().getTime() - start.getTime(), 1000) + ']',\n        '[' + module + ']',\n        msg,\n      );\n    }\n  },\n  warn(module: string, msg?: string) {\n    if (LOG_LEVEL_WARNING >= log_level) {\n      console.warn(\n        '[' + Log.getDurationString(new Date().getTime() - start.getTime(), 1000) + ']',\n        '[' + module + ']',\n        msg,\n      );\n    }\n  },\n  error(module: string, msg?: string, isofile?: ISOFile) {\n    if (isofile?.onError) {\n      isofile.onError(module, msg);\n    } else if (LOG_LEVEL_ERROR >= log_level) {\n      console.error(\n        '[' + Log.getDurationString(new Date().getTime() - start.getTime(), 1000) + ']',\n        '[' + module + ']',\n        msg,\n      );\n    }\n  },\n  /* Helper function to print a duration value in the form H:MM:SS.MS */\n  getDurationString(duration: number, _timescale?: number) {\n    let neg: boolean;\n    /* Helper function to print a number on a fixed number of digits */\n    function pad(number: string | number, length: number) {\n      const str = '' + number;\n      const a = str.split('.');\n      while (a[0].length < length) {\n        a[0] = '0' + a[0];\n      }\n      return a.join('.');\n    }\n    if (duration < 0) {\n      neg = true;\n      duration = -duration;\n    } else {\n      neg = false;\n    }\n    const timescale = _timescale || 1;\n    let duration_sec = duration / timescale;\n    const hours = Math.floor(duration_sec / 3600);\n    duration_sec -= hours * 3600;\n    const minutes = Math.floor(duration_sec / 60);\n    duration_sec -= minutes * 60;\n    let msec = duration_sec * 1000;\n    duration_sec = Math.floor(duration_sec);\n    msec -= duration_sec * 1000;\n    msec = Math.floor(msec);\n    return (\n      (neg ? '-' : '') +\n      hours +\n      ':' +\n      pad(minutes, 2) +\n      ':' +\n      pad(duration_sec, 2) +\n      '.' +\n      pad(msec, 3)\n    );\n  },\n  /* Helper function to stringify HTML5 TimeRanges objects */\n  printRanges(ranges: {\n    length: number;\n    start: (index: number) => number;\n    end: (index: number) => number;\n  }) {\n    const length = ranges.length;\n    if (length > 0) {\n      let str = '';\n      for (let i = 0; i < length; i++) {\n        if (i > 0) str += ',';\n        str +=\n          '[' +\n          Log.getDurationString(ranges.start(i)) +\n          ',' +\n          Log.getDurationString(ranges.end(i)) +\n          ']';\n      }\n      return str;\n    } else {\n      return '(empty)';\n    }\n  },\n};\n","import { DataStream } from '#/DataStream';\nimport { Log } from '#/log';\nimport { MP4BoxBuffer } from '#/mp4boxbuffer';\n\n/**\n * helper functions to concatenate two ArrayBuffer objects\n * @param buffer1\n * @param buffer2\n * @return the concatenation of buffer1 and buffer2 in that order\n */\nfunction concatBuffers(buffer1: ArrayBuffer, buffer2: ArrayBuffer) {\n  Log.debug(\n    'ArrayBuffer',\n    'Trying to create a new buffer of size: ' + (buffer1.byteLength + buffer2.byteLength),\n  );\n  const tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\n  tmp.set(new Uint8Array(buffer1), 0);\n  tmp.set(new Uint8Array(buffer2), buffer1.byteLength);\n  return tmp.buffer as MP4BoxBuffer;\n}\n\n/**\n * MultiBufferStream is a class that acts as a SimpleStream for parsing\n * It holds several, possibly non-contiguous ArrayBuffer objects, each with a fileStart property\n * containing the offset for the buffer data in an original/virtual file\n *\n * It inherits also from DataStream for all read/write/alloc operations\n */\nexport class MultiBufferStream extends DataStream {\n  buffers: Array<MP4BoxBuffer>;\n  bufferIndex: number;\n\n  constructor(buffer?: MP4BoxBuffer) {\n    super(new ArrayBuffer(), 0);\n    // List of ArrayBuffers, with a fileStart property, sorted in fileStart order and non-overlapping\n    this.buffers = [];\n    this.bufferIndex = -1;\n    if (buffer) {\n      this.insertBuffer(buffer);\n      this.bufferIndex = 0;\n    }\n  }\n\n  /***********************************************************************************\n   *                     Methods for the managnement of the buffers                  *\n   *                     (insertion, removal, concatenation, ...)                    *\n   ***********************************************************************************/\n\n  initialized() {\n    if (this.bufferIndex > -1) {\n      return true;\n    } else if (this.buffers.length > 0) {\n      const firstBuffer = this.buffers[0];\n      if (firstBuffer.fileStart === 0) {\n        this.buffer = firstBuffer;\n        this.bufferIndex = 0;\n        Log.debug('MultiBufferStream', 'Stream ready for parsing');\n        return true;\n      } else {\n        Log.warn('MultiBufferStream', 'The first buffer should have a fileStart of 0');\n        this.logBufferLevel();\n        return false;\n      }\n    } else {\n      Log.warn('MultiBufferStream', 'No buffer to start parsing from');\n      this.logBufferLevel();\n      return false;\n    }\n  }\n\n  /**\n   * Reduces the size of a given buffer, but taking the part between offset and offset+newlength\n   * @param  {ArrayBuffer} buffer\n   * @param  {Number}      offset    the start of new buffer\n   * @param  {Number}      newLength the length of the new buffer\n   * @return {ArrayBuffer}           the new buffer\n   */\n  reduceBuffer(buffer: MP4BoxBuffer, offset: number, newLength: number) {\n    const smallB = new Uint8Array(newLength);\n    smallB.set(new Uint8Array(buffer, offset, newLength));\n    (smallB.buffer as MP4BoxBuffer).fileStart = buffer.fileStart + offset;\n    (smallB.buffer as MP4BoxBuffer).usedBytes = 0;\n    return smallB.buffer as MP4BoxBuffer;\n  }\n\n  /**\n   * Inserts the new buffer in the sorted list of buffers,\n   *  making sure, it is not overlapping with existing ones (possibly reducing its size).\n   *  if the new buffer overrides/replaces the 0-th buffer (for instance because it is bigger),\n   *  updates the DataStream buffer for parsing\n   */\n  insertBuffer(ab: MP4BoxBuffer) {\n    let to_add = true;\n    let i = 0;\n    /* TODO: improve insertion if many buffers */\n    for (; i < this.buffers.length; i++) {\n      const b = this.buffers[i];\n      if (ab.fileStart <= b.fileStart) {\n        /* the insertion position is found */\n        if (ab.fileStart === b.fileStart) {\n          /* The new buffer overlaps with an existing buffer */\n          if (ab.byteLength > b.byteLength) {\n            /* the new buffer is bigger than the existing one\n\t\t\t\t\t   remove the existing buffer and try again to insert\n\t\t\t\t\t   the new buffer to check overlap with the next ones */\n            this.buffers.splice(i, 1);\n            i--;\n            continue;\n          } else {\n            /* the new buffer is smaller than the existing one, just drop it */\n            Log.warn(\n              'MultiBufferStream',\n              'Buffer (fileStart: ' +\n                ab.fileStart +\n                ' - Length: ' +\n                ab.byteLength +\n                ') already appended, ignoring',\n            );\n          }\n        } else {\n          /* The beginning of the new buffer is not overlapping with an existing buffer\n\t\t\t\t   let's check the end of it */\n          if (ab.fileStart + ab.byteLength <= b.fileStart) {\n            /* no overlap, we can add it as is */\n          } else {\n            /* There is some overlap, cut the new buffer short, and add it*/\n            ab = this.reduceBuffer(ab, 0, b.fileStart - ab.fileStart);\n          }\n          Log.debug(\n            'MultiBufferStream',\n            'Appending new buffer (fileStart: ' +\n              ab.fileStart +\n              ' - Length: ' +\n              ab.byteLength +\n              ')',\n          );\n          this.buffers.splice(i, 0, ab);\n          /* if this new buffer is inserted in the first place in the list of the buffer,\n\t\t\t\t   and the DataStream is initialized, make it the buffer used for parsing */\n          if (i === 0) {\n            this.buffer = ab;\n          }\n        }\n        to_add = false;\n        break;\n      } else if (ab.fileStart < b.fileStart + b.byteLength) {\n        /* the new buffer overlaps its beginning with the end of the current buffer */\n        const offset = b.fileStart + b.byteLength - ab.fileStart;\n        const newLength = ab.byteLength - offset;\n        if (newLength > 0) {\n          /* the new buffer is bigger than the current overlap, drop the overlapping part and try again inserting the remaining buffer */\n          ab = this.reduceBuffer(ab, offset, newLength);\n        } else {\n          /* the content of the new buffer is entirely contained in the existing buffer, drop it entirely */\n          to_add = false;\n          break;\n        }\n      }\n    }\n    /* if the buffer has not been added, we can add it at the end */\n    if (to_add) {\n      Log.debug(\n        'MultiBufferStream',\n        'Appending new buffer (fileStart: ' + ab.fileStart + ' - Length: ' + ab.byteLength + ')',\n      );\n      this.buffers.push(ab);\n      /* if this new buffer is inserted in the first place in the list of the buffer,\n\t\t   and the DataStream is initialized, make it the buffer used for parsing */\n      if (i === 0) {\n        this.buffer = ab;\n      }\n    }\n  }\n\n  /**\n   * Displays the status of the buffers (number and used bytes)\n   * @param  {Object} info callback method for display\n   */\n  logBufferLevel(info?: boolean) {\n    const ranges = [];\n    let bufferedString = '';\n    let range: { start?: number; end?: number };\n    let used = 0;\n    let total = 0;\n\n    for (let i = 0; i < this.buffers.length; i++) {\n      const buffer = this.buffers[i];\n      if (i === 0) {\n        range = {\n          start: buffer.fileStart,\n          end: buffer.fileStart + buffer.byteLength,\n        };\n        ranges.push(range);\n        bufferedString += '[' + range.start + '-';\n      } else if (range.end === buffer.fileStart) {\n        range.end = buffer.fileStart + buffer.byteLength;\n      } else {\n        range = {\n          start: buffer.fileStart,\n          end: buffer.fileStart + buffer.byteLength,\n        };\n        bufferedString += ranges[ranges.length - 1].end - 1 + '], [' + range.start + '-';\n        ranges.push(range);\n      }\n      used += buffer.usedBytes;\n      total += buffer.byteLength;\n    }\n\n    if (ranges.length > 0) {\n      bufferedString += range.end - 1 + ']';\n    }\n\n    const log = info ? Log.info : Log.debug;\n    if (this.buffers.length === 0) {\n      log('MultiBufferStream', 'No more buffer in memory');\n    } else {\n      log(\n        'MultiBufferStream',\n        '' +\n          this.buffers.length +\n          ' stored buffer(s) (' +\n          used +\n          '/' +\n          total +\n          ' bytes), continuous ranges: ' +\n          bufferedString,\n      );\n    }\n  }\n\n  cleanBuffers() {\n    for (let i = 0; i < this.buffers.length; i++) {\n      const buffer = this.buffers[i];\n      if (buffer.usedBytes === buffer.byteLength) {\n        Log.debug('MultiBufferStream', 'Removing buffer #' + i);\n        this.buffers.splice(i, 1);\n        i--;\n      }\n    }\n  }\n\n  mergeNextBuffer() {\n    if (this.bufferIndex + 1 < this.buffers.length) {\n      const next_buffer = this.buffers[this.bufferIndex + 1];\n      if (next_buffer.fileStart === this.buffer.fileStart + this.buffer.byteLength) {\n        const oldLength = this.buffer.byteLength;\n        const oldUsedBytes = this.buffer.usedBytes;\n        const oldFileStart = this.buffer.fileStart;\n        this.buffers[this.bufferIndex] = concatBuffers(this.buffer, next_buffer);\n        this.buffer = this.buffers[this.bufferIndex];\n        this.buffers.splice(this.bufferIndex + 1, 1);\n        this.buffer.usedBytes = oldUsedBytes; /* TODO: should it be += ? */\n        this.buffer.fileStart = oldFileStart;\n        Log.debug(\n          'ISOFile',\n          'Concatenating buffer for box parsing (length: ' +\n            oldLength +\n            '->' +\n            this.buffer.byteLength +\n            ')',\n        );\n        return true;\n      } else {\n        return false;\n      }\n    } else {\n      return false;\n    }\n  }\n\n  /*************************************************************************\n   *                        Seek-related functions                         *\n   *************************************************************************/\n\n  /**\n   * Finds the buffer that holds the given file position\n   * @param  {Boolean} fromStart    indicates if the search should start from the current buffer (false)\n   *                                or from the first buffer (true)\n   * @param  {Number}  filePosition position in the file to seek to\n   * @param  {Boolean} markAsUsed   indicates if the bytes in between the current position and the seek position\n   *                                should be marked as used for garbage collection\n   * @return {Number}               the index of the buffer holding the seeked file position, -1 if not found.\n   */\n  findPosition(fromStart: boolean, filePosition: number, markAsUsed: boolean) {\n    let index = -1;\n    let i = fromStart === true ? 0 : this.bufferIndex;\n\n    while (i < this.buffers.length) {\n      const abuffer = this.buffers[i];\n      if (abuffer && abuffer.fileStart <= filePosition) {\n        index = i;\n        if (markAsUsed) {\n          if (abuffer.fileStart + abuffer.byteLength <= filePosition) {\n            abuffer.usedBytes = abuffer.byteLength;\n          } else {\n            abuffer.usedBytes = filePosition - abuffer.fileStart;\n          }\n          this.logBufferLevel();\n        }\n      } else {\n        break;\n      }\n      i++;\n    }\n\n    if (index === -1) {\n      return -1;\n    }\n\n    const abuffer = this.buffers[index];\n    if (abuffer.fileStart + abuffer.byteLength >= filePosition) {\n      Log.debug('MultiBufferStream', 'Found position in existing buffer #' + index);\n      return index;\n    } else {\n      return -1;\n    }\n  }\n\n  /**\n   * Finds the largest file position contained in a buffer or in the next buffers if they are contiguous (no gap)\n   * starting from the given buffer index or from the current buffer if the index is not given\n   *\n   * @param  {Number} inputindex Index of the buffer to start from\n   * @return {Number}            The largest file position found in the buffers\n   */\n  findEndContiguousBuf(inputindex?: number) {\n    const index = inputindex !== undefined ? inputindex : this.bufferIndex;\n    let currentBuf = this.buffers[index];\n    /* find the end of the contiguous range of data */\n    if (this.buffers.length > index + 1) {\n      for (let i = index + 1; i < this.buffers.length; i++) {\n        const nextBuf = this.buffers[i];\n        if (nextBuf.fileStart === currentBuf.fileStart + currentBuf.byteLength) {\n          currentBuf = nextBuf;\n        } else {\n          break;\n        }\n      }\n    }\n    /* return the position of last byte in the file that we have */\n    return currentBuf.fileStart + currentBuf.byteLength;\n  }\n\n  /**\n   * Returns the largest file position contained in the buffers, larger than the given position\n   * @param  {Number} pos the file position to start from\n   * @return {Number}     the largest position in the current buffer or in the buffer and the next contiguous\n   *                      buffer that holds the given position\n   */\n  getEndFilePositionAfter(pos: number) {\n    const index = this.findPosition(true, pos, false);\n    if (index !== -1) {\n      return this.findEndContiguousBuf(index);\n    } else {\n      return pos;\n    }\n  }\n\n  /*************************************************************************\n   *                  Garbage collection related functions                 *\n   *************************************************************************/\n\n  /**\n   * Marks a given number of bytes as used in the current buffer for garbage collection\n   * @param {Number} nbBytes\n   */\n  addUsedBytes(nbBytes: number) {\n    this.buffer.usedBytes += nbBytes;\n    this.logBufferLevel();\n  }\n\n  /**\n   * Marks the entire current buffer as used, ready for garbage collection\n   */\n  setAllUsedBytes() {\n    this.buffer.usedBytes = this.buffer.byteLength;\n    this.logBufferLevel();\n  }\n\n  /*************************************************************************\n   *          Common API between MultiBufferStream and SimpleStream        *\n   *************************************************************************/\n\n  /**\n   * Tries to seek to a given file position\n   * if possible, repositions the parsing from there and returns true\n   * if not possible, does not change anything and returns false\n   * @param  {Number}  filePosition position in the file to seek to\n   * @param  {Boolean} fromStart    indicates if the search should start from the current buffer (false)\n   *                                or from the first buffer (true)\n   * @param  {Boolean} markAsUsed   indicates if the bytes in between the current position and the seek position\n   *                                should be marked as used for garbage collection\n   * @return {Boolean}              true if the seek succeeded, false otherwise\n   */\n  override seek(filePosition: number, fromStart?: boolean, markAsUsed?: boolean) {\n    const index = this.findPosition(fromStart, filePosition, markAsUsed);\n    if (index !== -1) {\n      this.buffer = this.buffers[index];\n      this.bufferIndex = index;\n      this.position = filePosition - this.buffer.fileStart;\n      Log.debug('MultiBufferStream', 'Repositioning parser at buffer position: ' + this.position);\n      return true;\n    } else {\n      Log.debug('MultiBufferStream', 'Position ' + filePosition + ' not found in buffered data');\n      return false;\n    }\n  }\n\n  /**\n   * Returns the current position in the file\n   * @return {Number} the position in the file\n   */\n  getPosition() {\n    if (this.bufferIndex === -1 || this.buffers[this.bufferIndex] === undefined) return 0;\n    return this.buffers[this.bufferIndex].fileStart + this.position;\n  }\n\n  /**\n   * Returns the length of the current buffer\n   * @return {Number} the length of the current buffer\n   */\n  getLength() {\n    return this.byteLength;\n  }\n\n  getEndPosition() {\n    if (this.bufferIndex === -1 || this.buffers[this.bufferIndex] === undefined) return 0;\n    return this.buffers[this.bufferIndex].fileStart + this.byteLength;\n  }\n\n  getAbsoluteEndPosition() {\n    if (this.buffers.length === 0) return 0;\n    const lastBuffer = this.buffers[this.buffers.length - 1];\n    return lastBuffer.fileStart + lastBuffer.byteLength;\n  }\n}\n","/*\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\n * License: BSD-3-Clause (see LICENSE file)\n */\n\nimport { MultiBufferStream } from '#/buffer';\nimport { MAX_UINT32 } from '#/constants';\nimport { DataStream } from '#/DataStream';\nimport { Log } from '#/log';\nimport type { BoxFourCC, Output, Reference } from '@types';\nimport type { mdatBox } from 'entries/all-boxes';\n\nexport class Box {\n  static registryId = Symbol.for('BoxIdentifier');\n\n  boxes?: Array<Box>;\n  data: Array<number> | Uint8Array;\n  has_unparsed_data?: boolean;\n  hdr_size?: number;\n  language: number;\n  languageString?: string;\n  original_size?: number;\n  sizePosition?: number;\n  start?: number;\n  track_ids?: Uint32Array;\n  box_name?: string;\n  uuid?: string;\n\n  // Handle box designation (4CC)\n  // Instance-defined type (used for dynamic box types)\n  #type?: string;\n  static readonly fourcc?: string;\n\n  get type(): string {\n    return (this.constructor as typeof Box).fourcc ?? this.#type;\n  }\n  set type(value: string) {\n    this.#type = value;\n  }\n\n  constructor(public size = 0) {}\n\n  addBox<T extends Box>(box: T): T {\n    if (!this.boxes) {\n      this.boxes = [];\n    }\n    this.boxes.push(box);\n    if (this[box.type + 's']) {\n      this[box.type + 's'].push(box);\n    } else {\n      this[box.type] = box;\n    }\n    return box;\n  }\n\n  set<TProp extends keyof this>(prop: TProp, value: this[TProp]) {\n    this[prop] = value;\n    return this;\n  }\n\n  addEntry(value: Box, _prop?: string) {\n    const prop = _prop || 'entries';\n    if (!this[prop]) {\n      this[prop] = [];\n    }\n    this[prop].push(value);\n    return this;\n  }\n\n  /** @bundle box-write.js */\n  writeHeader(stream: DataStream, msg?: string) {\n    this.size += 8;\n    if (this.size > MAX_UINT32 || this.original_size === 1) {\n      this.size += 8;\n    }\n    if (this.type === 'uuid') {\n      this.size += 16;\n    }\n    Log.debug(\n      'BoxWriter',\n      'Writing box ' +\n        this.type +\n        ' of size: ' +\n        this.size +\n        ' at position ' +\n        stream.getPosition() +\n        (msg || ''),\n    );\n    if (this.original_size === 0) {\n      stream.writeUint32(0);\n    } else if (this.size > MAX_UINT32 || this.original_size === 1) {\n      stream.writeUint32(1);\n    } else {\n      this.sizePosition = stream.getPosition();\n      stream.writeUint32(this.size);\n    }\n    stream.writeString(this.type, undefined, 4);\n    if (this.type === 'uuid') {\n      const uuidBytes = new Uint8Array(16);\n      for (let i = 0; i < 16; i++) {\n        uuidBytes[i] = parseInt(this.uuid.substring(i * 2, i * 2 + 2), 16);\n      }\n      stream.writeUint8Array(uuidBytes);\n    }\n    if (this.size > MAX_UINT32 || this.original_size === 1) {\n      this.sizePosition = stream.getPosition();\n      stream.writeUint64(this.size);\n    }\n  }\n\n  /** @bundle box-write.js */\n  write(stream: DataStream) {\n    if (this.type === 'mdat') {\n      const box = this as mdatBox;\n      if (box.stream) {\n        this.size = box.stream.getAbsoluteEndPosition();\n        this.writeHeader(stream);\n        for (const buffer of box.stream.buffers) {\n          const u8 = new Uint8Array(buffer);\n          stream.writeUint8Array(u8);\n        }\n      } else if (box.data) {\n        this.size = box.data.length;\n        this.writeHeader(stream);\n        stream.writeUint8Array(box.data);\n      }\n    } else {\n      this.size = this.data ? this.data.length : 0;\n      this.writeHeader(stream);\n      if (this.data) {\n        stream.writeUint8Array(this.data);\n      }\n    }\n  }\n\n  /** @bundle box-print.js */\n  printHeader(output: Output) {\n    this.size += 8;\n    if (this.size > MAX_UINT32) {\n      this.size += 8;\n    }\n    if (this.type === 'uuid') {\n      this.size += 16;\n    }\n    output.log(output.indent + 'size:' + this.size);\n    output.log(output.indent + 'type:' + this.type);\n  }\n\n  /** @bundle box-print.js */\n  print(output: Output) {\n    this.printHeader(output);\n  }\n\n  /** @bundle box-parse.js */\n  parse(stream: MultiBufferStream) {\n    if (this.type !== 'mdat') {\n      this.data = stream.readUint8Array(this.size - this.hdr_size);\n    } else {\n      if (this.size === 0) {\n        stream.seek(stream.getEndPosition());\n      } else {\n        stream.seek(this.start + this.size);\n      }\n    }\n  }\n\n  /** @bundle box-parse.js */\n  parseDataAndRewind(stream: MultiBufferStream) {\n    this.data = stream.readUint8Array(this.size - this.hdr_size);\n    // rewinding\n    stream.seek(this.start + this.hdr_size);\n  }\n\n  /** @bundle box-parse.js */\n  parseLanguage(stream: MultiBufferStream) {\n    this.language = stream.readUint16();\n    const chars = [];\n    chars[0] = (this.language >> 10) & 0x1f;\n    chars[1] = (this.language >> 5) & 0x1f;\n    chars[2] = this.language & 0x1f;\n    this.languageString = String.fromCharCode(chars[0] + 0x60, chars[1] + 0x60, chars[2] + 0x60);\n  }\n\n  /** @bundle isofile-advanced-creation.js */\n  computeSize(stream_?: MultiBufferStream) {\n    const stream = stream_ || new MultiBufferStream();\n    this.write(stream);\n  }\n\n  isEndOfBox(stream: MultiBufferStream): boolean {\n    const pos = stream.getPosition();\n    const end = this.start + this.size;\n    return pos === end;\n  }\n}\n\nexport class FullBox extends Box {\n  flags = 0;\n  version = 0;\n\n  /** @bundle box-write.js */\n  writeHeader(stream: MultiBufferStream) {\n    this.size += 4;\n    super.writeHeader(stream, ' v=' + this.version + ' f=' + this.flags);\n    stream.writeUint8(this.version);\n    stream.writeUint24(this.flags);\n  }\n\n  /** @bundle box-print.js */\n  printHeader(output: Output) {\n    this.size += 4;\n    super.printHeader(output);\n    output.log(output.indent + 'version:' + this.version);\n    output.log(output.indent + 'flags:' + this.flags);\n  }\n\n  /** @bundle box-parse.js */\n  parseDataAndRewind(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.data = stream.readUint8Array(this.size - this.hdr_size);\n    // restore the header size as if the full header had not been parsed\n    this.hdr_size -= 4;\n    // rewinding\n    stream.seek(this.start + this.hdr_size);\n  }\n\n  /** @bundle box-parse.js */\n  parseFullHeader(stream: MultiBufferStream) {\n    this.version = stream.readUint8();\n    this.flags = stream.readUint24();\n    this.hdr_size += 4;\n  }\n\n  /** @bundle box-parse.js */\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.data = stream.readUint8Array(this.size - this.hdr_size);\n  }\n}\n\nexport class SampleGroupEntry {\n  static registryId = Symbol.for('SampleGroupEntryIdentifier');\n\n  data: ArrayLike<number>;\n  description_length: number;\n\n  constructor(public grouping_type: string) {}\n\n  /** @bundle writing/samplegroups/samplegroup.js */\n  write(stream: MultiBufferStream) {\n    stream.writeUint8Array(this.data);\n  }\n\n  /** @bundle parsing/samplegroups/samplegroup.js */\n  parse(stream: MultiBufferStream) {\n    Log.warn('BoxParser', `Unknown sample group type: '${this.grouping_type}'`);\n    this.data = stream.readUint8Array(this.description_length);\n  }\n}\n\nexport class TrackGroupTypeBox extends FullBox {\n  track_group_id: number;\n\n  /** @bundle parsing/TrackGroup.js */\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.track_group_id = stream.readUint32();\n  }\n}\n\n/** @bundle parsing/singleitemtypereference.js */\nexport class SingleItemTypeReferenceBox extends Box {\n  from_item_ID: number;\n  references: Array<Reference>;\n\n  constructor(\n    fourcc: string,\n    size: number,\n    public box_name: string,\n    public hdr_size: number,\n    public start: number,\n  ) {\n    super(size);\n    this.type = fourcc as BoxFourCC;\n  }\n  parse(stream: MultiBufferStream): void {\n    this.from_item_ID = stream.readUint16();\n    const count = stream.readUint16();\n    this.references = [];\n    for (let i = 0; i < count; i++) {\n      this.references[i] = {\n        to_item_ID: stream.readUint16(),\n      };\n    }\n  }\n}\n\n/** @bundle parsing/singleitemtypereferencelarge.js */\nexport class SingleItemTypeReferenceBoxLarge extends Box {\n  from_item_ID: number;\n  references: Array<Reference>;\n\n  constructor(\n    fourcc: string,\n    size: number,\n    public box_name: string,\n    public hdr_size: number,\n    public start: number,\n  ) {\n    super(size);\n    this.type = fourcc as BoxFourCC;\n  }\n  parse(stream: MultiBufferStream): void {\n    this.from_item_ID = stream.readUint32();\n    const count = stream.readUint16();\n    this.references = [];\n    for (let i = 0; i < count; i++) {\n      this.references[i] = {\n        to_item_ID: stream.readUint32(),\n      };\n    }\n  }\n}\n\n/** @bundle parsing/TrakReference.js */\nexport class TrackReferenceTypeBox extends Box {\n  constructor(\n    fourcc: string,\n    size: number,\n    public hdr_size: number,\n    public start: number,\n  ) {\n    super(size);\n    this.type = fourcc as BoxFourCC;\n  }\n\n  parse(stream: MultiBufferStream | DataStream) {\n    this.track_ids = stream.readUint32Array((this.size - this.hdr_size) / 4);\n  }\n\n  /** @bundle box-write.js */\n  write(stream: DataStream) {\n    this.size = this.track_ids.length * 4;\n    this.writeHeader(stream);\n    stream.writeUint32Array(this.track_ids);\n  }\n}\n","import { Box } from '#/box';\n\nexport const DIFF_BOXES_PROP_NAMES = [\n  'boxes',\n  'entries',\n  'references',\n  'subsamples',\n  'items',\n  'item_infos',\n  'extents',\n  'associations',\n  'subsegments',\n  'ranges',\n  'seekLists',\n  'seekPoints',\n  'esd',\n  'levels',\n] as const;\n\nexport const DIFF_PRIMITIVE_ARRAY_PROP_NAMES = [\n  'compatible_brands',\n  'matrix',\n  'opcolor',\n  'sample_counts',\n  'sample_deltas',\n  'first_chunk',\n  'samples_per_chunk',\n  'sample_sizes',\n  'chunk_offsets',\n  'sample_offsets',\n  'sample_description_index',\n  'sample_duration',\n] as const;\n\n/** @bundle box-diff.js */\nexport function boxEqualFields(box_a: Box, box_b: Box) {\n  if (box_a && !box_b) return false;\n  let prop: string;\n  for (prop in box_a) {\n    if (DIFF_BOXES_PROP_NAMES.find(name => name === prop)) {\n      continue;\n    } else if (box_a[prop] instanceof Box || box_b[prop] instanceof Box) {\n      continue;\n    } else if (typeof box_a[prop] === 'undefined' || typeof box_b[prop] === 'undefined') {\n      continue;\n    } else if (typeof box_a[prop] === 'function' || typeof box_b[prop] === 'function') {\n      continue;\n    } else if (\n      ('subBoxNames' in box_a &&\n        (box_a.subBoxNames as Array<string>).indexOf(prop.slice(0, 4)) > -1) ||\n      ('subBoxNames' in box_b &&\n        (box_b.subBoxNames as Array<string>).indexOf(prop.slice(0, 4)) > -1)\n    ) {\n      continue;\n    } else {\n      if (\n        prop === 'data' ||\n        prop === 'start' ||\n        prop === 'size' ||\n        prop === 'creation_time' ||\n        prop === 'modification_time'\n      ) {\n        continue;\n      } else if (DIFF_PRIMITIVE_ARRAY_PROP_NAMES.find(name => name === prop)) {\n        continue;\n      } else {\n        if (box_a[prop] !== box_b[prop]) {\n          return false;\n        }\n      }\n    }\n  }\n  return true;\n}\n\nexport function boxEqual(box_a: Box, box_b: Box) {\n  if (!boxEqualFields(box_a, box_b)) {\n    return false;\n  }\n  for (let j = 0; j < DIFF_BOXES_PROP_NAMES.length; j++) {\n    const name = DIFF_BOXES_PROP_NAMES[j];\n    if (box_a[name] && box_b[name]) {\n      if (!boxEqual(box_a[name], box_b[name])) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n","import type * as MP4Box from '@types';\nimport type { Box, SampleGroupEntry } from '#/box';\nimport type { SampleEntry } from '#/boxes/sampleentries/base';\n\nfunction getRegistryId(boxClass: object): symbol {\n  let current = boxClass;\n  while (current) {\n    if ('registryId' in current) {\n      return (current as unknown)['registryId'] as symbol;\n    }\n    current = Object.getPrototypeOf(current);\n  }\n}\n\nconst isSampleGroupEntry = (value: object): value is SampleGroupEntry => {\n  const symbol = Symbol.for('SampleGroupEntryIdentifier');\n  return getRegistryId(value) === symbol;\n};\n\nconst isSampleEntry = (value: object): value is SampleEntry => {\n  const symbol = Symbol.for('SampleEntryIdentifier');\n  return getRegistryId(value) === symbol;\n};\n\nconst isBox = (value: object): value is Box => {\n  const symbol = Symbol.for('BoxIdentifier');\n  return getRegistryId(value) === symbol;\n};\n\nexport const BoxRegistry: MP4Box.BoxRegistry = {\n  uuid: {},\n  sampleEntry: {},\n  sampleGroupEntry: {},\n  box: {},\n};\nexport function registerBoxes<T>(registry: T): MP4Box.BoxRegistry<T> {\n  const localRegistry = {\n    uuid: {},\n    sampleEntry: {},\n    sampleGroupEntry: {},\n    box: {},\n  } as MP4Box.BoxRegistry<T>;\n\n  for (const [key, value] of Object.entries(registry)) {\n    // Check if SampleGroupEntry class\n    if (isSampleGroupEntry(value)) {\n      const groupingType = 'grouping_type' in value ? (value.grouping_type as string) : undefined;\n\n      if (!groupingType) {\n        throw new Error(\n          `SampleGroupEntry class ${key} does not have a valid static grouping_type. Please ensure it is defined correctly.`,\n        );\n      }\n\n      if (groupingType in localRegistry.sampleGroupEntry) {\n        throw new Error(\n          `SampleGroupEntry class ${key} has a grouping_type that is already registered. Please ensure it is unique.`,\n        );\n      }\n\n      localRegistry.sampleGroupEntry[groupingType] = value;\n      continue;\n    }\n\n    // Check if SampleEntry class\n    if (isSampleEntry(value)) {\n      const fourcc = 'fourcc' in value ? (value.fourcc as string) : undefined;\n\n      if (!fourcc) {\n        throw new Error(\n          `SampleEntry class ${key} does not have a valid static fourcc. Please ensure it is defined correctly.`,\n        );\n      }\n\n      if (fourcc in localRegistry.sampleEntry) {\n        throw new Error(\n          `SampleEntry class ${key} has a fourcc that is already registered. Please ensure it is unique.`,\n        );\n      }\n\n      localRegistry.sampleEntry[fourcc] = value;\n      continue;\n    }\n\n    // Check if Box class\n    if (isBox(value)) {\n      const fourcc = 'fourcc' in value ? (value.fourcc as string) : undefined;\n      const uuid = 'uuid' in value ? (value.uuid as string) : undefined;\n\n      // Check for UUID first\n      if (fourcc === 'uuid') {\n        if (!uuid) {\n          throw new Error(\n            `Box class ${key} has a fourcc of 'uuid' but does not have a valid uuid. Please ensure it is defined correctly.`,\n          );\n        }\n\n        if (uuid in localRegistry.uuid) {\n          throw new Error(\n            `Box class ${key} has a uuid that is already registered. Please ensure it is unique.`,\n          );\n        }\n\n        localRegistry.uuid[uuid] = value;\n        continue;\n      }\n\n      // This is a regular box with a fourcc\n      localRegistry.box[fourcc] = value;\n      continue;\n    }\n\n    throw new Error(\n      `Box class ${key} does not have a valid static fourcc, uuid, or grouping_type. Please ensure it is defined correctly.`,\n    );\n  }\n\n  // Assign the local registry to the global BoxRegistry\n  BoxRegistry.uuid = { ...localRegistry.uuid };\n  BoxRegistry.sampleEntry = { ...localRegistry.sampleEntry };\n  BoxRegistry.sampleGroupEntry = { ...localRegistry.sampleGroupEntry };\n  BoxRegistry.box = { ...localRegistry.box };\n\n  return BoxRegistry as MP4Box.BoxRegistry<T>;\n}\n\nexport const DescriptorRegistry = {} as MP4Box.DescriptorRegistry;\nexport function registerDescriptors<T>(registry: T) {\n  Object.entries(registry).forEach(([key, value]) => (DescriptorRegistry[key] = value));\n  return DescriptorRegistry;\n}\n","import type { MultiBufferStream } from '#/buffer';\nimport type { BoxFourCC, IncompleteBox } from '@types';\nimport { Log } from '#/log';\nimport { ERR_INVALID_DATA, ERR_NOT_ENOUGH_DATA, OK } from '#/constants';\nimport { Box } from '#/box';\nimport { BoxRegistry } from '#/registry';\n\nexport function parseUUID(stream: MultiBufferStream) {\n  return parseHex16(stream);\n}\n\nexport function parseHex16(stream: MultiBufferStream) {\n  let hex16 = '';\n  for (let i = 0; i < 16; i++) {\n    const hex = stream.readUint8().toString(16);\n    hex16 += hex.length === 1 ? '0' + hex : hex;\n  }\n  return hex16;\n}\n\nexport function parseOneBox(\n  stream: MultiBufferStream,\n  headerOnly: boolean,\n  parentSize?: number,\n): IncompleteBox {\n  let box: Box;\n  let originalSize: number;\n  const start = stream.getPosition();\n  let hdr_size = 0;\n  let uuid: string;\n  if (stream.getEndPosition() - start < 8) {\n    Log.debug('BoxParser', 'Not enough data in stream to parse the type and size of the box');\n    return { code: ERR_NOT_ENOUGH_DATA };\n  }\n  if (parentSize && parentSize < 8) {\n    Log.debug('BoxParser', 'Not enough bytes left in the parent box to parse a new box');\n    return { code: ERR_NOT_ENOUGH_DATA };\n  }\n  let size = stream.readUint32();\n  const type = stream.readString(4);\n\n  // Check if type is a valid fourcc\n  if (type.length !== 4 || !/^[\\x20-\\x7E]{4}$/.test(type)) {\n    Log.error('BoxParser', `Invalid box type: '${type}'`);\n    return { code: ERR_INVALID_DATA, start, type };\n  }\n\n  let box_type = type;\n  Log.debug(\n    'BoxParser',\n    \"Found box of type '\" + type + \"' and size \" + size + ' at position ' + start,\n  );\n  hdr_size = 8;\n  if (type === 'uuid') {\n    if (stream.getEndPosition() - stream.getPosition() < 16 || parentSize - hdr_size < 16) {\n      stream.seek(start);\n      Log.debug('BoxParser', 'Not enough bytes left in the parent box to parse a UUID box');\n      return { code: ERR_NOT_ENOUGH_DATA };\n    }\n    uuid = parseUUID(stream);\n    hdr_size += 16;\n    box_type = uuid;\n  }\n  if (size === 1) {\n    if (\n      stream.getEndPosition() - stream.getPosition() < 8 ||\n      (parentSize && parentSize - hdr_size < 8)\n    ) {\n      stream.seek(start);\n      Log.warn(\n        'BoxParser',\n        'Not enough data in stream to parse the extended size of the \"' + type + '\" box',\n      );\n      return { code: ERR_NOT_ENOUGH_DATA };\n    }\n    originalSize = size;\n    size = stream.readUint64();\n    hdr_size += 8;\n  } else if (size === 0) {\n    /* box extends till the end of file or invalid file */\n    if (parentSize) {\n      size = parentSize;\n    } else {\n      /* box extends till the end of file */\n      if (type !== 'mdat') {\n        Log.error('BoxParser', \"Unlimited box size not supported for type: '\" + type + \"'\");\n        box = new Box(size);\n        box.type = type as BoxFourCC;\n        return { code: OK, box, size: box.size };\n      }\n    }\n  }\n  if (size !== 0 && size < hdr_size) {\n    Log.error(\n      'BoxParser',\n      'Box of type ' + type + ' has an invalid size ' + size + ' (too small to be a box)',\n    );\n    return {\n      code: ERR_NOT_ENOUGH_DATA,\n      type: type,\n      size: size,\n      hdr_size: hdr_size,\n      start: start,\n    };\n  }\n  if (size !== 0 && parentSize && size > parentSize) {\n    Log.error(\n      'BoxParser',\n      \"Box of type '\" +\n        type +\n        \"' has a size \" +\n        size +\n        ' greater than its container size ' +\n        parentSize,\n    );\n    return {\n      code: ERR_NOT_ENOUGH_DATA,\n      type: type,\n      size: size,\n      hdr_size: hdr_size,\n      start: start,\n    };\n  }\n  if (size !== 0 && start + size > stream.getEndPosition()) {\n    stream.seek(start);\n    Log.info('BoxParser', \"Not enough data in stream to parse the entire '\" + type + \"' box\");\n    return {\n      code: ERR_NOT_ENOUGH_DATA,\n      type: type,\n      size: size,\n      hdr_size: hdr_size,\n      start: start,\n      original_size: originalSize,\n    };\n  }\n  if (headerOnly) {\n    return { code: OK, type: type, size: size, hdr_size: hdr_size, start: start };\n  } else {\n    if (type in BoxRegistry.box) {\n      box = new BoxRegistry.box[type](size);\n    } else {\n      if (type !== 'uuid') {\n        Log.warn('BoxParser', `Unknown box type: '${type}'`);\n        box = new Box(size);\n        box.type = type as BoxFourCC;\n        box.has_unparsed_data = true;\n      } else {\n        if (uuid in BoxRegistry.uuid) {\n          box = new BoxRegistry.uuid[uuid](size);\n        } else {\n          Log.warn('BoxParser', `Unknown UUID box type: '${uuid}'`);\n          box = new Box(size);\n          box.type = type as BoxFourCC;\n          box.uuid = uuid;\n          box.has_unparsed_data = true;\n        }\n      }\n    }\n  }\n  box.original_size = originalSize;\n  box.hdr_size = hdr_size;\n  /* recording the position of the box in the input stream */\n  box.start = start;\n  if (box.write === Box.prototype.write && box.type !== 'mdat') {\n    Log.info(\n      'BoxParser',\n      \"'\" +\n        box_type +\n        \"' box writing not yet implemented, keeping unparsed data in memory for later write\",\n    );\n    box.parseDataAndRewind(stream);\n  }\n  box.parse(stream);\n  const diff = stream.getPosition() - (box.start + box.size);\n  if (diff < 0) {\n    Log.warn(\n      'BoxParser',\n      \"Parsing of box '\" +\n        box_type +\n        \"' did not read the entire indicated box data size (missing \" +\n        -diff +\n        ' bytes), seeking forward',\n    );\n    stream.seek(box.start + box.size);\n  } else if (diff > 0 && box.size !== 0) {\n    Log.error(\n      'BoxParser',\n      \"Parsing of box '\" +\n        box_type +\n        \"' read \" +\n        diff +\n        ' more bytes than the indicated box data size, seeking backwards',\n    );\n    stream.seek(box.start + box.size);\n  }\n  return { code: OK, box, size: box.size };\n}\n","import type { BoxKind, Output } from '@types';\nimport type { MultiBufferStream } from '#/buffer';\nimport type { DataStream } from '#/DataStream';\nimport { Box } from '#/box';\nimport { Log } from '#/log';\nimport { OK } from '#/constants';\nimport { parseOneBox } from '#/parser';\n\nexport class ContainerBox extends Box {\n  subBoxNames?: ReadonlyArray<string>;\n\n  /** @bundle box-write.js */\n  write(stream: MultiBufferStream | DataStream) {\n    this.size = 0;\n    this.writeHeader(stream);\n    if (this.boxes) {\n      for (let i = 0; i < this.boxes.length; i++) {\n        if (this.boxes[i]) {\n          this.boxes[i].write(stream);\n          this.size += this.boxes[i].size;\n        }\n      }\n    }\n    /* adjusting the size, now that all sub-boxes are known */\n    Log.debug('BoxWriter', 'Adjusting box ' + this.type + ' with new size ' + this.size);\n    stream.adjustUint32(this.sizePosition, this.size);\n  }\n\n  /** @bundle box-print.js */\n  print(output: Output) {\n    this.printHeader(output);\n    for (let i = 0; i < this.boxes.length; i++) {\n      if (this.boxes[i]) {\n        const prev_indent = output.indent;\n        output.indent += ' ';\n        this.boxes[i].print(output);\n        output.indent = prev_indent;\n      }\n    }\n  }\n\n  /** @bundle box-parse.js */\n  parse(stream: MultiBufferStream) {\n    let ret: ReturnType<typeof parseOneBox>;\n    while (stream.getPosition() < this.start + this.size) {\n      ret = parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\n      if (ret.code === OK) {\n        const box = ret.box as BoxKind;\n        if (!this.boxes) {\n          this.boxes = [];\n        }\n        /* store the box in the 'boxes' array to preserve box order (for offset) but also store box in a property for more direct access */\n        this.boxes.push(box);\n        if (this.subBoxNames && this.subBoxNames.indexOf(box.type) !== -1) {\n          const fourcc = this.subBoxNames[this.subBoxNames.indexOf(box.type)] + 's';\n          if (!this[fourcc]) this[fourcc] = [];\n          this[fourcc].push(box);\n        } else {\n          const box_type = box.type !== 'uuid' ? box.type : box.uuid;\n          if (this[box_type]) {\n            Log.warn(\n              'ContainerBox',\n              `Box of type ${box_type} already exists in container box ${this.type}.`,\n            );\n          } else {\n            this[box_type] = box;\n          }\n        }\n      } else {\n        return;\n      }\n    }\n  }\n}\n","import { ContainerBox } from '#/containerBox';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\nimport type { av1CBox } from '../av1C';\nimport type { avcCBox } from '../avcC';\nimport type { hvcCBox } from '../hvcC';\nimport type { vpcCBox } from '../vpcC';\nimport type { vvcCBox } from '../vvcC';\n\nexport class SampleEntry extends ContainerBox {\n  static override readonly registryId = Symbol.for('SampleEntryIdentifier');\n\n  data_reference_index?: number;\n\n  constructor(\n    size?: number,\n    public hdr_size?: number,\n    public start?: number,\n  ) {\n    super(size);\n  }\n\n  /** @bundle box-codecs.js */\n  isVideo() {\n    return false;\n  }\n\n  /** @bundle box-codecs.js */\n  isAudio() {\n    return false;\n  }\n\n  /** @bundle box-codecs.js */\n  isSubtitle() {\n    return false;\n  }\n\n  /** @bundle box-codecs.js */\n  isMetadata() {\n    return false;\n  }\n\n  /** @bundle box-codecs.js */\n  isHint() {\n    return false;\n  }\n\n  /** @bundle box-codecs.js */\n  getCodec() {\n    return this.type.replace('.', '');\n  }\n\n  /** @bundle box-codecs.js */\n  getWidth(): number {\n    // @ts-expect-error FIXME: Only stubbed? Expects a number returned.\n    return '';\n  }\n\n  /** @bundle box-codecs.js */\n  getHeight(): number {\n    // @ts-expect-error FIXME: Only stubbed? Expects a number returned.\n    return '';\n  }\n\n  /** @bundle box-codecs.js */\n  getChannelCount(): number {\n    // @ts-expect-error FIXME: Only stubbed? Expects a number returned.\n    return '';\n  }\n\n  /** @bundle box-codecs.js */\n  getSampleRate(): number {\n    // @ts-expect-error FIXME: Only stubbed? Expects a number returned.\n    return '';\n  }\n\n  /** @bundle box-codecs.js */\n  getSampleSize(): number {\n    // @ts-expect-error FIXME: Only stubbed? Expects a number returned.\n    return '';\n  }\n\n  /** @bundle parsing/sampleentries/sampleentry.js */\n  parseHeader(stream: MultiBufferStream) {\n    stream.readUint8Array(6);\n    this.data_reference_index = stream.readUint16();\n    this.hdr_size += 8;\n  }\n\n  /** @bundle parsing/sampleentries/sampleentry.js */\n  parse(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    this.data = stream.readUint8Array(this.size - this.hdr_size);\n  }\n\n  /** @bundle parsing/sampleentries/sampleentry.js */\n  parseDataAndRewind(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    this.data = stream.readUint8Array(this.size - this.hdr_size);\n    // restore the header size as if the sample entry header had not been parsed\n    this.hdr_size -= 8;\n    // rewinding\n    stream.seek(this.start + this.hdr_size);\n  }\n\n  /** @bundle parsing/sampleentries/sampleentry.js */\n  parseFooter(stream: MultiBufferStream) {\n    super.parse(stream);\n  }\n\n  /** @bundle writing/sampleentry.js */\n  writeHeader(stream: MultiBufferStream) {\n    this.size = 8;\n    super.writeHeader(stream);\n    stream.writeUint8(0);\n    stream.writeUint8(0);\n    stream.writeUint8(0);\n    stream.writeUint8(0);\n    stream.writeUint8(0);\n    stream.writeUint8(0);\n    stream.writeUint16(this.data_reference_index);\n  }\n\n  /** @bundle writing/sampleentry.js */\n  writeFooter(stream: MultiBufferStream) {\n    if (this.boxes) {\n      for (let i = 0; i < this.boxes.length; i++) {\n        this.boxes[i].write(stream);\n        this.size += this.boxes[i].size;\n      }\n    }\n    Log.debug('BoxWriter', 'Adjusting box ' + this.type + ' with new size ' + this.size);\n    stream.adjustUint32(this.sizePosition, this.size);\n  }\n\n  /** @bundle writing/sampleentry.js */\n  write(stream: MultiBufferStream) {\n    this.writeHeader(stream);\n    stream.writeUint8Array(this.data);\n    this.size += this.data.length;\n    Log.debug('BoxWriter', 'Adjusting box ' + this.type + ' with new size ' + this.size);\n    stream.adjustUint32(this.sizePosition, this.size);\n  }\n}\n\n// Base SampleEntry types with default parsing\nexport class HintSampleEntry extends SampleEntry {}\nexport class MetadataSampleEntry extends SampleEntry {\n  /** @bundle box-codecs.js */\n  isMetadata() {\n    return true;\n  }\n}\nexport class SubtitleSampleEntry extends SampleEntry {\n  /** @bundle box-codecs.js */\n  isSubtitle() {\n    return true;\n  }\n}\nexport class TextSampleEntry extends SampleEntry {}\n\n//Base SampleEntry types for Audio and Video with specific parsing\nexport class VisualSampleEntry extends SampleEntry {\n  av1C?: av1CBox;\n  avcC?: avcCBox;\n  hvcC?: hvcCBox;\n  vpcC?: vpcCBox;\n  vvcC?: vvcCBox;\n\n  width: number;\n  height: number;\n  horizresolution: number;\n  vertresolution: number;\n  frame_count: number;\n  compressorname: string;\n  depth: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    stream.readUint16();\n    stream.readUint16();\n    stream.readUint32Array(3);\n    this.width = stream.readUint16();\n    this.height = stream.readUint16();\n    this.horizresolution = stream.readUint32();\n    this.vertresolution = stream.readUint32();\n    stream.readUint32();\n    this.frame_count = stream.readUint16();\n    const compressorname_length = Math.min(31, stream.readUint8());\n    this.compressorname = stream.readString(compressorname_length);\n    if (compressorname_length < 31) {\n      stream.readString(31 - compressorname_length);\n    }\n    this.depth = stream.readUint16();\n    stream.readUint16();\n    this.parseFooter(stream);\n  }\n\n  /** @bundle box-codecs.js */\n  isVideo() {\n    return true;\n  }\n\n  /** @bundle box-codecs.js */\n  getWidth() {\n    return this.width;\n  }\n\n  /** @bundle box-codecs.js */\n  getHeight() {\n    return this.height;\n  }\n\n  /** @bundle writing/sampleentries/sampleentry.js */\n  write(stream: MultiBufferStream) {\n    this.writeHeader(stream);\n    this.size += 2 * 7 + 6 * 4 + 32;\n    stream.writeUint16(0);\n    stream.writeUint16(0);\n    stream.writeUint32(0);\n    stream.writeUint32(0);\n    stream.writeUint32(0);\n    stream.writeUint16(this.width);\n    stream.writeUint16(this.height);\n    stream.writeUint32(this.horizresolution);\n    stream.writeUint32(this.vertresolution);\n    stream.writeUint32(0);\n    stream.writeUint16(this.frame_count);\n    stream.writeUint8(Math.min(31, this.compressorname.length));\n    stream.writeString(this.compressorname, undefined, 31);\n    stream.writeUint16(this.depth);\n    stream.writeInt16(-1);\n    this.writeFooter(stream);\n  }\n}\n\nexport class AudioSampleEntry extends SampleEntry {\n  version: number;\n  channel_count: number;\n  samplesize: number;\n  samplerate: number;\n\n  // Quicktime only\n  extensions: Uint8Array;\n\n  parse(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    this.version = stream.readUint16();\n    stream.readUint16(); // revision\n    stream.readUint32(); // vendor\n    this.channel_count = stream.readUint16();\n    this.samplesize = stream.readUint16();\n    stream.readUint16();\n    stream.readUint16();\n    this.samplerate = stream.readUint32() / (1 << 16);\n\n    const isQT = stream.isofile?.ftyp?.major_brand.includes('qt');\n    if (isQT) {\n      if (this.version === 1) {\n        this.extensions = stream.readUint8Array(16);\n      } else if (this.version === 2) {\n        this.extensions = stream.readUint8Array(36);\n      }\n    }\n\n    this.parseFooter(stream);\n  }\n\n  /** @bundle box-codecs.js */\n  isAudio() {\n    return true;\n  }\n\n  /** @bundle box-codecs.js */\n  getChannelCount() {\n    return this.channel_count;\n  }\n\n  /** @bundle box-codecs.js */\n  getSampleRate() {\n    return this.samplerate;\n  }\n\n  /** @bundle box-codecs.js */\n  getSampleSize() {\n    return this.samplesize;\n  }\n\n  /** @bundle writing/sampleentry.js */\n  write(stream: MultiBufferStream) {\n    this.writeHeader(stream);\n    this.size += 2 * 4 + 3 * 4;\n    stream.writeUint32(0);\n    stream.writeUint32(0);\n    stream.writeUint16(this.channel_count);\n    stream.writeUint16(this.samplesize);\n    stream.writeUint16(0);\n    stream.writeUint16(0);\n    stream.writeUint32(this.samplerate << 16);\n    this.writeFooter(stream);\n  }\n}\n\nexport class SystemSampleEntry extends SampleEntry {\n  parse(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    this.parseFooter(stream);\n  }\n\n  /** @bundle writing/sampleentry.js */\n  write(stream: MultiBufferStream) {\n    this.writeHeader(stream);\n    this.writeFooter(stream);\n  }\n}\n","import type { Nalu } from '@types';\n\nexport class ParameterSetArray extends Array<Nalu> {\n  toString() {\n    let str = \"<table class='inner-table'>\";\n    str += '<thead><tr><th>length</th><th>nalu_data</th></tr></thead>';\n    str += '<tbody>';\n\n    for (let i = 0; i < this.length; i++) {\n      const nalu = this[i];\n      str += '<tr>';\n      str += '<td>' + nalu.length + '</td>';\n      str += '<td>';\n      str += nalu.data.reduce(function (str, byte) {\n        return str + byte.toString(16).padStart(2, '0');\n      }, '0x');\n      str += '</td></tr>';\n    }\n    str += '</tbody></table>';\n    return str;\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { DataStream } from '#/DataStream';\nimport { ParameterSetArray } from './displays/parameterSetArray';\n\nexport class avcCBox extends Box {\n  static override readonly fourcc = 'avcC' as const;\n  box_name = 'AVCConfigurationBox' as const;\n\n  configurationVersion: number;\n  AVCProfileIndication: number;\n  profile_compatibility: number;\n  AVCLevelIndication: number;\n  lengthSizeMinusOne: number;\n  nb_SPS_nalus: number;\n  SPS: ParameterSetArray;\n  nb_PPS_nalus: number;\n  PPS: ParameterSetArray;\n  ext: Uint8Array;\n\n  parse(stream: MultiBufferStream | DataStream) {\n    this.configurationVersion = stream.readUint8();\n    this.AVCProfileIndication = stream.readUint8();\n    this.profile_compatibility = stream.readUint8();\n    this.AVCLevelIndication = stream.readUint8();\n    this.lengthSizeMinusOne = stream.readUint8() & 0x3;\n    this.nb_SPS_nalus = stream.readUint8() & 0x1f;\n    let toparse = this.size - this.hdr_size - 6;\n    this.SPS = new ParameterSetArray();\n    for (let i = 0; i < this.nb_SPS_nalus; i++) {\n      const length = stream.readUint16();\n      this.SPS.push({ length, data: stream.readUint8Array(length) });\n      toparse -= 2 + length;\n    }\n    this.nb_PPS_nalus = stream.readUint8();\n    toparse--;\n    this.PPS = new ParameterSetArray();\n    for (let i = 0; i < this.nb_PPS_nalus; i++) {\n      const length = stream.readUint16();\n      this.PPS.push({ length, data: stream.readUint8Array(length) });\n      toparse -= 2 + length;\n    }\n    if (toparse > 0) {\n      this.ext = stream.readUint8Array(toparse);\n    }\n  }\n\n  /** @bundle writing/avcC.js */\n  write(stream: MultiBufferStream) {\n    this.size = 7;\n    for (let i = 0; i < this.SPS.length; i++) {\n      this.size += 2 + this.SPS[i].length;\n    }\n    for (let i = 0; i < this.PPS.length; i++) {\n      this.size += 2 + this.PPS[i].length;\n    }\n    if (this.ext) {\n      this.size += this.ext.length;\n    }\n    this.writeHeader(stream);\n    stream.writeUint8(this.configurationVersion);\n    stream.writeUint8(this.AVCProfileIndication);\n    stream.writeUint8(this.profile_compatibility);\n    stream.writeUint8(this.AVCLevelIndication);\n    stream.writeUint8(this.lengthSizeMinusOne + (63 << 2));\n    stream.writeUint8(this.SPS.length + (7 << 5));\n    for (let i = 0; i < this.SPS.length; i++) {\n      stream.writeUint16(this.SPS[i].length);\n      stream.writeUint8Array(this.SPS[i].data);\n    }\n    stream.writeUint8(this.PPS.length);\n    for (let i = 0; i < this.PPS.length; i++) {\n      stream.writeUint16(this.PPS[i].length);\n      stream.writeUint8Array(this.PPS[i].data);\n    }\n    if (this.ext) {\n      stream.writeUint8Array(this.ext);\n    }\n  }\n}\n","import { Box, FullBox } from '#/box';\nimport { ContainerBox } from '#/containerBox';\nimport type { co64Box } from '#/boxes/co64';\nimport type { cslgBox } from '#/boxes/cslg';\nimport type { cttsBox } from '#/boxes/ctts';\nimport type { elngBox } from '#/boxes/elng';\nimport type { elstBox } from '#/boxes/elst';\nimport type { hdlrBox } from '#/boxes/hdlr';\nimport type { ipmaBox } from '#/boxes/ipma';\nimport type { kindBox } from '#/boxes/kind';\nimport type { mdhdBox } from '#/boxes/mdhd';\nimport type { mehdBox } from '#/boxes/mehd';\nimport type { mvhdBox } from '#/boxes/mvhd';\nimport type { psshBox } from '#/boxes/pssh';\nimport type { sbgpBox } from '#/boxes/sbgp';\nimport type { sdtpBox } from '#/boxes/sdtp';\nimport type { sgpdBox } from '#/boxes/sgpd';\nimport type { stcoBox } from '#/boxes/stco';\nimport type { stdpBox } from '#/boxes/stdp';\nimport type { stscBox } from '#/boxes/stsc';\nimport type { stsdBox } from '#/boxes/stsd';\nimport type { stssBox } from '#/boxes/stss';\nimport type { stszBox } from '#/boxes/stsz';\nimport type { sttsBox } from '#/boxes/stts';\nimport type { stz2Box } from '#/boxes/stz2';\nimport type { subsBox } from '#/boxes/subs';\nimport type { tfdtBox } from '#/boxes/tfdt';\nimport type { tfhdBox } from '#/boxes/tfhd';\nimport type { tfraBox } from '#/boxes/tfra';\nimport type { tkhdBox } from '#/boxes/tkhd';\nimport type { trefBox } from '#/boxes/tref';\nimport type { trexBox } from '#/boxes/trex';\nimport type { trunBox } from '#/boxes/trun';\nimport type { tycoBox } from '#/boxes/tyco';\nimport type { SampleGroupInfo } from '#/isofile';\nimport type { Sample } from '@types';\nimport type { drefBox } from './dref';\nimport type { EntityToGroup } from './EntityToGroup/base';\nimport type { mfhdBox } from './mfhd';\nimport type { smhdBox } from './smhd';\nimport type { sthdBox } from './sthd';\nimport type { vmhdBox } from './vmhd';\nimport type { hvcCBox } from './hvcC';\nimport type { ispeBox } from './ispe';\nimport type { clapBox } from './clap';\nimport type { irotBox } from './irot';\nimport type { maxrBox } from './maxr';\nimport type { MultiBufferStream } from '#/buffer';\n\n/**********************************************************************************/\n/*                                                                                */\n/*                                   Basic Boxes                                  */\n/*                                                                                */\n/**********************************************************************************/\n\nexport class mdatBox extends Box {\n  static override readonly fourcc = 'mdat' as const;\n  box_name = 'MediaDataBox' as const;\n  stream?: MultiBufferStream;\n}\n\nexport class idatBox extends Box {\n  static override readonly fourcc = 'idat' as const;\n  box_name = 'ItemDataBox' as const;\n}\nexport class freeBox extends Box {\n  static override readonly fourcc = 'free' as const;\n  box_name = 'FreeSpaceBox' as const;\n}\nexport class skipBox extends Box {\n  static override readonly fourcc = 'skip' as const;\n  box_name = 'FreeSpaceBox' as const;\n}\n\n/**********************************************************************************/\n/*                                                                                */\n/*                                   Full Boxes                                   */\n/*                                                                                */\n/**********************************************************************************/\n\nexport class hmhdBox extends FullBox {\n  static override readonly fourcc = 'hmhd' as const;\n  box_name = 'HintMediaHeaderBox' as const;\n}\nexport class nmhdBox extends FullBox {\n  static override readonly fourcc = 'nmhd' as const;\n  box_name = 'NullMediaHeaderBox' as const;\n}\nexport class iodsBox extends FullBox {\n  static override readonly fourcc = 'iods' as const;\n  box_name = 'ObjectDescriptorBox' as const;\n}\nexport class xmlBox extends FullBox {\n  static override readonly fourcc = 'xml ' as const;\n  box_name = 'XMLBox' as const;\n}\nexport class bxmlBox extends FullBox {\n  static override readonly fourcc = 'bxml' as const;\n  box_name = 'BinaryXMLBox' as const;\n}\nexport class iproBox extends FullBox {\n  static override readonly fourcc = 'ipro' as const;\n  box_name = 'ItemProtectionBox' as const;\n\n  sinfs: Array<sinfBox> = [];\n  get protections() {\n    return this.sinfs;\n  }\n}\n\n/**********************************************************************************/\n/*                                                                                */\n/*                                Container Boxes                                 */\n/*                                                                                */\n/**********************************************************************************/\n\nexport class moovBox extends ContainerBox {\n  static override readonly fourcc = 'moov' as const;\n  box_name = 'MovieBox' as const;\n  timescale: number;\n  mvhd: mvhdBox;\n  mvhds: Array<mvhdBox>;\n  mvex?: mvexBox;\n  mvexs: Array<mvexBox>;\n  iods: iodsBox;\n  iodss: Array<iodsBox>;\n  trak: trakBox;\n\n  traks: Array<trakBox> = [];\n  psshs: Array<psshBox> = [];\n  subBoxNames = ['trak', 'pssh'] as const;\n}\nexport class trakBox extends ContainerBox {\n  static override readonly fourcc = 'trak' as const;\n  box_name = 'TrackBox' as const;\n  mdia: mdiaBox;\n  mdias: Array<mdiaBox>;\n  tkhd: tkhdBox;\n  tkhds: Array<tkhdBox>;\n  tref: trefBox;\n  trefs: Array<trefBox>;\n  edts?: edtsBox;\n  edtss: Array<edtsBox>;\n  udta: udtaBox;\n  udtas: Array<udtaBox>;\n  samples_duration: number;\n  samples: Array<Sample> = [];\n  samples_size: number;\n  nextSample: number;\n  lastValidSample: number;\n  sample_groups_info: Array<SampleGroupInfo>;\n  first_dts: number;\n  first_traf_merged: boolean;\n  has_fragment_subsamples: boolean;\n}\nexport class edtsBox extends ContainerBox {\n  static override readonly fourcc = 'edts' as const;\n  box_name = 'EditBox' as const;\n  elst?: elstBox;\n  elsts: Array<elstBox>;\n}\nexport class mdiaBox extends ContainerBox {\n  static override readonly fourcc = 'mdia' as const;\n  box_name = 'MediaBox' as const;\n  elng: elngBox;\n  elngs: Array<elngBox>;\n  hdlr: hdlrBox;\n  hdlrs: Array<hdlrBox>;\n  mdhd: mdhdBox;\n  mdhds: Array<mdhdBox>;\n  minf: minfBox;\n  minfs: Array<minfBox>;\n}\nexport class minfBox extends ContainerBox {\n  static override readonly fourcc = 'minf' as const;\n  box_name = 'MediaInformationBox' as const;\n  stbl: stblBox;\n  stbls: Array<stblBox>;\n  hmhd: hmhdBox;\n  hmhds: Array<hmhdBox>;\n  vmhd?: vmhdBox;\n  vmhds?: Array<vmhdBox>;\n  smhd?: smhdBox;\n  smhds?: Array<smhdBox>;\n  sthd?: sthdBox;\n  sthds?: Array<sthdBox>;\n  nmhd?: nmhdBox;\n  nmhds?: Array<nmhdBox>;\n  dinf: dinfBox;\n  dinfs: Array<dinfBox>;\n  dref: drefBox;\n  drefs: Array<drefBox>;\n}\nexport class dinfBox extends ContainerBox {\n  static override readonly fourcc = 'dinf' as const;\n  box_name = 'DataInformationBox' as const;\n}\nexport class stblBox extends ContainerBox {\n  static override readonly fourcc = 'stbl' as const;\n  box_name = 'SampleTableBox' as const;\n  cslg: cslgBox;\n  cslgs: Array<cslgBox>;\n  stsd: stsdBox;\n  stsds: Array<stsdBox>;\n  stsc: stscBox;\n  stscs: Array<stscBox>;\n  stco: stcoBox;\n  stcos: Array<stcoBox>;\n  co64: co64Box;\n  co64s: Array<co64Box>;\n  stsz: stszBox;\n  stszs: Array<stszBox>;\n  stz2: stz2Box;\n  stz2s: Array<stz2Box>;\n  stts: sttsBox;\n  sttss: Array<sttsBox>;\n  ctts: cttsBox;\n  cttss: Array<cttsBox>;\n  stss: stssBox;\n  stsss: Array<stssBox>;\n  subs: subsBox;\n  subss: Array<subsBox>;\n  stdp: stdpBox;\n  stdps: Array<stdpBox>;\n  sdtp: sdtpBox;\n  sdtps: Array<sdtpBox>;\n\n  sgpds: Array<sgpdBox> = [];\n  sbgps: Array<sbgpBox> = [];\n  subBoxNames = ['sgpd', 'sbgp'];\n}\nexport class mvexBox extends ContainerBox {\n  static override readonly fourcc = 'mvex' as const;\n  box_name = 'MovieExtendsBox' as const;\n  trex: trexBox;\n  mehd: mehdBox;\n  mehds: Array<mehdBox>;\n\n  trexs: Array<trexBox> = [];\n  subBoxNames = ['trex'];\n}\nexport class moofBox extends ContainerBox {\n  static override readonly fourcc = 'moof' as const;\n  box_name = 'MovieFragmentBox' as const;\n  mfhd: mfhdBox;\n  mfhds: Array<mfhdBox>;\n  traf: trafBox;\n\n  trafs: Array<trafBox> = [];\n  subBoxNames = ['traf'];\n}\nexport class trafBox extends ContainerBox {\n  static override readonly fourcc = 'traf' as const;\n  box_name = 'TrackFragmentBox' as const;\n  subs: subsBox;\n  subss: Array<subsBox>;\n  tfdt: tfdtBox;\n  tfdts: Array<tfdtBox>;\n  tfhd: tfhdBox;\n  tfhds: Array<tfhdBox>;\n  trun: trunBox;\n\n  first_sample_index: number;\n  sample_number: number;\n  sample_groups_info: Array<SampleGroupInfo>;\n\n  truns: Array<trunBox> = [];\n  sgpds: Array<sgpdBox> = [];\n  sbgps: Array<sbgpBox> = [];\n  subBoxNames = ['trun', 'sgpd', 'sbgp'];\n}\nexport class vttcBox extends ContainerBox {\n  static override readonly fourcc = 'vttc' as const;\n  box_name = 'VTTCueBox' as const;\n}\n\nexport class mfraBox extends ContainerBox {\n  static override readonly fourcc = 'mfra' as const;\n  box_name = 'MovieFragmentRandomAccessBox' as const;\n  tfras: Array<tfraBox> = [];\n  subBoxNames = ['tfra'] as const;\n}\nexport class mecoBox extends ContainerBox {\n  static override readonly fourcc = 'meco' as const;\n  box_name = 'AdditionalMetadataContainerBox' as const;\n}\n\nexport class hntiBox extends ContainerBox {\n  static override readonly fourcc = 'hnti' as const;\n  box_name = 'trackhintinformation' as const;\n  subBoxNames = ['sdp ', 'rtp '] as const;\n}\nexport class hinfBox extends ContainerBox {\n  static override readonly fourcc = 'hinf' as const;\n  box_name = 'hintstatisticsbox' as const;\n  maxrs: Array<maxrBox> = [];\n  subBoxNames = ['maxr'] as const;\n}\nexport class strkBox extends ContainerBox {\n  static override readonly fourcc = 'strk' as const;\n  box_name = 'SubTrackBox' as const;\n}\nexport class strdBox extends ContainerBox {\n  static override readonly fourcc = 'strd' as const;\n  box_name = 'SubTrackDefinitionBox' as const;\n}\nexport class sinfBox extends ContainerBox {\n  static override readonly fourcc = 'sinf' as const;\n  box_name = 'ProtectionSchemeInfoBox' as const;\n}\nexport class rinfBox extends ContainerBox {\n  static override readonly fourcc = 'rinf' as const;\n  box_name = 'RestrictedSchemeInfoBox' as const;\n}\nexport class schiBox extends ContainerBox {\n  static override readonly fourcc = 'schi' as const;\n  box_name = 'SchemeInformationBox' as const;\n}\nexport class trgrBox extends ContainerBox {\n  static override readonly fourcc = 'trgr' as const;\n  box_name = 'TrackGroupBox' as const;\n}\nexport class udtaBox extends ContainerBox {\n  static override readonly fourcc = 'udta' as const;\n  box_name = 'UserDataBox' as const;\n  kinds: Array<kindBox> = [];\n  strks: Array<strkBox> = [];\n  subBoxNames = ['kind', 'strk'] as const;\n}\nexport class iprpBox extends ContainerBox {\n  static override readonly fourcc = 'iprp' as const;\n  box_name = 'ItemPropertiesBox' as const;\n  ipco: ipcoBox;\n\n  ipmas: Array<ipmaBox> = [];\n  subBoxNames = ['ipma'] as const;\n}\nexport class ipcoBox extends ContainerBox {\n  static override readonly fourcc = 'ipco' as const;\n  box_name = 'ItemPropertyContainerBox' as const;\n  hvcCs: Array<hvcCBox> = [];\n  ispes: Array<ispeBox> = [];\n  claps: Array<clapBox> = [];\n  irots: Array<irotBox> = [];\n  subBoxNames = ['hvcC', 'ispe', 'clap', 'irot'] as const;\n}\nexport class grplBox extends ContainerBox {\n  static override readonly fourcc = 'grpl' as const;\n  box_name = 'GroupsListBox' as const;\n  boxes: Array<EntityToGroup>;\n}\nexport class j2kHBox extends ContainerBox {\n  static override readonly fourcc = 'j2kH' as const;\n  box_name = 'J2KHeaderInfoBox' as const;\n}\nexport class etypBox extends ContainerBox {\n  static override readonly fourcc = 'etyp' as const;\n  box_name = 'ExtendedTypeBox' as const;\n  tycos: Array<tycoBox> = [];\n  subBoxNames = ['tyco'] as const;\n}\nexport class povdBox extends ContainerBox {\n  static override readonly fourcc = 'povd' as const;\n  box_name = 'ProjectedOmniVideoBox' as const;\n  subBoxNames = ['prfr'] as const;\n}\n","import { Box, FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { OK } from '#/constants';\nimport { Log } from '#/log';\nimport { parseOneBox } from '#/parser';\n\nexport class drefBox extends FullBox {\n  static override readonly fourcc = 'dref' as const;\n  box_name = 'DataReferenceBox' as const;\n\n  entries: Array<Box>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.entries = [];\n    const entry_count = stream.readUint32();\n    for (let i = 0; i < entry_count; i++) {\n      const ret = parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\n      if (ret.code === OK) {\n        const box = ret.box;\n        this.entries.push(box);\n      } else {\n        return;\n      }\n    }\n  }\n\n  /** @bundle writing/dref.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 4; //\n    this.writeHeader(stream);\n    stream.writeUint32(this.entries.length);\n    for (let i = 0; i < this.entries.length; i++) {\n      this.entries[i].write(stream);\n      this.size += this.entries[i].size;\n    }\n    /* adjusting the size, now that all sub-boxes are known */\n    Log.debug('BoxWriter', 'Adjusting box ' + this.type + ' with new size ' + this.size);\n    stream.adjustUint32(this.sizePosition, this.size);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class elngBox extends FullBox {\n  static override readonly fourcc = 'elng' as const;\n  box_name = 'ExtendedLanguageBox' as const;\n\n  extended_language: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.extended_language = stream.readString(this.size - this.hdr_size);\n  }\n\n  /** @bundle writing/elng.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = this.extended_language.length;\n    this.writeHeader(stream);\n    stream.writeString(this.extended_language);\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport type { DataStream } from '#/DataStream';\n\nexport class ftypBox extends Box {\n  static override readonly fourcc = 'ftyp' as const;\n  box_name = 'FileTypeBox' as const;\n\n  major_brand: string;\n  minor_version: number;\n  compatible_brands: Array<string>;\n\n  parse(stream: MultiBufferStream) {\n    let toparse = this.size - this.hdr_size;\n    this.major_brand = stream.readString(4);\n    this.minor_version = stream.readUint32();\n    toparse -= 8;\n    this.compatible_brands = [];\n    let i = 0;\n    while (toparse >= 4) {\n      this.compatible_brands[i] = stream.readString(4);\n      toparse -= 4;\n      i++;\n    }\n  }\n\n  /** @bundle writing/ftyp.js */\n  write(stream: MultiBufferStream | DataStream) {\n    this.size = 8 + 4 * this.compatible_brands.length;\n    this.writeHeader(stream);\n    stream.writeString(this.major_brand, undefined, 4);\n    stream.writeUint32(this.minor_version);\n    for (let i = 0; i < this.compatible_brands.length; i++) {\n      stream.writeString(this.compatible_brands[i], undefined, 4);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\n\nexport class hdlrBox extends FullBox {\n  static override readonly fourcc = 'hdlr' as const;\n  box_name = 'HandlerBox' as const;\n\n  version: number;\n  handler: string;\n  name: string;\n  flags: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 0) {\n      stream.readUint32();\n      this.handler = stream.readString(4);\n      stream.readUint32Array(3);\n      if (!this.isEndOfBox(stream)) {\n        const name_size = this.start + this.size - stream.getPosition();\n        this.name = stream.readCString();\n\n        // Check if last byte was null-terminator indeed\n        const end = this.start + this.size - 1;\n        stream.seek(end);\n        const lastByte = stream.readUint8();\n        if (lastByte !== 0 && name_size > 1) {\n          Log.info(\n            'BoxParser',\n            'Warning: hdlr name is not null-terminated, possibly length-prefixed string. Trimming first byte.',\n          );\n          this.name = this.name.slice(1);\n        }\n      }\n    }\n  }\n\n  /** @bundle writing/hldr.js */\n  write(stream: MultiBufferStream) {\n    this.size = 5 * 4 + this.name.length + 1;\n    this.version = 0;\n    this.flags = 0;\n    this.writeHeader(stream);\n    stream.writeUint32(0);\n    stream.writeString(this.handler, undefined, 4);\n    stream.writeUint32Array([0, 0, 0]); // reserved\n    stream.writeCString(this.name);\n  }\n}\n","import { Box } from '#/box';\nimport { DataStream } from '#/DataStream';\nimport type { NaluArray } from '@types';\nimport type { NALUArrays } from './displays/naluArrays';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class hvcCBox extends Box {\n  static override readonly fourcc = 'hvcC' as const;\n  box_name = 'HEVCConfigurationBox' as const;\n\n  configurationVersion: number;\n  general_profile_space: number;\n  general_tier_flag: number;\n  general_profile_idc: number;\n  general_profile_compatibility: number;\n  general_constraint_indicator: Uint8Array;\n  general_level_idc: number;\n  min_spatial_segmentation_idc: number;\n  parallelismType: number;\n  chroma_format_idc: number;\n  bit_depth_luma_minus8: number;\n  bit_depth_chroma_minus8: number;\n  avgFrameRate: number;\n  constantFrameRate: number;\n  numTemporalLayers: number;\n  temporalIdNested: number;\n  lengthSizeMinusOne: number;\n  nalu_arrays: NALUArrays;\n\n  parse(stream: MultiBufferStream | DataStream) {\n    this.configurationVersion = stream.readUint8();\n    let tmp_byte = stream.readUint8();\n    this.general_profile_space = tmp_byte >> 6;\n    this.general_tier_flag = (tmp_byte & 0x20) >> 5;\n    this.general_profile_idc = tmp_byte & 0x1f;\n    this.general_profile_compatibility = stream.readUint32();\n    this.general_constraint_indicator = stream.readUint8Array(6);\n    this.general_level_idc = stream.readUint8();\n    this.min_spatial_segmentation_idc = stream.readUint16() & 0xfff;\n    this.parallelismType = stream.readUint8() & 0x3;\n    this.chroma_format_idc = stream.readUint8() & 0x3;\n    this.bit_depth_luma_minus8 = stream.readUint8() & 0x7;\n    this.bit_depth_chroma_minus8 = stream.readUint8() & 0x7;\n    this.avgFrameRate = stream.readUint16();\n    tmp_byte = stream.readUint8();\n    this.constantFrameRate = tmp_byte >> 6;\n    this.numTemporalLayers = (tmp_byte & 0xd) >> 3;\n    this.temporalIdNested = (tmp_byte & 0x4) >> 2;\n    this.lengthSizeMinusOne = tmp_byte & 0x3;\n\n    this.nalu_arrays = [];\n    const numOfArrays = stream.readUint8();\n    for (let i = 0; i < numOfArrays; i++) {\n      const nalu_array = [] as NaluArray;\n      this.nalu_arrays.push(nalu_array);\n      tmp_byte = stream.readUint8();\n      nalu_array.completeness = (tmp_byte & 0x80) >> 7;\n      nalu_array.nalu_type = tmp_byte & 0x3f;\n      const numNalus = stream.readUint16();\n      for (let j = 0; j < numNalus; j++) {\n        const length = stream.readUint16();\n        nalu_array.push({\n          data: stream.readUint8Array(length),\n        });\n      }\n    }\n  }\n\n  /** @bundle writing/write.js */\n  write(stream: DataStream) {\n    this.size = 23;\n\n    for (let i = 0; i < this.nalu_arrays.length; i++) {\n      this.size += 3;\n      for (let j = 0; j < this.nalu_arrays[i].length; j++) {\n        this.size += 2 + this.nalu_arrays[i][j].data.length;\n      }\n    }\n\n    this.writeHeader(stream);\n\n    stream.writeUint8(this.configurationVersion);\n    stream.writeUint8(\n      (this.general_profile_space << 6) + (this.general_tier_flag << 5) + this.general_profile_idc,\n    );\n    stream.writeUint32(this.general_profile_compatibility);\n    stream.writeUint8Array(this.general_constraint_indicator);\n    stream.writeUint8(this.general_level_idc);\n    stream.writeUint16(this.min_spatial_segmentation_idc + (15 << 24));\n    stream.writeUint8(this.parallelismType + (63 << 2));\n    stream.writeUint8(this.chroma_format_idc + (63 << 2));\n    stream.writeUint8(this.bit_depth_luma_minus8 + (31 << 3));\n    stream.writeUint8(this.bit_depth_chroma_minus8 + (31 << 3));\n    stream.writeUint16(this.avgFrameRate);\n    stream.writeUint8(\n      (this.constantFrameRate << 6) +\n        (this.numTemporalLayers << 3) +\n        (this.temporalIdNested << 2) +\n        this.lengthSizeMinusOne,\n    );\n    stream.writeUint8(this.nalu_arrays.length);\n    for (let i = 0; i < this.nalu_arrays.length; i++) {\n      // bit(1) array_completeness + bit(1) reserved = 0 + bit(6) nal_unit_type\n      stream.writeUint8((this.nalu_arrays[i].completeness << 7) + this.nalu_arrays[i].nalu_type);\n      stream.writeUint16(this.nalu_arrays[i].length);\n      for (let j = 0; j < this.nalu_arrays[i].length; j++) {\n        stream.writeUint16(this.nalu_arrays[i][j].data.length);\n        stream.writeUint8Array(this.nalu_arrays[i][j].data);\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { MAX_UINT32 } from '#/constants';\n\nexport class mdhdBox extends FullBox {\n  static override readonly fourcc = 'mdhd' as const;\n  box_name = 'MediaHeaderBox' as const;\n\n  creation_time: number;\n  modification_time: number;\n  timescale: number;\n  duration: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 1) {\n      this.creation_time = stream.readUint64();\n      this.modification_time = stream.readUint64();\n      this.timescale = stream.readUint32();\n      this.duration = stream.readUint64();\n    } else {\n      this.creation_time = stream.readUint32();\n      this.modification_time = stream.readUint32();\n      this.timescale = stream.readUint32();\n      this.duration = stream.readUint32();\n    }\n    this.parseLanguage(stream);\n    stream.readUint16();\n  }\n\n  /** @bundle writing/mdhd.js */\n  write(stream: MultiBufferStream) {\n    const useVersion1 =\n      this.modification_time > MAX_UINT32 ||\n      this.creation_time > MAX_UINT32 ||\n      this.duration > MAX_UINT32 ||\n      this.version === 1;\n    this.version = useVersion1 ? 1 : 0;\n\n    this.size = 4 * 4 + 2 * 2;\n    this.size += useVersion1 ? 3 * 4 : 0; // creation_time, modification_time, duration\n\n    this.flags = 0;\n    this.writeHeader(stream);\n\n    if (useVersion1) {\n      stream.writeUint64(this.creation_time);\n      stream.writeUint64(this.modification_time);\n      stream.writeUint32(this.timescale);\n      stream.writeUint64(this.duration);\n    } else {\n      stream.writeUint32(this.creation_time);\n      stream.writeUint32(this.modification_time);\n      stream.writeUint32(this.timescale);\n      stream.writeUint32(this.duration);\n    }\n\n    stream.writeUint16(this.language);\n    stream.writeUint16(0);\n  }\n}\n","import { Log } from '#//log';\nimport { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { MAX_UINT32 } from '#/constants';\n\nexport class mehdBox extends FullBox {\n  static override readonly fourcc = 'mehd' as const;\n  box_name = 'MovieExtendsHeaderBox' as const;\n\n  fragment_duration: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.flags & 0x1) {\n      Log.warn('BoxParser', 'mehd box incorrectly uses flags set to 1, converting version to 1');\n      this.version = 1;\n    }\n    if (this.version === 1) {\n      this.fragment_duration = stream.readUint64();\n    } else {\n      this.fragment_duration = stream.readUint32();\n    }\n  }\n\n  /** @bundle writing/mehd.js */\n  write(stream: MultiBufferStream) {\n    const useVersion1 = this.fragment_duration > MAX_UINT32 || this.version === 1;\n    this.version = useVersion1 ? 1 : 0;\n\n    this.size = 4;\n    this.size += useVersion1 ? 4 : 0; // fragment_duration\n\n    this.flags = 0;\n    this.writeHeader(stream);\n\n    if (useVersion1) {\n      stream.writeUint64(this.fragment_duration);\n    } else {\n      stream.writeUint32(this.fragment_duration);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\n\nexport class infeBox extends FullBox {\n  static override readonly fourcc = 'infe' as const;\n  box_name = 'ItemInfoEntry' as const;\n\n  item_ID: number;\n  item_protection_index: number;\n  item_name: string;\n  content_type: string;\n  content_encoding: string;\n  extension_type: string;\n  item_type: string;\n  item_uri_type: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 0 || this.version === 1) {\n      this.item_ID = stream.readUint16();\n      this.item_protection_index = stream.readUint16();\n      this.item_name = stream.readCString();\n      this.content_type = stream.readCString();\n      if (!this.isEndOfBox(stream)) {\n        this.content_encoding = stream.readCString();\n      }\n    }\n    if (this.version === 1) {\n      this.extension_type = stream.readString(4);\n      Log.warn('BoxParser', 'Cannot parse extension type');\n      stream.seek(this.start + this.size);\n      return;\n    }\n    if (this.version >= 2) {\n      if (this.version === 2) {\n        this.item_ID = stream.readUint16();\n      } else if (this.version === 3) {\n        this.item_ID = stream.readUint32();\n      }\n      this.item_protection_index = stream.readUint16();\n      this.item_type = stream.readString(4);\n      this.item_name = stream.readCString();\n      if (this.item_type === 'mime') {\n        this.content_type = stream.readCString();\n        this.content_encoding = stream.readCString();\n      } else if (this.item_type === 'uri ') {\n        this.item_uri_type = stream.readCString();\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport { infeBox } from '#/boxes/infe';\nimport type { MultiBufferStream } from '#/buffer';\nimport { OK } from '#/constants';\nimport { Log } from '#/log';\nimport { parseOneBox } from '#/parser';\nimport type { BoxKind } from '@types';\n\nexport class iinfBox extends FullBox {\n  static override readonly fourcc = 'iinf' as const;\n  box_name = 'ItemInfoBox' as const;\n\n  version: number;\n  entry_count: number;\n  item_infos: Array<infeBox>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 0) {\n      this.entry_count = stream.readUint16();\n    } else {\n      this.entry_count = stream.readUint32();\n    }\n\n    this.item_infos = [];\n\n    for (let i = 0; i < this.entry_count; i++) {\n      const ret = parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\n      if (ret.code === OK) {\n        const box = ret.box as BoxKind;\n        if (box.type === 'infe') {\n          this.item_infos[i] = box as infeBox;\n        } else {\n          Log.error('BoxParser', \"Expected 'infe' box, got \" + ret.box.type, stream.isofile);\n        }\n      } else {\n        return;\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport interface Extent {\n  extent_index: number;\n  extent_offset: number;\n  extent_length: number;\n}\n\nexport class ilocBox extends FullBox {\n  static override readonly fourcc = 'iloc' as const;\n  box_name = 'ItemLocationBox' as const;\n\n  offset_size: number;\n  length_size: number;\n  base_offset_size: number;\n  index_size: number;\n  items: Array<{\n    base_offset: number;\n    construction_method: number;\n    item_ID: number;\n    data_reference_index: number;\n    extents: Array<Extent>;\n  }>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    let byte: number;\n    byte = stream.readUint8();\n    this.offset_size = (byte >> 4) & 0xf;\n    this.length_size = byte & 0xf;\n    byte = stream.readUint8();\n    this.base_offset_size = (byte >> 4) & 0xf;\n    if (this.version === 1 || this.version === 2) {\n      this.index_size = byte & 0xf;\n    } else {\n      this.index_size = 0;\n      // reserved = byte & 0xF;\n    }\n    this.items = [];\n    let item_count = 0;\n    if (this.version < 2) {\n      item_count = stream.readUint16();\n    } else if (this.version === 2) {\n      item_count = stream.readUint32();\n    } else {\n      throw new Error('version of iloc box not supported');\n    }\n    for (let i = 0; i < item_count; i++) {\n      let item_ID = 0;\n      let construction_method = 0;\n      let base_offset = 0;\n\n      if (this.version < 2) {\n        item_ID = stream.readUint16();\n      } else if (this.version === 2) {\n        item_ID = stream.readUint32();\n      } else {\n        throw new Error('version of iloc box not supported');\n      }\n      if (this.version === 1 || this.version === 2) {\n        construction_method = stream.readUint16() & 0xf;\n      } else {\n        construction_method = 0;\n      }\n\n      const data_reference_index = stream.readUint16();\n      switch (this.base_offset_size) {\n        case 0:\n          base_offset = 0;\n          break;\n        case 4:\n          base_offset = stream.readUint32();\n          break;\n        case 8:\n          base_offset = stream.readUint64();\n          break;\n        default:\n          throw new Error('Error reading base offset size');\n      }\n\n      const extents: Array<Extent> = [];\n      const extent_count = stream.readUint16();\n\n      for (let j = 0; j < extent_count; j++) {\n        let extent_index = 0;\n        let extent_offset = 0;\n        let extent_length = 0;\n\n        if (this.version === 1 || this.version === 2) {\n          switch (this.index_size) {\n            case 0:\n              extent_index = 0;\n              break;\n            case 4:\n              extent_index = stream.readUint32();\n              break;\n            case 8:\n              extent_index = stream.readUint64();\n              break;\n            default:\n              throw new Error('Error reading extent index');\n          }\n        }\n\n        switch (this.offset_size) {\n          case 0:\n            extent_offset = 0;\n            break;\n          case 4:\n            extent_offset = stream.readUint32();\n            break;\n          case 8:\n            extent_offset = stream.readUint64();\n            break;\n          default:\n            throw new Error('Error reading extent index');\n        }\n\n        switch (this.length_size) {\n          case 0:\n            extent_length = 0;\n            break;\n          case 4:\n            extent_length = stream.readUint32();\n            break;\n          case 8:\n            extent_length = stream.readUint64();\n            break;\n          default:\n            throw new Error('Error reading extent index');\n        }\n\n        extents.push({ extent_index, extent_length, extent_offset });\n      }\n\n      this.items.push({\n        base_offset,\n        construction_method,\n        item_ID,\n        data_reference_index,\n        extents,\n      });\n    }\n  }\n}\n","import { Box, FullBox, SingleItemTypeReferenceBox, SingleItemTypeReferenceBoxLarge } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { OK } from '#/constants';\nimport { Log } from '#/log';\nimport { parseOneBox } from '#/parser';\n\nconst REFERENCE_TYPE_NAMES = {\n  auxl: 'Auxiliary image item',\n  base: 'Pre-derived image item base',\n  cdsc: 'Item describes referenced item',\n  dimg: 'Derived image item',\n  dpnd: 'Item coding dependency',\n  eroi: 'Region',\n  evir: 'EVC slice',\n  exbl: 'Scalable image item',\n  'fdl ': 'File delivery',\n  font: 'Font item',\n  iloc: 'Item data location',\n  mask: 'Region mask',\n  mint: 'Data integrity',\n  pred: 'Predictively coded item',\n  prem: 'Pre-multiplied item',\n  tbas: 'HEVC tile track base item',\n  text: 'Text item',\n  thmb: 'Thumbnail image item',\n};\n\nexport class irefBox extends FullBox {\n  static override readonly fourcc = 'iref' as const;\n  box_name = 'ItemReferenceBox' as const;\n\n  static allowed_types = [\n    'auxl',\n    'base',\n    'cdsc',\n    'dimg',\n    'dpnd',\n    'eroi',\n    'evir',\n    'exbl',\n    'fdl ',\n    'font',\n    'iloc',\n    'mask',\n    'mint',\n    'pred',\n    'prem',\n    'tbas',\n    'text',\n    'thmb',\n  ] as const;\n\n  references: Array<SingleItemTypeReferenceBox | SingleItemTypeReferenceBoxLarge> = [];\n  version: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.references = [];\n\n    while (stream.getPosition() < this.start + this.size) {\n      const ret = parseOneBox(stream, true, this.size - (stream.getPosition() - this.start));\n      if (ret.code === OK) {\n        let name = 'Unknown item reference';\n        if (!irefBox.allowed_types.includes(ret.type as (typeof irefBox.allowed_types)[number])) {\n          Log.warn('BoxParser', `Unknown item reference type: '${ret.type}'`);\n        } else name = REFERENCE_TYPE_NAMES[ret.type];\n\n        const box =\n          this.version === 0\n            ? new SingleItemTypeReferenceBox(ret.type, ret.size, name, ret.hdr_size, ret.start)\n            : new SingleItemTypeReferenceBoxLarge(\n                ret.type,\n                ret.size,\n                name,\n                ret.hdr_size,\n                ret.start,\n              );\n\n        if (box.write === Box.prototype.write && box.type !== 'mdat') {\n          Log.warn(\n            'BoxParser',\n            box.type +\n              ' box writing not yet implemented, keeping unparsed data in memory for later write',\n          );\n          box.parseDataAndRewind(stream);\n        }\n        box.parse(stream);\n        this.references.push(box);\n      } else {\n        return;\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class pitmBox extends FullBox {\n  static override readonly fourcc = 'pitm' as const;\n  box_name = 'PrimaryItemBox' as const;\n\n  item_id: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 0) {\n      this.item_id = stream.readUint16();\n    } else {\n      this.item_id = stream.readUint32();\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport { dinfBox, grplBox, idatBox, iproBox, iprpBox } from '#/boxes/defaults';\nimport { hdlrBox } from '#/boxes/hdlr';\nimport { iinfBox } from '#/boxes/iinf';\nimport { ilocBox } from '#/boxes/iloc';\nimport { irefBox } from '#/boxes/iref';\nimport { pitmBox } from '#/boxes/pitm';\nimport type { MultiBufferStream } from '#/buffer';\nimport { ContainerBox } from '#/containerBox';\n\nexport class metaBox extends FullBox {\n  static override readonly fourcc = 'meta' as const;\n  box_name = 'MetaBox' as const;\n\n  isQT = false; // Flag to indicate if this is a QT meta box\n\n  hdlr: hdlrBox;\n  hdlrs: Array<hdlrBox>;\n  iinf: iinfBox;\n  iinfs: Array<iinfBox>;\n  idat: idatBox;\n  idats: Array<idatBox>;\n  ipro: iproBox;\n  ipros: Array<iproBox>;\n  grpl: grplBox;\n  grpls: Array<grplBox>;\n  iloc: ilocBox;\n  ilocs: Array<ilocBox>;\n  iprp: iprpBox;\n  iprps: Array<iprpBox>;\n  pitm: pitmBox;\n  pitms: Array<pitmBox>;\n  iref: irefBox;\n  irefs: Array<irefBox>;\n  dinf: dinfBox;\n  dinfs: Array<dinfBox>;\n\n  parse(stream: MultiBufferStream) {\n    const pos = stream.getPosition();\n\n    // Try to check if this is a QT meta box\n    if (this.size > 8) {\n      stream.readUint32(); // Skip size\n      const qtType = stream.readString(4);\n      switch (qtType) {\n        case 'hdlr':\n        case 'mhdr':\n        case 'keys':\n        case 'ilst':\n        case 'ctry':\n        case 'lang':\n          this.isQT = true;\n          break;\n        default:\n          break;\n      }\n      stream.seek(pos);\n    }\n\n    // meta is a FullBox in MPEG-4 and a ContainerBox in QTFF\n    if (!this.isQT) this.parseFullHeader(stream);\n    ContainerBox.prototype.parse.call(this, stream);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class mfhdBox extends FullBox {\n  static override readonly fourcc = 'mfhd' as const;\n  box_name = 'MovieFragmentHeaderBox' as const;\n\n  sequence_number: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.sequence_number = stream.readUint32();\n  }\n\n  /** @bundle writing/mfhd.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 4;\n    this.writeHeader(stream);\n    stream.writeUint32(this.sequence_number);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { MAX_UINT32 } from '#/constants';\nimport type { Matrix, Output } from '@types';\n\nexport class mvhdBox extends FullBox {\n  static override readonly fourcc = 'mvhd' as const;\n  box_name = 'MovieHeaderBox' as const;\n\n  creation_time: number;\n  modification_time: number;\n  timescale: number;\n  duration: number;\n  rate: number;\n  volume: number;\n  next_track_id: number;\n  matrix: Matrix;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 1) {\n      this.creation_time = stream.readUint64();\n      this.modification_time = stream.readUint64();\n      this.timescale = stream.readUint32();\n      this.duration = stream.readUint64();\n    } else {\n      this.creation_time = stream.readUint32();\n      this.modification_time = stream.readUint32();\n      this.timescale = stream.readUint32();\n      this.duration = stream.readUint32();\n    }\n    this.rate = stream.readUint32();\n    this.volume = stream.readUint16() >> 8;\n    stream.readUint16();\n    stream.readUint32Array(2);\n    this.matrix = stream.readInt32Array(9);\n    stream.readUint32Array(6);\n    this.next_track_id = stream.readUint32();\n  }\n\n  /** @bundle writing/mvhd.js */\n  write(stream: MultiBufferStream) {\n    const useVersion1 =\n      this.modification_time > MAX_UINT32 ||\n      this.creation_time > MAX_UINT32 ||\n      this.duration > MAX_UINT32 ||\n      this.version === 1;\n    this.version = useVersion1 ? 1 : 0;\n\n    this.size = 4 * 4 + 20 * 4;\n    this.size += useVersion1 ? 3 * 4 : 0; // creation_time, modification_time, duration\n\n    this.flags = 0;\n    this.writeHeader(stream);\n\n    if (useVersion1) {\n      stream.writeUint64(this.creation_time);\n      stream.writeUint64(this.modification_time);\n      stream.writeUint32(this.timescale);\n      stream.writeUint64(this.duration);\n    } else {\n      stream.writeUint32(this.creation_time);\n      stream.writeUint32(this.modification_time);\n      stream.writeUint32(this.timescale);\n      stream.writeUint32(this.duration);\n    }\n    stream.writeUint32(this.rate);\n    stream.writeUint16(this.volume << 8);\n    stream.writeUint16(0);\n    stream.writeUint32(0);\n    stream.writeUint32(0);\n    stream.writeInt32Array(this.matrix);\n    stream.writeUint32(0);\n    stream.writeUint32(0);\n    stream.writeUint32(0);\n    stream.writeUint32(0);\n    stream.writeUint32(0);\n    stream.writeUint32(0);\n    stream.writeUint32(this.next_track_id);\n  }\n\n  /** @bundle box-print.js */\n  print(output: Output) {\n    super.printHeader(output);\n    output.log(output.indent + 'creation_time: ' + this.creation_time);\n    output.log(output.indent + 'modification_time: ' + this.modification_time);\n    output.log(output.indent + 'timescale: ' + this.timescale);\n    output.log(output.indent + 'duration: ' + this.duration);\n    output.log(output.indent + 'rate: ' + this.rate);\n    output.log(output.indent + 'volume: ' + (this.volume >> 8));\n    output.log(output.indent + 'matrix: ' + this.matrix.join(', '));\n    output.log(output.indent + 'next_track_id: ' + this.next_track_id);\n  }\n}\n","import type { MultiBufferStream } from '#/buffer';\nimport { MetadataSampleEntry } from './base';\n\nexport class mettSampleEntry extends MetadataSampleEntry {\n  content_encoding: string;\n  mime_format: string;\n  static override readonly fourcc = 'mett' as const;\n\n  parse(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    this.content_encoding = stream.readCString();\n    this.mime_format = stream.readCString();\n    this.parseFooter(stream);\n  }\n}\n","import type { MultiBufferStream } from '#/buffer';\nimport { MetadataSampleEntry } from './base';\n\nexport class metxSampleEntry extends MetadataSampleEntry {\n  content_encoding: string;\n  namespace: string;\n  schema_location: string;\n\n  static override readonly fourcc = 'metx' as const;\n\n  parse(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    this.content_encoding = stream.readCString();\n    this.namespace = stream.readCString();\n    this.schema_location = stream.readCString();\n    this.parseFooter(stream);\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\n\nexport class av1CBox extends Box {\n  static override readonly fourcc = 'av1C' as const;\n  box_name = 'AV1CodecConfigurationBox' as const;\n\n  version: number;\n  seq_profile: number;\n  seq_level_idx_0: number;\n  seq_tier_0: number;\n  high_bitdepth: number;\n  twelve_bit: number;\n  monochrome: number;\n  chroma_subsampling_x: number;\n  chroma_subsampling_y: number;\n  chroma_sample_position: number;\n  reserved_1: number;\n  initial_presentation_delay_present: number;\n  initial_presentation_delay_minus_one: number;\n  reserved_2: number;\n  configOBUs: Uint8Array;\n\n  parse(stream: MultiBufferStream) {\n    let tmp = stream.readUint8();\n    if (((tmp >> 7) & 0x1) !== 1) {\n      Log.error('BoxParser', 'av1C marker problem', stream.isofile);\n      return;\n    }\n    this.version = tmp & 0x7f;\n    if (this.version !== 1) {\n      Log.error('BoxParser', 'av1C version ' + this.version + ' not supported', stream.isofile);\n      return;\n    }\n    tmp = stream.readUint8();\n    this.seq_profile = (tmp >> 5) & 0x7;\n    this.seq_level_idx_0 = tmp & 0x1f;\n    tmp = stream.readUint8();\n    this.seq_tier_0 = (tmp >> 7) & 0x1;\n    this.high_bitdepth = (tmp >> 6) & 0x1;\n    this.twelve_bit = (tmp >> 5) & 0x1;\n    this.monochrome = (tmp >> 4) & 0x1;\n    this.chroma_subsampling_x = (tmp >> 3) & 0x1;\n    this.chroma_subsampling_y = (tmp >> 2) & 0x1;\n    this.chroma_sample_position = tmp & 0x3;\n    tmp = stream.readUint8();\n    this.reserved_1 = (tmp >> 5) & 0x7;\n    if (this.reserved_1 !== 0) {\n      Log.error('BoxParser', 'av1C reserved_1 parsing problem', stream.isofile);\n      return;\n    }\n    this.initial_presentation_delay_present = (tmp >> 4) & 0x1;\n    if (this.initial_presentation_delay_present === 1) {\n      this.initial_presentation_delay_minus_one = tmp & 0xf;\n    } else {\n      this.reserved_2 = tmp & 0xf;\n      if (this.reserved_2 !== 0) {\n        Log.error('BoxParser', 'av1C reserved_2 parsing problem', stream.isofile);\n        return;\n      }\n    }\n\n    const configOBUs_length = this.size - this.hdr_size - 4;\n    this.configOBUs = stream.readUint8Array(configOBUs_length);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { DataStream } from '#/DataStream';\nimport type { ES_Descriptor } from '#/descriptor';\nimport { DescriptorRegistry } from '#/registry';\n\nexport class esdsBox extends FullBox {\n  static override readonly fourcc = 'esds' as const;\n  box_name = 'ElementaryStreamDescriptorBox' as const;\n\n  esd: ES_Descriptor;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const esd_data = stream.readUint8Array(this.size - this.hdr_size);\n    // NOTE:    This used to be `typeof MPEG4DescriptorParser !== 'undefined'`\n    if ('MPEG4DescriptorParser' in DescriptorRegistry) {\n      const esd_parser = new DescriptorRegistry.MPEG4DescriptorParser();\n      this.esd = esd_parser.parseOneDescriptor(new DataStream(esd_data.buffer, 0)) as ES_Descriptor;\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class vpcCBox extends FullBox {\n  static override readonly fourcc = 'vpcC' as const;\n  box_name = 'VPCodecConfigurationRecord' as const;\n\n  profile: number;\n  level: number;\n  bitDepth: number;\n  chromaSubsampling: number;\n  videoFullRangeFlag: number;\n  colourPrimaries: number;\n  transferCharacteristics: number;\n  matrixCoefficients: number;\n  codecIntializationDataSize: number;\n  codecIntializationData: Uint8Array;\n  colorSpace: number;\n  transferFunction: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 1) {\n      this.profile = stream.readUint8();\n      this.level = stream.readUint8();\n      const tmp = stream.readUint8();\n      this.bitDepth = tmp >> 4;\n      this.chromaSubsampling = (tmp >> 1) & 0x7;\n      this.videoFullRangeFlag = tmp & 0x1;\n      this.colourPrimaries = stream.readUint8();\n      this.transferCharacteristics = stream.readUint8();\n      this.matrixCoefficients = stream.readUint8();\n      this.codecIntializationDataSize = stream.readUint16();\n      this.codecIntializationData = stream.readUint8Array(this.codecIntializationDataSize);\n    } else {\n      this.profile = stream.readUint8();\n      this.level = stream.readUint8();\n      let tmp = stream.readUint8();\n      this.bitDepth = (tmp >> 4) & 0xf;\n      this.colorSpace = tmp & 0xf;\n      tmp = stream.readUint8();\n      this.chromaSubsampling = (tmp >> 4) & 0xf;\n      this.transferFunction = (tmp >> 1) & 0x7;\n      this.videoFullRangeFlag = tmp & 0x1;\n      this.codecIntializationDataSize = stream.readUint16();\n      this.codecIntializationData = stream.readUint8Array(this.codecIntializationDataSize);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport type { NaluArray } from '@types';\n\nexport class vvcCBox extends FullBox {\n  static override readonly fourcc = 'vvcC' as const;\n  box_name = 'VvcConfigurationBox' as const;\n\n  lengthSizeMinusOne: number;\n  ptl_present_flag: number;\n  ols_idx: number;\n  num_sublayers: number;\n  constant_frame_rate: number;\n  chroma_format_idc: number;\n  bit_depth_minus8: number;\n  num_bytes_constraint_info: number;\n  general_profile_idc: number;\n  general_tier_flag: number;\n  general_level_idc: number;\n  ptl_frame_only_constraint_flag: number;\n  ptl_multilayer_enabled_flag: number;\n  general_constraint_info: Uint8Array;\n  ptl_sublayer_present_mask: number;\n  sublayer_level_idc: Array<number>;\n  ptl_num_sub_profiles: number;\n  general_sub_profile_idc: Array<number>;\n  max_picture_width: number;\n  max_picture_height: number;\n  avg_frame_rate: number;\n  nalu_arrays: Array<NaluArray>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    // helper object to simplify extracting individual bits\n    const bitReader = {\n      held_bits: undefined,\n      num_held_bits: 0,\n\n      stream_read_1_bytes: function (strm) {\n        this.held_bits = strm.readUint8();\n        this.num_held_bits = 1 * 8;\n      },\n      stream_read_2_bytes: function (strm) {\n        this.held_bits = strm.readUint16();\n        this.num_held_bits = 2 * 8;\n      },\n\n      extract_bits: function (num_bits) {\n        const ret = (this.held_bits >> (this.num_held_bits - num_bits)) & ((1 << num_bits) - 1);\n        this.num_held_bits -= num_bits;\n        return ret;\n      },\n    };\n\n    // VvcDecoderConfigurationRecord\n    bitReader.stream_read_1_bytes(stream);\n    bitReader.extract_bits(5); // reserved\n    this.lengthSizeMinusOne = bitReader.extract_bits(2);\n    this.ptl_present_flag = bitReader.extract_bits(1);\n\n    if (this.ptl_present_flag) {\n      bitReader.stream_read_2_bytes(stream);\n      this.ols_idx = bitReader.extract_bits(9);\n      this.num_sublayers = bitReader.extract_bits(3);\n      this.constant_frame_rate = bitReader.extract_bits(2);\n      this.chroma_format_idc = bitReader.extract_bits(2);\n\n      bitReader.stream_read_1_bytes(stream);\n      this.bit_depth_minus8 = bitReader.extract_bits(3);\n      bitReader.extract_bits(5); // reserved\n\n      // VvcPTLRecord\n      {\n        bitReader.stream_read_2_bytes(stream);\n        bitReader.extract_bits(2); // reserved\n        this.num_bytes_constraint_info = bitReader.extract_bits(6);\n        this.general_profile_idc = bitReader.extract_bits(7);\n        this.general_tier_flag = bitReader.extract_bits(1);\n\n        this.general_level_idc = stream.readUint8();\n\n        bitReader.stream_read_1_bytes(stream);\n        this.ptl_frame_only_constraint_flag = bitReader.extract_bits(1);\n        this.ptl_multilayer_enabled_flag = bitReader.extract_bits(1);\n\n        this.general_constraint_info = new Uint8Array(this.num_bytes_constraint_info);\n        if (this.num_bytes_constraint_info) {\n          for (let i = 0; i < this.num_bytes_constraint_info - 1; i++) {\n            const cnstr1 = bitReader.extract_bits(6);\n            bitReader.stream_read_1_bytes(stream);\n            const cnstr2 = bitReader.extract_bits(2);\n\n            this.general_constraint_info[i] = (cnstr1 << 2) | cnstr2;\n          }\n          this.general_constraint_info[this.num_bytes_constraint_info - 1] =\n            bitReader.extract_bits(6);\n        } else {\n          //forbidden in spec!\n          bitReader.extract_bits(6);\n        }\n\n        if (this.num_sublayers > 1) {\n          bitReader.stream_read_1_bytes(stream);\n          this.ptl_sublayer_present_mask = 0;\n          for (let j = this.num_sublayers - 2; j >= 0; --j) {\n            const val = bitReader.extract_bits(1);\n            this.ptl_sublayer_present_mask |= val << j;\n          }\n          for (let j = this.num_sublayers; j <= 8 && this.num_sublayers > 1; ++j) {\n            bitReader.extract_bits(1); // ptl_reserved_zero_bit\n          }\n\n          this.sublayer_level_idc = [];\n          for (let j = this.num_sublayers - 2; j >= 0; --j) {\n            if (this.ptl_sublayer_present_mask & (1 << j)) {\n              this.sublayer_level_idc[j] = stream.readUint8();\n            }\n          }\n        }\n\n        this.ptl_num_sub_profiles = stream.readUint8();\n        this.general_sub_profile_idc = [];\n        if (this.ptl_num_sub_profiles) {\n          for (let i = 0; i < this.ptl_num_sub_profiles; i++) {\n            this.general_sub_profile_idc.push(stream.readUint32());\n          }\n        }\n      } // end VvcPTLRecord\n\n      this.max_picture_width = stream.readUint16();\n      this.max_picture_height = stream.readUint16();\n      this.avg_frame_rate = stream.readUint16();\n    }\n\n    const VVC_NALU_OPI = 12;\n    const VVC_NALU_DEC_PARAM = 13;\n\n    this.nalu_arrays = [];\n    const num_of_arrays = stream.readUint8();\n    for (let i = 0; i < num_of_arrays; i++) {\n      const nalu_array = [] as NaluArray;\n      this.nalu_arrays.push(nalu_array);\n\n      bitReader.stream_read_1_bytes(stream);\n      nalu_array.completeness = bitReader.extract_bits(1);\n      bitReader.extract_bits(2); // reserved\n      nalu_array.nalu_type = bitReader.extract_bits(5);\n\n      let numNalus = 1;\n      if (nalu_array.nalu_type !== VVC_NALU_DEC_PARAM && nalu_array.nalu_type !== VVC_NALU_OPI) {\n        numNalus = stream.readUint16();\n      }\n\n      for (let j = 0; j < numNalus; j++) {\n        const len = stream.readUint16();\n        nalu_array.push({\n          data: stream.readUint8Array(len),\n          length: len,\n        });\n      }\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class colrBox extends Box {\n  static override readonly fourcc = 'colr' as const;\n  box_name = 'ColourInformationBox' as const;\n\n  colour_type: string;\n  colour_primaries: number;\n  transfer_characteristics: number;\n  matrix_coefficients: number;\n  full_range_flag: number;\n  ICC_profile: Uint8Array;\n\n  parse(stream: MultiBufferStream) {\n    this.colour_type = stream.readString(4);\n    if (this.colour_type === 'nclx') {\n      this.colour_primaries = stream.readUint16();\n      this.transfer_characteristics = stream.readUint16();\n      this.matrix_coefficients = stream.readUint16();\n      const tmp = stream.readUint8();\n      this.full_range_flag = tmp >> 7;\n    } else if (this.colour_type === 'rICC') {\n      this.ICC_profile = stream.readUint8Array(this.size - 4);\n    } else if (this.colour_type === 'prof') {\n      this.ICC_profile = stream.readUint8Array(this.size - 4);\n    }\n  }\n}\n","import { av1CBox } from '#/boxes/av1C';\nimport { avcCBox } from '#/boxes/avcC';\nimport { sinfBox } from '#/boxes/defaults';\nimport { esdsBox } from '#/boxes/esds';\nimport { hvcCBox } from '#/boxes/hvcC';\nimport { vpcCBox } from '#/boxes/vpcC';\nimport { vvcCBox } from '#/boxes/vvcC';\nimport { colrBox } from '#/boxes/colr';\nimport {\n  AudioSampleEntry,\n  MetadataSampleEntry,\n  SubtitleSampleEntry,\n  SystemSampleEntry,\n  TextSampleEntry,\n  VisualSampleEntry,\n} from './base';\n\n/** @bundle box-codecs.js */\nfunction decimalToHex(d: number | string, padding?: number) {\n  let hex = Number(d).toString(16);\n  padding = typeof padding === 'undefined' ? 2 : padding;\n  while (hex.length < padding) {\n    hex = '0' + hex;\n  }\n  return hex;\n}\n\nclass avcCSampleEntryBase extends VisualSampleEntry {\n  avcC: avcCBox;\n  avcCs: Array<avcCBox>;\n\n  /** @bundle box-codecs.js */\n  getCodec() {\n    const baseCodec = super.getCodec();\n    if (this.avcC) {\n      return `${baseCodec}.${decimalToHex(this.avcC.AVCProfileIndication)}${decimalToHex(\n        this.avcC.profile_compatibility,\n      )}${decimalToHex(this.avcC.AVCLevelIndication)}`;\n    } else {\n      return baseCodec;\n    }\n  }\n}\n\n// Sample entries inheriting from Audio and Video\nexport class avc1SampleEntry extends avcCSampleEntryBase {\n  static override readonly fourcc = 'avc1' as const;\n  // ISO/IEC 14496-15:2024 5.4.2.1.2\n  box_name = 'AVCSampleEntry' as const;\n}\n\nexport class avc2SampleEntry extends avcCSampleEntryBase {\n  static override readonly fourcc = 'avc2' as const;\n  // ISO/IEC 14496-15:2024 5.4.2.1.2\n  box_name = 'AVC2SampleEntry' as const;\n}\n\nexport class avc3SampleEntry extends avcCSampleEntryBase {\n  static override readonly fourcc = 'avc3' as const;\n  // ISO/IEC 14496-15:2024 5.4.2.1.2\n  box_name = 'AVCSampleEntry' as const;\n}\n\nexport class avc4SampleEntry extends avcCSampleEntryBase {\n  static override readonly fourcc = 'avc4' as const;\n  // ISO/IEC 14496-15:2024 5.4.2.1.2\n  box_name = 'AVC2SampleEntry' as const;\n}\n\nexport class av01SampleEntry extends VisualSampleEntry {\n  av1C: av1CBox;\n  av1Cs: Array<av1CBox>;\n\n  static override readonly fourcc = 'av01' as const;\n\n  // AV1 Codec ISO Media File Format Binding v1.2.0 Section 2.2.3\n  box_name = 'AV1SampleEntry' as const;\n\n  /** @bundle box-codecs.js */\n  getCodec(): string {\n    // NOTE:    was before `const baseCodec = SampleEntry.prototype.getCodec.call(this);`\n    const baseCodec = super.getCodec();\n\n    const level_idx_0 = this.av1C.seq_level_idx_0;\n    const level = level_idx_0 < 10 ? '0' + level_idx_0 : level_idx_0;\n    let bitdepth: string;\n    if (this.av1C.seq_profile === 2 && this.av1C.high_bitdepth === 1) {\n      bitdepth = this.av1C.twelve_bit === 1 ? '12' : '10';\n    } else if (this.av1C.seq_profile <= 2) {\n      bitdepth = this.av1C.high_bitdepth === 1 ? '10' : '08';\n    }\n    // TODO need to parse the SH to find color config\n    return (\n      baseCodec +\n      '.' +\n      this.av1C.seq_profile +\n      '.' +\n      level +\n      (this.av1C.seq_tier_0 ? 'H' : 'M') +\n      '.' +\n      bitdepth\n    ); //+\".\"+this.av1C.monochrome+\".\"+this.av1C.chroma_subsampling_x+\"\"+this.av1C.chroma_subsampling_y+\"\"+this.av1C.chroma_sample_position;\n  }\n}\n\nexport class dav1SampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'dav1' as const;\n}\n\nclass hvcCSampleEntryBase extends VisualSampleEntry {\n  hvcC: hvcCBox;\n  hvcCs: Array<hvcCBox>;\n\n  /** @bundle box-codecs.js */\n  getCodec(): string {\n    let baseCodec = super.getCodec();\n    if (this.hvcC) {\n      baseCodec += '.';\n      switch (this.hvcC.general_profile_space) {\n        case 0:\n          baseCodec += '';\n          break;\n        case 1:\n          baseCodec += 'A';\n          break;\n        case 2:\n          baseCodec += 'B';\n          break;\n        case 3:\n          baseCodec += 'C';\n          break;\n      }\n      baseCodec += this.hvcC.general_profile_idc;\n      baseCodec += '.';\n      let val = this.hvcC.general_profile_compatibility;\n      let reversed = 0;\n      for (let i = 0; i < 32; i++) {\n        reversed |= val & 1;\n        if (i === 31) break;\n        reversed <<= 1;\n        val >>= 1;\n      }\n      baseCodec += decimalToHex(reversed, 0);\n      baseCodec += '.';\n      if (this.hvcC.general_tier_flag === 0) {\n        baseCodec += 'L';\n      } else {\n        baseCodec += 'H';\n      }\n      baseCodec += this.hvcC.general_level_idc;\n      let hasByte = false;\n      let constraint_string = '';\n      for (let i = 5; i >= 0; i--) {\n        if (this.hvcC.general_constraint_indicator[i] || hasByte) {\n          constraint_string =\n            '.' + decimalToHex(this.hvcC.general_constraint_indicator[i], 0) + constraint_string;\n          hasByte = true;\n        }\n      }\n      baseCodec += constraint_string;\n    }\n    return baseCodec;\n  }\n}\n\nexport class hvc1SampleEntry extends hvcCSampleEntryBase {\n  static override readonly fourcc = 'hvc1' as const;\n  // ISO/IEC 14496-15:2024 8.4.1.1.2\n  box_name = 'HEVCSampleEntry' as const;\n}\n\nexport class hvc2SampleEntry extends hvcCSampleEntryBase {\n  static override readonly fourcc = 'hvc2' as const;\n}\n\nexport class hev1SampleEntry extends hvcCSampleEntryBase {\n  static override readonly fourcc = 'hev1' as const;\n  // ISO/IEC 14496-15:2024 8.4.1.1.2\n  box_name = 'HEVCSampleEntry' as const;\n  colrs: Array<colrBox> = [];\n  subBoxNames = ['colr'] as const;\n}\n\nexport class hev2SampleEntry extends hvcCSampleEntryBase {\n  static override readonly fourcc = 'hev2' as const;\n}\n\nexport class hvt1SampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'hvt1' as const;\n  // ISO/IEC 14496-15:2024 10.5.2.2\n  box_name = 'HEVCTileSampleSampleEntry' as const;\n}\n\nexport class lhe1SampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'lhe1' as const;\n  // ISO/IEC 14496-15:2024 9.5.3.1.2\n  box_name = 'LHEVCSampleEntry' as const;\n}\n\nexport class lhv1SampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'lhv1' as const;\n  // ISO/IEC 14496-15:2024 9.5.3.1.2\n  box_name = 'LHEVCSampleEntry' as const;\n}\n\nexport class dvh1SampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'dvh1' as const;\n}\n\nexport class dvheSampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'dvhe' as const;\n}\n\n/** @babel box-codecs.js */\nclass vvcCSampleEntryBase extends VisualSampleEntry {\n  vvcC: vvcCBox;\n  vvcCs: Array<vvcCBox>;\n  getCodec() {\n    let baseCodec = super.getCodec();\n    if (this.vvcC) {\n      baseCodec += '.' + this.vvcC.general_profile_idc;\n      if (this.vvcC.general_tier_flag) {\n        baseCodec += '.H';\n      } else {\n        baseCodec += '.L';\n      }\n      baseCodec += this.vvcC.general_level_idc;\n\n      let constraint_string = '';\n      if (this.vvcC.general_constraint_info) {\n        const bytes = [];\n        let byte = 0;\n        byte |= this.vvcC.ptl_frame_only_constraint_flag << 7;\n        byte |= this.vvcC.ptl_multilayer_enabled_flag << 6;\n        let last_nonzero: number;\n        for (let i = 0; i < this.vvcC.general_constraint_info.length; ++i) {\n          byte |= (this.vvcC.general_constraint_info[i] >> 2) & 0x3f;\n          bytes.push(byte);\n          if (byte) {\n            last_nonzero = i;\n          }\n\n          byte = (this.vvcC.general_constraint_info[i] >> 2) & 0x03;\n        }\n\n        if (last_nonzero === undefined) {\n          constraint_string = '.CA';\n        } else {\n          constraint_string = '.C';\n          const base32_chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';\n          let held_bits = 0;\n          let num_held_bits = 0;\n          for (let i = 0; i <= last_nonzero; ++i) {\n            held_bits = (held_bits << 8) | bytes[i];\n            num_held_bits += 8;\n\n            while (num_held_bits >= 5) {\n              const val = (held_bits >> (num_held_bits - 5)) & 0x1f;\n              constraint_string += base32_chars[val];\n\n              num_held_bits -= 5;\n              held_bits &= (1 << num_held_bits) - 1;\n            }\n          }\n          if (num_held_bits) {\n            held_bits <<= 5 - num_held_bits; // right-pad with zeros to 5 bits (is this correct?)\n            constraint_string += base32_chars[held_bits & 0x1f];\n          }\n        }\n      }\n      baseCodec += constraint_string;\n    }\n    return baseCodec;\n  }\n}\n\nexport class vvc1SampleEntry extends vvcCSampleEntryBase {\n  static override readonly fourcc = 'vvc1' as const;\n  // ISO/IEC 14496-15:2024 11.3.1.2\n  box_name = 'VvcSampleEntry' as const;\n}\n\nexport class vvi1SampleEntry extends vvcCSampleEntryBase {\n  static override readonly fourcc = 'vvi1' as const;\n  // ISO/IEC 14496-15:2024 11.3.1.2\n  box_name = 'VvcSampleEntry' as const;\n}\n\nexport class vvs1SampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'vvs1' as const;\n  // ISO/IEC 14496-15:2024 11.3.1.2\n  box_name = 'VvcSampleEntry' as const;\n}\n\nexport class vvcNSampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'vvcN' as const;\n  // ISO/IEC 14496-15:2024 11.3.3.1.2\n  box_name = 'VvcNonVCLSampleEntry' as const;\n}\n\nclass vpcCSampleEntryBase extends VisualSampleEntry {\n  vpcC: vpcCBox;\n  vpcCs: Array<vpcCBox>;\n  getCodec() {\n    const baseCodec = super.getCodec();\n    let level: number | string = this.vpcC.level;\n    if (level === 0) {\n      level = '00';\n    }\n    let bitDepth: number | string = this.vpcC.bitDepth;\n    if (bitDepth === 8) {\n      bitDepth = '08';\n    }\n    return `${baseCodec}.0${this.vpcC.profile}.${level}.${bitDepth}`;\n  }\n}\n\nexport class vp08SampleEntry extends vpcCSampleEntryBase {\n  static override readonly fourcc = 'vp08' as const;\n}\n\nexport class vp09SampleEntry extends vpcCSampleEntryBase {\n  static override readonly fourcc = 'vp09' as const;\n}\n\nexport class avs3SampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'avs3' as const;\n}\n\nexport class j2kiSampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'j2ki' as const;\n  // ISO/IEC 15444-16:2021 Section 7.3\n  box_name = 'J2KSampleEntry' as const;\n}\n\nexport class mjp2SampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'mjp2' as const;\n}\n\nexport class mjpgSampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'mjpg' as const;\n}\n\nexport class uncvSampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'uncv' as const;\n  // ISO/IEC 23001-17:2024 4.2\n  box_name = 'UncompressedVideoSampleEntry' as const;\n}\n\nexport class mp4vSampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'mp4v' as const;\n  // ISO/IEC 14496-14:2020 Section 6.7.3\n  box_name = 'MP4VisualSampleEntry' as const;\n}\n\nexport class mp4aSampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'mp4a' as const;\n  // ISO/IEC 14496-14:2020 Section 6.7.3\n  box_name = 'MP4AudioSampleEntry' as const;\n\n  esds: esdsBox;\n  esdss: Array<esdsBox>;\n\n  getCodec() {\n    const baseCodec = super.getCodec();\n    if (this.esds && this.esds.esd) {\n      const oti = this.esds.esd.getOTI();\n      const dsi = this.esds.esd.getAudioConfig();\n      return baseCodec + '.' + decimalToHex(oti) + (dsi ? '.' + dsi : '');\n    } else {\n      return baseCodec;\n    }\n  }\n}\n\nexport class m4aeSampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'm4ae' as const;\n}\n\nexport class ac_3SampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'ac-3' as const;\n}\n\nexport class ac_4SampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'ac-4' as const;\n}\n\nexport class ec_3SampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'ec-3' as const;\n}\n\nexport class OpusSampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'Opus' as const;\n}\n\nexport class mha1SampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'mha1' as const;\n}\n\nexport class mha2SampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'mha2' as const;\n}\n\nexport class mhm1SampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'mhm1' as const;\n}\n\nexport class mhm2SampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'mhm2' as const;\n}\n\nexport class fLaCSampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'fLaC' as const;\n}\n\n// Encrypted sample entries\nexport class encvSampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'encv' as const;\n}\n\nexport class encaSampleEntry extends AudioSampleEntry {\n  static override readonly fourcc = 'enca' as const;\n}\n\nexport class encuSampleEntry extends SubtitleSampleEntry {\n  static override readonly fourcc = 'encu' as const;\n  subBoxNames = ['sinf'] as const;\n\n  sinfs: Array<sinfBox> = [];\n}\n\nexport class encsSampleEntry extends SystemSampleEntry {\n  static override readonly fourcc = 'encs' as const;\n  subBoxNames = ['sinf'] as const;\n\n  sinfs: Array<sinfBox> = [];\n}\n\nexport class mp4sSampleEntry extends SystemSampleEntry {\n  static override readonly fourcc = 'mp4s' as const;\n\n  esds: esdsBox;\n}\n\nexport class enctSampleEntry extends TextSampleEntry {\n  static override readonly fourcc = 'enct' as const;\n  subBoxNames = ['sinf'] as const;\n\n  sinfs: Array<sinfBox> = [];\n}\n\nexport class encmSampleEntry extends MetadataSampleEntry {\n  static override readonly fourcc = 'encm' as const;\n  subBoxNames = ['sinf'] as const;\n\n  sinfs: Array<sinfBox> = [];\n}\n\n// Restricted sample entries\nexport class resvSampleEntry extends VisualSampleEntry {\n  static override readonly fourcc = 'resv' as const;\n  // ISO/IEC 14496-12:2022 Section 8.15\n  box_name = 'RestrictedVideoSampleEntry' as const;\n}\n","import type { MultiBufferStream } from '#/buffer';\nimport { SubtitleSampleEntry } from './base';\n\nexport class sbttSampleEntry extends SubtitleSampleEntry {\n  content_encoding: string;\n  mime_format: string;\n\n  static override readonly fourcc = 'sbtt' as const;\n\n  parse(stream: MultiBufferStream): void {\n    this.parseHeader(stream);\n    this.content_encoding = stream.readCString();\n    this.mime_format = stream.readCString();\n    this.parseFooter(stream);\n  }\n}\n","import type { MultiBufferStream } from '#/buffer';\nimport { SubtitleSampleEntry } from './base';\n\nexport class stppSampleEntry extends SubtitleSampleEntry {\n  namespace: string;\n  schema_location: string;\n  auxiliary_mime_types: string;\n\n  static override readonly fourcc = 'stpp' as const;\n\n  parse(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    this.namespace = stream.readCString();\n    this.schema_location = stream.readCString();\n    this.auxiliary_mime_types = stream.readCString();\n    this.parseFooter(stream);\n  }\n\n  /** @bundle writing/sampleentry.js */\n  write(stream: MultiBufferStream) {\n    this.writeHeader(stream);\n    this.size +=\n      this.namespace.length +\n      1 +\n      this.schema_location.length +\n      1 +\n      this.auxiliary_mime_types.length +\n      1;\n    stream.writeCString(this.namespace);\n    stream.writeCString(this.schema_location);\n    stream.writeCString(this.auxiliary_mime_types);\n    this.writeFooter(stream);\n  }\n}\n","import type { MultiBufferStream } from '#/buffer';\nimport { SubtitleSampleEntry } from './base';\n\nexport class stxtSampleEntry extends SubtitleSampleEntry {\n  content_encoding: string;\n  mime_format: string;\n\n  static override readonly fourcc = 'stxt' as const;\n\n  parse(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    this.content_encoding = stream.readCString();\n    this.mime_format = stream.readCString();\n    this.parseFooter(stream);\n  }\n\n  getCodec() {\n    const baseCodec = super.getCodec();\n    if (this.mime_format) {\n      return baseCodec + '.' + this.mime_format;\n    } else {\n      return baseCodec;\n    }\n  }\n}\n","import type { MultiBufferStream } from '#/buffer';\nimport { SubtitleSampleEntry } from './base';\n\nexport class tx3gSampleEntry extends SubtitleSampleEntry {\n  displayFlags: number;\n  horizontal_justification: number;\n  vertical_justification: number;\n  bg_color_rgba: Uint8Array;\n  box_record: Int16Array;\n  style_record: Uint8Array;\n\n  static override readonly fourcc = 'tx3g' as const;\n\n  parse(stream: MultiBufferStream) {\n    this.parseHeader(stream);\n    this.displayFlags = stream.readUint32();\n    this.horizontal_justification = stream.readInt8();\n    this.vertical_justification = stream.readInt8();\n    this.bg_color_rgba = stream.readUint8Array(4);\n    this.box_record = stream.readInt16Array(4);\n    this.style_record = stream.readUint8Array(12);\n    this.parseFooter(stream);\n  }\n}\n","import type { MultiBufferStream } from '#/buffer';\nimport { MetadataSampleEntry } from './base';\n\nexport class wvttSampleEntry extends MetadataSampleEntry {\n  static override readonly fourcc = 'wvtt' as const;\n\n  parse(stream: MultiBufferStream): void {\n    this.parseHeader(stream);\n    this.parseFooter(stream);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\ninterface Entry {\n  sample_count: number;\n  group_description_index: number;\n}\n\nexport class sbgpBox extends FullBox {\n  static override readonly fourcc = 'sbgp' as const;\n  box_name = 'SampleToGroupBox' as const;\n\n  grouping_type: string;\n  grouping_type_parameter: number;\n  entries: Array<Entry>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.grouping_type = stream.readString(4);\n    if (this.version === 1) {\n      this.grouping_type_parameter = stream.readUint32();\n    } else {\n      this.grouping_type_parameter = 0;\n    }\n    this.entries = [];\n    const entry_count = stream.readUint32();\n    for (let i = 0; i < entry_count; i++) {\n      this.entries.push({\n        sample_count: stream.readInt32(),\n        group_description_index: stream.readInt32(),\n      });\n    }\n  }\n\n  /** @bundle writing/sbgp.js */\n  write(stream: MultiBufferStream) {\n    if (this.grouping_type_parameter) this.version = 1;\n    else this.version = 0;\n    this.flags = 0;\n    this.size = 8 + 8 * this.entries.length + (this.version === 1 ? 4 : 0);\n    this.writeHeader(stream);\n    stream.writeString(this.grouping_type, undefined, 4);\n    if (this.version === 1) {\n      stream.writeUint32(this.grouping_type_parameter);\n    }\n    stream.writeUint32(this.entries.length);\n    for (let i = 0; i < this.entries.length; i++) {\n      const entry = this.entries[i];\n      stream.writeInt32(entry.sample_count);\n      stream.writeInt32(entry.group_description_index);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class sdtpBox extends FullBox {\n  static override readonly fourcc = 'sdtp' as const;\n  box_name = 'SampleDependencyTypeBox' as const;\n\n  is_leading: Array<number>;\n  sample_depends_on: Array<number>;\n  sample_is_depended_on: Array<number>;\n  sample_has_redundancy: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const count = this.size - this.hdr_size;\n    this.is_leading = [];\n    this.sample_depends_on = [];\n    this.sample_is_depended_on = [];\n    this.sample_has_redundancy = [];\n    for (let i = 0; i < count; i++) {\n      const tmp_byte = stream.readUint8();\n      this.is_leading[i] = tmp_byte >> 6;\n      this.sample_depends_on[i] = (tmp_byte >> 4) & 0x3;\n      this.sample_is_depended_on[i] = (tmp_byte >> 2) & 0x3;\n      this.sample_has_redundancy[i] = tmp_byte & 0x3;\n    }\n  }\n}\n","import { FullBox, SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n// import * as BOXES from '#/codecs-all';\nimport { Log } from '#/log';\nimport { BoxRegistry } from '#/registry';\n\nexport class sgpdBox extends FullBox {\n  static override readonly fourcc = 'sgpd' as const;\n  box_name = 'SampleGroupDescriptionBox' as const;\n\n  grouping_type:\n    | 'alst'\n    | 'avll'\n    | 'avss'\n    | 'dtrt'\n    | 'mvif'\n    | 'prol'\n    | 'rap'\n    | 'rash'\n    | 'roll'\n    | 'scif'\n    | 'scnm'\n    | 'seig'\n    | 'stsa'\n    | 'sync'\n    | 'tele'\n    | 'tsas'\n    | 'tscl'\n    | 'vipr'\n    | (string & {});\n  default_length: number;\n  default_group_description_index: number;\n  default_sample_description_index: number;\n  entries: Array<SampleGroupEntry>;\n  used: boolean;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.grouping_type = stream.readString(4);\n    Log.debug('BoxParser', 'Found Sample Groups of type ' + this.grouping_type);\n    if (this.version === 1) {\n      this.default_length = stream.readUint32();\n    } else {\n      this.default_length = 0;\n    }\n    if (this.version >= 2) {\n      this.default_group_description_index = stream.readUint32();\n    }\n    this.entries = [];\n    const entry_count = stream.readUint32();\n    for (let i = 0; i < entry_count; i++) {\n      let entry: SampleGroupEntry;\n      if (this.grouping_type in BoxRegistry.sampleGroupEntry) {\n        entry = new BoxRegistry.sampleGroupEntry[this.grouping_type](this.grouping_type);\n      } else {\n        entry = new SampleGroupEntry(this.grouping_type);\n      }\n      this.entries.push(entry);\n      if (this.version === 1) {\n        if (this.default_length === 0) {\n          entry.description_length = stream.readUint32();\n        } else {\n          entry.description_length = this.default_length;\n        }\n      } else {\n        entry.description_length = this.default_length;\n      }\n      if (entry.write === SampleGroupEntry.prototype.write) {\n        Log.info(\n          'BoxParser',\n          'SampleGroup for type ' +\n            this.grouping_type +\n            ' writing not yet implemented, keeping unparsed data in memory for later write',\n        );\n        // storing data\n        entry.data = stream.readUint8Array(entry.description_length);\n        // rewinding\n        stream.seek(stream.getPosition() - entry.description_length);\n      }\n      entry.parse(stream);\n    }\n  }\n\n  /** @bundle writing/sgpd.js */\n  write(stream: MultiBufferStream) {\n    // leave version as read\n    // this.version;\n    this.flags = 0;\n    this.size = 12;\n    for (let i = 0; i < this.entries.length; i++) {\n      const entry = this.entries[i];\n      if (this.version === 1) {\n        if (this.default_length === 0) {\n          this.size += 4;\n        }\n        this.size += entry.data.length;\n      }\n    }\n    this.writeHeader(stream);\n    stream.writeString(this.grouping_type, undefined, 4);\n    if (this.version === 1) {\n      stream.writeUint32(this.default_length);\n    }\n    if (this.version >= 2) {\n      stream.writeUint32(this.default_sample_description_index);\n    }\n    stream.writeUint32(this.entries.length);\n    for (let i = 0; i < this.entries.length; i++) {\n      const entry = this.entries[i];\n      if (this.version === 1) {\n        if (this.default_length === 0) {\n          stream.writeUint32(entry.description_length);\n        }\n      }\n      entry.write(stream);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { MAX_UINT32 } from '#/constants';\n\ninterface Reference {\n  reference_type: number;\n  referenced_size: number;\n  subsegment_duration: number;\n  starts_with_SAP: number;\n  SAP_type: number;\n  SAP_delta_time: number;\n}\n\nexport class sidxBox extends FullBox {\n  static override readonly fourcc = 'sidx' as const;\n  box_name = 'CompressedSegmentIndexBox' as const;\n\n  reference_ID: number;\n  timescale: number;\n  earliest_presentation_time: number;\n  first_offset: number;\n  references: Array<Reference>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.reference_ID = stream.readUint32();\n    this.timescale = stream.readUint32();\n\n    if (this.version === 0) {\n      this.earliest_presentation_time = stream.readUint32();\n      this.first_offset = stream.readUint32();\n    } else {\n      this.earliest_presentation_time = stream.readUint64();\n      this.first_offset = stream.readUint64();\n    }\n\n    stream.readUint16();\n\n    this.references = [];\n\n    const count = stream.readUint16();\n\n    for (let i = 0; i < count; i++) {\n      const type = stream.readUint32();\n      const subsegment_duration = stream.readUint32();\n      const sap = stream.readUint32();\n\n      this.references.push({\n        reference_type: (type >> 31) & 0x1,\n        referenced_size: type & 0x7fffffff,\n        subsegment_duration,\n        starts_with_SAP: (sap >> 31) & 0x1,\n        SAP_type: (sap >> 28) & 0x7,\n        SAP_delta_time: sap & 0xfffffff,\n      });\n    }\n  }\n\n  /** @bundle writing/sidx.js */\n  write(stream: MultiBufferStream) {\n    const useVersion1 =\n      this.earliest_presentation_time > MAX_UINT32 ||\n      this.first_offset > MAX_UINT32 ||\n      this.version === 1;\n    this.version = useVersion1 ? 1 : 0;\n\n    this.size = 4 * 2 + 2 + 2 + 12 * this.references.length;\n    this.size += useVersion1 ? 16 : 8; // earliest_presentation_time and first_offset\n\n    this.flags = 0;\n    this.writeHeader(stream);\n\n    stream.writeUint32(this.reference_ID);\n    stream.writeUint32(this.timescale);\n    if (useVersion1) {\n      stream.writeUint64(this.earliest_presentation_time);\n      stream.writeUint64(this.first_offset);\n    } else {\n      stream.writeUint32(this.earliest_presentation_time);\n      stream.writeUint32(this.first_offset);\n    }\n    stream.writeUint16(0);\n    stream.writeUint16(this.references.length);\n    for (let i = 0; i < this.references.length; i++) {\n      const ref = this.references[i];\n      stream.writeUint32((ref.reference_type << 31) | ref.referenced_size);\n      stream.writeUint32(ref.subsegment_duration);\n      stream.writeUint32((ref.starts_with_SAP << 31) | (ref.SAP_type << 28) | ref.SAP_delta_time);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class smhdBox extends FullBox {\n  static override readonly fourcc = 'smhd' as const;\n  box_name = 'SoundMediaHeaderBox' as const;\n\n  balance: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.balance = stream.readUint16();\n    stream.readUint16();\n  }\n\n  /** @bundle writing/smhd.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.size = 4;\n    this.writeHeader(stream);\n    stream.writeUint16(this.balance);\n    stream.writeUint16(0);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport type { Sample } from '@types';\n\nexport class stcoBox extends FullBox {\n  static override readonly fourcc = 'stco' as const;\n  box_name = 'ChunkOffsetBox' as const;\n\n  chunk_offsets: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const entry_count = stream.readUint32();\n    this.chunk_offsets = [];\n    if (this.version === 0) {\n      for (let i = 0; i < entry_count; i++) {\n        this.chunk_offsets.push(stream.readUint32());\n      }\n    }\n  }\n\n  /** @bundle writings/stco.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 4 + 4 * this.chunk_offsets.length;\n    this.writeHeader(stream);\n    stream.writeUint32(this.chunk_offsets.length);\n    stream.writeUint32Array(this.chunk_offsets);\n  }\n\n  /** @bundle box-unpack.js */\n  unpack(samples: Array<Sample>) {\n    for (let i = 0; i < this.chunk_offsets.length; i++) {\n      samples[i].offset = this.chunk_offsets[i];\n    }\n  }\n}\n","import { FullBox } from '#/box';\n\nexport class sthdBox extends FullBox {\n  static override readonly fourcc = 'sthd' as const;\n  box_name = 'SubtitleMediaHeaderBox' as const;\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport type { Sample } from '@types';\n\nexport class stscBox extends FullBox {\n  static override readonly fourcc = 'stsc' as const;\n  box_name = 'SampleToChunkBox' as const;\n\n  first_chunk: Array<number>;\n  samples_per_chunk: Array<number>;\n  sample_description_index: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const entry_count = stream.readUint32();\n    this.first_chunk = [];\n    this.samples_per_chunk = [];\n    this.sample_description_index = [];\n    if (this.version === 0) {\n      for (let i = 0; i < entry_count; i++) {\n        this.first_chunk.push(stream.readUint32());\n        this.samples_per_chunk.push(stream.readUint32());\n        this.sample_description_index.push(stream.readUint32());\n      }\n    }\n  }\n\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 4 + 12 * this.first_chunk.length;\n    this.writeHeader(stream);\n    stream.writeUint32(this.first_chunk.length);\n    for (let i = 0; i < this.first_chunk.length; i++) {\n      stream.writeUint32(this.first_chunk[i]);\n      stream.writeUint32(this.samples_per_chunk[i]);\n      stream.writeUint32(this.sample_description_index[i]);\n    }\n  }\n\n  unpack(samples: Array<Sample>) {\n    let l = 0;\n    let m = 0;\n    for (let i = 0; i < this.first_chunk.length; i++) {\n      for (\n        let j = 0;\n        j < (i + 1 < this.first_chunk.length ? this.first_chunk[i + 1] : Infinity);\n        j++\n      ) {\n        m++;\n        for (let k = 0; k < this.samples_per_chunk[i]; k++) {\n          if (samples[l]) {\n            samples[l].description_index = this.sample_description_index[i];\n            samples[l].chunk_index = m;\n          } else {\n            return;\n          }\n          l++;\n        }\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { OK } from '#/constants';\nimport { Log } from '#/log';\nimport { BoxRegistry } from '#/registry';\nimport type { BoxFourCC } from '@types';\nimport { SampleEntry } from './sampleentries/base';\nimport { parseOneBox } from '#/parser';\n\nexport class stsdBox extends FullBox {\n  static override readonly fourcc = 'stsd' as const;\n  box_name = 'SampleDescriptionBox' as const;\n\n  entries: Array<SampleEntry>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.entries = [];\n\n    const entryCount = stream.readUint32();\n\n    for (let i = 1; i <= entryCount; i++) {\n      const ret = parseOneBox(stream, true, this.size - (stream.getPosition() - this.start));\n\n      if (ret.code === OK) {\n        let box: SampleEntry;\n        if (ret.type in BoxRegistry.sampleEntry) {\n          box = new BoxRegistry.sampleEntry[ret.type](ret.size);\n          box.hdr_size = ret.hdr_size;\n          box.start = ret.start;\n        } else {\n          Log.warn('BoxParser', `Unknown sample entry type: '${ret.type}'`);\n          box = new SampleEntry(ret.size, ret.hdr_size, ret.start);\n          box.type = ret.type as BoxFourCC;\n        }\n\n        if (box.write === SampleEntry.prototype.write) {\n          Log.info(\n            'BoxParser',\n            'SampleEntry ' +\n              box.type +\n              ' box writing not yet implemented, keeping unparsed data in memory for later write',\n          );\n          box.parseDataAndRewind(stream);\n        }\n\n        box.parse(stream);\n        this.entries.push(box);\n      } else {\n        return;\n      }\n    }\n  }\n\n  /** @bundle writing/stsd.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 0;\n    this.writeHeader(stream);\n    stream.writeUint32(this.entries.length);\n    this.size += 4;\n    for (let i = 0; i < this.entries.length; i++) {\n      this.entries[i].write(stream);\n      this.size += this.entries[i].size;\n    }\n    /* adjusting the size, now that all sub-boxes are known */\n    Log.debug('BoxWriter', 'Adjusting box ' + this.type + ' with new size ' + this.size);\n    stream.adjustUint32(this.sizePosition, this.size);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class stszBox extends FullBox {\n  static override readonly fourcc = 'stsz' as const;\n  box_name = 'SampleSizeBox' as const;\n\n  sample_sizes: Array<number>;\n  sample_size: number;\n  sample_count: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.sample_sizes = [];\n    if (this.version === 0) {\n      this.sample_size = stream.readUint32();\n      this.sample_count = stream.readUint32();\n      for (let i = 0; i < this.sample_count; i++) {\n        if (this.sample_size === 0) {\n          this.sample_sizes.push(stream.readUint32());\n        } else {\n          this.sample_sizes[i] = this.sample_size;\n        }\n      }\n    }\n  }\n\n  /** @bundle writing/stsz.js */\n  write(stream: MultiBufferStream) {\n    let constant = true;\n    this.version = 0;\n    this.flags = 0;\n    if (this.sample_sizes.length > 0) {\n      let i = 0;\n      while (i + 1 < this.sample_sizes.length) {\n        if (this.sample_sizes[i + 1] !== this.sample_sizes[0]) {\n          constant = false;\n          break;\n        } else {\n          i++;\n        }\n      }\n    } else {\n      constant = false;\n    }\n    this.size = 8;\n    if (!constant) {\n      this.size += 4 * this.sample_sizes.length;\n    }\n    this.writeHeader(stream);\n    if (!constant) {\n      stream.writeUint32(0);\n    } else {\n      stream.writeUint32(this.sample_sizes[0]);\n    }\n    stream.writeUint32(this.sample_sizes.length);\n    if (!constant) {\n      stream.writeUint32Array(this.sample_sizes);\n    }\n  }\n\n  /** @bundle box-unpack.js */\n  unpack(samples) {\n    for (let i = 0; i < this.sample_sizes.length; i++) {\n      samples[i].size = this.sample_sizes[i];\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\nimport type { Sample } from '@types';\n\nexport class sttsBox extends FullBox {\n  static override readonly fourcc = 'stts' as const;\n  box_name = 'TimeToSampleBox' as const;\n\n  sample_counts: Array<number> = [];\n  sample_deltas: Array<number> = [];\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const entry_count = stream.readUint32();\n    this.sample_counts.length = 0;\n    this.sample_deltas.length = 0;\n    if (this.version === 0) {\n      for (let i = 0; i < entry_count; i++) {\n        this.sample_counts.push(stream.readUint32());\n        let delta = stream.readInt32();\n        if (delta < 0) {\n          Log.warn(\n            'BoxParser',\n            'File uses negative stts sample delta, using value 1 instead, sync may be lost!',\n          );\n          delta = 1;\n        }\n        this.sample_deltas.push(delta);\n      }\n    }\n  }\n\n  /** @bundle writing/stts.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 4 + 8 * this.sample_counts.length;\n    this.writeHeader(stream);\n    stream.writeUint32(this.sample_counts.length);\n    for (let i = 0; i < this.sample_counts.length; i++) {\n      stream.writeUint32(this.sample_counts[i]);\n      stream.writeUint32(this.sample_deltas[i]);\n    }\n  }\n\n  /** @bundle box-unpack.js */\n  unpack(samples: Array<Sample>) {\n    let k = 0;\n    for (let i = 0; i < this.sample_counts.length; i++) {\n      for (let j = 0; j < this.sample_counts[i]; j++) {\n        if (k === 0) {\n          samples[k].dts = 0;\n        } else {\n          samples[k].dts = samples[k - 1].dts + this.sample_deltas[i];\n        }\n        k++;\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { MAX_UINT32 } from '#/constants';\n\nexport class tfdtBox extends FullBox {\n  static override readonly fourcc = 'tfdt' as const;\n  box_name = 'TrackFragmentBaseMediaDecodeTimeBox' as const;\n\n  baseMediaDecodeTime: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 1) {\n      this.baseMediaDecodeTime = stream.readUint64();\n    } else {\n      this.baseMediaDecodeTime = stream.readUint32();\n    }\n  }\n\n  /** @bundle writing/tdft.js */\n  write(stream: MultiBufferStream) {\n    // use version 1 if baseMediaDecodeTime does not fit 32 bits\n    const useVersion1 = this.baseMediaDecodeTime > MAX_UINT32 || this.version === 1;\n    this.version = useVersion1 ? 1 : 0;\n\n    this.size = 4;\n    this.size += useVersion1 ? 4 : 0;\n\n    this.flags = 0;\n    this.writeHeader(stream);\n    if (useVersion1) {\n      stream.writeUint64(this.baseMediaDecodeTime);\n    } else {\n      stream.writeUint32(this.baseMediaDecodeTime);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport {\n  TFHD_FLAG_BASE_DATA_OFFSET,\n  TFHD_FLAG_SAMPLE_DESC,\n  TFHD_FLAG_SAMPLE_DUR,\n  TFHD_FLAG_SAMPLE_FLAGS,\n  TFHD_FLAG_SAMPLE_SIZE,\n} from '#/constants';\n\nexport class tfhdBox extends FullBox {\n  static override readonly fourcc = 'tfhd' as const;\n  box_name = 'TrackFragmentHeaderBox' as const;\n\n  track_id: number;\n  base_data_offset: number;\n  default_sample_description_index: number;\n  default_sample_duration: number;\n  default_sample_size: number;\n  default_sample_flags: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    let readBytes = 0;\n    this.track_id = stream.readUint32();\n    if (this.size - this.hdr_size > readBytes && this.flags & TFHD_FLAG_BASE_DATA_OFFSET) {\n      this.base_data_offset = stream.readUint64();\n      readBytes += 8;\n    } else {\n      this.base_data_offset = 0;\n    }\n    if (this.size - this.hdr_size > readBytes && this.flags & TFHD_FLAG_SAMPLE_DESC) {\n      this.default_sample_description_index = stream.readUint32();\n      readBytes += 4;\n    } else {\n      this.default_sample_description_index = 0;\n    }\n    if (this.size - this.hdr_size > readBytes && this.flags & TFHD_FLAG_SAMPLE_DUR) {\n      this.default_sample_duration = stream.readUint32();\n      readBytes += 4;\n    } else {\n      this.default_sample_duration = 0;\n    }\n    if (this.size - this.hdr_size > readBytes && this.flags & TFHD_FLAG_SAMPLE_SIZE) {\n      this.default_sample_size = stream.readUint32();\n      readBytes += 4;\n    } else {\n      this.default_sample_size = 0;\n    }\n    if (this.size - this.hdr_size > readBytes && this.flags & TFHD_FLAG_SAMPLE_FLAGS) {\n      this.default_sample_flags = stream.readUint32();\n      readBytes += 4;\n    } else {\n      this.default_sample_flags = 0;\n    }\n  }\n\n  /** @bundle writing/tfhd.js */\n  write(stream) {\n    this.version = 0;\n    this.size = 4;\n    if (this.flags & TFHD_FLAG_BASE_DATA_OFFSET) {\n      this.size += 8;\n    }\n    if (this.flags & TFHD_FLAG_SAMPLE_DESC) {\n      this.size += 4;\n    }\n    if (this.flags & TFHD_FLAG_SAMPLE_DUR) {\n      this.size += 4;\n    }\n    if (this.flags & TFHD_FLAG_SAMPLE_SIZE) {\n      this.size += 4;\n    }\n    if (this.flags & TFHD_FLAG_SAMPLE_FLAGS) {\n      this.size += 4;\n    }\n    this.writeHeader(stream);\n    stream.writeUint32(this.track_id);\n    if (this.flags & TFHD_FLAG_BASE_DATA_OFFSET) {\n      stream.writeUint64(this.base_data_offset);\n    }\n    if (this.flags & TFHD_FLAG_SAMPLE_DESC) {\n      stream.writeUint32(this.default_sample_description_index);\n    }\n    if (this.flags & TFHD_FLAG_SAMPLE_DUR) {\n      stream.writeUint32(this.default_sample_duration);\n    }\n    if (this.flags & TFHD_FLAG_SAMPLE_SIZE) {\n      stream.writeUint32(this.default_sample_size);\n    }\n    if (this.flags & TFHD_FLAG_SAMPLE_FLAGS) {\n      stream.writeUint32(this.default_sample_flags);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { MAX_UINT32 } from '#/constants';\nimport type { Matrix } from '@types';\n\nexport class tkhdBox extends FullBox {\n  static override readonly fourcc = 'tkhd' as const;\n  box_name = 'TrackHeaderBox' as const;\n\n  creation_time: number;\n  modification_time: number;\n  track_id: number;\n  duration: number;\n  layer = 0;\n  alternate_group = 0;\n  volume: number;\n  matrix: Matrix;\n  width: number;\n  height: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 1) {\n      this.creation_time = stream.readUint64();\n      this.modification_time = stream.readUint64();\n      this.track_id = stream.readUint32();\n      stream.readUint32();\n      this.duration = stream.readUint64();\n    } else {\n      this.creation_time = stream.readUint32();\n      this.modification_time = stream.readUint32();\n      this.track_id = stream.readUint32();\n      stream.readUint32();\n      this.duration = stream.readUint32();\n    }\n    stream.readUint32Array(2);\n    this.layer = stream.readInt16();\n    this.alternate_group = stream.readInt16();\n    this.volume = stream.readInt16() >> 8;\n    stream.readUint16();\n    this.matrix = stream.readInt32Array(9);\n    this.width = stream.readUint32();\n    this.height = stream.readUint32();\n  }\n\n  write(stream: MultiBufferStream) {\n    const useVersion1 =\n      this.modification_time > MAX_UINT32 ||\n      this.creation_time > MAX_UINT32 ||\n      this.duration > MAX_UINT32 ||\n      this.version === 1;\n    this.version = useVersion1 ? 1 : 0;\n\n    this.size = 5 * 4 + 15 * 4; // 5x4 for header, 15x4 for fields\n    this.size += useVersion1 ? 3 * 4 : 0; // creation_time, modification_time, duration\n\n    this.flags = this.flags ?? 0x1 | 0x2; // track_enabled | track_in_movie\n    this.writeHeader(stream);\n\n    if (useVersion1) {\n      stream.writeUint64(this.creation_time);\n      stream.writeUint64(this.modification_time);\n      stream.writeUint32(this.track_id);\n      stream.writeUint32(0); // reserved\n      stream.writeUint64(this.duration);\n    } else {\n      stream.writeUint32(this.creation_time);\n      stream.writeUint32(this.modification_time);\n      stream.writeUint32(this.track_id);\n      stream.writeUint32(0); // reserved\n      stream.writeUint32(this.duration);\n    }\n    stream.writeUint32Array([0, 0]); // reserved\n    stream.writeInt16(this.layer);\n    stream.writeInt16(this.alternate_group);\n    stream.writeInt16(this.volume << 8); // volume in 0.256 units\n    stream.writeInt16(0); // reserved\n    stream.writeInt32Array(this.matrix); // 3x3 matrix\n    stream.writeUint32(this.width);\n    stream.writeUint32(this.height);\n  }\n\n  /** @bundle box-print.js */\n  print(output: { log: (arg: string) => void; indent: string }) {\n    super.printHeader(output);\n    output.log(output.indent + 'creation_time: ' + this.creation_time);\n    output.log(output.indent + 'modification_time: ' + this.modification_time);\n    output.log(output.indent + 'track_id: ' + this.track_id);\n    output.log(output.indent + 'duration: ' + this.duration);\n    output.log(output.indent + 'volume: ' + (this.volume >> 8));\n    output.log(output.indent + 'matrix: ' + this.matrix.join(', '));\n    output.log(output.indent + 'layer: ' + this.layer);\n    output.log(output.indent + 'alternate_group: ' + this.alternate_group);\n    output.log(output.indent + 'width: ' + this.width);\n    output.log(output.indent + 'height: ' + this.height);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class trexBox extends FullBox {\n  static override readonly fourcc = 'trex' as const;\n  box_name = 'TrackExtendsBox' as const;\n\n  track_id: number;\n  default_sample_description_index: number;\n  default_sample_duration: number;\n  default_sample_size: number;\n  default_sample_flags: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.track_id = stream.readUint32();\n    this.default_sample_description_index = stream.readUint32();\n    this.default_sample_duration = stream.readUint32();\n    this.default_sample_size = stream.readUint32();\n    this.default_sample_flags = stream.readUint32();\n  }\n\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 4 * 5;\n    this.writeHeader(stream);\n    stream.writeUint32(this.track_id);\n    stream.writeUint32(this.default_sample_description_index);\n    stream.writeUint32(this.default_sample_duration);\n    stream.writeUint32(this.default_sample_size);\n    stream.writeUint32(this.default_sample_flags);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport {\n  TRUN_FLAGS_CTS_OFFSET,\n  TRUN_FLAGS_DATA_OFFSET,\n  TRUN_FLAGS_DURATION,\n  TRUN_FLAGS_FIRST_FLAG,\n  TRUN_FLAGS_FLAGS,\n  TRUN_FLAGS_SIZE,\n} from '#/constants';\n\nexport class trunBox extends FullBox {\n  static override readonly fourcc = 'trun' as const;\n  box_name = 'TrackRunBox' as const;\n\n  sample_count: number;\n  data_offset: number;\n  first_sample_flags: number;\n  sample_duration: Array<number> = [];\n  sample_size: Array<number> = [];\n  sample_flags: Array<number> = [];\n  sample_composition_time_offset: Array<number> = [];\n  data_offset_position: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    let readBytes = 0;\n    this.sample_count = stream.readUint32();\n    readBytes += 4;\n    if (this.size - this.hdr_size > readBytes && this.flags & TRUN_FLAGS_DATA_OFFSET) {\n      this.data_offset = stream.readInt32(); //signed\n      readBytes += 4;\n    } else {\n      this.data_offset = 0;\n    }\n    if (this.size - this.hdr_size > readBytes && this.flags & TRUN_FLAGS_FIRST_FLAG) {\n      this.first_sample_flags = stream.readUint32();\n      readBytes += 4;\n    } else {\n      this.first_sample_flags = 0;\n    }\n    this.sample_duration = [];\n    this.sample_size = [];\n    this.sample_flags = [];\n    this.sample_composition_time_offset = [];\n    if (this.size - this.hdr_size > readBytes) {\n      for (let i = 0; i < this.sample_count; i++) {\n        if (this.flags & TRUN_FLAGS_DURATION) {\n          this.sample_duration[i] = stream.readUint32();\n        }\n        if (this.flags & TRUN_FLAGS_SIZE) {\n          this.sample_size[i] = stream.readUint32();\n        }\n        if (this.flags & TRUN_FLAGS_FLAGS) {\n          this.sample_flags[i] = stream.readUint32();\n        }\n        if (this.flags & TRUN_FLAGS_CTS_OFFSET) {\n          if (this.version === 0) {\n            this.sample_composition_time_offset[i] = stream.readUint32();\n          } else {\n            this.sample_composition_time_offset[i] = stream.readInt32(); //signed\n          }\n        }\n      }\n    }\n  }\n\n  /** @bundle writing/trun.js */\n  write(stream: MultiBufferStream) {\n    this.size = 4;\n    if (this.flags & TRUN_FLAGS_DATA_OFFSET) {\n      this.size += 4;\n    }\n    if (this.flags & TRUN_FLAGS_FIRST_FLAG) {\n      this.size += 4;\n    }\n    if (this.flags & TRUN_FLAGS_DURATION) {\n      this.size += 4 * this.sample_duration.length;\n    }\n    if (this.flags & TRUN_FLAGS_SIZE) {\n      this.size += 4 * this.sample_size.length;\n    }\n    if (this.flags & TRUN_FLAGS_FLAGS) {\n      this.size += 4 * this.sample_flags.length;\n    }\n    if (this.flags & TRUN_FLAGS_CTS_OFFSET) {\n      this.size += 4 * this.sample_composition_time_offset.length;\n    }\n    this.writeHeader(stream);\n    stream.writeUint32(this.sample_count);\n    if (this.flags & TRUN_FLAGS_DATA_OFFSET) {\n      this.data_offset_position = stream.getPosition();\n      stream.writeInt32(this.data_offset); //signed\n    }\n    if (this.flags & TRUN_FLAGS_FIRST_FLAG) {\n      stream.writeUint32(this.first_sample_flags);\n    }\n    for (let i = 0; i < this.sample_count; i++) {\n      if (this.flags & TRUN_FLAGS_DURATION) {\n        stream.writeUint32(this.sample_duration[i]);\n      }\n      if (this.flags & TRUN_FLAGS_SIZE) {\n        stream.writeUint32(this.sample_size[i]);\n      }\n      if (this.flags & TRUN_FLAGS_FLAGS) {\n        stream.writeUint32(this.sample_flags[i]);\n      }\n      if (this.flags & TRUN_FLAGS_CTS_OFFSET) {\n        if (this.version === 0) {\n          stream.writeUint32(this.sample_composition_time_offset[i]);\n        } else {\n          stream.writeInt32(this.sample_composition_time_offset[i]); //signed\n        }\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class urlBox extends FullBox {\n  static override readonly fourcc = 'url ' as const;\n  box_name = 'DataEntryUrlBox' as const;\n\n  location?: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.flags !== 0x000001) {\n      this.location = stream.readCString();\n    }\n  }\n\n  /** @bundle writing/url.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    if (this.location) {\n      this.flags = 0;\n      this.size = this.location.length + 1;\n    } else {\n      this.flags = 0x000001;\n      this.size = 0;\n    }\n    this.writeHeader(stream);\n    if (this.location) {\n      stream.writeCString(this.location);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class vmhdBox extends FullBox {\n  static override readonly fourcc = 'vmhd' as const;\n  box_name = 'VideoMediaHeaderBox' as const;\n\n  graphicsmode: number;\n  opcolor: Uint16Array | [number, number, number];\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.graphicsmode = stream.readUint16();\n    this.opcolor = stream.readUint16Array(3);\n  }\n\n  /** @bundle writing/vmhd.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.size = 8;\n    this.writeHeader(stream);\n    stream.writeUint16(this.graphicsmode);\n    stream.writeUint16Array(this.opcolor);\n  }\n}\n","/*\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\n * License: BSD-3-Clause (see LICENSE file)\n */\n\nimport { Box } from '#/box';\nimport { boxEqual } from '#/box-diff';\nimport { avcCBox } from '#/boxes/avcC';\nimport {\n  dinfBox,\n  hmhdBox,\n  mdatBox,\n  mdiaBox,\n  minfBox,\n  moofBox,\n  moovBox,\n  mvexBox,\n  nmhdBox,\n  stblBox,\n  trafBox,\n  trakBox,\n} from '#/boxes/defaults';\nimport { drefBox } from '#/boxes/dref';\nimport { elngBox } from '#/boxes/elng';\nimport { ftypBox } from '#/boxes/ftyp';\nimport { hdlrBox } from '#/boxes/hdlr';\nimport { hvcCBox } from '#/boxes/hvcC';\nimport { mdhdBox } from '#/boxes/mdhd';\nimport { mehdBox } from '#/boxes/mehd';\nimport { metaBox } from '#/boxes/meta';\nimport { mfhdBox } from '#/boxes/mfhd';\nimport { mvhdBox } from '#/boxes/mvhd';\nimport { stppSampleEntry } from '#/boxes/sampleentries';\nimport {\n  AudioSampleEntry,\n  HintSampleEntry,\n  MetadataSampleEntry,\n  SubtitleSampleEntry,\n  SystemSampleEntry,\n  VisualSampleEntry,\n} from '#/boxes/sampleentries/base';\nimport { sbgpBox } from '#/boxes/sbgp';\nimport { sdtpBox } from '#/boxes/sdtp';\nimport { sgpdBox } from '#/boxes/sgpd';\nimport { sidxBox } from '#/boxes/sidx';\nimport { smhdBox } from '#/boxes/smhd';\nimport { stcoBox } from '#/boxes/stco';\nimport { sthdBox } from '#/boxes/sthd';\nimport { stscBox } from '#/boxes/stsc';\nimport { stsdBox } from '#/boxes/stsd';\nimport { stszBox } from '#/boxes/stsz';\nimport { sttsBox } from '#/boxes/stts';\nimport { tfdtBox } from '#/boxes/tfdt';\nimport { tfhdBox } from '#/boxes/tfhd';\nimport { tkhdBox } from '#/boxes/tkhd';\nimport { trexBox } from '#/boxes/trex';\nimport { trunBox } from '#/boxes/trun';\nimport { urlBox } from '#/boxes/url';\nimport { vmhdBox } from '#/boxes/vmhd';\nimport { MultiBufferStream } from '#/buffer';\nimport {\n  ERR_INVALID_DATA,\n  ERR_NOT_ENOUGH_DATA,\n  OK,\n  TFHD_FLAG_BASE_DATA_OFFSET,\n  TFHD_FLAG_DEFAULT_BASE_IS_MOOF,\n  TFHD_FLAG_SAMPLE_DESC,\n  TFHD_FLAG_SAMPLE_DUR,\n  TFHD_FLAG_SAMPLE_FLAGS,\n  TFHD_FLAG_SAMPLE_SIZE,\n  TKHD_FLAG_ENABLED,\n  TKHD_FLAG_IN_MOVIE,\n  TKHD_FLAG_IN_PREVIEW,\n  TRUN_FLAGS_CTS_OFFSET,\n  TRUN_FLAGS_DATA_OFFSET,\n  TRUN_FLAGS_DURATION,\n  TRUN_FLAGS_FIRST_FLAG,\n  TRUN_FLAGS_FLAGS,\n  TRUN_FLAGS_SIZE,\n} from '#/constants';\nimport { DataStream } from '#/DataStream';\nimport { Log } from '#/log';\nimport { BoxRegistry } from '#/registry';\nimport type {\n  AllIdentifiers,\n  AllRegisteredBoxes,\n  BoxKind,\n  Description,\n  EntityGroup,\n  ExtractedTrack,\n  FragmentedTrack,\n  IncompleteBox,\n  Item,\n  Movie,\n  Output,\n  Sample,\n  SampleEntryFourCC,\n  SubSample,\n  Track,\n} from '@types';\nimport { MP4BoxBuffer } from '#/mp4boxbuffer';\nimport { parseOneBox } from '#/parser';\n\nexport class SampleGroupInfo {\n  last_sample_in_run = -1;\n  entry_index = -1;\n\n  description: Description;\n  fragment_description: Description;\n  is_fragment: boolean;\n\n  constructor(\n    public grouping_type: string,\n    public grouping_type_parameter: number,\n    public sbgp?: sbgpBox,\n  ) {}\n}\n\nexport interface IsoFileOptions {\n  brands?: Array<string>;\n  description_boxes?: Array<BoxKind>;\n  duration?: number;\n  height?: number;\n  id?: number;\n  language?: string;\n  layer?: number;\n  media_duration?: number;\n  rate?: number;\n  timescale?: number;\n  type?: SampleEntryFourCC;\n  width?: number;\n  hdlr?: string;\n  name?: string;\n  hevcDecoderConfigRecord?: ArrayBuffer;\n  avcDecoderConfigRecord?: ArrayBuffer;\n  balance?: number;\n  channel_count?: number;\n  samplesize?: number;\n  samplerate?: number;\n  namespace?: string;\n  schema_location?: string;\n  auxiliary_mime_types?: string;\n  description?: Box;\n  default_sample_description_index?: number;\n  default_sample_duration?: number;\n  default_sample_size?: number;\n  default_sample_flags?: number;\n}\n\nexport class ISOFile<TSegmentUser = unknown, TSampleUser = unknown> {\n  /** MutiBufferStream object used to parse boxes */\n  stream: MultiBufferStream;\n  /** Array of all boxes (in order) found in the file */\n  boxes: Array<Box> = [];\n  /** Array of all mdats */\n  mdats: Array<mdatBox> = [];\n  /** Array of all moofs */\n  moofs: Array<moofBox> = [];\n  /** Boolean indicating if the file is compatible with progressive parsing (moov first) */\n  isProgressive = false;\n  /** Boolean used to fire moov start event only once */\n  moovStartFound = false;\n  /** Callback called when the moov parsing starts */\n  onMoovStart?: () => void;\n  /** Boolean keeping track of the call to onMoovStart, to avoid double calls */\n  moovStartSent = false;\n  /** Callback called when the moov is entirely parsed */\n  onReady?: (info: Movie) => void;\n  /** Boolean keeping track of the call to onReady, to avoid double calls */\n  readySent = false;\n  /** Callback to call when segments are ready */\n  onSegment?: (\n    id: number,\n    user: TSegmentUser,\n    buffer: ArrayBuffer,\n    nextSample: number,\n    last: boolean,\n  ) => void;\n  /** Callback to call when samples are ready */\n  onSamples?: (id: number, user: TSampleUser, samples: Array<Sample>) => void;\n  /** Callback to call when there is an error in the parsing or processing of samples */\n  onError?: (module: string, message: string) => void;\n  /** Callback to call when an item is processed */\n  onItem?: () => void;\n  /** Boolean indicating if the moov box run-length encoded tables of sample information have been processed */\n  sampleListBuilt = false;\n  /** Array of Track objects for which fragmentation of samples is requested */\n  fragmentedTracks: Array<FragmentedTrack<TSegmentUser>> = [];\n  /** Array of Track objects for which extraction of samples is requested */\n  extractedTracks: Array<ExtractedTrack<TSampleUser>> = [];\n  /** Boolean indicating that fragmention is ready */\n  isFragmentationInitialized = false;\n  /** Boolean indicating that fragmented has started */\n  sampleProcessingStarted = false;\n  /** Number of the next 'moof' to generate when fragmenting */\n  nextMoofNumber = 0;\n  /** Boolean indicating if the initial list of items has been produced */\n  itemListBuilt = false;\n  /** Callback called when the sidx box is entirely parsed */\n  onSidx?: (sidx: sidxBox) => void;\n  /** Boolean keeping track of the call to onSidx, to avoid double calls */\n  sidxSent = false;\n\n  /** @bundle isofile-item-processing.js */\n  items: Array<Item> = [];\n\n  /** @bundle isofile-item-processing.js */\n  entity_groups: Array<EntityGroup> = [];\n\n  /**\n   * size of the buffers allocated for samples\n   * @bundle isofile-item-processing.js\n   */\n  itemsDataSize = 0;\n\n  moov: moovBox;\n  moovs: Array<moovBox>;\n  sidx: sidxBox;\n  sidxs: Array<sidxBox>;\n  meta: metaBox;\n  metas: Array<metaBox>;\n  ftyp: ftypBox;\n  ftyps: Array<ftypBox>;\n  nextSeekPosition: number;\n  initial_duration: number;\n\n  constructor(stream?: MultiBufferStream, discardMdatData = true) {\n    this.discardMdatData = discardMdatData;\n    if (stream) {\n      this.stream = stream;\n      this.parse();\n    } else {\n      this.stream = new MultiBufferStream();\n    }\n    this.stream.isofile = this;\n  }\n\n  setSegmentOptions(\n    id: number,\n    user: TSegmentUser,\n    opts: Partial<{\n      nbSamples: number;\n      nbSamplesPerFragment: number;\n      sizePerSegment: number;\n      rapAlignement: boolean;\n    }>,\n  ) {\n    // Destructure and provide defaults for optional properties\n    const { sizePerSegment = Number.MAX_SAFE_INTEGER, rapAlignement = true } = opts;\n\n    // Set defaults for sample counts\n    let nbSamples = opts.nbSamples ?? opts.nbSamplesPerFragment ?? 1000;\n    const nbSamplesPerFragment = opts.nbSamplesPerFragment ?? nbSamples;\n\n    // Validate number of samples\n    if (nbSamples <= 0 || nbSamplesPerFragment <= 0 || sizePerSegment <= 0) {\n      Log.error(\n        'ISOFile',\n        `Invalid segment options: nbSamples=${nbSamples}, nbSamplesPerFragment=${nbSamplesPerFragment}, sizePerSegment=${sizePerSegment}`,\n      );\n      return;\n    }\n\n    // Check if the number of samples is valid\n    if (nbSamples < nbSamplesPerFragment) {\n      Log.warn(\n        'ISOFile',\n        `nbSamples (${nbSamples}) is less than nbSamplesPerFragment (${nbSamplesPerFragment}), setting nbSamples to nbSamplesPerFragment`,\n      );\n      nbSamples = nbSamplesPerFragment;\n    }\n\n    // Number of samples per segment must be same across all tracks\n    if (this.fragmentedTracks.some(track => track.nb_samples !== nbSamples)) {\n      Log.error(\n        'ISOFile',\n        `Cannot set segment options for track ${id}: nbSamples (${nbSamples}) does not match existing tracks`,\n      );\n      return;\n    }\n\n    const trak = this.getTrackById(id);\n    if (trak) {\n      const fragTrack: FragmentedTrack<TSegmentUser> = {\n        id,\n        user,\n        trak,\n        segmentStream: undefined,\n        nb_samples: nbSamples,\n        nb_samples_per_fragment: nbSamplesPerFragment,\n        size_per_segment: sizePerSegment,\n        rapAlignement,\n        state: {\n          lastFragmentSampleNumber: 0,\n          lastSegmentSampleNumber: 0,\n          accumulatedSize: 0,\n        },\n      };\n      this.fragmentedTracks.push(fragTrack);\n      trak.nextSample = 0;\n    }\n\n    if (this.discardMdatData) {\n      Log.warn(\n        'ISOFile',\n        'Segmentation options set but discardMdatData is true, samples will not be segmented',\n      );\n    }\n  }\n\n  unsetSegmentOptions(id: number) {\n    let index = -1;\n    for (let i = 0; i < this.fragmentedTracks.length; i++) {\n      const fragTrack = this.fragmentedTracks[i];\n      if (fragTrack.id === id) {\n        index = i;\n      }\n    }\n    if (index > -1) {\n      this.fragmentedTracks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Define explicit segment boundaries using absolute sample numbers (1-based).\n   * This bypasses nbSamples/sizePerSegment logic; segmentation will fire when the\n   * current sample number reaches one of the provided boundaries.\n   */\n  setExternalSegmentBoundaries(\n    id: number,\n    user: TSegmentUser,\n    boundarySamples: Array<number>,\n    { rapAlignement = true }: { rapAlignement?: boolean } = {},\n  ) {\n    if (!Array.isArray(boundarySamples) || boundarySamples.length === 0) {\n      Log.error('ISOFile', `Cannot set external segment boundaries for track ${id}: empty list`);\n      return;\n    }\n\n    const normalized = boundarySamples\n      .filter(v => Number.isFinite(v) && v > 0)\n      .map(v => Math.floor(v))\n      .sort((a, b) => a - b);\n\n    if (normalized.length === 0) {\n      Log.error(\n        'ISOFile',\n        `Cannot set external segment boundaries for track ${id}: no valid positive numbers`,\n      );\n      return;\n    }\n\n    // Remove any existing segmentation options for this track\n    this.unsetSegmentOptions(id);\n\n    const trak = this.getTrackById(id);\n    if (trak) {\n      const fragTrack: FragmentedTrack<TSegmentUser> = {\n        id,\n        user,\n        trak,\n        segmentStream: undefined,\n        nb_samples: Number.MAX_SAFE_INTEGER,\n        nb_samples_per_fragment: Number.MAX_SAFE_INTEGER,\n        size_per_segment: Number.MAX_SAFE_INTEGER,\n        rapAlignement,\n        external_segment_boundaries: normalized,\n        state: {\n          lastFragmentSampleNumber: 0,\n          lastSegmentSampleNumber: 0,\n          accumulatedSize: 0,\n          nextBoundaryIndex: 0,\n        },\n      };\n      this.fragmentedTracks.push(fragTrack);\n      trak.nextSample = 0;\n    }\n\n    if (this.discardMdatData) {\n      Log.warn(\n        'ISOFile',\n        'Segmentation options set but discardMdatData is true, samples will not be segmented',\n      );\n    }\n  }\n\n  setExtractionOptions(\n    id: number,\n    user?: TSampleUser,\n    { nbSamples: nb_samples = 1000 }: { nbSamples?: number } = {},\n  ) {\n    const trak = this.getTrackById(id);\n    if (trak) {\n      this.extractedTracks.push({\n        id,\n        user,\n        trak,\n        nb_samples,\n        samples: [],\n      });\n      trak.nextSample = 0;\n    }\n\n    if (this.discardMdatData) {\n      Log.warn(\n        'ISOFile',\n        'Extraction options set but discardMdatData is true, samples will not be extracted',\n      );\n    }\n  }\n\n  unsetExtractionOptions(id: number) {\n    let index = -1;\n    for (let i = 0; i < this.extractedTracks.length; i++) {\n      const extractTrack = this.extractedTracks[i];\n      if (extractTrack.id === id) {\n        index = i;\n      }\n    }\n    if (index > -1) {\n      this.extractedTracks.splice(index, 1);\n    }\n  }\n\n  parse() {\n    const parseBoxHeadersOnly = false;\n\n    if (this.restoreParsePosition) {\n      if (!this.restoreParsePosition()) {\n        return;\n      }\n    }\n\n    while (true) {\n      if (this.hasIncompleteMdat && this.hasIncompleteMdat()) {\n        if (this.processIncompleteMdat()) {\n          continue;\n        } else {\n          return;\n        }\n      } else {\n        if (this.saveParsePosition) {\n          this.saveParsePosition();\n        }\n        const ret = parseOneBox(this.stream, parseBoxHeadersOnly);\n        if (ret.code === ERR_NOT_ENOUGH_DATA) {\n          if (this.processIncompleteBox) {\n            if (this.processIncompleteBox(ret)) {\n              continue;\n            } else {\n              return;\n            }\n          } else {\n            return;\n          }\n        } else if (ret.code === OK) {\n          /* the box is entirely parsed */\n          const box = ret.box as BoxKind;\n          /* store the box in the 'boxes' array to preserve box order (for file rewrite if needed)  */\n          this.boxes.push(box);\n          if (box.type === 'uuid') {\n            if (this[box.uuid] !== undefined) {\n              Log.warn(\n                'ISOFile',\n                'Duplicate Box of uuid: ' + box.uuid + ', overriding previous occurrence',\n              );\n            }\n            this[box.uuid] = box;\n          } else {\n            /* but also store box in a property for more direct access */\n            switch (box.type) {\n              case 'mdat':\n                this.mdats.push(box as mdatBox);\n                this.transferMdatData(box as mdatBox);\n                break;\n              case 'moof':\n                this.moofs.push(box as moofBox);\n                break;\n              case 'free':\n              case 'skip':\n                break;\n              case 'moov':\n                this.moovStartFound = true;\n                if (this.mdats.length === 0) {\n                  this.isProgressive = true;\n                }\n              /* no break */\n              /* falls through */\n              default:\n                if (this[box.type] !== undefined) {\n                  if (Array.isArray(this[box.type + 's'])) {\n                    Log.info(\n                      'ISOFile',\n                      `Found multiple boxes of type ${box.type} in ISOFile, adding to array`,\n                    );\n                    this[box.type + 's'].push(box);\n                  } else {\n                    Log.warn(\n                      'ISOFile',\n                      `Found multiple boxes of type ${box.type} but no array exists. Creating array dynamically.`,\n                    );\n                    this[box.type + 's'] = [this[box.type], box];\n                  }\n                } else {\n                  this[box.type] = box;\n                  if (Array.isArray(this[box.type + 's'])) {\n                    this[box.type + 's'].push(box);\n                  }\n                }\n                break;\n            }\n          }\n          if (this.updateUsedBytes) {\n            this.updateUsedBytes(box, ret);\n          }\n        } else if (ret.code === ERR_INVALID_DATA) {\n          Log.error(\n            'ISOFile',\n            `Invalid data found while parsing box of type '${ret.type}' at position ${ret.start}. Aborting parsing.`,\n            this,\n          );\n          break;\n        }\n      }\n    }\n  }\n\n  checkBuffer(ab?: MP4BoxBuffer) {\n    if (!ab) throw new Error('Buffer must be defined and non empty');\n    if (ab.byteLength === 0) {\n      Log.warn('ISOFile', 'Ignoring empty buffer (fileStart: ' + ab.fileStart + ')');\n      this.stream.logBufferLevel();\n      return false;\n    }\n    Log.info('ISOFile', 'Processing buffer (fileStart: ' + ab.fileStart + ')');\n\n    /* mark the bytes in the buffer as not being used yet */\n    ab.usedBytes = 0;\n    this.stream.insertBuffer(ab);\n    this.stream.logBufferLevel();\n\n    if (!this.stream.initialized()) {\n      Log.warn('ISOFile', 'Not ready to start parsing');\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Processes a new ArrayBuffer (with a fileStart property)\n   * Returns the next expected file position, or undefined if not ready to parse\n   */\n  appendBuffer(ab: MP4BoxBuffer, last?: boolean) {\n    let nextFileStart: number;\n    if (!this.checkBuffer(ab)) {\n      return;\n    }\n\n    /* Parse whatever is in the existing buffers */\n    this.parse();\n\n    /* Check if the moovStart callback needs to be called */\n    if (this.moovStartFound && !this.moovStartSent) {\n      this.moovStartSent = true;\n      if (this.onMoovStart) this.onMoovStart();\n    }\n\n    if (this.moov) {\n      /* A moov box has been entirely parsed */\n\n      /* if this is the first call after the moov is found we initialize the list of samples (may be empty in fragmented files) */\n      if (!this.sampleListBuilt) {\n        this.buildSampleLists();\n        this.sampleListBuilt = true;\n      }\n\n      /* We update the sample information if there are any new moof boxes */\n      this.updateSampleLists();\n\n      /* If the application needs to be informed that the 'moov' has been found,\n         we create the information object and callback the application */\n      if (this.onReady && !this.readySent) {\n        this.readySent = true;\n        this.onReady(this.getInfo());\n      }\n\n      /* See if any sample extraction or segment creation needs to be done with the available samples */\n      this.processSamples(last);\n\n      /* Inform about the best range to fetch next */\n      if (this.nextSeekPosition) {\n        nextFileStart = this.nextSeekPosition;\n        this.nextSeekPosition = undefined;\n      } else {\n        nextFileStart = this.nextParsePosition;\n      }\n      if (this.stream.getEndFilePositionAfter) {\n        nextFileStart = this.stream.getEndFilePositionAfter(nextFileStart);\n      }\n    } else {\n      if (this.nextParsePosition) {\n        /* moov has not been parsed but the first buffer was received,\n           the next fetch should probably be the next box start */\n        nextFileStart = this.nextParsePosition;\n      } else {\n        /* No valid buffer has been parsed yet, we cannot know what to parse next */\n        nextFileStart = 0;\n      }\n    }\n    if (this.sidx) {\n      if (this.onSidx && !this.sidxSent) {\n        this.onSidx(this.sidx);\n        this.sidxSent = true;\n      }\n    }\n    if (this.meta) {\n      if (this.flattenItemInfo && !this.itemListBuilt) {\n        this.flattenItemInfo();\n        this.itemListBuilt = true;\n      }\n      if (this.processItems) {\n        this.processItems(this.onItem);\n      }\n    }\n\n    if (this.stream.cleanBuffers) {\n      Log.info(\n        'ISOFile',\n        'Done processing buffer (fileStart: ' +\n          ab.fileStart +\n          ') - next buffer to fetch should have a fileStart position of ' +\n          nextFileStart,\n      );\n      this.stream.logBufferLevel();\n      this.stream.cleanBuffers();\n      this.stream.logBufferLevel(true);\n      Log.info('ISOFile', 'Sample data size in memory: ' + this.getAllocatedSampleDataSize());\n    }\n    return nextFileStart;\n  }\n\n  getFragmentDuration() {\n    const mvex = this.getBox('mvex');\n    if (!mvex) return;\n\n    // Use mehd if available\n    if (mvex.mehd) {\n      return {\n        num: mvex.mehd.fragment_duration,\n        den: this.moov.mvhd.timescale,\n      };\n    }\n\n    // Find the longest track\n    const traks = this.getBoxes('trak', false);\n    let maximum = { num: 0, den: 1 };\n\n    for (const trak of traks) {\n      const duration = trak.samples_duration;\n      const timescale = trak.mdia.mdhd.timescale;\n      if (duration && timescale) {\n        const ratio = duration / timescale;\n        if (ratio > maximum.num / maximum.den) {\n          maximum = { num: duration, den: timescale };\n        }\n      }\n    }\n\n    return maximum;\n  }\n\n  getInfo(): Movie {\n    if (!this.moov) {\n      return {\n        hasMoov: false,\n        mime: '',\n      } as Movie;\n    }\n\n    const _1904 = new Date('1904-01-01T00:00:00Z').getTime();\n    const isFragmented = this.getBox('mvex') !== undefined;\n\n    const movie: Movie = {\n      hasMoov: true,\n      duration: this.moov.mvhd.duration,\n      timescale: this.moov.mvhd.timescale,\n      isFragmented,\n      fragment_duration: this.getFragmentDuration(),\n      isProgressive: this.isProgressive,\n      hasIOD: this.moov.iods !== undefined,\n      brands: [this.ftyp.major_brand].concat(this.ftyp.compatible_brands),\n      created: new Date(_1904 + this.moov.mvhd.creation_time * 1000),\n      modified: new Date(_1904 + this.moov.mvhd.modification_time * 1000),\n      tracks: [] as Array<Track>,\n      audioTracks: [] as Array<Track>,\n      videoTracks: [] as Array<Track>,\n      subtitleTracks: [] as Array<Track>,\n      metadataTracks: [] as Array<Track>,\n      hintTracks: [] as Array<Track>,\n      otherTracks: [] as Array<Track>,\n      mime: '',\n    };\n\n    for (let i = 0; i < this.moov.traks.length; i++) {\n      const trak = this.moov.traks[i];\n\n      const sample_desc = trak.mdia.minf.stbl.stsd.entries[0];\n\n      const size = trak.samples_size;\n      const track_timescale = trak.mdia.mdhd.timescale;\n      const samples_duration = trak.samples_duration;\n      const bitrate = (size * 8 * track_timescale) / samples_duration;\n\n      const track: Track = {\n        samples_duration,\n        bitrate,\n        size,\n        timescale: track_timescale,\n        alternate_group: trak.tkhd.alternate_group,\n        codec: sample_desc.getCodec(),\n        created: new Date(_1904 + trak.tkhd.creation_time * 1000),\n        cts_shift: trak.mdia.minf.stbl.cslg,\n        duration: trak.mdia.mdhd.duration,\n        id: trak.tkhd.track_id,\n        kind:\n          trak.udta && trak.udta.kinds.length ? trak.udta.kinds[0] : { schemeURI: '', value: '' },\n        // NOTE:   trak.mdia.elng used to be trak.mdia.eln\n        language: trak.mdia.elng ? trak.mdia.elng.extended_language : trak.mdia.mdhd.languageString,\n        layer: trak.tkhd.layer,\n        matrix: trak.tkhd.matrix,\n        modified: new Date(_1904 + trak.tkhd.modification_time * 1000),\n        movie_duration: trak.tkhd.duration,\n        movie_timescale: movie.timescale,\n        name: trak.mdia.hdlr.name,\n        nb_samples: trak.samples.length,\n        references: [],\n        track_height: trak.tkhd.height / (1 << 16),\n        track_width: trak.tkhd.width / (1 << 16),\n        volume: trak.tkhd.volume,\n      };\n\n      movie.tracks.push(track);\n\n      if (trak.tref) {\n        for (let j = 0; j < trak.tref.references.length; j++) {\n          track.references.push({\n            type: trak.tref.references[j].type,\n            track_ids: trak.tref.references[j].track_ids,\n          });\n        }\n      }\n\n      if (trak.edts !== undefined && trak.edts.elst !== undefined) {\n        track.edits = trak.edts.elst.entries;\n      }\n\n      if (sample_desc instanceof AudioSampleEntry) {\n        track.type = 'audio';\n        movie.audioTracks.push(track);\n        track.audio = {\n          sample_rate: sample_desc.getSampleRate(),\n          channel_count: sample_desc.getChannelCount(),\n          sample_size: sample_desc.getSampleSize(),\n        };\n      } else if (sample_desc instanceof VisualSampleEntry) {\n        track.type = 'video';\n        movie.videoTracks.push(track);\n        track.video = {\n          width: sample_desc.getWidth(),\n          height: sample_desc.getHeight(),\n        };\n      } else if (sample_desc instanceof SubtitleSampleEntry) {\n        track.type = 'subtitles';\n        movie.subtitleTracks.push(track);\n      } else if (sample_desc instanceof HintSampleEntry) {\n        track.type = 'metadata';\n        movie.hintTracks.push(track);\n      } else if (sample_desc instanceof MetadataSampleEntry) {\n        track.type = 'metadata';\n        movie.metadataTracks.push(track);\n      } else {\n        track.type = 'metadata';\n        movie.otherTracks.push(track);\n      }\n    }\n\n    if (movie.videoTracks && movie.videoTracks.length > 0) {\n      movie.mime += 'video/mp4; codecs=\"';\n    } else if (movie.audioTracks && movie.audioTracks.length > 0) {\n      movie.mime += 'audio/mp4; codecs=\"';\n    } else {\n      movie.mime += 'application/mp4; codecs=\"';\n    }\n    for (let i = 0; i < movie.tracks.length; i++) {\n      if (i !== 0) movie.mime += ',';\n      movie.mime += movie.tracks[i].codec;\n    }\n    movie.mime += '\"; profiles=\"';\n    movie.mime += this.ftyp.compatible_brands.join();\n    movie.mime += '\"';\n\n    return movie;\n  }\n\n  setNextSeekPositionFromSample(sample: Sample) {\n    if (!sample) {\n      return;\n    }\n    if (this.nextSeekPosition) {\n      this.nextSeekPosition = Math.min(sample.offset + sample.alreadyRead, this.nextSeekPosition);\n    } else {\n      this.nextSeekPosition = sample.offset + sample.alreadyRead;\n    }\n  }\n\n  processSamples(last?: boolean) {\n    if (!this.sampleProcessingStarted) return;\n\n    /* For each track marked for fragmentation,\n       check if the next sample is there (i.e. if the sample information is known (i.e. moof has arrived) and if it has been downloaded)\n       and create a fragment with it */\n    if (this.isFragmentationInitialized && this.onSegment !== undefined) {\n      const consumedTracks = new Set<number>();\n      while (\n        consumedTracks.size < this.fragmentedTracks.length &&\n        this.fragmentedTracks.some(track => track.trak.nextSample < track.trak.samples.length) &&\n        this.sampleProcessingStarted\n      ) {\n        for (const fragTrak of this.fragmentedTracks) {\n          const trak = fragTrak.trak;\n          if (!consumedTracks.has(fragTrak.id)) {\n            // Check if the sample is available\n            const sample =\n              trak.nextSample < trak.samples.length\n                ? this.getSample(trak, trak.nextSample)\n                : undefined;\n            if (!sample) {\n              this.setNextSeekPositionFromSample(trak.samples[trak.nextSample]);\n              /* The fragment cannot not be created because the media data is not there (not downloaded), wait for it */\n              consumedTracks.add(fragTrak.id);\n              continue;\n            }\n\n            // Accumulate the size of the sample in the fragment state\n            fragTrak.state.accumulatedSize += sample.size;\n\n            const sampleNum = trak.nextSample + 1;\n            const usesExternalBoundaries =\n              fragTrak.external_segment_boundaries !== undefined &&\n              fragTrak.external_segment_boundaries.length > 0;\n            const boundaryIndex = fragTrak.state.nextBoundaryIndex ?? 0;\n            const nextExternalBoundary = usesExternalBoundaries\n              ? fragTrak.external_segment_boundaries[boundaryIndex]\n              : undefined;\n            const isExternalBoundary =\n              nextExternalBoundary !== undefined && sampleNum >= nextExternalBoundary;\n\n            // Check if fragment or segment are overdue or if we are at a boundary\n            const isFragmentOverdue =\n              sampleNum - fragTrak.state.lastFragmentSampleNumber >\n              fragTrak.nb_samples_per_fragment;\n            const isSegmentOverdue =\n              sampleNum - fragTrak.state.lastSegmentSampleNumber > fragTrak.nb_samples;\n            let isFragmentBoundary =\n              isFragmentOverdue || sampleNum % fragTrak.nb_samples_per_fragment === 0;\n            let isSegmentBoundary = isSegmentOverdue || sampleNum % fragTrak.nb_samples === 0;\n\n            // Check if the segment size is reached\n            let isSizeBoundary = fragTrak.state.accumulatedSize >= fragTrak.size_per_segment;\n\n            // Check if the sample is a RAP (Random Access Point)\n            const isRAP = !fragTrak.rapAlignement || sample.is_sync;\n\n            // During flush, we create a fragment even if we are not at a boundary\n            const isFlush = last || trak.nextSample + 1 >= trak.samples.length;\n            if (isFlush && !isRAP) {\n              Log.warn(\n                'ISOFile',\n                'Flushing track #' +\n                  fragTrak.id +\n                  ' at sample #' +\n                  trak.nextSample +\n                  ' which is not a RAP, this may lead to playback issues',\n              );\n            }\n\n            // Align fragment/segment boundaries with RAPs if requested\n            isFragmentBoundary = isFragmentBoundary && isRAP;\n            isSegmentBoundary =\n              (usesExternalBoundaries ? isExternalBoundary : isSegmentBoundary) && isRAP;\n            isSizeBoundary = !usesExternalBoundaries && isSizeBoundary && isRAP;\n            if (usesExternalBoundaries) {\n              isFragmentBoundary = isExternalBoundary && isRAP;\n            }\n\n            // Create a fragment if needed\n            if (isFragmentBoundary || isSizeBoundary || isFlush) {\n              if (isFragmentOverdue) {\n                Log.warn(\n                  'ISOFile',\n                  'Fragment on track #' +\n                    fragTrak.id +\n                    ' is overdue, creating it with samples [' +\n                    fragTrak.state.lastFragmentSampleNumber +\n                    ', ' +\n                    trak.nextSample +\n                    ']',\n                );\n              } else {\n                Log.debug(\n                  'ISOFile',\n                  'Creating media fragment on track #' +\n                    fragTrak.id +\n                    ' for samples [' +\n                    fragTrak.state.lastFragmentSampleNumber +\n                    ', ' +\n                    trak.nextSample +\n                    ']',\n                );\n              }\n\n              const result = this.createFragment(\n                fragTrak.id,\n                fragTrak.state.lastFragmentSampleNumber,\n                trak.nextSample,\n                fragTrak.segmentStream,\n              );\n              if (result) {\n                fragTrak.segmentStream = result;\n                fragTrak.state.lastFragmentSampleNumber = trak.nextSample + 1;\n              } else {\n                /* The fragment could not be created because the media data is not there (not downloaded), wait for it */\n                consumedTracks.add(fragTrak.id);\n                continue;\n              }\n            }\n\n            /* A fragment is created by a collection of samples, but the segment is the accumulation in the\n            buffer of these fragments. It is flushed only as requested by the application (nb_samples)\n            to avoid too many callbacks */\n            if (isSegmentBoundary || isSizeBoundary || isFlush) {\n              if (isSegmentOverdue) {\n                Log.warn(\n                  'ISOFile',\n                  'Segment on track #' +\n                    fragTrak.id +\n                    ' is overdue, sending it with samples [' +\n                    Math.max(0, trak.nextSample - fragTrak.nb_samples) +\n                    ', ' +\n                    (trak.nextSample - 1) +\n                    ']',\n                );\n              } else {\n                Log.info(\n                  'ISOFile',\n                  'Sending fragmented data on track #' +\n                    fragTrak.id +\n                    ' for samples [' +\n                    Math.max(0, trak.nextSample - fragTrak.nb_samples) +\n                    ', ' +\n                    (trak.nextSample - 1) +\n                    ']',\n                );\n              }\n              Log.info(\n                'ISOFile',\n                'Sample data size in memory: ' + this.getAllocatedSampleDataSize(),\n              );\n              if (this.onSegment) {\n                this.onSegment(\n                  fragTrak.id,\n                  fragTrak.user,\n                  fragTrak.segmentStream.buffer,\n                  trak.nextSample + 1,\n                  last || trak.nextSample + 1 >= trak.samples.length,\n                );\n              }\n              if (usesExternalBoundaries && isSegmentBoundary) {\n                fragTrak.state.nextBoundaryIndex = boundaryIndex + 1;\n              }\n              /* force the creation of a new buffer */\n              fragTrak.segmentStream = undefined;\n              // Reset the accumulated size and sample number\n              fragTrak.state.accumulatedSize = 0;\n              fragTrak.state.lastSegmentSampleNumber = trak.nextSample + 1;\n            }\n\n            // Advance to the next sample\n            trak.nextSample++;\n          }\n        }\n      }\n    }\n\n    if (this.onSamples !== undefined) {\n      /* For each track marked for data export,\n         check if the next sample is there (i.e. has been downloaded) and send it */\n      for (let i = 0; i < this.extractedTracks.length; i++) {\n        const extractTrak = this.extractedTracks[i];\n        const trak = extractTrak.trak;\n        while (trak.nextSample < trak.samples.length && this.sampleProcessingStarted) {\n          Log.debug(\n            'ISOFile',\n            'Exporting on track #' + extractTrak.id + ' sample #' + trak.nextSample,\n          );\n          const sample = this.getSample(trak, trak.nextSample);\n          if (sample) {\n            trak.nextSample++;\n            extractTrak.samples.push(sample);\n          } else {\n            this.setNextSeekPositionFromSample(trak.samples[trak.nextSample]);\n            break;\n          }\n          if (\n            trak.nextSample % extractTrak.nb_samples === 0 ||\n            trak.nextSample >= trak.samples.length\n          ) {\n            Log.debug(\n              'ISOFile',\n              'Sending samples on track #' + extractTrak.id + ' for sample ' + trak.nextSample,\n            );\n            if (this.onSamples) {\n              this.onSamples(extractTrak.id, extractTrak.user, extractTrak.samples);\n            }\n            extractTrak.samples = [];\n            if (extractTrak !== this.extractedTracks[i]) {\n              /* check if the extraction needs to be stopped */\n              break;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /* Find and return specific boxes using recursion and early return */\n  getBox<T extends AllIdentifiers>(type: T): AllRegisteredBoxes[T] | undefined {\n    const result = this.getBoxes(type, true);\n    return result.length ? result[0] : undefined;\n  }\n\n  getBoxes<T extends AllIdentifiers>(type: T, returnEarly: boolean) {\n    const result: Array<AllRegisteredBoxes[T]> = [];\n\n    const sweep = (root: Box | ISOFile) => {\n      if (root instanceof Box && root.type && root.type === type) {\n        result.push(root as unknown as AllRegisteredBoxes[T]);\n      }\n\n      const inner: Array<Box> = [];\n      if (root['boxes']) inner.push(...root.boxes);\n      if (root['entries']) inner.push(...(root['entries'] as Array<Box>));\n      if (root['item_infos']) inner.push(...(root['item_infos'] as Array<Box>));\n      if (root['references']) inner.push(...(root['references'] as Array<Box>));\n\n      for (const box of inner) {\n        if (result.length && returnEarly) return;\n        sweep(box);\n      }\n    };\n\n    sweep(this);\n    return result;\n  }\n\n  getTrackSamplesInfo(track_id: number) {\n    const track = this.getTrackById(track_id);\n    if (track) {\n      return track.samples;\n    }\n  }\n\n  getTrackSample(track_id: number, number: number) {\n    const track = this.getTrackById(track_id);\n    const sample = this.getSample(track, number);\n    return sample;\n  }\n\n  /* Called by the application to release the resources associated to samples already forwarded to the application */\n  releaseUsedSamples(id: number, sampleNum: number) {\n    let size = 0;\n    const trak = this.getTrackById(id);\n    if (!trak.lastValidSample) trak.lastValidSample = 0;\n    for (let i = trak.lastValidSample; i < sampleNum; i++) {\n      size += this.releaseSample(trak, i);\n    }\n    Log.info(\n      'ISOFile',\n      'Track #' +\n        id +\n        ' released samples up to ' +\n        sampleNum +\n        ' (released size: ' +\n        size +\n        ', remaining: ' +\n        this.samplesDataSize +\n        ')',\n    );\n    trak.lastValidSample = sampleNum;\n  }\n\n  start() {\n    this.sampleProcessingStarted = true;\n    this.processSamples(false);\n  }\n\n  stop() {\n    this.sampleProcessingStarted = false;\n  }\n\n  /* Called by the application to flush the remaining samples (e.g. once the download is finished or when no more samples will be added) */\n  flush() {\n    Log.info('ISOFile', 'Flushing remaining samples');\n    this.updateSampleLists();\n    this.processSamples(true);\n    this.stream.cleanBuffers();\n    this.stream.logBufferLevel(true);\n  }\n\n  /* Finds the byte offset for a given time on a given track\n     also returns the time of the previous rap */\n  seekTrack(time: number, useRap: boolean, trak: trakBox) {\n    let rap_seek_sample_num = 0;\n    let seek_sample_num = 0;\n    let timescale: number;\n\n    if (trak.samples.length === 0) {\n      Log.info(\n        'ISOFile',\n        'No sample in track, cannot seek! Using time ' +\n          Log.getDurationString(0, 1) +\n          ' and offset: ' +\n          0,\n      );\n      return { offset: 0, time: 0 };\n    }\n\n    for (let j = 0; j < trak.samples.length; j++) {\n      const sample = trak.samples[j];\n      if (j === 0) {\n        seek_sample_num = 0;\n        timescale = sample.timescale;\n      } else if (sample.cts > time * sample.timescale) {\n        seek_sample_num = j - 1;\n        break;\n      }\n      if (useRap && sample.is_sync) {\n        rap_seek_sample_num = j;\n      }\n    }\n    if (useRap) {\n      seek_sample_num = rap_seek_sample_num;\n    }\n    time = trak.samples[seek_sample_num].cts;\n    trak.nextSample = seek_sample_num;\n    while (trak.samples[seek_sample_num].alreadyRead === trak.samples[seek_sample_num].size) {\n      // No remaining samples to look for, all are downloaded.\n      if (!trak.samples[seek_sample_num + 1]) {\n        break;\n      }\n      seek_sample_num++;\n    }\n    const seek_offset =\n      trak.samples[seek_sample_num].offset + trak.samples[seek_sample_num].alreadyRead;\n    Log.info(\n      'ISOFile',\n      'Seeking to ' +\n        (useRap ? 'RAP' : '') +\n        ' sample #' +\n        trak.nextSample +\n        ' on track ' +\n        trak.tkhd.track_id +\n        ', time ' +\n        Log.getDurationString(time, timescale) +\n        ' and offset: ' +\n        seek_offset,\n    );\n    return { offset: seek_offset, time: time / timescale };\n  }\n\n  getTrackDuration(trak: trakBox) {\n    if (!trak.samples) {\n      return Infinity;\n    }\n\n    const sample = trak.samples[trak.samples.length - 1];\n    return (sample.cts + sample.duration) / sample.timescale;\n  }\n\n  /* Finds the byte offset in the file corresponding to the given time or to the time of the previous RAP */\n  seek(time: number, useRap: boolean) {\n    const moov = this.moov;\n    let seek_info = { offset: Infinity, time: Infinity };\n    if (!this.moov) {\n      throw new Error('Cannot seek: moov not received!');\n    } else {\n      for (let i = 0; i < moov.traks.length; i++) {\n        const trak = moov.traks[i];\n        if (time > this.getTrackDuration(trak)) {\n          // skip tracks that already ended\n          continue;\n        }\n        const trak_seek_info = this.seekTrack(time, useRap, trak);\n        if (trak_seek_info.offset < seek_info.offset) {\n          seek_info.offset = trak_seek_info.offset;\n        }\n        if (trak_seek_info.time < seek_info.time) {\n          seek_info.time = trak_seek_info.time;\n        }\n      }\n      Log.info(\n        'ISOFile',\n        'Seeking at time ' +\n          Log.getDurationString(seek_info.time, 1) +\n          ' needs a buffer with a fileStart position of ' +\n          seek_info.offset,\n      );\n      if (seek_info.offset === Infinity) {\n        /* No sample info, in all tracks, cannot seek */\n        seek_info = { offset: this.nextParsePosition, time: 0 };\n      } else {\n        /* check if the seek position is already in some buffer and\n         in that case return the end of that buffer (or of the last contiguous buffer) */\n        /* TODO: Should wait until append operations are done */\n        seek_info.offset = this.stream.getEndFilePositionAfter(seek_info.offset);\n      }\n      Log.info(\n        'ISOFile',\n        'Adjusted seek position (after checking data already in buffer): ' + seek_info.offset,\n      );\n      return seek_info;\n    }\n  }\n\n  equal(b: { boxes: Array<Box> }) {\n    let box_index = 0;\n    while (box_index < this.boxes.length && box_index < b.boxes.length) {\n      const a_box = this.boxes[box_index];\n      const b_box = b.boxes[box_index];\n      if (!boxEqual(a_box, b_box)) {\n        return false;\n      }\n      box_index++;\n    }\n    return true;\n  }\n\n  /**\n   * Rewrite the entire file\n   * @bundle isofile-write.js\n   */\n  write(outstream: DataStream) {\n    for (let i = 0; i < this.boxes.length; i++) {\n      this.boxes[i].write(outstream);\n    }\n  }\n\n  /** @bundle isofile-write.js */\n  createFragment(\n    track_id: number,\n    sampleStart: number,\n    sampleEnd: number,\n    existingStream: DataStream,\n  ) {\n    // Check existence of all samples\n    const samples: Array<Sample> = [];\n    for (let i = sampleStart; i <= sampleEnd; i++) {\n      const trak = this.getTrackById(track_id);\n      const sample = this.getSample(trak, i);\n      if (!sample) {\n        this.setNextSeekPositionFromSample(trak.samples[i]);\n        return;\n      }\n      samples.push(sample);\n    }\n\n    const stream = existingStream || new DataStream();\n\n    const moof = this.createMoof(samples);\n    moof.write(stream);\n\n    /* adjusting the data_offset now that the moof size is known*/\n    moof.trafs[0].truns[0].data_offset = moof.size + 8; //8 is mdat header\n    Log.debug(\n      'MP4Box',\n      'Adjusting data_offset with new value ' + moof.trafs[0].truns[0].data_offset,\n    );\n    stream.adjustUint32(\n      moof.trafs[0].truns[0].data_offset_position,\n      moof.trafs[0].truns[0].data_offset,\n    );\n\n    const mdat = new mdatBox();\n    mdat.stream = new MultiBufferStream();\n    let offset = 0;\n    for (const sample of samples) {\n      if (sample.data) {\n        const mp4Buffer = MP4BoxBuffer.fromArrayBuffer(sample.data.buffer, offset);\n        mdat.stream.insertBuffer(mp4Buffer);\n        offset += sample.data.byteLength;\n      }\n    }\n    mdat.write(stream);\n    return stream;\n  }\n\n  /**\n   * Modify the file and create the initialization segment\n   * @bundle isofile-write.js\n   */\n  static writeInitializationSegment(ftyp: ftypBox, moov: moovBox, total_duration: number) {\n    Log.debug('ISOFile', 'Generating initialization segment');\n\n    const stream = new DataStream();\n    ftyp.write(stream);\n\n    /* we can now create the new mvex box */\n    const mvex = moov.addBox(new mvexBox());\n    if (total_duration) {\n      const mehd = mvex.addBox(new mehdBox());\n      mehd.fragment_duration = total_duration;\n    }\n\n    // Add trex boxes for each track\n    for (let i = 0; i < moov.traks.length; i++) {\n      const trex = mvex.addBox(new trexBox());\n      trex.track_id = moov.traks[i].tkhd.track_id;\n      trex.default_sample_description_index = 1;\n      trex.default_sample_duration = moov.traks[i].samples[0]?.duration ?? 0;\n      trex.default_sample_size = 0;\n      trex.default_sample_flags = 1 << 16;\n    }\n    moov.write(stream);\n\n    return stream.buffer;\n  }\n\n  /** @bundle isofile-write.js */\n  save(name: string) {\n    const stream = new DataStream();\n    stream.isofile = this;\n    this.write(stream);\n    return stream.save(name);\n  }\n\n  /** @bundle isofile-write.js */\n  getBuffer() {\n    const stream = new DataStream();\n    stream.isofile = this;\n    this.write(stream);\n    return stream;\n  }\n\n  /** @bundle isofile-write.js */\n  initializeSegmentation() {\n    if (!this.onSegment) {\n      Log.warn('MP4Box', 'No segmentation callback set!');\n    }\n    if (!this.isFragmentationInitialized) {\n      this.isFragmentationInitialized = true;\n      this.resetTables();\n    }\n\n    // Create the moov that will hold all the tracks\n    const moov = new moovBox();\n    moov.addBox(this.moov.mvhd);\n\n    // Add the tracks we want to fragment\n    for (let i = 0; i < this.fragmentedTracks.length; i++) {\n      const trak = this.getTrackById(this.fragmentedTracks[i].id);\n      if (!trak) {\n        Log.warn(\n          'ISOFile',\n          `Track with id ${this.fragmentedTracks[i].id} not found, skipping fragmentation initialization`,\n        );\n        continue;\n      }\n      moov.addBox(trak);\n    }\n\n    return {\n      tracks: moov.traks.map((trak, i) => ({\n        id: trak.tkhd.track_id,\n        user: this.fragmentedTracks[i].user,\n      })),\n      buffer: ISOFile.writeInitializationSegment(\n        this.ftyp,\n        moov,\n      this.moov?.mvex?.mehd.fragment_duration,\n    ),\n    };\n  }\n\n  /** @bundle isofile-write.js */\n  initializeTrackSegmentation(trackId: number) {\n    if (!this.onSegment) {\n      Log.warn('MP4Box', 'No segmentation callback set!');\n    }\n    if (!this.isFragmentationInitialized) {\n      this.isFragmentationInitialized = true;\n      this.resetTables();\n    }\n\n    const fragmentedTrack = this.fragmentedTracks.find(track => track.id === trackId);\n    if (!fragmentedTrack) {\n      Log.warn(\n        'ISOFile',\n        `Track with id ${trackId} not configured for fragmentation, skipping initialization`,\n      );\n      return;\n    }\n\n    const trak = this.getTrackById(trackId);\n    if (!trak) {\n      Log.warn('ISOFile', `Track with id ${trackId} not found, skipping fragmentation`);\n      return;\n    }\n\n    const moov = new moovBox();\n    moov.addBox(this.moov.mvhd);\n    moov.addBox(trak);\n\n    return {\n      track: {\n        id: trak.tkhd.track_id,\n        user: fragmentedTrack.user,\n      },\n      buffer: ISOFile.writeInitializationSegment(\n        this.ftyp,\n        moov,\n        this.moov?.mvex?.mehd.fragment_duration,\n      ),\n    };\n  }\n\n  /**\n   * Index of the last moof box received\n   * @bundle isofile-sample-processing.js\n   */\n  lastMoofIndex = 0;\n\n  /**\n   * size of the buffers allocated for samples\n   * @bundle isofile-sample-processing.js\n   */\n  samplesDataSize = 0;\n\n  /**\n   * Resets all sample tables\n   * @bundle isofile-sample-processing.js\n   */\n  resetTables() {\n    this.initial_duration = this.moov.mvhd.duration;\n    this.moov.mvhd.duration = 0;\n    for (let i = 0; i < this.moov.traks.length; i++) {\n      const trak = this.moov.traks[i];\n      trak.tkhd.duration = 0;\n      trak.mdia.mdhd.duration = 0;\n      const stco = trak.mdia.minf.stbl.stco || trak.mdia.minf.stbl.co64;\n      stco.chunk_offsets = [];\n      const stsc = trak.mdia.minf.stbl.stsc;\n      stsc.first_chunk = [];\n      stsc.samples_per_chunk = [];\n      stsc.sample_description_index = [];\n      const stsz = trak.mdia.minf.stbl.stsz || trak.mdia.minf.stbl.stz2;\n      stsz.sample_sizes = [];\n      const stts = trak.mdia.minf.stbl.stts;\n      stts.sample_counts = [];\n      stts.sample_deltas = [];\n      const ctts = trak.mdia.minf.stbl.ctts;\n      if (ctts) {\n        ctts.sample_counts = [];\n        ctts.sample_offsets = [];\n      }\n      const stss = trak.mdia.minf.stbl.stss;\n      const k = trak.mdia.minf.stbl.boxes.indexOf(stss);\n      if (k !== -1) trak.mdia.minf.stbl.boxes[k] = undefined;\n    }\n  }\n\n  /** @bundle isofile-sample-processing.js */\n  static initSampleGroups(\n    trak: trakBox,\n    traf: trafBox | undefined,\n    sbgps: Array<sbgpBox>,\n    trak_sgpds: Array<sgpdBox>,\n    traf_sgpds?: Array<sgpdBox>,\n  ) {\n    if (traf) {\n      traf.sample_groups_info = [];\n    }\n    if (!trak.sample_groups_info) {\n      trak.sample_groups_info = [];\n    }\n    for (let k = 0; k < sbgps.length; k++) {\n      const sample_group_key = sbgps[k].grouping_type + '/' + sbgps[k].grouping_type_parameter;\n      const sample_group_info = new SampleGroupInfo(\n        sbgps[k].grouping_type,\n        sbgps[k].grouping_type_parameter,\n        sbgps[k],\n      );\n      if (traf) {\n        traf.sample_groups_info[sample_group_key] = sample_group_info;\n      }\n      if (!trak.sample_groups_info[sample_group_key]) {\n        trak.sample_groups_info[sample_group_key] = sample_group_info;\n      }\n      for (let l = 0; l < trak_sgpds.length; l++) {\n        if (trak_sgpds[l].grouping_type === sbgps[k].grouping_type) {\n          sample_group_info.description = trak_sgpds[l] as Description;\n          sample_group_info.description.used = true;\n        }\n      }\n      if (traf_sgpds) {\n        for (let l = 0; l < traf_sgpds.length; l++) {\n          if (traf_sgpds[l].grouping_type === sbgps[k].grouping_type) {\n            sample_group_info.fragment_description = traf_sgpds[l] as Description;\n            sample_group_info.fragment_description.used = true;\n            sample_group_info.is_fragment = true;\n          }\n        }\n      }\n    }\n    if (!traf) {\n      for (let k = 0; k < trak_sgpds.length; k++) {\n        if (!trak_sgpds[k].used && trak_sgpds[k].version >= 2) {\n          const sample_group_key = trak_sgpds[k].grouping_type + '/0';\n          const sample_group_info = new SampleGroupInfo(trak_sgpds[k].grouping_type, 0);\n          if (!trak.sample_groups_info[sample_group_key]) {\n            trak.sample_groups_info[sample_group_key] = sample_group_info;\n          }\n        }\n      }\n    } else {\n      if (traf_sgpds) {\n        for (let k = 0; k < traf_sgpds.length; k++) {\n          if (!traf_sgpds[k].used && traf_sgpds[k].version >= 2) {\n            const sample_group_key = traf_sgpds[k].grouping_type + '/0';\n            const sample_group_info = new SampleGroupInfo(traf_sgpds[k].grouping_type, 0);\n            sample_group_info.is_fragment = true;\n            if (!traf.sample_groups_info[sample_group_key]) {\n              traf.sample_groups_info[sample_group_key] = sample_group_info;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /** @bundle isofile-sample-processing.js */\n  static setSampleGroupProperties(\n    trak: trakBox,\n    sample: Sample,\n    sample_number: number,\n    sample_groups_info: Array<SampleGroupInfo>,\n  ) {\n    sample.sample_groups = [];\n    for (const k in sample_groups_info) {\n      sample.sample_groups[k] = {\n        grouping_type: sample_groups_info[k].grouping_type,\n        grouping_type_parameter: sample_groups_info[k].grouping_type_parameter,\n      };\n      if (sample_number >= sample_groups_info[k].last_sample_in_run) {\n        if (sample_groups_info[k].last_sample_in_run < 0) {\n          sample_groups_info[k].last_sample_in_run = 0;\n        }\n        sample_groups_info[k].entry_index++;\n        if (sample_groups_info[k].entry_index <= sample_groups_info[k].sbgp.entries.length - 1) {\n          sample_groups_info[k].last_sample_in_run +=\n            sample_groups_info[k].sbgp.entries[sample_groups_info[k].entry_index].sample_count;\n        }\n      }\n      if (sample_groups_info[k].entry_index <= sample_groups_info[k].sbgp.entries.length - 1) {\n        sample.sample_groups[k].group_description_index =\n          sample_groups_info[k].sbgp.entries[\n            sample_groups_info[k].entry_index\n          ].group_description_index;\n      } else {\n        sample.sample_groups[k].group_description_index = -1; // special value for not defined\n      }\n      if (sample.sample_groups[k].group_description_index !== 0) {\n        let description: Description;\n        if (sample_groups_info[k].fragment_description) {\n          description = sample_groups_info[k].fragment_description;\n        } else {\n          description = sample_groups_info[k].description;\n        }\n        if (sample.sample_groups[k].group_description_index > 0) {\n          let index: number;\n          if (sample.sample_groups[k].group_description_index > 65535) {\n            index = (sample.sample_groups[k].group_description_index >> 16) - 1;\n          } else {\n            index = sample.sample_groups[k].group_description_index - 1;\n          }\n          if (description && index >= 0) {\n            sample.sample_groups[k].description = description.entries[index];\n          }\n        } else {\n          if (description && description.version >= 2) {\n            if (description.default_group_description_index > 0) {\n              sample.sample_groups[k].description =\n                description.entries[description.default_group_description_index - 1];\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /** @bundle isofile-sample-processing.js */\n  static process_sdtp(sdtp: sdtpBox, sample: Sample, number: number) {\n    if (!sample) {\n      return;\n    }\n    if (sdtp) {\n      sample.is_leading = sdtp.is_leading[number];\n      sample.depends_on = sdtp.sample_depends_on[number];\n      sample.is_depended_on = sdtp.sample_is_depended_on[number];\n      sample.has_redundancy = sdtp.sample_has_redundancy[number];\n    } else {\n      sample.is_leading = 0;\n      sample.depends_on = 0;\n      sample.is_depended_on = 0;\n      sample.has_redundancy = 0;\n    }\n  }\n\n  /* Build initial sample list from  sample tables */\n  buildSampleLists() {\n    for (let i = 0; i < this.moov.traks.length; i++) {\n      this.buildTrakSampleLists(this.moov.traks[i]);\n    }\n  }\n\n  buildTrakSampleLists(trak: trakBox) {\n    let j: number;\n    let chunk_run_index: number;\n    let chunk_index: number;\n    let last_chunk_in_run: number;\n    let offset_in_chunk: number;\n    let last_sample_in_chunk: number;\n\n    trak.samples = [];\n    trak.samples_duration = 0;\n    trak.samples_size = 0;\n\n    const stco = trak.mdia.minf.stbl.stco || trak.mdia.minf.stbl.co64;\n    const stsc = trak.mdia.minf.stbl.stsc;\n    const stsz = trak.mdia.minf.stbl.stsz || trak.mdia.minf.stbl.stz2;\n    const stts = trak.mdia.minf.stbl.stts;\n    const ctts = trak.mdia.minf.stbl.ctts;\n    const stss = trak.mdia.minf.stbl.stss;\n    const stsd = trak.mdia.minf.stbl.stsd;\n    const subs = trak.mdia.minf.stbl.subs;\n    const stdp = trak.mdia.minf.stbl.stdp;\n    const sbgps = trak.mdia.minf.stbl.sbgps;\n    const sgpds = trak.mdia.minf.stbl.sgpds;\n\n    let last_sample_in_stts_run = -1;\n    let stts_run_index = -1;\n    let last_sample_in_ctts_run = -1;\n    let ctts_run_index = -1;\n    let last_stss_index = 0;\n    let subs_entry_index = 0;\n    let last_subs_sample_index = 0;\n\n    ISOFile.initSampleGroups(trak, undefined, sbgps, sgpds);\n\n    if (typeof stsz === 'undefined') {\n      return;\n    }\n\n    /* we build the samples one by one and compute their properties */\n    for (j = 0; j < stsz.sample_sizes.length; j++) {\n      const sample = {\n        number: j,\n        track_id: trak.tkhd.track_id,\n        timescale: trak.mdia.mdhd.timescale,\n        alreadyRead: 0,\n        size: stsz.sample_sizes[j],\n      } as Sample;\n\n      trak.samples[j] = sample;\n      /* size can be known directly */\n      trak.samples_size += sample.size;\n      /* computing chunk-based properties (offset, sample description index)*/\n      if (j === 0) {\n        chunk_index = 1; /* the first sample is in the first chunk (chunk indexes are 1-based) */\n        chunk_run_index = 0; /* the first chunk is the first entry in the first_chunk table */\n        sample.chunk_index = chunk_index;\n        sample.chunk_run_index = chunk_run_index;\n        last_sample_in_chunk = stsc.samples_per_chunk[chunk_run_index];\n        offset_in_chunk = 0;\n\n        /* Is there another entry in the first_chunk table ? */\n        if (chunk_run_index + 1 < stsc.first_chunk.length) {\n          /* The last chunk in the run is the chunk before the next first chunk */\n          last_chunk_in_run = stsc.first_chunk[chunk_run_index + 1] - 1;\n        } else {\n          /* There is only one entry in the table, it is valid for all future chunks*/\n          last_chunk_in_run = Infinity;\n        }\n      } else {\n        if (j < last_sample_in_chunk) {\n          /* the sample is still in the current chunk */\n          sample.chunk_index = chunk_index;\n          sample.chunk_run_index = chunk_run_index;\n        } else {\n          /* the sample is in the next chunk */\n          chunk_index++;\n          sample.chunk_index = chunk_index;\n          /* reset the accumulated offset in the chunk */\n          offset_in_chunk = 0;\n          if (chunk_index <= last_chunk_in_run) {\n            /* stay in the same entry of the first_chunk table */\n            /* chunk_run_index unmodified */\n          } else {\n            chunk_run_index++;\n            /* Is there another entry in the first_chunk table ? */\n            if (chunk_run_index + 1 < stsc.first_chunk.length) {\n              /* The last chunk in the run is the chunk before the next first chunk */\n              last_chunk_in_run = stsc.first_chunk[chunk_run_index + 1] - 1;\n            } else {\n              /* There is only one entry in the table, it is valid for all future chunks*/\n              last_chunk_in_run = Infinity;\n            }\n          }\n          sample.chunk_run_index = chunk_run_index;\n          last_sample_in_chunk += stsc.samples_per_chunk[chunk_run_index];\n        }\n      }\n\n      sample.description_index = stsc.sample_description_index[sample.chunk_run_index] - 1;\n      sample.description = stsd.entries[sample.description_index];\n      sample.offset =\n        stco.chunk_offsets[sample.chunk_index - 1] +\n        offset_in_chunk; /* chunk indexes are 1-based */\n      offset_in_chunk += sample.size;\n\n      /* setting dts, cts, duration and rap flags */\n      if (j > last_sample_in_stts_run) {\n        stts_run_index++;\n        if (last_sample_in_stts_run < 0) {\n          last_sample_in_stts_run = 0;\n        }\n        last_sample_in_stts_run += stts.sample_counts[stts_run_index];\n      }\n      if (j > 0) {\n        trak.samples[j - 1].duration = stts.sample_deltas[stts_run_index];\n        trak.samples_duration += trak.samples[j - 1].duration;\n        sample.dts = trak.samples[j - 1].dts + trak.samples[j - 1].duration;\n      } else {\n        sample.dts = 0;\n      }\n      if (ctts) {\n        if (j >= last_sample_in_ctts_run) {\n          ctts_run_index++;\n          if (last_sample_in_ctts_run < 0) {\n            last_sample_in_ctts_run = 0;\n          }\n          last_sample_in_ctts_run += ctts.sample_counts[ctts_run_index];\n        }\n        sample.cts = trak.samples[j].dts + ctts.sample_offsets[ctts_run_index];\n      } else {\n        sample.cts = sample.dts;\n      }\n      if (stss) {\n        if (j === stss.sample_numbers[last_stss_index] - 1) {\n          // sample numbers are 1-based\n          sample.is_sync = true;\n          last_stss_index++;\n        } else {\n          sample.is_sync = false;\n          sample.degradation_priority = 0;\n        }\n        if (subs) {\n          if (subs.entries[subs_entry_index].sample_delta + last_subs_sample_index === j + 1) {\n            sample.subsamples = subs.entries[subs_entry_index].subsamples;\n            last_subs_sample_index += subs.entries[subs_entry_index].sample_delta;\n            subs_entry_index++;\n          }\n        }\n      } else {\n        sample.is_sync = true;\n      }\n      ISOFile.process_sdtp(trak.mdia.minf.stbl.sdtp, sample, sample.number);\n      if (stdp) {\n        sample.degradation_priority = stdp.priority[j];\n      } else {\n        sample.degradation_priority = 0;\n      }\n      if (subs) {\n        if (subs.entries[subs_entry_index].sample_delta + last_subs_sample_index === j) {\n          sample.subsamples = subs.entries[subs_entry_index].subsamples;\n          last_subs_sample_index += subs.entries[subs_entry_index].sample_delta;\n        }\n      }\n      if (sbgps.length > 0 || sgpds.length > 0) {\n        ISOFile.setSampleGroupProperties(trak, sample, j, trak.sample_groups_info);\n      }\n    }\n    if (j > 0) {\n      trak.samples[j - 1].duration = Math.max(trak.mdia.mdhd.duration - trak.samples[j - 1].dts, 0);\n      trak.samples_duration += trak.samples[j - 1].duration;\n    }\n  }\n\n  /**\n   * Update sample list when new 'moof' boxes are received\n   * @bundle isofile-sample-processing.js\n   */\n  updateSampleLists() {\n    let default_sample_description_index: number;\n    let default_sample_duration: number;\n    let default_sample_size: number;\n    let default_sample_flags: number;\n    let last_run_position: number;\n\n    if (this.moov === undefined) {\n      return;\n    }\n\n    /* if the input file is fragmented and fetched in multiple downloads, we need to update the list of samples */\n    while (this.lastMoofIndex < this.moofs.length) {\n      const box = this.moofs[this.lastMoofIndex];\n      this.lastMoofIndex++;\n      if (box.type === 'moof') {\n        const moof = box;\n        for (let i = 0; i < moof.trafs.length; i++) {\n          const traf = moof.trafs[i];\n          const trak = this.getTrackById(traf.tfhd.track_id);\n          const trex = this.getTrexById(traf.tfhd.track_id);\n          if (traf.tfhd.flags & TFHD_FLAG_SAMPLE_DESC) {\n            default_sample_description_index = traf.tfhd.default_sample_description_index;\n          } else {\n            default_sample_description_index = trex ? trex.default_sample_description_index : 1;\n          }\n          if (traf.tfhd.flags & TFHD_FLAG_SAMPLE_DUR) {\n            default_sample_duration = traf.tfhd.default_sample_duration;\n          } else {\n            default_sample_duration = trex ? trex.default_sample_duration : 0;\n          }\n          if (traf.tfhd.flags & TFHD_FLAG_SAMPLE_SIZE) {\n            default_sample_size = traf.tfhd.default_sample_size;\n          } else {\n            default_sample_size = trex ? trex.default_sample_size : 0;\n          }\n          if (traf.tfhd.flags & TFHD_FLAG_SAMPLE_FLAGS) {\n            default_sample_flags = traf.tfhd.default_sample_flags;\n          } else {\n            default_sample_flags = trex ? trex.default_sample_flags : 0;\n          }\n          traf.sample_number = 0;\n          /* process sample groups */\n          if (traf.sbgps.length > 0) {\n            ISOFile.initSampleGroups(trak, traf, traf.sbgps, trak.mdia.minf.stbl.sgpds, traf.sgpds);\n          }\n          for (let j = 0; j < traf.truns.length; j++) {\n            const trun = traf.truns[j];\n            for (let k = 0; k < trun.sample_count; k++) {\n              const description_index = default_sample_description_index - 1;\n\n              let sample_flags = default_sample_flags;\n              if (trun.flags & TRUN_FLAGS_FLAGS) {\n                sample_flags = trun.sample_flags[k];\n              } else if (k === 0 && trun.flags & TRUN_FLAGS_FIRST_FLAG) {\n                sample_flags = trun.first_sample_flags;\n              }\n\n              let size = default_sample_size;\n              if (trun.flags & TRUN_FLAGS_SIZE) {\n                size = trun.sample_size[k];\n              }\n              trak.samples_size += size;\n\n              let duration = default_sample_duration;\n              if (trun.flags & TRUN_FLAGS_DURATION) {\n                duration = trun.sample_duration[k];\n              }\n              trak.samples_duration += duration;\n\n              let dts: number;\n              if (trak.first_traf_merged || k > 0) {\n                dts =\n                  trak.samples[trak.samples.length - 1].dts +\n                  trak.samples[trak.samples.length - 1].duration;\n              } else {\n                if (traf.tfdt) {\n                  dts = traf.tfdt.baseMediaDecodeTime;\n                } else {\n                  dts = 0;\n                }\n                trak.first_traf_merged = true;\n              }\n\n              let cts = dts;\n              if (trun.flags & TRUN_FLAGS_CTS_OFFSET) {\n                cts = dts + trun.sample_composition_time_offset[k];\n              }\n\n              //ISOFile.process_sdtp(traf.sdtp, sample, sample.number_in_traf);\n              const bdop = traf.tfhd.flags & TFHD_FLAG_BASE_DATA_OFFSET ? true : false;\n              const dbim = traf.tfhd.flags & TFHD_FLAG_DEFAULT_BASE_IS_MOOF ? true : false;\n              const dop = trun.flags & TRUN_FLAGS_DATA_OFFSET ? true : false;\n              let bdo = 0;\n              if (!bdop) {\n                if (!dbim) {\n                  if (j === 0) {\n                    // the first track in the movie fragment\n                    bdo = moof.start; // the position of the first byte of the enclosing Movie Fragment Box\n                  } else {\n                    bdo = last_run_position; // end of the data defined by the preceding *track* (irrespective of the track id) fragment in the moof\n                  }\n                } else {\n                  bdo = moof.start;\n                }\n              } else {\n                bdo = traf.tfhd.base_data_offset;\n              }\n\n              let offset: number;\n              if (j === 0 && k === 0) {\n                if (dop) {\n                  offset = bdo + trun.data_offset; // If the data-offset is present, it is relative to the base-data-offset established in the track fragment header\n                } else {\n                  offset = bdo; // the data for this run starts the base-data-offset defined by the track fragment header\n                }\n              } else {\n                offset = last_run_position; // this run starts immediately after the data of the previous run\n              }\n              last_run_position = offset + size;\n\n              const number_in_traf = traf.sample_number;\n              traf.sample_number++;\n\n              const sample: Sample = {\n                cts,\n                description_index,\n                description: trak.mdia.minf.stbl.stsd.entries[description_index],\n                dts,\n                duration,\n                moof_number: this.lastMoofIndex,\n                number_in_traf,\n                number: trak.samples.length,\n                offset,\n                size,\n                timescale: trak.mdia.mdhd.timescale,\n                track_id: trak.tkhd.track_id,\n                is_sync: (sample_flags >> 16) & 0x1 ? false : true,\n                is_leading: (sample_flags >> 26) & 0x3,\n                depends_on: (sample_flags >> 24) & 0x3,\n                is_depended_on: (sample_flags >> 22) & 0x3,\n                has_redundancy: (sample_flags >> 20) & 0x3,\n                degradation_priority: sample_flags & 0xffff,\n              };\n\n              traf.first_sample_index = trak.samples.length;\n              trak.samples.push(sample);\n\n              if (\n                traf.sbgps.length > 0 ||\n                traf.sgpds.length > 0 ||\n                trak.mdia.minf.stbl.sbgps.length > 0 ||\n                trak.mdia.minf.stbl.sgpds.length > 0\n              ) {\n                ISOFile.setSampleGroupProperties(\n                  trak,\n                  sample,\n                  sample.number_in_traf,\n                  traf.sample_groups_info,\n                );\n              }\n            }\n          }\n          if (traf.subs) {\n            trak.has_fragment_subsamples = true;\n            let sample_index = traf.first_sample_index;\n            for (let j = 0; j < traf.subs.entries.length; j++) {\n              sample_index += traf.subs.entries[j].sample_delta;\n              const sample = trak.samples[sample_index - 1];\n              sample.subsamples = traf.subs.entries[j].subsamples;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Try to get sample data for a given sample:\n   * returns null if not found\n   * returns the same sample if already requested\n   *\n   * @bundle isofile-sample-processing.js\n   */\n  getSample(trak: trakBox, sampleNum: number) {\n    const sample = trak.samples[sampleNum];\n\n    if (!this.moov) return;\n\n    if (!sample.data) {\n      /* Not yet fetched */\n      sample.data = new Uint8Array(sample.size);\n      sample.alreadyRead = 0;\n      this.samplesDataSize += sample.size;\n      Log.debug(\n        'ISOFile',\n        'Allocating sample #' +\n          sampleNum +\n          ' on track #' +\n          trak.tkhd.track_id +\n          ' of size ' +\n          sample.size +\n          ' (total: ' +\n          this.samplesDataSize +\n          ')',\n      );\n    } else if (sample.alreadyRead === sample.size) {\n      /* Already fetched entirely */\n      return sample;\n    }\n\n    /* The sample has only been partially fetched, we need to check in all buffers */\n    while (true) {\n      let stream = this.stream;\n      let index = stream.findPosition(true, sample.offset + sample.alreadyRead, false);\n      let buffer: MP4BoxBuffer;\n      let fileStart: number;\n      if (index > -1) {\n        // We haven't yet transferred the sample data to mdat\n        buffer = stream.buffers[index];\n        fileStart = buffer.fileStart;\n      } else {\n        // We might have already transferred the sample data to mdat\n        for (const mdat of this.mdats) {\n          if (!mdat.stream) {\n            Log.debug(\n              'ISOFile',\n              'mdat stream not yet fully read for #' + this.mdats.indexOf(mdat) + ' mdat',\n            );\n            continue; // mdat stream not yet fully read\n          }\n          index = mdat.stream.findPosition(\n            true,\n            sample.offset + sample.alreadyRead - mdat.start - mdat.hdr_size,\n            false,\n          );\n          if (index > -1) {\n            stream = mdat.stream;\n            buffer = mdat.stream.buffers[index];\n            fileStart = mdat.start + mdat.hdr_size + buffer.fileStart;\n            break;\n          }\n        }\n      }\n\n      if (buffer) {\n        const lengthAfterStart =\n          buffer.byteLength - (sample.offset + sample.alreadyRead - fileStart);\n        if (sample.size - sample.alreadyRead <= lengthAfterStart) {\n          /* the (rest of the) sample is entirely contained in this buffer */\n\n          Log.debug(\n            'ISOFile',\n            'Getting sample #' +\n              sampleNum +\n              ' data (alreadyRead: ' +\n              sample.alreadyRead +\n              ' offset: ' +\n              (sample.offset + sample.alreadyRead - fileStart) +\n              ' read size: ' +\n              (sample.size - sample.alreadyRead) +\n              ' full size: ' +\n              sample.size +\n              ')',\n          );\n\n          DataStream.memcpy(\n            sample.data.buffer,\n            sample.alreadyRead,\n            buffer,\n            sample.offset + sample.alreadyRead - fileStart,\n            sample.size - sample.alreadyRead,\n          );\n\n          /* update the number of bytes used in this buffer and check if it needs to be removed */\n          buffer.usedBytes += sample.size - sample.alreadyRead;\n          stream.logBufferLevel();\n\n          sample.alreadyRead = sample.size;\n\n          return sample;\n        } else {\n          /* the sample does not end in this buffer */\n\n          if (lengthAfterStart === 0) return;\n\n          Log.debug(\n            'ISOFile',\n            'Getting sample #' +\n              sampleNum +\n              ' partial data (alreadyRead: ' +\n              sample.alreadyRead +\n              ' offset: ' +\n              (sample.offset + sample.alreadyRead - fileStart) +\n              ' read size: ' +\n              lengthAfterStart +\n              ' full size: ' +\n              sample.size +\n              ')',\n          );\n\n          // NOTE:  this was an error before\n          //        it used to be DataStream.memcpy({...})\n          DataStream.memcpy(\n            sample.data.buffer,\n            sample.alreadyRead,\n            buffer,\n            sample.offset + sample.alreadyRead - fileStart,\n            lengthAfterStart,\n          );\n          sample.alreadyRead += lengthAfterStart;\n\n          /* update the number of bytes used in this buffer and check if it needs to be removed */\n          buffer.usedBytes += lengthAfterStart;\n          stream.logBufferLevel();\n\n          /* keep looking in the next buffer */\n        }\n      } else return;\n    }\n  }\n\n  /**\n   * Release the memory used to store the data of the sample\n   *\n   * @bundle isofile-sample-processing.js\n   */\n  releaseSample(trak: trakBox, sampleNum: number) {\n    const sample = trak.samples[sampleNum];\n    if (sample.data) {\n      this.samplesDataSize -= sample.size;\n      sample.data = undefined;\n      sample.alreadyRead = 0;\n      return sample.size;\n    } else {\n      return 0;\n    }\n  }\n\n  /** @bundle isofile-sample-processing.js */\n  getAllocatedSampleDataSize() {\n    return this.samplesDataSize;\n  }\n\n  /**\n   * Builds the MIME Type 'codecs' sub-parameters for the whole file\n   *\n   * @bundle isofile-sample-processing.js\n   */\n  getCodecs() {\n    let codecs = '';\n    for (let i = 0; i < this.moov.traks.length; i++) {\n      const trak = this.moov.traks[i];\n      if (i > 0) {\n        codecs += ',';\n      }\n      codecs += trak.mdia.minf.stbl.stsd.entries[0].getCodec();\n    }\n    return codecs;\n  }\n\n  /**\n   * Helper function\n   *\n   * @bundle isofile-sample-processing.js\n   */\n  getTrexById(id: number) {\n    if (!this.moov || !this.moov.mvex) return;\n    for (let i = 0; i < this.moov.mvex.trexs.length; i++) {\n      const trex = this.moov.mvex.trexs[i];\n      if (trex.track_id === id) return trex;\n    }\n  }\n\n  /**\n   * Helper function\n   *\n   * @bundle isofile-sample-processing.js\n   */\n  getTrackById(id: number): trakBox {\n    if (!this.moov) return;\n    for (let j = 0; j < this.moov.traks.length; j++) {\n      const trak = this.moov.traks[j];\n      if (trak.tkhd.track_id === id) return trak;\n    }\n  }\n\n  /** @bundle isofile-item-processing.js */\n  flattenItemInfo() {\n    const items = this.items;\n    const entity_groups = this.entity_groups;\n    const meta = this.meta;\n    if (!meta || !meta.hdlr || !meta.iinf) return;\n    for (let i = 0; i < meta.iinf.item_infos.length; i++) {\n      const id = meta.iinf.item_infos[i].item_ID;\n      items[id] = {\n        id,\n        name: meta.iinf.item_infos[i].item_name,\n        ref_to: [],\n        content_type: meta.iinf.item_infos[i].content_type,\n        content_encoding: meta.iinf.item_infos[i].content_encoding,\n        item_uri_type: meta.iinf.item_infos[i].item_uri_type,\n        type: meta.iinf.item_infos[i].item_type ? meta.iinf.item_infos[i].item_type : 'mime',\n        protection:\n          // NOTE:   This was `meta.iinf.item_infos[i].protection_index` before\n          meta.iinf.item_infos[i].item_protection_index > 0\n            ? // NOTE:   This was `meta.iinf.item_infos[i].protection_index - 1` before\n              meta.ipro.protections[meta.iinf.item_infos[i].item_protection_index - 1]\n            : undefined,\n      };\n    }\n    if (meta.grpl) {\n      for (let i = 0; i < meta.grpl.boxes.length; i++) {\n        const entityGroup = meta.grpl.boxes[i];\n        entity_groups[entityGroup.group_id] = {\n          id: entityGroup.group_id,\n          entity_ids: entityGroup.entity_ids,\n          type: entityGroup.type,\n        };\n      }\n    }\n    if (meta.iloc) {\n      for (let i = 0; i < meta.iloc.items.length; i++) {\n        const itemloc = meta.iloc.items[i];\n        const item = items[itemloc.item_ID];\n        if (itemloc.data_reference_index !== 0) {\n          Log.warn('Item storage with reference to other files: not supported');\n          item.source = meta.dinf.boxes[itemloc.data_reference_index - 1];\n        }\n        item.extents = [];\n        item.size = 0;\n        for (let j = 0; j < itemloc.extents.length; j++) {\n          item.extents[j] = {\n            offset: itemloc.extents[j].extent_offset + itemloc.base_offset,\n            length: itemloc.extents[j].extent_length,\n            alreadyRead: 0,\n          };\n          if (itemloc.construction_method === 1) {\n            item.extents[j].offset += meta.idat.start + meta.idat.hdr_size;\n          }\n          item.size += item.extents[j].length;\n        }\n      }\n    }\n    if (meta.pitm) {\n      items[meta.pitm.item_id].primary = true;\n    }\n    if (meta.iref) {\n      for (let i = 0; i < meta.iref.references.length; i++) {\n        const ref = meta.iref.references[i];\n        for (let j = 0; j < ref.references.length; j++) {\n          items[ref.from_item_ID].ref_to.push({ type: ref.type, id: ref.references[j] });\n        }\n      }\n    }\n    if (meta.iprp) {\n      for (let k = 0; k < meta.iprp.ipmas.length; k++) {\n        const ipma = meta.iprp.ipmas[k];\n        for (let i = 0; i < ipma.associations.length; i++) {\n          const association = ipma.associations[i];\n          const item = items[association.id] ?? entity_groups[association.id];\n          if (item) {\n            if (item.properties === undefined) {\n              item.properties = {\n                boxes: [],\n              };\n            }\n            for (let j = 0; j < association.props.length; j++) {\n              const propEntry = association.props[j];\n              if (\n                propEntry.property_index > 0 &&\n                propEntry.property_index - 1 < meta.iprp.ipco.boxes.length\n              ) {\n                const propbox = meta.iprp.ipco.boxes[propEntry.property_index - 1];\n                item.properties[propbox.type] = propbox;\n                item.properties.boxes.push(propbox);\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /** @bundle isofile-item-processing.js */\n  getItem(item_id: number) {\n    if (!this.meta) return;\n\n    const item = this.items[item_id];\n    if (!item.data && item.size) {\n      /* Not yet fetched */\n      item.data = new Uint8Array(item.size);\n      item.alreadyRead = 0;\n      this.itemsDataSize += item.size;\n      Log.debug(\n        'ISOFile',\n        'Allocating item #' +\n          item_id +\n          ' of size ' +\n          item.size +\n          ' (total: ' +\n          this.itemsDataSize +\n          ')',\n      );\n    } else if (item.alreadyRead === item.size) {\n      /* Already fetched entirely */\n      return item;\n    }\n\n    /* The item has only been partially fetched, we need to check in all buffers to find the remaining extents*/\n\n    for (let i = 0; i < item.extents.length; i++) {\n      const extent = item.extents[i];\n      if (extent.alreadyRead === extent.length) {\n        continue;\n      } else {\n        const index = this.stream.findPosition(true, extent.offset + extent.alreadyRead, false);\n        if (index > -1) {\n          const buffer = this.stream.buffers[index];\n          const lengthAfterStart =\n            buffer.byteLength - (extent.offset + extent.alreadyRead - buffer.fileStart);\n          if (extent.length - extent.alreadyRead <= lengthAfterStart) {\n            /* the (rest of the) extent is entirely contained in this buffer */\n\n            Log.debug(\n              'ISOFile',\n              'Getting item #' +\n                item_id +\n                ' extent #' +\n                i +\n                ' data (alreadyRead: ' +\n                extent.alreadyRead +\n                ' offset: ' +\n                (extent.offset + extent.alreadyRead - buffer.fileStart) +\n                ' read size: ' +\n                (extent.length - extent.alreadyRead) +\n                ' full extent size: ' +\n                extent.length +\n                ' full item size: ' +\n                item.size +\n                ')',\n            );\n\n            // Note: this used to be a memcpy({ ... })\n            DataStream.memcpy(\n              item.data.buffer,\n              item.alreadyRead,\n              buffer,\n              extent.offset + extent.alreadyRead - buffer.fileStart,\n              extent.length - extent.alreadyRead,\n            );\n\n            /* update the number of bytes used in this buffer and check if it needs to be removed */\n            if (!this.parsingMdat || this.discardMdatData)\n              buffer.usedBytes += extent.length - extent.alreadyRead;\n            this.stream.logBufferLevel();\n\n            item.alreadyRead += extent.length - extent.alreadyRead;\n            extent.alreadyRead = extent.length;\n          } else {\n            /* the sample does not end in this buffer */\n\n            Log.debug(\n              'ISOFile',\n              'Getting item #' +\n                item_id +\n                ' extent #' +\n                i +\n                ' partial data (alreadyRead: ' +\n                extent.alreadyRead +\n                ' offset: ' +\n                (extent.offset + extent.alreadyRead - buffer.fileStart) +\n                ' read size: ' +\n                lengthAfterStart +\n                ' full extent size: ' +\n                extent.length +\n                ' full item size: ' +\n                item.size +\n                ')',\n            );\n\n            // Note: this used to be a memcpy({ ... })\n            DataStream.memcpy(\n              item.data.buffer,\n              item.alreadyRead,\n              buffer,\n              extent.offset + extent.alreadyRead - buffer.fileStart,\n              lengthAfterStart,\n            );\n            extent.alreadyRead += lengthAfterStart;\n            item.alreadyRead += lengthAfterStart;\n\n            /* update the number of bytes used in this buffer and check if it needs to be removed */\n            if (!this.parsingMdat || this.discardMdatData) buffer.usedBytes += lengthAfterStart;\n            this.stream.logBufferLevel();\n            return;\n          }\n        } else return;\n      }\n    }\n    if (item.alreadyRead === item.size) {\n      /* fetched entirely */\n      return item;\n    }\n  }\n\n  /**\n   * Release the memory used to store the data of the item\n   *\n   * @bundle isofile-item-processing.js\n   */\n  releaseItem(item_id: number) {\n    const item = this.items[item_id];\n    if (item.data) {\n      this.itemsDataSize -= item.size;\n      item.data = undefined;\n      item.alreadyRead = 0;\n      for (let i = 0; i < item.extents.length; i++) {\n        const extent = item.extents[i];\n        extent.alreadyRead = 0;\n      }\n      return item.size;\n    } else {\n      return 0;\n    }\n  }\n\n  /** @bundle isofile-item-processing.js */\n  processItems(callback: (item: Item) => void) {\n    for (const i in this.items) {\n      const item = this.items[i];\n      this.getItem(item.id);\n      if (callback && !item.sent) {\n        callback(item);\n        item.sent = true;\n        item.data = undefined;\n      }\n    }\n  }\n\n  /** @bundle isofile-item-processing.js */\n  hasItem(name: string) {\n    for (const i in this.items) {\n      const item = this.items[i];\n      if (item.name === name) {\n        return item.id;\n      }\n    }\n    return -1;\n  }\n\n  /** @bundle isofile-item-processing.js */\n  getMetaHandler() {\n    if (this.meta) return this.meta.hdlr.handler;\n  }\n\n  /** @bundle isofile-item-processing.js */\n  getPrimaryItem() {\n    if (this.meta && this.meta.pitm) return this.getItem(this.meta.pitm.item_id);\n  }\n\n  /** @bundle isofile-item-processing.js */\n  itemToFragmentedTrackFile({ itemId }: { itemId?: number } = {}) {\n    let item;\n    if (itemId) {\n      item = this.getItem(itemId);\n    } else {\n      item = this.getPrimaryItem();\n    }\n    if (!item) return;\n\n    const file = new ISOFile();\n    file.discardMdatData = false;\n    // assuming the track type is the same as the item type\n    const trackOptions: IsoFileOptions = {\n      type: item.type,\n      description_boxes: item.properties.boxes,\n    };\n    if (item.properties.ispe) {\n      trackOptions.width = item.properties.ispe.image_width;\n      trackOptions.height = item.properties.ispe.image_height;\n    }\n    const trackId = file.addTrack(trackOptions);\n    if (trackId) {\n      file.addSample(trackId, item.data);\n      return file;\n    }\n  }\n\n  /**\n   * position in the current buffer of the beginning of the last box parsed\n   *\n   * @bundle isofile-advanced-parsing.js\n   */\n  lastBoxStartPosition = 0;\n  /**\n   * indicator if the parsing is stuck in the middle of an mdat box\n   *\n   * @bundle isofile-advanced-parsing.js\n   */\n  parsingMdat?: mdatBox;\n  /* next file position that the parser needs:\n   *  - 0 until the first buffer (i.e. fileStart ===0) has been received\n   *  - otherwise, the next box start until the moov box has been parsed\n   *  - otherwise, the position of the next sample to fetch\n   * @bundle isofile-advanced-parsing.js\n   */\n  nextParsePosition = 0;\n  /**\n   * keep mdat data\n   *\n   * @bundle isofile-advanced-parsing.js\n   */\n  discardMdatData = true;\n\n  /** @bundle isofile-advanced-parsing.js */\n  processIncompleteBox(ret: IncompleteBox) {\n    /* we did not have enough bytes in the current buffer to parse the entire box */\n    if (ret.type === 'mdat') {\n      /* we had enough bytes to get its type and size and it's an 'mdat' */\n\n      /* special handling for mdat boxes, since we don't actually need to parse it linearly\n\t\t   we create the box */\n      const box = new mdatBox(ret.size);\n      this.parsingMdat = box;\n      this.boxes.push(box);\n      this.mdats.push(box);\n      box.start = ret.start;\n      box.hdr_size = ret.hdr_size;\n      box.original_size = ret.original_size;\n      this.stream.addUsedBytes(box.hdr_size);\n\n      /* indicate that the parsing should start from the end of the box */\n      this.lastBoxStartPosition = box.start + box.size;\n      /* let's see if we have the end of the box in the other buffers */\n      const found = this.stream.seek(box.start + box.size, false, this.discardMdatData);\n      if (found) {\n        /* we can now transfer the data to the mdat box stream */\n        this.transferMdatData();\n        /* found the end of the box */\n        this.parsingMdat = undefined;\n        /* let's see if we can parse more in this buffer */\n        return true;\n      } else {\n        /* 'mdat' end not found in the existing buffers */\n        /* determine the next position in the file to start parsing from */\n        if (!this.moovStartFound) {\n          /* moov not find yet,\n\t\t\t\t   the file probably has 'mdat' at the beginning, and 'moov' at the end,\n\t\t\t\t   indicate that the downloader should not try to download those bytes now */\n          this.nextParsePosition = box.start + box.size;\n        } else {\n          /* we have the start of the moov box,\n\t\t\t\t   the next bytes should try to complete the current 'mdat' */\n          this.nextParsePosition = this.stream.findEndContiguousBuf();\n        }\n        /* not much we can do, wait for more buffers to arrive */\n        return false;\n      }\n    } else {\n      /* box is incomplete, we may not even know its type */\n      if (ret.type === 'moov') {\n        /* the incomplete box is a 'moov' box */\n        this.moovStartFound = true;\n        if (this.mdats.length === 0) {\n          this.isProgressive = true;\n        }\n      }\n      /* either it's not an mdat box (and we need to parse it, we cannot skip it)\n\t\t   (TODO: we could skip 'free' boxes ...)\n\t\t\t   or we did not have enough data to parse the type and size of the box,\n\t\t   we try to concatenate the current buffer with the next buffer to restart parsing */\n      const merged = this.stream.mergeNextBuffer ? this.stream.mergeNextBuffer() : false;\n      if (merged) {\n        /* The next buffer was contiguous, the merging succeeded,\n\t\t\t   we can now continue parsing,\n\t\t\t   the next best position to parse is at the end of this new buffer */\n        this.nextParsePosition = this.stream.getEndPosition();\n        return true;\n      } else {\n        /* we cannot concatenate existing buffers because they are not contiguous or because there is no additional buffer */\n        /* The next best position to parse is still at the end of this old buffer */\n        if (!ret.type) {\n          /* There were not enough bytes in the buffer to parse the box type and length,\n\t\t\t\t   the next fetch should retrieve those missing bytes, i.e. the next bytes after this buffer */\n          this.nextParsePosition = this.stream.getEndPosition();\n        } else {\n          /* we had enough bytes to parse size and type of the incomplete box\n\t\t\t\t   if we haven't found yet the moov box, skip this one and try the next one\n\t\t\t\t   if we have found the moov box, let's continue linear parsing */\n          if (this.moovStartFound) {\n            this.nextParsePosition = this.stream.getEndPosition();\n          } else {\n            this.nextParsePosition = this.stream.getPosition() + ret.size;\n          }\n        }\n        return false;\n      }\n    }\n  }\n\n  /** @bundle isofile-advanced-parsing.js */\n  hasIncompleteMdat() {\n    return this.parsingMdat !== undefined;\n  }\n\n  /**\n   * Transfer the data of the mdat box to its stream\n   * @param mdat the mdat box to use\n   */\n  transferMdatData(inMdat?: mdatBox) {\n    const mdat = inMdat ?? this.parsingMdat;\n    if (this.discardMdatData) {\n      Log.debug('ISOFile', \"Discarding 'mdat' data, not transferring it to the mdat box stream\");\n      return;\n    }\n    if (!mdat) {\n      Log.warn('ISOFile', \"Cannot transfer 'mdat' data, no mdat box is being parsed\");\n      return;\n    }\n\n    // Start by finding the starting buffer\n    const startBufferIndex = this.stream.findPosition(true, mdat.start + mdat.hdr_size, false);\n    const endBufferIndex = this.stream.findPosition(true, mdat.start + mdat.size, false);\n\n    if (startBufferIndex === -1 || endBufferIndex === -1) {\n      Log.warn('ISOFile', \"Cannot transfer 'mdat' data, start or end buffer not found\");\n      return;\n    }\n\n    // Transfer the data\n    mdat.stream = new MultiBufferStream();\n    for (let i = startBufferIndex; i <= endBufferIndex; i++) {\n      const buffer = this.stream.buffers[i];\n      const startOffset =\n        i === startBufferIndex ? mdat.start + mdat.hdr_size - buffer.fileStart : 0;\n      const endOffset =\n        i === endBufferIndex ? mdat.start + mdat.size - buffer.fileStart : buffer.byteLength;\n      if (endOffset > startOffset) {\n        Log.debug(\n          'ISOFile',\n          \"Transferring 'mdat' data from buffer #\" +\n            i +\n            ' (' +\n            startOffset +\n            ' to ' +\n            endOffset +\n            ')',\n        );\n\n        const transferSize = endOffset - startOffset;\n        const newBuffer = new MP4BoxBuffer(transferSize);\n        const lastPosition = mdat.stream.getAbsoluteEndPosition();\n        DataStream.memcpy(newBuffer, 0, buffer, startOffset, transferSize);\n        newBuffer.fileStart = lastPosition;\n\n        // Insert the new buffer into the mdat stream\n        mdat.stream.insertBuffer(newBuffer);\n\n        // Consume the bytes in the original stream\n        buffer.usedBytes += transferSize;\n      }\n    }\n  }\n\n  /** @bundle isofile-advanced-parsing.js */\n  processIncompleteMdat() {\n    /* we are in the parsing of an incomplete mdat box */\n    const box = this.parsingMdat;\n    const found = this.stream.seek(box.start + box.size, false, this.discardMdatData);\n    if (found) {\n      Log.debug('ISOFile', \"Found 'mdat' end in buffered data\");\n      /* we can now transfer the data to the mdat box stream */\n      this.transferMdatData();\n      /* the end of the mdat has been found */\n      this.parsingMdat = undefined;\n      /* we can parse more in this buffer */\n      return true;\n    } else {\n      /* we don't have the end of this mdat yet,\n\t\t   indicate that the next byte to fetch is the end of the buffers we have so far,\n\t\t   return and wait for more buffer to come */\n      this.nextParsePosition = this.stream.findEndContiguousBuf();\n      return false;\n    }\n  }\n\n  /** @bundle isofile-advanced-parsing.js */\n  restoreParsePosition() {\n    /* Reposition at the start position of the previous box not entirely parsed */\n    return this.stream.seek(this.lastBoxStartPosition, true, this.discardMdatData);\n  }\n\n  /** @bundle isofile-advanced-parsing.js */\n  saveParsePosition() {\n    /* remember the position of the box start in case we need to roll back (if the box is incomplete) */\n    this.lastBoxStartPosition = this.stream.getPosition();\n  }\n\n  /** @bundle isofile-advanced-parsing.js */\n  updateUsedBytes(box: Box, _ret: ReturnType<typeof parseOneBox>) {\n    if (this.stream.addUsedBytes) {\n      if (box.type === 'mdat') {\n        /* for an mdat box, only its header is considered used, other bytes will be used when sample data is requested */\n        this.stream.addUsedBytes(box.hdr_size);\n        if (this.discardMdatData) {\n          this.stream.addUsedBytes(box.size - box.hdr_size);\n        }\n      } else {\n        /* for all other boxes, the entire box data is considered used */\n        this.stream.addUsedBytes(box.size);\n      }\n    }\n  }\n\n  /** @bundle isofile-advanced-creation.js */\n  addBox<T extends Box>(box: T): T {\n    return Box.prototype.addBox.call(this, box);\n  }\n\n  /** @bundle isofile-advanced-creation.js */\n  init(options: IsoFileOptions = {}) {\n    const ftyp = this.addBox(new ftypBox());\n    ftyp.major_brand = (options.brands && options.brands[0]) || 'iso4';\n    ftyp.minor_version = 0;\n    ftyp.compatible_brands = options.brands || ['iso4'];\n\n    const moov = this.addBox(new moovBox());\n    moov.addBox(new mvexBox());\n\n    const mvhd = moov.addBox(new mvhdBox());\n    mvhd.timescale = options.timescale || 600;\n    mvhd.rate = options.rate || 1 << 16;\n    mvhd.creation_time = 0;\n    mvhd.modification_time = 0;\n    mvhd.duration = options.duration || 0;\n    mvhd.volume = options.width ? 0 : 0x0100;\n    mvhd.matrix = [1 << 16, 0, 0, 0, 1 << 16, 0, 0, 0, 0x40000000];\n    mvhd.next_track_id = 1;\n\n    return this;\n  }\n\n  /** @bundle isofile-advanced-creation.js */\n  addTrack(_options: IsoFileOptions = {}) {\n    if (!this.moov) {\n      this.init(_options);\n    }\n\n    const options: IsoFileOptions = _options || {};\n\n    options.width = options.width || 320;\n    options.height = options.height || 320;\n    options.id = options.id || this.moov.mvhd.next_track_id;\n    options.type = options.type || 'avc1';\n\n    const trak = this.moov.addBox(new trakBox());\n    this.moov.mvhd.next_track_id = options.id + 1;\n\n    const tkhd = trak.addBox(new tkhdBox());\n    tkhd.flags = TKHD_FLAG_ENABLED | TKHD_FLAG_IN_MOVIE | TKHD_FLAG_IN_PREVIEW;\n    tkhd.creation_time = 0;\n    tkhd.modification_time = 0;\n    tkhd.track_id = options.id;\n    tkhd.duration = options.duration || 0;\n    tkhd.layer = options.layer || 0;\n    tkhd.alternate_group = 0;\n    tkhd.volume = 1;\n    tkhd.matrix = [1 << 16, 0, 0, 0, 1 << 16, 0, 0, 0, 0x40000000];\n    tkhd.width = options.width << 16;\n    tkhd.height = options.height << 16;\n\n    const mdia = trak.addBox(new mdiaBox());\n    const mdhd = mdia.addBox(new mdhdBox());\n    mdhd.creation_time = 0;\n    mdhd.modification_time = 0;\n    mdhd.timescale = options.timescale || 1;\n    mdhd.duration = options.media_duration || 0;\n    // @ts-expect-error FIXME:   some code expects language to be a number\n    mdhd.language = options.language || 'und';\n\n    const hdlr = mdia.addBox(new hdlrBox());\n    hdlr.handler = options.hdlr || 'vide';\n    hdlr.name = options.name || 'Track created with MP4Box.js';\n\n    const elng = mdia.addBox(new elngBox());\n    elng.extended_language = options.language || 'fr-FR';\n\n    const minf = mdia.addBox(new minfBox());\n\n    const sampleEntry = BoxRegistry.sampleEntry[options.type];\n    if (!sampleEntry) return;\n\n    const sample_description_entry = new sampleEntry();\n    sample_description_entry.data_reference_index = 1;\n\n    if (sample_description_entry instanceof VisualSampleEntry) {\n      const sde = sample_description_entry as VisualSampleEntry;\n      const vmhd = minf.addBox(new vmhdBox());\n      vmhd.graphicsmode = 0;\n      vmhd.opcolor = [0, 0, 0];\n\n      sde.width = options.width;\n      sde.height = options.height;\n      sde.horizresolution = 0x48 << 16;\n      sde.vertresolution = 0x48 << 16;\n      sde.frame_count = 1;\n      sde.compressorname = options.type + ' Compressor';\n      sde.depth = 0x18;\n\n      if (options.avcDecoderConfigRecord) {\n        const avcC = sde.addBox(new avcCBox(options.avcDecoderConfigRecord.byteLength));\n        avcC.parse(new DataStream(options.avcDecoderConfigRecord));\n      } else if (options.hevcDecoderConfigRecord) {\n        const hvcC = sde.addBox(new hvcCBox(options.hevcDecoderConfigRecord.byteLength));\n        hvcC.parse(new DataStream(options.hevcDecoderConfigRecord));\n      }\n    } else if (sample_description_entry instanceof AudioSampleEntry) {\n      const sde = sample_description_entry as AudioSampleEntry;\n      const smhd = minf.addBox(new smhdBox());\n      smhd.balance = options.balance || 0;\n\n      sde.channel_count = options.channel_count || 2;\n      sde.samplesize = options.samplesize || 16;\n      sde.samplerate = options.samplerate || 1 << 16;\n    } else if (sample_description_entry instanceof HintSampleEntry) {\n      minf.addBox(new hmhdBox()); // TODO: add properties\n    } else if (sample_description_entry instanceof SubtitleSampleEntry) {\n      minf.addBox(new sthdBox());\n      if (sample_description_entry instanceof stppSampleEntry) {\n        sample_description_entry.namespace = options.namespace || 'nonamespace';\n        sample_description_entry.schema_location = options.schema_location || '';\n        sample_description_entry.auxiliary_mime_types = options.auxiliary_mime_types || '';\n      }\n    } else if (sample_description_entry instanceof MetadataSampleEntry) {\n      minf.addBox(new nmhdBox());\n    } else if (sample_description_entry instanceof SystemSampleEntry) {\n      minf.addBox(new nmhdBox());\n    } else {\n      minf.addBox(new nmhdBox());\n    }\n\n    if (options.description) {\n      (sample_description_entry.addBox as (box: Box) => Box).call(\n        sample_description_entry,\n        options.description,\n      );\n    }\n    if (options.description_boxes) {\n      options.description_boxes.forEach(function (b) {\n        (sample_description_entry.addBox as (box: Box) => Box).call(sample_description_entry, b);\n      });\n    }\n    const dinf = minf.addBox(new dinfBox());\n    const dref = dinf.addBox(new drefBox());\n    const url = new urlBox();\n    url.flags = 0x1;\n    dref.addEntry(url);\n\n    const stbl = minf.addBox(new stblBox());\n    const stsd = stbl.addBox(new stsdBox());\n    stsd.addEntry(sample_description_entry);\n\n    const stts = stbl.addBox(new sttsBox());\n    stts.sample_counts = [];\n    stts.sample_deltas = [];\n\n    const stsc = stbl.addBox(new stscBox());\n    stsc.first_chunk = [];\n    stsc.samples_per_chunk = [];\n    stsc.sample_description_index = [];\n\n    const stco = stbl.addBox(new stcoBox());\n    stco.chunk_offsets = [];\n    const stsz = stbl.addBox(new stszBox());\n    stsz.sample_sizes = [];\n\n    const trex = this.moov.mvex.addBox(new trexBox());\n    trex.track_id = options.id;\n    trex.default_sample_description_index = options.default_sample_description_index || 1;\n    trex.default_sample_duration = options.default_sample_duration || 0;\n    trex.default_sample_size = options.default_sample_size || 0;\n    trex.default_sample_flags = options.default_sample_flags || 0;\n\n    this.buildTrakSampleLists(trak);\n    return options.id;\n  }\n\n  /** @bundle isofile-advanced-creation.js */\n  addSample(\n    track_id: number,\n    data: Uint8Array<ArrayBuffer>,\n    {\n      sample_description_index,\n      duration = 1,\n      cts = 0,\n      dts = 0,\n      is_sync = false,\n      is_leading = 0,\n      depends_on = 0,\n      is_depended_on = 0,\n      has_redundancy = 0,\n      degradation_priority = 0,\n      subsamples,\n      offset = 0,\n    }: {\n      sample_description_index?: number;\n      duration?: number;\n      cts?: number;\n      dts?: number;\n      is_sync?: boolean;\n      is_leading?: number;\n      depends_on?: number;\n      is_depended_on?: number;\n      has_redundancy?: number;\n      degradation_priority?: number;\n      subsamples?: Array<SubSample>;\n      offset?: number;\n    } = {},\n  ) {\n    const trak = this.getTrackById(track_id);\n    if (trak === undefined) return;\n\n    const descriptionIndex = sample_description_index ? sample_description_index - 1 : 0;\n\n    const sample: Sample = {\n      number: trak.samples.length,\n      track_id: trak.tkhd.track_id,\n      timescale: trak.mdia.mdhd.timescale,\n      description_index: descriptionIndex,\n      description: trak.mdia.minf.stbl.stsd.entries[descriptionIndex],\n      data,\n      size: data.byteLength,\n      alreadyRead: data.byteLength,\n      duration,\n      cts,\n      dts,\n      is_sync,\n      is_leading,\n      depends_on,\n      is_depended_on,\n      has_redundancy,\n      degradation_priority,\n      offset,\n      subsamples,\n    };\n\n    trak.samples.push(sample);\n    trak.samples_size += sample.size;\n    trak.samples_duration += sample.duration;\n    if (trak.first_dts === undefined) {\n      trak.first_dts = dts;\n    }\n\n    this.processSamples();\n\n    const moof = this.addBox(this.createMoof([sample]));\n    moof.computeSize();\n    /* adjusting the data_offset now that the moof size is known*/\n    moof.trafs[0].truns[0].data_offset = moof.size + 8; //8 is mdat header\n\n    const mdat = this.addBox(new mdatBox());\n    mdat.data = new Uint8Array(data);\n\n    return sample;\n  }\n\n  /** @bundle isofile-advanced-creation.js */\n  createMoof(samples: Array<Sample>) {\n    // All samples must be from the same track\n    if (samples.length === 0) return;\n    if (samples.some(s => s.track_id !== samples[0].track_id)) {\n      throw new Error(\n        'Cannot create moof for samples from different tracks: ' +\n          samples.map(s => s.track_id).join(', '),\n      );\n    }\n    const trackId = samples[0].track_id;\n    const trak = this.getTrackById(trackId);\n    if (!trak) {\n      throw new Error('Cannot create moof for non-existing track: ' + trackId);\n    }\n\n    // Create the moof box\n    const moof = new moofBox();\n\n    // Add the mfhd box with the sequence number\n    const mfhd = moof.addBox(new mfhdBox());\n    mfhd.sequence_number = ++this.nextMoofNumber;\n\n    // Create the traf box\n    const traf = moof.addBox(new trafBox());\n\n    // Add the tfhd and tfdt boxes\n    const tfhd = traf.addBox(new tfhdBox());\n    tfhd.track_id = trackId;\n    tfhd.flags = TFHD_FLAG_DEFAULT_BASE_IS_MOOF;\n    const tfdt = traf.addBox(new tfdtBox());\n    tfdt.baseMediaDecodeTime = samples[0].dts - (trak.first_dts || 0);\n\n    // Construct the trun box\n    const trun = traf.addBox(new trunBox());\n    trun.flags =\n      TRUN_FLAGS_DATA_OFFSET |\n      TRUN_FLAGS_DURATION |\n      TRUN_FLAGS_SIZE |\n      TRUN_FLAGS_FLAGS |\n      TRUN_FLAGS_CTS_OFFSET;\n    trun.data_offset = 0;\n    trun.first_sample_flags = 0;\n    trun.sample_count = samples.length;\n\n    for (const sample of samples) {\n      let sample_flags = 0;\n      if (sample.is_sync)\n        sample_flags = 1 << 25; // sample_depends_on_none (I picture)\n      else sample_flags = 1 << 16; // non-sync\n\n      trun.sample_duration.push(sample.duration);\n      trun.sample_size.push(sample.size);\n      trun.sample_flags.push(sample_flags);\n      trun.sample_composition_time_offset.push(sample.cts - sample.dts);\n    }\n\n    return moof;\n  }\n\n  /** @bundle box-print.js */\n  print(output: Output) {\n    output.indent = '';\n    for (let i = 0; i < this.boxes.length; i++) {\n      if (this.boxes[i]) {\n        this.boxes[i].print(output);\n      }\n    }\n  }\n}\n","/*\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\n * License: BSD-3-Clause (see LICENSE file)\n */\n\nimport { MultiBufferStream } from '#/buffer';\nimport { ISOFile } from '#/isofile';\n\nexport function createFile(keepMdatData = false, stream?: MultiBufferStream) {\n  /* Boolean indicating if bytes containing media data should be kept in memory */\n  const file = new ISOFile(stream, !keepMdatData);\n  return file;\n}\n","/*\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\n * License: BSD-3-Clause (see LICENSE file)\n */\n\nimport { MultiBufferStream } from '#/buffer';\nimport { DataStream } from '#/DataStream';\nimport { Log } from '#/log';\n\nconst ES_DescrTag = 0x03;\nconst DecoderConfigDescrTag = 0x04;\nconst DecSpecificInfoTag = 0x05;\nconst SLConfigDescrTag = 0x06;\n\nexport class Descriptor {\n  descs = [];\n  data: Uint8Array;\n\n  constructor(\n    public tag: number,\n    public size: number,\n  ) {}\n\n  parse(stream: DataStream) {\n    this.data = stream.readUint8Array(this.size);\n  }\n\n  findDescriptor(tag: number) {\n    for (let i = 0; i < this.descs.length; i++) {\n      if (this.descs[i].tag === tag) {\n        return this.descs[i];\n      }\n    }\n  }\n\n  parseOneDescriptor(stream: DataStream): DescriptorKinds {\n    let size = 0;\n    const tag = stream.readUint8();\n    let byteRead = stream.readUint8();\n    while (byteRead & 0x80) {\n      size = (size << 7) + (byteRead & 0x7f);\n      byteRead = stream.readUint8();\n    }\n    size = (size << 7) + (byteRead & 0x7f);\n    Log.debug(\n      'Descriptor',\n      'Found ' +\n        (descTagToName[tag] || 'Descriptor ' + tag) +\n        ', size ' +\n        size +\n        ' at position ' +\n        stream.getPosition(),\n    );\n    const desc = descTagToName[tag]\n      ? new DESCRIPTOR_CLASSES[descTagToName[tag]](size)\n      : // @ts-expect-error FIXME: Descriptor expects a tag as first parameter\n        new Descriptor(size);\n\n    desc.parse(stream);\n    return desc;\n  }\n\n  parseRemainingDescriptors(stream: DataStream) {\n    const start = stream.getPosition();\n    while (stream.getPosition() < start + this.size) {\n      const desc = this.parseOneDescriptor?.(stream);\n      this.descs.push(desc);\n    }\n  }\n}\n\nexport class ES_Descriptor extends Descriptor {\n  dependsOn_ES_ID: number;\n  ES_ID: number;\n  flags: number;\n  OCR_ES_ID: number;\n  URL: string;\n\n  constructor(size?: number) {\n    super(ES_DescrTag, size);\n  }\n\n  parse(stream: MultiBufferStream) {\n    this.ES_ID = stream.readUint16();\n    this.flags = stream.readUint8();\n    this.size -= 3;\n    if (this.flags & 0x80) {\n      this.dependsOn_ES_ID = stream.readUint16();\n      this.size -= 2;\n    } else {\n      this.dependsOn_ES_ID = 0;\n    }\n    if (this.flags & 0x40) {\n      const l = stream.readUint8();\n      this.URL = stream.readString(l);\n      this.size -= l + 1;\n    } else {\n      this.URL = '';\n    }\n    if (this.flags & 0x20) {\n      this.OCR_ES_ID = stream.readUint16();\n      this.size -= 2;\n    } else {\n      this.OCR_ES_ID = 0;\n    }\n    this.parseRemainingDescriptors(stream);\n  }\n\n  getOTI() {\n    const dcd = this.findDescriptor(DecoderConfigDescrTag);\n    if (dcd) {\n      return dcd.oti;\n    } else {\n      return 0;\n    }\n  }\n\n  getAudioConfig() {\n    const dcd = this.findDescriptor(DecoderConfigDescrTag);\n    if (!dcd) return;\n    const dsi = dcd.findDescriptor(DecSpecificInfoTag);\n    if (dsi && dsi.data) {\n      let audioObjectType = (dsi.data[0] & 0xf8) >> 3;\n      if (audioObjectType === 31 && dsi.data.length >= 2) {\n        audioObjectType = 32 + ((dsi.data[0] & 0x7) << 3) + ((dsi.data[1] & 0xe0) >> 5);\n      }\n      return audioObjectType;\n    }\n  }\n}\n\nclass DecoderConfigDescriptor extends Descriptor {\n  avgBitrate: number;\n  bufferSize: number;\n  maxBitrate: number;\n  oti: number;\n  streamType: number;\n  upStream: boolean;\n\n  constructor(size: number) {\n    super(DecoderConfigDescrTag, size);\n  }\n  parse(stream: MultiBufferStream) {\n    this.oti = stream.readUint8();\n    this.streamType = stream.readUint8();\n    this.upStream = ((this.streamType >> 1) & 1) !== 0;\n    this.streamType = this.streamType >>> 2;\n    this.bufferSize = stream.readUint24();\n    this.maxBitrate = stream.readUint32();\n    this.avgBitrate = stream.readUint32();\n    this.size -= 13;\n    this.parseRemainingDescriptors(stream);\n  }\n}\n\nclass DecoderSpecificInfo extends Descriptor {\n  constructor(size: number) {\n    super(DecSpecificInfoTag, size);\n  }\n}\n\nclass SLConfigDescriptor extends Descriptor {\n  constructor(size: number) {\n    super(SLConfigDescrTag, size);\n  }\n}\n\nconst DESCRIPTOR_CLASSES = {\n  Descriptor,\n  ES_Descriptor,\n  DecoderConfigDescriptor,\n  DecoderSpecificInfo,\n  SLConfigDescriptor,\n};\ntype DescriptorKinds =\n  | Descriptor\n  | ES_Descriptor\n  | DecoderConfigDescriptor\n  | DecoderSpecificInfo\n  | SLConfigDescriptor;\n\nconst descTagToName = {\n  [ES_DescrTag]: 'ES_Descriptor',\n  [DecoderConfigDescrTag]: 'DecoderConfigDescriptor',\n  [DecSpecificInfoTag]: 'DecoderSpecificInfo',\n  [SLConfigDescrTag]: 'SLConfigDescriptor',\n};\n\nexport class MPEG4DescriptorParser {\n  getDescriptorName(tag: number) {\n    return descTagToName[tag];\n  }\n\n  parseOneDescriptor = Descriptor.prototype.parseOneDescriptor;\n}\n","import { Box } from '#/box';\nimport { OK } from '#/constants';\nimport type { Sample, TypedArray } from '@types';\nimport { parseOneBox } from '#/parser';\nimport { DataStream } from '#/DataStream';\nimport { MultiBufferStream } from '#/buffer';\nimport { MP4BoxBuffer } from '#/mp4boxbuffer';\n\n/*\n * Copyright (c) 2012-2013. Telecom ParisTech/TSI/MM/GPAC Cyril Concolato\n * License: BSD-3-Clause (see LICENSE file)\n */\nexport class VTTin4Parser {\n  parseSample(data: TypedArray) {\n    const cues: Array<Box> = [];\n    const stream = new MultiBufferStream(MP4BoxBuffer.fromArrayBuffer(data.buffer, 0));\n\n    while (!stream.isEof()) {\n      const cue = parseOneBox(stream, false);\n      if (cue.code === OK && cue.box?.type === 'vttc') {\n        cues.push(cue.box);\n      }\n    }\n    return cues;\n  }\n\n  getText(startTime: number, endTime: number, data: TypedArray) {\n    function pad(value: number, width: number) {\n      const string = value.toString();\n      if (string.length >= width) {\n        return string;\n      }\n      return new Array(width - string.length + 1).join('0') + string;\n    }\n    function secToTimestamp(insec: number) {\n      const h = Math.floor(insec / 3600);\n      const m = Math.floor((insec - h * 3600) / 60);\n      const s = Math.floor(insec - h * 3600 - m * 60);\n      const ms = Math.floor((insec - h * 3600 - m * 60 - s) * 1000);\n      return '' + pad(h, 2) + ':' + pad(m, 2) + ':' + pad(s, 2) + '.' + pad(ms, 3);\n    }\n    const cues = this.parseSample(data);\n    let string = '';\n    for (let i = 0; i < cues.length; i++) {\n      const cueIn4 = cues[i];\n      string += secToTimestamp(startTime) + ' --> ' + secToTimestamp(endTime) + '\\r\\n';\n      // @ts-expect-error FIXME: which box should get a payl-property?\n      string += cueIn4.payl.text;\n    }\n    return string;\n  }\n}\n\nexport class XMLSubtitlein4Parser {\n  parseSample(sample: Sample) {\n    const res = {\n      resources: [] as Array<Uint8Array>,\n      documentString: '',\n      document: undefined as undefined | Document,\n    };\n    const stream = new DataStream(sample.data.buffer);\n    if (!sample.subsamples || sample.subsamples.length === 0) {\n      res.documentString = stream.readString(sample.data.length);\n    } else {\n      res.documentString = stream.readString(sample.subsamples[0].size);\n      if (sample.subsamples.length > 1) {\n        for (let i = 1; i < sample.subsamples.length; i++) {\n          res.resources[i] = stream.readUint8Array(sample.subsamples[i].size);\n        }\n      }\n    }\n    if (typeof DOMParser !== 'undefined') {\n      res.document = new DOMParser().parseFromString(res.documentString, 'application/xml');\n    }\n    return res;\n  }\n}\n\nexport class Textin4Parser {\n  parseSample(sample: Sample) {\n    const stream = new DataStream(sample.data.buffer);\n    const textString = stream.readString(sample.data.length);\n    return textString;\n  }\n\n  parseConfig(data: TypedArray) {\n    const stream = new DataStream(data.buffer);\n    stream.readUint32(); // version & flags\n    const textString = stream.readCString();\n    return textString;\n  }\n}\n\nexport class TX3GParser {\n  parseSample(sample: Sample) {\n    const stream = new DataStream(sample.data.buffer);\n    const size = stream.readUint16();\n    if (size === 0) {\n      // If size is 0, it indicates an empty text sample\n      return;\n    }\n\n    return stream.readString(size);\n  }\n}\n","import { DataStream } from '#/DataStream';\nimport { createFile } from '#/create-file';\nimport { MP4BoxBuffer } from '#/mp4boxbuffer';\nimport type { Movie } from './types';\n\ntype RangeFetcher = (start: number, end: number) => Promise<ArrayBuffer>;\n\nexport interface LoadMoovOnlyOptions {\n  /** Local browser File/Blob to read */\n  blob?: Blob;\n  /** Total size in bytes (defaults to blob.size if provided) */\n  size?: number;\n  /** Custom range fetcher; use this if you already have chunking logic */\n  fetchRange?: RangeFetcher;\n  /**\n   * Max bytes to read per probe before we know where to jump next.\n   * Kept small to avoid downloading large mdats just to discover their size.\n   */\n  probeSize?: number;\n  /** Chunk size in bytes; defaults to 1 MiB */\n  chunkSize?: number;\n}\n\nexport interface LoadMoovOnlyResult {\n  info: Movie;\n  mp4: ReturnType<typeof createFile>;\n  /** Serialized `ftyp` + `moov` header as a contiguous buffer starting at offset 0 */\n  header?: MP4BoxBuffer;\n}\n\nfunction buildHeader(mp4: ReturnType<typeof createFile>) {\n  if (!mp4.ftyp || !mp4.moov) return;\n  const stream = new DataStream();\n  stream.isofile = mp4;\n  mp4.ftyp.write(stream);\n  mp4.moov.write(stream);\n  const buffer = stream.buffer;\n  buffer.fileStart = 0;\n  return buffer;\n}\n\nexport async function loadMoovOnly(options: LoadMoovOnlyOptions): Promise<LoadMoovOnlyResult> {\n  const { blob, fetchRange, chunkSize = 1024 * 1024, probeSize = 64 * 1024 } = options;\n\n  if (!blob && !fetchRange) {\n    throw new Error('loadMoovOnly requires either a Blob/File or a custom fetchRange');\n  }\n\n  const size = options.size ?? blob?.size;\n  if (size === undefined) {\n    throw new Error('loadMoovOnly could not determine the resource size');\n  }\n\n  const reader: RangeFetcher = fetchRange\n    ? fetchRange\n    : async (start, end) => {\n        if (!blob) {\n          throw new Error('Blob is required when fetchRange is not provided');\n        }\n        const slice = blob.slice(start, end + 1);\n        return slice.arrayBuffer();\n      };\n\n  const mp4 = createFile(false);\n  let info: Movie | undefined;\n  mp4.onReady = movie => {\n    info = movie;\n  };\n\n  const hasCompleteMoov = () => {\n    const moov = mp4.moov;\n    if (!moov || moov.start === undefined || moov.size === undefined) return false;\n    const moovEnd = moov.start + moov.size;\n    const availableEnd = mp4.stream.getEndFilePositionAfter(moov.start);\n    return availableEnd >= moovEnd && mp4.sampleListBuilt;\n  };\n\n  let offset = 0;\n  let header: MP4BoxBuffer | undefined;\n  while (!hasCompleteMoov() && offset < size) {\n    // Before we know where to jump, keep reads small to avoid wasting bandwidth on huge mdats\n    const effectiveChunkSize = mp4.moov ? chunkSize : Math.min(chunkSize, probeSize);\n    const rangeEnd = Math.min(offset + effectiveChunkSize, size) - 1;\n    let suggestedNext: number | undefined;\n\n    const ab = await reader(offset, rangeEnd);\n    const data = MP4BoxBuffer.fromArrayBuffer(ab, offset);\n    const next = mp4.appendBuffer(data);\n    if (typeof next === 'number') {\n      suggestedNext = next;\n    }\n\n    if (hasCompleteMoov()) break;\n    // Jump directly to the next suggested range (typically end of mdat) when available\n    if (suggestedNext !== undefined && suggestedNext > offset) {\n      offset = suggestedNext;\n    } else {\n      offset = rangeEnd + 1;\n    }\n  }\n\n  if (mp4.moov && !mp4.sampleListBuilt) {\n    mp4.buildSampleLists();\n    mp4.sampleListBuilt = true;\n  }\n\n  if (!header) {\n    header = buildHeader(mp4);\n  }\n\n  mp4.flush();\n  if (!info) info = mp4.getInfo();\n\n  return { info, mp4, header };\n}\n","export * from '#/boxes/a1lx';\nexport * from '#/boxes/a1op';\nexport * from '#/boxes/auxC';\nexport * from '#/boxes/av1C';\nexport * from '#/boxes/avcC';\nexport * from '#/boxes/btrt';\nexport * from '#/boxes/ccst';\nexport * from '#/boxes/cdef';\nexport * from '#/boxes/clap';\nexport * from '#/boxes/clli';\nexport * from '#/boxes/cmex';\nexport * from '#/boxes/cmin';\nexport * from '#/boxes/cmpd';\nexport * from '#/boxes/co64';\nexport * from '#/boxes/CoLL';\nexport * from '#/boxes/colr';\nexport * from '#/boxes/covi';\nexport * from '#/boxes/cprt';\nexport * from '#/boxes/csch';\nexport * from '#/boxes/cslg';\nexport * from '#/boxes/ctts';\nexport * from '#/boxes/dac3';\nexport * from '#/boxes/dec3';\nexport * from '#/boxes/defaults';\nexport * from '#/boxes/dfLa';\nexport * from '#/boxes/dimm';\nexport * from '#/boxes/dmax';\nexport * from '#/boxes/dmed';\nexport * from '#/boxes/dOps';\nexport * from '#/boxes/dref';\nexport * from '#/boxes/drep';\nexport * from '#/boxes/elng';\nexport * from '#/boxes/elst';\nexport * from '#/boxes/emsg';\nexport * from '#/boxes/EntityToGroup';\nexport * from '#/boxes/esds';\nexport * from '#/boxes/fiel';\nexport * from '#/boxes/frma';\nexport * from '#/boxes/ftyp';\nexport * from '#/boxes/hdlr';\nexport * from '#/boxes/hvcC';\nexport * from '#/boxes/iinf';\nexport * from '#/boxes/iloc';\nexport * from '#/boxes/imir';\nexport * from '#/boxes/infe';\nexport * from '#/boxes/ipma';\nexport * from '#/boxes/iref';\nexport * from '#/boxes/irot';\nexport * from '#/boxes/ispe';\nexport * from '#/boxes/itai';\nexport * from '#/boxes/kind';\nexport * from '#/boxes/leva';\nexport * from '#/boxes/lhvC';\nexport * from '#/boxes/lsel';\nexport * from '#/boxes/maxr';\nexport * from '#/boxes/mdcv';\nexport * from '#/boxes/mdhd';\nexport * from '#/boxes/mehd';\nexport * from '#/boxes/meta';\nexport * from '#/boxes/mfhd';\nexport * from '#/boxes/mfro';\nexport * from '#/boxes/mskC';\nexport * from '#/boxes/mvhd';\nexport * from '#/boxes/npck';\nexport * from '#/boxes/nump';\nexport * from '#/boxes/padb';\nexport * from '#/boxes/pasp';\nexport * from '#/boxes/payl';\nexport * from '#/boxes/payt';\nexport * from '#/boxes/pdin';\nexport * from '#/boxes/pitm';\nexport * from '#/boxes/pixi';\nexport * from '#/boxes/pmax';\nexport * from '#/boxes/prdi';\nexport * from '#/boxes/prfr';\nexport * from '#/boxes/prft';\nexport * from '#/boxes/pssh';\nexport * from '#/boxes/qt/clef';\nexport * from '#/boxes/qt/data';\nexport * from '#/boxes/qt/enof';\nexport * from '#/boxes/qt/ilst';\nexport * from '#/boxes/qt/keys';\nexport * from '#/boxes/qt/prof';\nexport * from '#/boxes/qt/tapt';\nexport * from '#/boxes/qt/wave';\nexport * from '#/boxes/rtp';\nexport * from '#/boxes/saio';\nexport * from '#/boxes/saiz';\nexport * from '#/boxes/sampleentries';\nexport * from '#/boxes/sbgp';\nexport * from '#/boxes/sbpm';\nexport * from '#/boxes/schm';\nexport * from '#/boxes/sdp';\nexport * from '#/boxes/sdtp';\nexport * from '#/boxes/senc';\nexport * from '#/boxes/sgpd';\nexport * from '#/boxes/sidx';\nexport * from '#/boxes/SmDm';\nexport * from '#/boxes/smhd';\nexport * from '#/boxes/srat';\nexport * from '#/boxes/ssix';\nexport * from '#/boxes/stco';\nexport * from '#/boxes/stdp';\nexport * from '#/boxes/sthd';\nexport * from '#/boxes/stri';\nexport * from '#/boxes/stsc';\nexport * from '#/boxes/stsd';\nexport * from '#/boxes/stsg';\nexport * from '#/boxes/stsh';\nexport * from '#/boxes/stss';\nexport * from '#/boxes/stsz';\nexport * from '#/boxes/stts';\nexport * from '#/boxes/stvi';\nexport * from '#/boxes/styp';\nexport * from '#/boxes/stz2';\nexport * from '#/boxes/subs';\nexport * from '#/boxes/taic';\nexport * from '#/boxes/tenc';\nexport * from '#/boxes/tfdt';\nexport * from '#/boxes/tfhd';\nexport * from '#/boxes/tfra';\nexport * from '#/boxes/tkhd';\nexport * from '#/boxes/tmax';\nexport * from '#/boxes/tmin';\nexport * from '#/boxes/totl';\nexport * from '#/boxes/tpay';\nexport * from '#/boxes/tpyl';\nexport * from '#/boxes/trackgroups/msrc';\nexport * from '#/boxes/tref';\nexport * from '#/boxes/trep';\nexport * from '#/boxes/trex';\nexport * from '#/boxes/trpy';\nexport * from '#/boxes/trun';\nexport * from '#/boxes/tsel';\nexport * from '#/boxes/txtC';\nexport * from '#/boxes/tyco';\nexport * from '#/boxes/udes';\nexport * from '#/boxes/uncC';\nexport * from '#/boxes/url';\nexport * from '#/boxes/urn';\nexport * from '#/boxes/vmhd';\nexport * from '#/boxes/vpcC';\nexport * from '#/boxes/vttC';\nexport * from '#/boxes/vvcC';\nexport * from '#/boxes/vvnC';\n\nexport * from '#/boxes/samplegroups/alst';\nexport * from '#/boxes/samplegroups/avll';\nexport * from '#/boxes/samplegroups/avss';\nexport * from '#/boxes/samplegroups/dtrt';\nexport * from '#/boxes/samplegroups/mvif';\nexport * from '#/boxes/samplegroups/prol';\nexport * from '#/boxes/samplegroups/rap';\nexport * from '#/boxes/samplegroups/rash';\nexport * from '#/boxes/samplegroups/roll';\nexport * from '#/boxes/samplegroups/scif';\nexport * from '#/boxes/samplegroups/scnm';\nexport * from '#/boxes/samplegroups/seig';\nexport * from '#/boxes/samplegroups/stsa';\nexport * from '#/boxes/samplegroups/sync';\nexport * from '#/boxes/samplegroups/tele';\nexport * from '#/boxes/samplegroups/tsas';\nexport * from '#/boxes/samplegroups/tscl';\nexport * from '#/boxes/samplegroups/vipr';\n\nexport * from '#/boxes/uuid';\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class a1lxBox extends Box {\n  static override readonly fourcc = 'a1lx' as const;\n  box_name = 'AV1LayeredImageIndexingProperty' as const;\n\n  layer_size: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    const large_size = stream.readUint8() & 1;\n    const FieldLength = ((large_size & 1) + 1) * 16;\n    this.layer_size = [];\n    for (let i = 0; i < 3; i++) {\n      if (FieldLength === 16) {\n        this.layer_size[i] = stream.readUint16();\n      } else {\n        this.layer_size[i] = stream.readUint32();\n      }\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class a1opBox extends Box {\n  static override readonly fourcc = 'a1op' as const;\n  box_name = 'OperatingPointSelectorProperty' as const;\n\n  op_index: number;\n\n  parse(stream: MultiBufferStream) {\n    this.op_index = stream.readUint8();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class auxCBox extends FullBox {\n  static override readonly fourcc = 'auxC' as const;\n  box_name = 'AuxiliaryTypeProperty' as const;\n\n  aux_type: string;\n  aux_subtype: Uint8Array;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.aux_type = stream.readCString();\n    const aux_subtype_length = this.size - this.hdr_size - (this.aux_type.length + 1);\n    this.aux_subtype = stream.readUint8Array(aux_subtype_length);\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class btrtBox extends Box {\n  static override readonly fourcc = 'btrt' as const;\n  box_name = 'BitRateBox' as const;\n\n  bufferSizeDB: number;\n  maxBitrate: number;\n  avgBitrate: number;\n\n  parse(stream: MultiBufferStream) {\n    this.bufferSizeDB = stream.readUint32();\n    this.maxBitrate = stream.readUint32();\n    this.avgBitrate = stream.readUint32();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class ccstBox extends FullBox {\n  static override readonly fourcc = 'ccst' as const;\n  box_name = 'CodingConstraintsBox' as const;\n\n  all_ref_pics_intra: boolean;\n  intra_pred_used: boolean;\n  max_ref_per_pic: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const flags = stream.readUint8();\n    this.all_ref_pics_intra = (flags & 0x80) === 0x80;\n    this.intra_pred_used = (flags & 0x40) === 0x40;\n    this.max_ref_per_pic = (flags & 0x3f) >> 2;\n    stream.readUint24();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class cdefBox extends Box {\n  static override readonly fourcc = 'cdef' as const;\n  box_name = 'ComponentDefinitionBox' as const;\n\n  channel_count: number;\n  channel_indexes: Array<number>;\n  channel_types: Array<number>;\n  channel_associations: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.channel_count = stream.readUint16();\n    this.channel_indexes = [];\n    this.channel_types = [];\n    this.channel_associations = [];\n    for (let i = 0; i < this.channel_count; i++) {\n      this.channel_indexes.push(stream.readUint16());\n      this.channel_types.push(stream.readUint16());\n      this.channel_associations.push(stream.readUint16());\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class clapBox extends Box {\n  static override readonly fourcc = 'clap' as const;\n  box_name = 'CleanApertureBox' as const;\n\n  cleanApertureWidthN: number;\n  cleanApertureWidthD: number;\n  cleanApertureHeightN: number;\n  cleanApertureHeightD: number;\n  horizOffN: number;\n  horizOffD: number;\n  vertOffN: number;\n  vertOffD: number;\n\n  parse(stream: MultiBufferStream) {\n    this.cleanApertureWidthN = stream.readUint32();\n    this.cleanApertureWidthD = stream.readUint32();\n    this.cleanApertureHeightN = stream.readUint32();\n    this.cleanApertureHeightD = stream.readUint32();\n    this.horizOffN = stream.readUint32();\n    this.horizOffD = stream.readUint32();\n    this.vertOffN = stream.readUint32();\n    this.vertOffD = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class clliBox extends Box {\n  static override readonly fourcc = 'clli' as const;\n  box_name = 'ContentLightLevelBox' as const;\n\n  max_content_light_level: number;\n  max_pic_average_light_level: number;\n\n  parse(stream: MultiBufferStream) {\n    this.max_content_light_level = stream.readUint16();\n    this.max_pic_average_light_level = stream.readUint16();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class cmexBox extends Box {\n  static override readonly fourcc = 'cmex' as const;\n  box_name = 'CameraExtrinsicMatrixProperty' as const;\n\n  flags: number;\n  pos_x: number;\n  pos_y: number;\n  pos_z: number;\n  version: number;\n  quat_x: number;\n  quat_y: number;\n  quat_z: number;\n  id: number;\n\n  parse(stream: MultiBufferStream) {\n    if (this.flags & 0x1) {\n      this.pos_x = stream.readInt32();\n    }\n    if (this.flags & 0x2) {\n      this.pos_y = stream.readInt32();\n    }\n    if (this.flags & 0x4) {\n      this.pos_z = stream.readInt32();\n    }\n    if (this.flags & 0x8) {\n      if (this.version === 0) {\n        if (this.flags & 0x10) {\n          this.quat_x = stream.readInt32();\n          this.quat_y = stream.readInt32();\n          this.quat_z = stream.readInt32();\n        } else {\n          this.quat_x = stream.readInt16();\n          this.quat_y = stream.readInt16();\n          this.quat_z = stream.readInt16();\n        }\n      } else if (this.version === 1) {\n        //ViewpointGlobalCoordinateSysRotationStruct rot;\n      }\n    }\n    if (this.flags & 0x20) {\n      this.id = stream.readUint32();\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class cminBox extends Box {\n  static override readonly fourcc = 'cmin' as const;\n  box_name = 'CameraIntrinsicMatrixProperty' as const;\n\n  focal_length_x: number;\n  principal_point_x: number;\n  principal_point_y: number;\n  flags: number;\n  focal_length_y: number;\n  skew_factor: number;\n\n  parse(stream: MultiBufferStream) {\n    this.focal_length_x = stream.readInt32();\n    this.principal_point_x = stream.readInt32();\n    this.principal_point_y = stream.readInt32();\n    if (this.flags & 0x1) {\n      this.focal_length_y = stream.readInt32();\n      this.skew_factor = stream.readInt32();\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class cmpdBox extends Box {\n  static override readonly fourcc = 'cmpd' as const;\n  box_name = 'ComponentDefinitionBox' as const;\n\n  component_count: number;\n  component_types: Array<number>;\n  component_type_urls: Array<string>;\n\n  parse(stream: MultiBufferStream) {\n    this.component_count = stream.readUint32();\n    this.component_types = [];\n    this.component_type_urls = [];\n    for (let i = 0; i < this.component_count; i++) {\n      const component_type = stream.readUint16();\n      this.component_types.push(component_type);\n      if (component_type >= 0x8000) {\n        this.component_type_urls.push(stream.readCString());\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class co64Box extends FullBox {\n  static override readonly fourcc = 'co64' as const;\n  box_name = 'ChunkLargeOffsetBox' as const;\n\n  chunk_offsets: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const entry_count = stream.readUint32();\n    this.chunk_offsets = [];\n    if (this.version === 0) {\n      for (let i = 0; i < entry_count; i++) {\n        this.chunk_offsets.push(stream.readUint64());\n      }\n    }\n  }\n\n  /** @bundle writing/co64.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 4 + 8 * this.chunk_offsets.length;\n    this.writeHeader(stream);\n    stream.writeUint32(this.chunk_offsets.length);\n    for (let i = 0; i < this.chunk_offsets.length; i++) {\n      stream.writeUint64(this.chunk_offsets[i]);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class CoLLBox extends FullBox {\n  static override readonly fourcc = 'CoLL' as const;\n  box_name = 'ContentLightLevelBox' as const;\n\n  maxCLL: number;\n  maxFALL: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.maxCLL = stream.readUint16();\n    this.maxFALL = stream.readUint16();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nclass SphereRegion {\n  centre_azimuth: number;\n  centre_elevation: number;\n  centre_tilt: number;\n  range_included_flag: boolean;\n  azimuth_range: number;\n  elevation_range: number;\n  interpolate_included_flag: boolean;\n  interpolate: boolean;\n\n  toString() {\n    let s = 'centre_azimuth: ';\n    s += this.centre_azimuth;\n    s += ' (';\n    s += this.centre_azimuth * 2 ** -16;\n    s += '), centre_elevation: ';\n    s += this.centre_elevation;\n    s += ' (';\n    s += this.centre_elevation * 2 ** -16;\n    s += '), centre_tilt: ';\n    s += this.centre_tilt;\n    s += ' (';\n    s += this.centre_tilt * 2 ** -16;\n    s += ')';\n    if (this.range_included_flag) {\n      s += ', azimuth_range: ';\n      s += this.azimuth_range;\n      s += ' (';\n      s += this.azimuth_range * 2 ** -16;\n      s += '), elevation_range: ';\n      s += this.elevation_range;\n      s += ' (';\n      s += this.elevation_range * 2 ** -16;\n      s += ')';\n    }\n    if (this.interpolate_included_flag) {\n      s += ', interpolate: ';\n      s += this.interpolate;\n    }\n    return s;\n  }\n}\n\nclass CoverageSphereRegion {\n  view_idc: number;\n  sphere_region: SphereRegion;\n\n  toString() {\n    let s = '';\n    if (this.view_idc) {\n      s += 'view_idc: ';\n      s += this.view_idc;\n      s += ', ';\n    }\n    s += 'sphere_region: {';\n    s += this.sphere_region;\n    s += '}';\n    return s;\n  }\n}\n\nexport class coviBox extends FullBox {\n  static override readonly fourcc = 'covi' as const;\n  box_name = 'CoverageInformationBox' as const;\n\n  coverage_shape_type: number;\n  default_view_idc: number;\n  coverage_regions: Array<CoverageSphereRegion>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.coverage_shape_type = stream.readUint8();\n    const num_regions = stream.readUint8();\n    const f = stream.readInt8();\n    const view_idc_presence_flag = f & 0x80;\n    if (view_idc_presence_flag) {\n      this.default_view_idc = (f & 0b01100000) >> 5;\n    }\n    this.coverage_regions = new Array<CoverageSphereRegion>();\n    for (let i = 0; i < num_regions; i++) {\n      const region = new CoverageSphereRegion();\n      if (view_idc_presence_flag) {\n        region.view_idc = stream.readUint8() >> 6;\n      }\n      region.sphere_region = this.parseSphereRegion(stream, true, true);\n      this.coverage_regions.push(region);\n    }\n  }\n\n  parseSphereRegion(\n    stream: MultiBufferStream,\n    range_included_flag: boolean,\n    interpolate_included_flag: boolean,\n  ) {\n    const sphere_region = new SphereRegion();\n    sphere_region.centre_azimuth = stream.readInt32();\n    sphere_region.centre_elevation = stream.readInt32();\n    sphere_region.centre_tilt = stream.readInt32();\n    sphere_region.range_included_flag = range_included_flag;\n    if (range_included_flag) {\n      sphere_region.azimuth_range = stream.readUint32();\n      sphere_region.elevation_range = stream.readUint32();\n    }\n    sphere_region.interpolate_included_flag = interpolate_included_flag;\n    if (interpolate_included_flag) {\n      sphere_region.interpolate = (stream.readUint8() & 0x80) === 0x80;\n    }\n    return sphere_region;\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class cprtBox extends FullBox {\n  static override readonly fourcc = 'cprt' as const;\n  box_name = 'CopyrightBox' as const;\n\n  notice: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.parseLanguage(stream);\n    this.notice = stream.readCString();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class cschBox extends FullBox {\n  static override readonly fourcc = 'csch' as const;\n  box_name = 'CompatibleSchemeTypeBox' as const;\n\n  scheme_type: string;\n  scheme_version: number;\n  scheme_uri: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.scheme_type = stream.readString(4);\n    this.scheme_version = stream.readUint32();\n    if (this.flags & 0x000001) {\n      this.scheme_uri = stream.readCString();\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nconst INT32_MAX = 2_147_483_647;\n\nexport class cslgBox extends FullBox {\n  static override readonly fourcc = 'cslg' as const;\n  box_name = 'CompositionToDecodeBox' as const;\n\n  compositionToDTSShift: number;\n  leastDecodeToDisplayDelta: number;\n  greatestDecodeToDisplayDelta: number;\n  compositionStartTime: number;\n  compositionEndTime: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 0) {\n      this.compositionToDTSShift = stream.readInt32(); /* signed */\n      this.leastDecodeToDisplayDelta = stream.readInt32(); /* signed */\n      this.greatestDecodeToDisplayDelta = stream.readInt32(); /* signed */\n      this.compositionStartTime = stream.readInt32(); /* signed */\n      this.compositionEndTime = stream.readInt32(); /* signed */\n    } else if (this.version === 1) {\n      this.compositionToDTSShift = stream.readInt64(); /* signed */\n      this.leastDecodeToDisplayDelta = stream.readInt64(); /* signed */\n      this.greatestDecodeToDisplayDelta = stream.readInt64(); /* signed */\n      this.compositionStartTime = stream.readInt64(); /* signed */\n      this.compositionEndTime = stream.readInt64(); /* signed */\n    }\n  }\n\n  /** @bundle writing/cslg.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    if (\n      this.compositionToDTSShift > INT32_MAX ||\n      this.leastDecodeToDisplayDelta > INT32_MAX ||\n      this.greatestDecodeToDisplayDelta > INT32_MAX ||\n      this.compositionStartTime > INT32_MAX ||\n      this.compositionEndTime > INT32_MAX\n    ) {\n      this.version = 1;\n    }\n    this.flags = 0;\n    if (this.version === 0) {\n      this.size = 4 * 5;\n      this.writeHeader(stream);\n      stream.writeInt32(this.compositionToDTSShift);\n      stream.writeInt32(this.leastDecodeToDisplayDelta);\n      stream.writeInt32(this.greatestDecodeToDisplayDelta);\n      stream.writeInt32(this.compositionStartTime);\n      stream.writeInt32(this.compositionEndTime);\n    } else if (this.version === 1) {\n      this.size = 8 * 5;\n      this.writeHeader(stream);\n      stream.writeInt64(this.compositionToDTSShift);\n      stream.writeInt64(this.leastDecodeToDisplayDelta);\n      stream.writeInt64(this.greatestDecodeToDisplayDelta);\n      stream.writeInt64(this.compositionStartTime);\n      stream.writeInt64(this.compositionEndTime);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\nimport type { Sample } from '@types';\n\nexport class cttsBox extends FullBox {\n  static override readonly fourcc = 'ctts' as const;\n  box_name = 'CompositionOffsetBox' as const;\n\n  sample_counts: Array<number>;\n  sample_offsets: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const entry_count = stream.readUint32();\n    this.sample_counts = [];\n    this.sample_offsets = [];\n    if (this.version === 0) {\n      for (let i = 0; i < entry_count; i++) {\n        this.sample_counts.push(stream.readUint32());\n        /* some files are buggy and declare version=0 while using signed offsets.\n           The likelyhood of using the most significant bit in a 32-bits time offset is very low,\n           so using signed value here as well */\n        const value = stream.readInt32();\n        if (value < 0) {\n          Log.warn('BoxParser', 'ctts box uses negative values without using version 1');\n        }\n        this.sample_offsets.push(value);\n      }\n    } else if (this.version === 1) {\n      for (let i = 0; i < entry_count; i++) {\n        this.sample_counts.push(stream.readUint32());\n        this.sample_offsets.push(stream.readInt32()); /* signed */\n      }\n    }\n  }\n\n  /** @bundle writing/ctts.js */\n  write(stream: MultiBufferStream) {\n    this.version = this.sample_offsets.some(offset => offset < 0) ? 1 : 0;\n    this.flags = 0;\n    this.size = 4 + 8 * this.sample_counts.length;\n    this.writeHeader(stream);\n    stream.writeUint32(this.sample_counts.length);\n    for (let i = 0; i < this.sample_counts.length; i++) {\n      stream.writeUint32(this.sample_counts[i]);\n      if (this.version === 1) {\n        stream.writeInt32(this.sample_offsets[i]); /* signed */\n      } else {\n        stream.writeUint32(this.sample_offsets[i]); /* unsigned */\n      }\n    }\n  }\n\n  /** @bundle box-unpack.js */\n  unpack(samples: Array<Sample>) {\n    let k = 0;\n    for (let i = 0; i < this.sample_counts.length; i++) {\n      for (let j = 0; j < this.sample_counts[i]; j++) {\n        samples[k].pts = samples[k].dts + this.sample_offsets[i];\n        k++;\n      }\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class dac3Box extends Box {\n  static override readonly fourcc = 'dac3' as const;\n  box_name = 'AC3SpecificBox' as const;\n\n  fscod: number;\n  bsid: number;\n  bsmod: number;\n  acmod: number;\n  lfeon: number;\n  bit_rate_code: number;\n\n  parse(stream: MultiBufferStream) {\n    const tmp_byte1 = stream.readUint8();\n    const tmp_byte2 = stream.readUint8();\n    const tmp_byte3 = stream.readUint8();\n    this.fscod = tmp_byte1 >> 6;\n    this.bsid = (tmp_byte1 >> 1) & 0x1f;\n    this.bsmod = ((tmp_byte1 & 0x1) << 2) | ((tmp_byte2 >> 6) & 0x3);\n    this.acmod = (tmp_byte2 >> 3) & 0x7;\n    this.lfeon = (tmp_byte2 >> 2) & 0x1;\n    this.bit_rate_code = (tmp_byte2 & 0x3) | ((tmp_byte3 >> 5) & 0x7);\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\ninterface IndSub {\n  fscod: number;\n  bsid: number;\n  bsmod: number;\n  acmod: number;\n  lfeon: number;\n  num_dep_sub: number;\n  chan_loc?: number;\n}\n\nexport class dec3Box extends Box {\n  static override readonly fourcc = 'dec3' as const;\n  box_name = 'EC3SpecificBox' as const;\n\n  data_rate: number;\n  num_ind_sub: number;\n  ind_subs: Array<IndSub>;\n\n  parse(stream: MultiBufferStream) {\n    const tmp_16 = stream.readUint16();\n    this.data_rate = tmp_16 >> 3;\n    this.num_ind_sub = tmp_16 & 0x7;\n    this.ind_subs = [];\n    for (let i = 0; i < this.num_ind_sub + 1; i++) {\n      const tmp_byte1 = stream.readUint8();\n      const tmp_byte2 = stream.readUint8();\n      const tmp_byte3 = stream.readUint8();\n      const ind_sub: IndSub = {\n        fscod: tmp_byte1 >> 6,\n        bsid: (tmp_byte1 >> 1) & 0x1f,\n        bsmod: ((tmp_byte1 & 0x1) << 4) | ((tmp_byte2 >> 4) & 0xf),\n        acmod: (tmp_byte2 >> 1) & 0x7,\n        lfeon: tmp_byte2 & 0x1,\n        num_dep_sub: (tmp_byte3 >> 1) & 0xf,\n      };\n      this.ind_subs.push(ind_sub);\n      if (ind_sub.num_dep_sub > 0) {\n        ind_sub.chan_loc = ((tmp_byte3 & 0x1) << 8) | stream.readUint8();\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class dfLaBox extends FullBox {\n  static override readonly fourcc = 'dfLa' as const;\n  box_name = 'FLACSpecificBox' as const;\n\n  samplerate: number;\n  numMetadataBlocks: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const BLOCKTYPE_MASK = 0x7f;\n    const LASTMETADATABLOCKFLAG_MASK = 0x80;\n\n    const boxesFound = [];\n    const knownBlockTypes = [\n      'STREAMINFO',\n      'PADDING',\n      'APPLICATION',\n      'SEEKTABLE',\n      'VORBIS_COMMENT',\n      'CUESHEET',\n      'PICTURE',\n      'RESERVED',\n    ];\n\n    let flagAndType: number;\n    do {\n      flagAndType = stream.readUint8();\n      const type = Math.min(flagAndType & BLOCKTYPE_MASK, knownBlockTypes.length - 1);\n\n      // if this is a STREAMINFO block, read the true samplerate since this\n      // can be different to the AudioSampleEntry samplerate.\n      if (!type) {\n        // read past all the other stuff\n        stream.readUint8Array(13);\n\n        // extract samplerate\n        this.samplerate = stream.readUint32() >> 12;\n\n        // read to end of STREAMINFO\n        stream.readUint8Array(20);\n      } else {\n        // not interested in other block types so just discard length bytes\n        stream.readUint8Array(stream.readUint24());\n      }\n\n      boxesFound.push(knownBlockTypes[type]);\n    } while (flagAndType & LASTMETADATABLOCKFLAG_MASK);\n\n    this.numMetadataBlocks = boxesFound.length + ' (' + boxesFound.join(', ') + ')';\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class dimmBox extends Box {\n  static override readonly fourcc = 'dimm' as const;\n  box_name = 'hintimmediateBytesSent' as const;\n\n  bytessent: number;\n\n  parse(stream: MultiBufferStream) {\n    this.bytessent = stream.readUint64();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class dmax extends Box {\n  static override readonly fourcc = 'dmax' as const;\n  box_name = 'hintlongestpacket' as const;\n\n  time: number;\n\n  parse(stream: MultiBufferStream) {\n    this.time = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class dmedBox extends Box {\n  static override readonly fourcc = 'dmed' as const;\n  box_name = 'hintmediaBytesSent' as const;\n\n  bytessent: number;\n\n  parse(stream: MultiBufferStream) {\n    this.bytessent = stream.readUint64();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class dOpsBox extends Box {\n  static override readonly fourcc = 'dOps' as const;\n  box_name = 'OpusSpecificBox' as const;\n\n  Version: number;\n  OutputChannelCount: number;\n  PreSkip: number;\n  InputSampleRate: number;\n  OutputGain: number;\n  ChannelMappingFamily: number;\n  StreamCount: number;\n  CoupledCount: number;\n  ChannelMapping: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.Version = stream.readUint8();\n    this.OutputChannelCount = stream.readUint8();\n    this.PreSkip = stream.readUint16();\n    this.InputSampleRate = stream.readUint32();\n    this.OutputGain = stream.readInt16();\n    this.ChannelMappingFamily = stream.readUint8();\n    if (this.ChannelMappingFamily !== 0) {\n      this.StreamCount = stream.readUint8();\n      this.CoupledCount = stream.readUint8();\n      this.ChannelMapping = [];\n      for (let i = 0; i < this.OutputChannelCount; i++) {\n        this.ChannelMapping[i] = stream.readUint8();\n      }\n    }\n  }\n\n  write(stream: MultiBufferStream) {\n    this.size = 11; // Version(1) + OutputChannelCount(1) + PreSkip(2) + InputSampleRate(4) + OutputGain(2) + ChannelMappingFamily(1)\n    if (this.ChannelMappingFamily !== 0) {\n      // Add StreamCount(1) + CoupledCount(1) + ChannelMapping array\n      this.size += 2 + this.OutputChannelCount;\n    }\n\n    this.writeHeader(stream);\n    stream.writeUint8(this.Version);\n    stream.writeUint8(this.OutputChannelCount);\n    stream.writeUint16(this.PreSkip);\n    stream.writeUint32(this.InputSampleRate);\n    stream.writeInt16(this.OutputGain);\n    stream.writeUint8(this.ChannelMappingFamily);\n    if (this.ChannelMappingFamily !== 0) {\n      stream.writeUint8(this.StreamCount);\n      stream.writeUint8(this.CoupledCount);\n      for (let i = 0; i < this.OutputChannelCount; i++) {\n        stream.writeUint8(this.ChannelMapping[i]);\n      }\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class drepBox extends Box {\n  static override readonly fourcc = 'drep' as const;\n  box_name = 'hintrepeatedBytesSent' as const;\n\n  bytessent: number;\n\n  parse(stream: MultiBufferStream) {\n    this.bytessent = stream.readUint64();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport type { Entry } from '@types';\nimport { MAX_UINT32 } from '#/constants';\n\nexport class elstBox extends FullBox {\n  static override readonly fourcc = 'elst' as const;\n  box_name = 'EditListBox' as const;\n\n  entries: Array<Entry>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.entries = [];\n    const entry_count = stream.readUint32();\n    for (let i = 0; i < entry_count; i++) {\n      const entry: Entry = {\n        segment_duration: this.version === 1 ? stream.readUint64() : stream.readUint32(),\n        media_time: this.version === 1 ? stream.readInt64() : stream.readInt32(),\n        media_rate_integer: stream.readInt16(),\n        media_rate_fraction: stream.readInt16(),\n      };\n      this.entries.push(entry);\n    }\n  }\n\n  /** @bundle writing/elst.js */\n  write(stream: MultiBufferStream) {\n    const useVersion1 =\n      this.entries.some(\n        entry => entry.segment_duration > MAX_UINT32 || entry.media_time > MAX_UINT32,\n      ) || this.version === 1;\n    this.version = useVersion1 ? 1 : 0;\n\n    this.size = 4 + 12 * this.entries.length;\n    this.size += useVersion1 ? 2 * 4 * this.entries.length : 0;\n\n    this.writeHeader(stream);\n    stream.writeUint32(this.entries.length);\n    for (let i = 0; i < this.entries.length; i++) {\n      const entry = this.entries[i];\n      if (useVersion1) {\n        stream.writeUint64(entry.segment_duration);\n        stream.writeInt64(entry.media_time);\n      } else {\n        stream.writeUint32(entry.segment_duration);\n        stream.writeInt32(entry.media_time);\n      }\n      stream.writeInt16(entry.media_rate_integer);\n      stream.writeInt16(entry.media_rate_fraction);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class emsgBox extends FullBox {\n  static override readonly fourcc = 'emsg' as const;\n  box_name = 'EventMessageBox' as const;\n\n  timescale: number;\n  presentation_time: number;\n  event_duration: number;\n  id: number;\n  scheme_id_uri: string;\n  value: string;\n  presentation_time_delta: number;\n  message_data: Uint8Array;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.version === 1) {\n      this.timescale = stream.readUint32();\n      this.presentation_time = stream.readUint64();\n      this.event_duration = stream.readUint32();\n      this.id = stream.readUint32();\n      this.scheme_id_uri = stream.readCString();\n      this.value = stream.readCString();\n    } else {\n      this.scheme_id_uri = stream.readCString();\n      this.value = stream.readCString();\n      this.timescale = stream.readUint32();\n      this.presentation_time_delta = stream.readUint32();\n      this.event_duration = stream.readUint32();\n      this.id = stream.readUint32();\n    }\n    let message_size =\n      this.size -\n      this.hdr_size -\n      (4 * 4 + (this.scheme_id_uri.length + 1) + (this.value.length + 1));\n    if (this.version === 1) {\n      message_size -= 4;\n    }\n    this.message_data = stream.readUint8Array(message_size);\n  }\n\n  /** @bundle writing/emsg.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size =\n      4 * 4 + this.message_data.length + (this.scheme_id_uri.length + 1) + (this.value.length + 1);\n    this.writeHeader(stream);\n    stream.writeCString(this.scheme_id_uri);\n    stream.writeCString(this.value);\n    stream.writeUint32(this.timescale);\n    stream.writeUint32(this.presentation_time_delta);\n    stream.writeUint32(this.event_duration);\n    stream.writeUint32(this.id);\n    stream.writeUint8Array(this.message_data);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\n// ISO/IEC 14496-12:2022 Section 8.18.3 Entity to group box\nexport class EntityToGroup extends FullBox {\n  group_id: number;\n  num_entities_in_group: number;\n  entity_ids: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.group_id = stream.readUint32();\n    this.num_entities_in_group = stream.readUint32();\n    this.entity_ids = [];\n    for (let i = 0; i < this.num_entities_in_group; i++) {\n      const entity_id = stream.readUint32();\n      this.entity_ids.push(entity_id);\n    }\n  }\n}\n","import type { MultiBufferStream } from '#/buffer';\nimport { EntityToGroup } from './base';\n\n// Auto exposure bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.2.1)\nexport class aebrBox extends EntityToGroup {\n  static override readonly fourcc = 'aebr' as const;\n  box_name = 'Auto exposure bracketing' as const;\n}\n\n// Flash exposure bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.5.1)\nexport class afbrBox extends EntityToGroup {\n  static override readonly fourcc = 'afbr' as const;\n  box_name = 'Flash exposure information' as const;\n}\n\n// Album collection (ISO/IEC 23008-12:2022 Section 6.8.7.1)\nexport class albcBox extends EntityToGroup {\n  static override readonly fourcc = 'albc' as const;\n  box_name = 'Album collection' as const;\n}\n\n// Alternative entity (ISO/IEC 14496-12:2022 Section 8.18.3.1)\nexport class altrBox extends EntityToGroup {\n  static override readonly fourcc = 'altr' as const;\n  box_name = 'Alternative entity' as const;\n}\n\n// Burst image entity group (ISO/IEC 23008-12:2022 Section 6.8.2.2)\nexport class brstBox extends EntityToGroup {\n  static override readonly fourcc = 'brst' as const;\n  box_name = 'Burst image' as const;\n}\n\n// Depth of field bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.6.1)\nexport class dobrBox extends EntityToGroup {\n  static override readonly fourcc = 'dobr' as const;\n  box_name = 'Depth of field bracketing' as const;\n}\n\n// Equivalent entity (ISO/IEC 23008-12:2022 Section 6.8.1.1)\nexport class eqivBox extends EntityToGroup {\n  static override readonly fourcc = 'eqiv' as const;\n  box_name = 'Equivalent entity' as const;\n}\n\n// Favourites collection (ISO/IEC 23008-12:2022 Section 6.8.7.2)\nexport class favcBox extends EntityToGroup {\n  static override readonly fourcc = 'favc' as const;\n  box_name = 'Favorites collection' as const;\n}\n\n// Focus bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.4.1)\nexport class fobrBox extends EntityToGroup {\n  static override readonly fourcc = 'fobr' as const;\n  box_name = 'Focus bracketing' as const;\n}\n\n// Audio to image entity group (ISO/IEC 23008-12:2022 Section 6.8.4)\nexport class iaugBox extends EntityToGroup {\n  static override readonly fourcc = 'iaug' as const;\n  box_name = 'Image item with an audio track' as const;\n}\n\n// Panorama (ISO/IEC 23008-12:2022 Section 6.8.8.1)\nexport class panoBox extends EntityToGroup {\n  static override readonly fourcc = 'pano' as const;\n  box_name = 'Panorama' as const;\n}\n\n// Slideshow (ISO/IEC 23008-12:2022 Section 6.8.9.1)\nexport class slidBox extends EntityToGroup {\n  static override readonly fourcc = 'slid' as const;\n  box_name = 'Slideshow' as const;\n}\n\n// Stereo pair (ISO/IEC 23008-12:2022 Section 6.8.5)\nexport class sterBox extends EntityToGroup {\n  static override readonly fourcc = 'ster' as const;\n  box_name = 'Stereo' as const;\n}\n\n// Time-synchronised capture entity group (ISO/IEC 23008-12:2022 Section 6.8.3)\nexport class tsynBox extends EntityToGroup {\n  static override readonly fourcc = 'tsyn' as const;\n  box_name = 'Time-synchronized capture' as const;\n}\n\n// White balance bracketing (ISO/IEC 23008-12:2022 Section 6.8.6.3.1)\nexport class wbbrBox extends EntityToGroup {\n  static override readonly fourcc = 'wbbr' as const;\n  box_name = 'White balance bracketing' as const;\n}\n\n// Alternative entity (ISO/IEC 23008-12:2022 AMD1 Section 6.8.10)\nexport class prgrBox extends EntityToGroup {\n  static override readonly fourcc = 'prgr' as const;\n  box_name = 'Progressive rendering' as const;\n}\n\n// Image Pyramid entity group (ISO/IEC 23008-12:20xx Section 6.8.11)\nexport class pymdBox extends EntityToGroup {\n  tile_size_x: number;\n  tile_size_y: number;\n  layer_binning: Array<number>;\n  tiles_in_layer_column_minus1: Array<number>;\n  tiles_in_layer_row_minus1: Array<number>;\n\n  static override readonly fourcc = 'pymd' as const;\n  box_name = 'Image pyramid' as const;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.group_id = stream.readUint32();\n    this.num_entities_in_group = stream.readUint32();\n    this.entity_ids = [];\n    for (let i = 0; i < this.num_entities_in_group; i++) {\n      const entity_id = stream.readUint32();\n      this.entity_ids.push(entity_id);\n    }\n\n    this.tile_size_x = stream.readUint16();\n    this.tile_size_y = stream.readUint16();\n    this.layer_binning = [];\n    this.tiles_in_layer_column_minus1 = [];\n    this.tiles_in_layer_row_minus1 = [];\n    for (let i = 0; i < this.num_entities_in_group; i++) {\n      this.layer_binning[i] = stream.readUint16();\n      this.tiles_in_layer_row_minus1[i] = stream.readUint16();\n      this.tiles_in_layer_column_minus1[i] = stream.readUint16();\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class fielBox extends Box {\n  static override readonly fourcc = 'fiel' as const;\n  box_name = 'FieldHandlingBox' as const;\n\n  fieldCount: number;\n  fieldOrdering: number;\n\n  parse(stream: MultiBufferStream) {\n    this.fieldCount = stream.readUint8();\n    this.fieldOrdering = stream.readUint8();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class frmaBox extends Box {\n  static override readonly fourcc = 'frma' as const;\n  box_name = 'OriginalFormatBox' as const;\n\n  data_format: string;\n\n  parse(stream: MultiBufferStream) {\n    this.data_format = stream.readString(4);\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class imirBox extends Box {\n  static override readonly fourcc = 'imir' as const;\n  box_name = 'ImageMirror' as const;\n\n  reserved: number;\n  axis: number;\n\n  parse(stream: MultiBufferStream) {\n    const tmp = stream.readUint8();\n    this.reserved = tmp >> 7;\n    this.axis = tmp & 1;\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport interface Assocation {\n  id: number;\n  props: Array<{ property_index: number; essential: boolean }>;\n}\n\nexport class ipmaBox extends FullBox {\n  static override readonly fourcc = 'ipma' as const;\n  box_name = 'ItemPropertyAssociationBox' as const;\n\n  associations: Array<Assocation>;\n  version: number;\n  flags: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const entry_count = stream.readUint32();\n    this.associations = [];\n    for (let i = 0; i < entry_count; i++) {\n      const id = this.version < 1 ? stream.readUint16() : stream.readUint32();\n\n      const props = [];\n      const association_count = stream.readUint8();\n\n      for (let j = 0; j < association_count; j++) {\n        const tmp = stream.readUint8();\n        props.push({\n          essential: (tmp & 0x80) >> 7 === 1,\n          property_index: this.flags & 0x1 ? ((tmp & 0x7f) << 8) | stream.readUint8() : tmp & 0x7f,\n        });\n      }\n\n      this.associations.push({\n        id,\n        props,\n      });\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class irotBox extends Box {\n  static override readonly fourcc = 'irot' as const;\n  box_name = 'ImageRotation' as const;\n\n  angle: number;\n\n  parse(stream: MultiBufferStream) {\n    this.angle = stream.readUint8() & 0x3;\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class ispeBox extends FullBox {\n  static override readonly fourcc = 'ispe' as const;\n  box_name = 'ImageSpatialExtentsProperty' as const;\n\n  image_width: number;\n  image_height: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.image_width = stream.readUint32();\n    this.image_height = stream.readUint32();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class itaiBox extends FullBox {\n  static override readonly fourcc = 'itai' as const;\n  box_name = 'TAITimestampBox' as const;\n\n  TAI_timestamp: number;\n  sychronization_state: number;\n  timestamp_generation_failure: number;\n  timestamp_is_modified: number;\n\n  parse(stream: MultiBufferStream) {\n    this.TAI_timestamp = stream.readUint64();\n    const status_bits = stream.readUint8();\n    this.sychronization_state = (status_bits >> 7) & 0x01;\n    this.timestamp_generation_failure = (status_bits >> 6) & 0x01;\n    this.timestamp_is_modified = (status_bits >> 5) & 0x01;\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class kindBox extends FullBox {\n  static override readonly fourcc = 'kind' as const;\n  box_name = 'KindBox' as const;\n\n  schemeURI: string;\n  value: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.schemeURI = stream.readCString();\n    if (!this.isEndOfBox(stream)) {\n      this.value = stream.readCString();\n    }\n  }\n\n  /** @bundle writing/kind.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = this.schemeURI.length + 1 + (this.value ? this.value.length + 1 : 0);\n    this.writeHeader(stream);\n    stream.writeCString(this.schemeURI);\n    if (this.value) stream.writeCString(this.value);\n  }\n}\n","import { Log } from '#//log';\nimport { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\ninterface Level {\n  padding_flag: number;\n  track_ID: number;\n  assignment_type: number;\n  grouping_type: string;\n  grouping_type_parameter: number;\n  sub_track_id: number;\n}\n\nexport class levaBox extends FullBox {\n  static override readonly fourcc = 'leva' as const;\n  box_name = 'LevelAssignmentBox' as const;\n\n  levels: Array<Level>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const count = stream.readUint8();\n    this.levels = [];\n    for (let i = 0; i < count; i++) {\n      const level = {} as Level;\n      this.levels[i] = level;\n      level.track_ID = stream.readUint32();\n      const tmp_byte = stream.readUint8();\n      level.padding_flag = tmp_byte >> 7;\n      level.assignment_type = tmp_byte & 0x7f;\n      switch (level.assignment_type) {\n        case 0:\n          level.grouping_type = stream.readString(4);\n          break;\n        case 1:\n          level.grouping_type = stream.readString(4);\n          level.grouping_type_parameter = stream.readUint32();\n          break;\n        case 2:\n          break;\n        case 3:\n          break;\n        case 4:\n          level.sub_track_id = stream.readUint32();\n          break;\n        default:\n          Log.warn('BoxParser', `Unknown level assignment type: ${level.assignment_type}`);\n      }\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport type { NaluArray } from '@types';\nimport type { NALUArrays } from './displays/naluArrays';\n\nexport class lhvCBox extends Box {\n  static override readonly fourcc = 'lhvC' as const;\n  box_name = 'LHEVCConfigurationBox' as const;\n\n  configurationVersion: number;\n  min_spatial_segmentation_idc: number;\n  parallelismType: number;\n  numTemporalLayers: number;\n  temporalIdNested: number;\n  lengthSizeMinusOne: number;\n  nalu_arrays: NALUArrays;\n\n  parse(stream: MultiBufferStream) {\n    this.configurationVersion = stream.readUint8();\n    this.min_spatial_segmentation_idc = stream.readUint16() & 0xfff;\n    this.parallelismType = stream.readUint8() & 0x3;\n    let tmp_byte = stream.readUint8();\n    this.numTemporalLayers = (tmp_byte & 0xd) >> 3;\n    this.temporalIdNested = (tmp_byte & 0x4) >> 2;\n    this.lengthSizeMinusOne = tmp_byte & 0x3;\n\n    this.nalu_arrays = [];\n    const numOfArrays = stream.readUint8();\n\n    for (let i = 0; i < numOfArrays; i++) {\n      const nalu_array = [] as NaluArray;\n      this.nalu_arrays.push(nalu_array);\n      tmp_byte = stream.readUint8();\n      nalu_array.completeness = (tmp_byte & 0x80) >> 7;\n      nalu_array.nalu_type = tmp_byte & 0x3f;\n      const numNalus = stream.readUint16();\n      for (let j = 0; j < numNalus; j++) {\n        const length = stream.readUint16();\n        nalu_array.push({ data: stream.readUint8Array(length) });\n      }\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class lselBox extends Box {\n  static override readonly fourcc = 'lsel' as const;\n  box_name = 'LayerSelectorProperty' as const;\n\n  layer_id: number;\n\n  parse(stream: MultiBufferStream) {\n    this.layer_id = stream.readUint16();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class maxrBox extends Box {\n  static override readonly fourcc = 'maxr' as const;\n  box_name = 'hintmaxrate' as const;\n\n  period: number;\n  bytes: number;\n\n  parse(stream: MultiBufferStream) {\n    this.period = stream.readUint32();\n    this.bytes = stream.readUint32();\n  }\n}\n","export class ColorPoint {\n  constructor(\n    public x: number,\n    public y: number,\n  ) {}\n  toString() {\n    return '(' + this.x + ',' + this.y + ')';\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { ColorPoint } from './displays/colorPoint';\n\nexport class mdcvBox extends Box {\n  static override readonly fourcc = 'mdcv' as const;\n  box_name = 'MasteringDisplayColourVolumeBox' as const;\n\n  display_primaries: Array<ColorPoint>;\n  white_point: ColorPoint;\n  max_display_mastering_luminance: number;\n  min_display_mastering_luminance: number;\n\n  parse(stream: MultiBufferStream) {\n    this.display_primaries = [];\n    this.display_primaries[0] = new ColorPoint(stream.readUint16(), stream.readUint16());\n    this.display_primaries[1] = new ColorPoint(stream.readUint16(), stream.readUint16());\n    this.display_primaries[2] = new ColorPoint(stream.readUint16(), stream.readUint16());\n    this.white_point = new ColorPoint(stream.readUint16(), stream.readUint16());\n    this.max_display_mastering_luminance = stream.readUint32();\n    this.min_display_mastering_luminance = stream.readUint32();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class mfroBox extends FullBox {\n  static override readonly fourcc = 'mfro' as const;\n  box_name = 'MovieFragmentRandomAccessOffsetBox' as const;\n\n  _size: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this._size = stream.readUint32();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class mskCBox extends FullBox {\n  static override readonly fourcc = 'mskC' as const;\n  box_name = 'MaskConfigurationProperty' as const;\n\n  bits_per_pixel: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.bits_per_pixel = stream.readUint8();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class npckBox extends Box {\n  static override readonly fourcc = 'npck' as const;\n  box_name = 'hintPacketsSent' as const;\n\n  packetssent: number;\n\n  parse(stream: MultiBufferStream) {\n    this.packetssent = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class numpBox extends Box {\n  static override readonly fourcc = 'nump' as const;\n  box_name = 'hintPacketsSent' as const;\n\n  packetssent: number;\n\n  parse(stream: MultiBufferStream) {\n    this.packetssent = stream.readUint64();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nclass PaddingBit {\n  constructor(\n    public pad1: number,\n    public pad2: number,\n  ) {}\n}\n\nexport class padbBox extends FullBox {\n  static override readonly fourcc = 'padb' as const;\n  box_name = 'PaddingBitsBox' as const;\n\n  padbits: Array<PaddingBit>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const sample_count = stream.readUint32();\n    this.padbits = [];\n    for (let i = 0; i < Math.floor((sample_count + 1) / 2); i++) {\n      const bits = stream.readUint8();\n      const pad1 = (bits & 0x70) >> 4; // 5,6,7 bits\n      const pad2 = bits & 0x07; // 0,1,2 bits\n      this.padbits.push(new PaddingBit(pad1, pad2));\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class paspBox extends Box {\n  static override readonly fourcc = 'pasp' as const;\n  box_name = 'PixelAspectRatioBox' as const;\n\n  hSpacing: number;\n  vSpacing: number;\n\n  parse(stream: MultiBufferStream) {\n    this.hSpacing = stream.readUint32();\n    this.vSpacing = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class paylBox extends Box {\n  static override readonly fourcc = 'payl' as const;\n  box_name = 'CuePayloadBox' as const;\n\n  text: string;\n\n  parse(stream: MultiBufferStream) {\n    this.text = stream.readString(this.size - this.hdr_size);\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class paytBox extends Box {\n  static override readonly fourcc = 'payt' as const;\n  box_name = 'hintpayloadID' as const;\n\n  payloadID: number;\n  rtpmap_string: string;\n\n  parse(stream: MultiBufferStream) {\n    this.payloadID = stream.readUint32();\n    const count = stream.readUint8();\n    this.rtpmap_string = stream.readString(count);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class pdinBox extends FullBox {\n  static override readonly fourcc = 'pdin' as const;\n  box_name = 'ProgressiveDownloadInfoBox' as const;\n\n  rate: Array<number> = [];\n  initial_delay: Array<number> = [];\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const count = (this.size - this.hdr_size) / 8;\n    for (let i = 0; i < count; i++) {\n      this.rate[i] = stream.readUint32();\n      this.initial_delay[i] = stream.readUint32();\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class pixiBox extends FullBox {\n  static override readonly fourcc = 'pixi' as const;\n  box_name = 'PixelInformationProperty' as const;\n\n  num_channels: number;\n  bits_per_channels: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.num_channels = stream.readUint8();\n    this.bits_per_channels = [];\n    for (let i = 0; i < this.num_channels; i++) {\n      this.bits_per_channels[i] = stream.readUint8();\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class pmaxBox extends Box {\n  static override readonly fourcc = 'pmax' as const;\n  box_name = 'hintlargestpacket' as const;\n\n  bytes: number;\n\n  parse(stream: MultiBufferStream) {\n    this.bytes = stream.readUint32();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class prdiBox extends FullBox {\n  static override readonly fourcc = 'prdi' as const;\n  box_name = 'ProgressiveDerivedImageItemInformationProperty' as const;\n\n  step_count: number;\n  item_count: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.step_count = stream.readUint16();\n    this.item_count = [];\n    if (this.flags & 0x2) {\n      for (let i = 0; i < this.step_count; i++) {\n        this.item_count[i] = stream.readUint16();\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class prfrBox extends FullBox {\n  static override readonly fourcc = 'prfr' as const;\n  box_name = 'ProjectionFormatBox' as const;\n\n  projection_type: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.projection_type = stream.readUint8() & 0b00011111;\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class prftBox extends FullBox {\n  static override readonly fourcc = 'prft' as const;\n  box_name = 'ProducerReferenceTimeBox' as const;\n\n  ref_track_id: number;\n  ntp_timestamp: number;\n  media_time: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.ref_track_id = stream.readUint32();\n    this.ntp_timestamp = stream.readUint64();\n    if (this.version === 0) {\n      this.media_time = stream.readUint32();\n    } else {\n      this.media_time = stream.readUint64();\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport { parseHex16 } from '#/parser';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class psshBox extends FullBox {\n  static override readonly fourcc = 'pssh' as const;\n  box_name = 'ProtectionSystemSpecificHeaderBox' as const;\n\n  system_id: string;\n  kid: Array<string>;\n  protection_data?: Uint8Array;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.system_id = parseHex16(stream);\n\n    this.kid = [];\n    if (this.version > 0) {\n      const count = stream.readUint32();\n      for (let i = 0; i < count; i++) {\n        this.kid[i] = parseHex16(stream);\n      }\n    }\n\n    const datasize = stream.readUint32();\n    if (datasize > 0) {\n      this.protection_data = stream.readUint8Array(datasize);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class clefBox extends FullBox {\n  static override readonly fourcc = 'clef' as const;\n  box_name = 'TrackCleanApertureDimensionsBox' as const;\n\n  width: number;\n  height: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.width = stream.readUint32();\n    this.height = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport { Log } from '#/log';\nimport type { MultiBufferStream } from '#/buffer';\n\n/*\n * Parses the types above. Only implement the ones we actually\n * have real world test data for. Add a test case, as you implement them.\n */\nfunction parseItifData(type, data) {\n  if (type === dataBox.Types.UTF8) {\n    return new TextDecoder('utf-8').decode(data);\n  }\n\n  const view = new DataView(data.buffer);\n  if (type === dataBox.Types.BE_UNSIGNED_INT) {\n    if (data.length === 1) {\n      return view.getUint8(0);\n    } else if (data.length === 2) {\n      return view.getUint16(0, false);\n    } else if (data.length === 4) {\n      return view.getUint32(0, false);\n    } else if (data.length === 8) {\n      return view.getBigUint64(0, false);\n    } else {\n      throw new Error('Unsupported ITIF_TYPE_BE_UNSIGNED_INT length ' + data.length);\n    }\n  } else if (type === dataBox.Types.BE_SIGNED_INT) {\n    if (data.length === 1) {\n      return view.getInt8(0);\n    } else if (data.length === 2) {\n      return view.getInt16(0, false);\n    } else if (data.length === 4) {\n      return view.getInt32(0, false);\n    } else if (data.length === 8) {\n      return view.getBigInt64(0, false);\n    } else {\n      throw new Error('Unsupported ITIF_TYPE_BE_SIGNED_INT length ' + data.length);\n    }\n  } else if (type === dataBox.Types.BE_FLOAT32) {\n    return view.getFloat32(0, false);\n  }\n\n  Log.warn('DataBox', 'Unsupported or unimplemented itif data type: ' + type);\n  return undefined;\n}\n\n/*\n * The QTFF data Atom is typically in an ilst Box.\n * https://developer.apple.com/documentation/quicktime-file-format/data_atom\n */\n\nexport class dataBox extends Box {\n  static override readonly fourcc = 'data' as const;\n  box_name = 'DataBox' as const;\n\n  country: number;\n  countryString?: string;\n  language: number;\n  languageString?: string;\n  raw: Uint8Array;\n  value?: string | number | bigint | boolean | object;\n  valueType: number;\n\n  /*\n   * itif data types\n   * https://developer.apple.com/documentation/quicktime-file-format/well-known_types\n   */\n  static Types = {\n    RESERVED: 0,\n    UTF8: 1,\n    UTF16: 2,\n    SJIS: 3,\n    UTF8_SORT: 4,\n    UTF16_SORT: 5,\n    JPEG: 13,\n    PNG: 14,\n    BE_SIGNED_INT: 21,\n    BE_UNSIGNED_INT: 22,\n    BE_FLOAT32: 23,\n    BE_FLOAT64: 24,\n    BMP: 27,\n    QT_ATOM: 28,\n    BE_SIGNED_INT8: 65,\n    BE_SIGNED_INT16: 66,\n    BE_SIGNED_INT32: 67,\n    BE_FLOAT32_POINT: 70,\n    BE_FLOAT32_DIMENSIONS: 71,\n    BE_FLOAT32_RECT: 72,\n    BE_SIGNED_INT64: 74,\n    BE_UNSIGNED_INT8: 75,\n    BE_UNSIGNED_INT16: 76,\n    BE_UNSIGNED_INT32: 77,\n    BE_UNSIGNED_INT64: 78,\n    BE_FLOAT64_AFFINE_TRANSFORM: 79,\n  } as const;\n\n  parse(stream: MultiBufferStream) {\n    this.valueType = stream.readUint32();\n    this.country = stream.readUint16();\n    if (this.country > 255) {\n      stream.seek(stream.getPosition() - 2);\n      this.countryString = stream.readString(2);\n    }\n    this.language = stream.readUint16();\n    if (this.language > 255) {\n      stream.seek(stream.getPosition() - 2);\n      this.parseLanguage(stream);\n    }\n    this.raw = stream.readUint8Array(this.size - this.hdr_size - 8);\n    this.value = parseItifData(this.valueType, this.raw);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class enofBox extends FullBox {\n  static override readonly fourcc = 'enof' as const;\n  box_name = 'TrackEncodedPixelsDimensionsBox' as const;\n\n  width: number;\n  height: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.width = stream.readUint32();\n    this.height = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport { OK } from '#/constants';\nimport { parseOneBox } from '#/parser';\nimport type { MultiBufferStream } from '#/buffer';\n\n/*\n * The QTFF ilst Box typically follows a keys Box within a meta Box.\n * https://developer.apple.com/documentation/quicktime-file-format/metadata_item_list_atom\n */\n\nexport class ilstBox extends Box {\n  static override readonly fourcc = 'ilst' as const;\n  box_name = 'IlstBox' as const;\n\n  /* Indexed by the index in keys */\n  list: Record<number, Box>;\n\n  parse(stream: MultiBufferStream) {\n    this.list = {};\n    let total = this.size - this.hdr_size;\n    while (total > 0) {\n      const size = stream.readUint32();\n\n      /* The index into the keys box */\n      const index = stream.readUint32();\n\n      const res = parseOneBox(stream, false, size - 8);\n      if (res.code === OK) this.list[index] = res.box;\n      total -= size;\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\n/*\n * The QTFF keys Atom is typically in a meta Box.\n * https://developer.apple.com/documentation/quicktime-file-format/metadata_item_keys_atom\n  static override readonly fourcc = 'ilst' as const;\n * key indexes are 1-based and so we store them in a Object, not an array.\n */\nexport class keysBox extends FullBox {\n  static override readonly fourcc = 'keys' as const;\n  box_name = 'KeysBox' as const;\n\n  count: number;\n  keys: Record<number, string>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.count = stream.readUint32();\n    this.keys = {};\n    for (let i = 0; i < this.count; i++) {\n      const len = stream.readUint32();\n      this.keys[i + 1] = stream.readString(len - 4);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class profBox extends FullBox {\n  static override readonly fourcc = 'prof' as const;\n  box_name = 'TrackProductionApertureDimensionsBox' as const;\n\n  width: number;\n  height: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.width = stream.readUint32();\n    this.height = stream.readUint32();\n  }\n}\n","import { ContainerBox } from '#/containerBox';\nimport { clefBox } from '#/boxes/qt/clef';\nimport { enofBox } from '#/boxes/qt/enof';\nimport { profBox } from '#/boxes/qt/prof';\n\nexport class taptBox extends ContainerBox {\n  static override readonly fourcc = 'tapt' as const;\n  box_name = 'TrackApertureModeDimensionsBox' as const;\n\n  clefs: Array<clefBox> = [];\n  profs: Array<profBox> = [];\n  enofs: Array<enofBox> = [];\n  subBoxNames = ['clef', 'prof', 'enof'] as const;\n}\n","import { ContainerBox } from '#/containerBox';\n\nexport class waveBox extends ContainerBox {\n  static override readonly fourcc = 'wave' as const;\n  box_name = 'siDecompressionParamBox' as const;\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class rtp_Box extends Box {\n  static override readonly fourcc = 'rtp ' as const;\n  box_name = 'rtpmoviehintinformation' as const;\n\n  descriptionformat: string;\n  sdptext: string;\n\n  parse(stream: MultiBufferStream) {\n    this.descriptionformat = stream.readString(4);\n    this.sdptext = stream.readString(this.size - this.hdr_size - 4);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class saioBox extends FullBox {\n  static override readonly fourcc = 'saio' as const;\n  box_name = 'SampleAuxiliaryInformationOffsetsBox' as const;\n\n  aux_info_type: string;\n  aux_info_type_parameter: number;\n  offset: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.flags & 0x1) {\n      this.aux_info_type = stream.readString(4);\n      this.aux_info_type_parameter = stream.readUint32();\n    }\n    const count = stream.readUint32();\n    this.offset = [];\n    for (let i = 0; i < count; i++) {\n      if (this.version === 0) {\n        this.offset[i] = stream.readUint32();\n      } else {\n        this.offset[i] = stream.readUint64();\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class saizBox extends FullBox {\n  static override readonly fourcc = 'saiz' as const;\n  box_name = 'SampleAuxiliaryInformationSizesBox' as const;\n\n  aux_info_type: string;\n  aux_info_type_parameter: number;\n  default_sample_info_size: number;\n  sample_count: number;\n  sample_info_size: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    if (this.flags & 0x1) {\n      this.aux_info_type = stream.readString(4);\n      this.aux_info_type_parameter = stream.readUint32();\n    }\n    this.default_sample_info_size = stream.readUint8();\n    this.sample_count = stream.readUint32();\n    this.sample_info_size = [];\n    if (this.default_sample_info_size === 0) {\n      for (let i = 0; i < this.sample_count; i++) {\n        this.sample_info_size[i] = stream.readUint8();\n      }\n    }\n  }\n}\n","export class Pixel {\n  constructor(\n    public bad_pixel_row: number,\n    public bad_pixel_column: number,\n  ) {}\n  toString() {\n    return '[row: ' + this.bad_pixel_row + ', column: ' + this.bad_pixel_column + ']';\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Pixel } from './displays/pixel';\n\nexport class sbpmBox extends FullBox {\n  static override readonly fourcc = 'sbpm' as const;\n  box_name = 'SensorBadPixelsMapBox' as const;\n\n  component_count: number;\n  component_index: Array<number>;\n  correction_applied: boolean;\n  num_bad_rows: number;\n  num_bad_cols: number;\n  num_bad_pixels: number;\n  bad_rows: Array<number>;\n  bad_columns: Array<number>;\n  bad_pixels: Array<Pixel>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.component_count = stream.readUint16();\n    this.component_index = [];\n    for (let i = 0; i < this.component_count; i++) {\n      this.component_index.push(stream.readUint16());\n    }\n    const flags = stream.readUint8();\n    this.correction_applied = 0x80 === (flags & 0x80);\n    this.num_bad_rows = stream.readUint32();\n    this.num_bad_cols = stream.readUint32();\n    this.num_bad_pixels = stream.readUint32();\n    this.bad_rows = [];\n    this.bad_columns = [];\n    this.bad_pixels = [];\n    for (let i = 0; i < this.num_bad_rows; i++) {\n      this.bad_rows.push(stream.readUint32());\n    }\n    for (let i = 0; i < this.num_bad_cols; i++) {\n      this.bad_columns.push(stream.readUint32());\n    }\n    for (let i = 0; i < this.num_bad_pixels; i++) {\n      const row = stream.readUint32();\n      const col = stream.readUint32();\n      this.bad_pixels.push(new Pixel(row, col));\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class schmBox extends FullBox {\n  static override readonly fourcc = 'schm' as const;\n  box_name = 'SchemeTypeBox' as const;\n\n  scheme_type: string;\n  scheme_version: number;\n  scheme_uri: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.scheme_type = stream.readString(4);\n    this.scheme_version = stream.readUint32();\n    if (this.flags & 0x000001) {\n      this.scheme_uri = stream.readString(this.size - this.hdr_size - 8);\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class sdp_Box extends Box {\n  static override readonly fourcc = 'sdp ' as const;\n  box_name = 'rtptracksdphintinformation' as const;\n\n  sdptext?: string;\n\n  parse(stream: MultiBufferStream) {\n    this.sdptext = stream.readString(this.size - this.hdr_size);\n  }\n}\n","import { FullBox } from '#/box';\n\nexport class sencBox extends FullBox {\n  static override readonly fourcc = 'senc' as const;\n  box_name = 'SampleEncryptionBox' as const;\n\n  // Cannot be fully parsed because Per_Sample_IV_Size needs to be known\n  /* parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    let sample_count = stream.readUint32();\n    this.samples = [];\n    for (let i = 0; i < sample_count; i++) {\n      let sample = {};\n      // tenc.default_Per_Sample_IV_Size or seig.Per_Sample_IV_Size\n      sample.InitializationVector = this.readUint8Array(Per_Sample_IV_Size*8);\n      if (this.flags & 0x2) {\n        sample.subsamples = [];\n        subsample_count = stream.readUint16();\n        for (let j = 0; j < subsample_count; j++) {\n          let subsample = {};\n          subsample.BytesOfClearData = stream.readUint16();\n          subsample.BytesOfProtectedData = stream.readUint32();\n          sample.subsamples.push(subsample);\n        }\n      }\n      // TODO\n      this.samples.push(sample);\n    } \n  } */\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class SmDmBox extends FullBox {\n  static override readonly fourcc = 'SmDm' as const;\n  box_name = 'SMPTE2086MasteringDisplayMetadataBox' as const;\n\n  primaryRChromaticity_x: number;\n  primaryRChromaticity_y: number;\n  primaryGChromaticity_x: number;\n  primaryGChromaticity_y: number;\n  primaryBChromaticity_x: number;\n  primaryBChromaticity_y: number;\n  whitePointChromaticity_x: number;\n  whitePointChromaticity_y: number;\n  luminanceMax: number;\n  luminanceMin: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.primaryRChromaticity_x = stream.readUint16();\n    this.primaryRChromaticity_y = stream.readUint16();\n    this.primaryGChromaticity_x = stream.readUint16();\n    this.primaryGChromaticity_y = stream.readUint16();\n    this.primaryBChromaticity_x = stream.readUint16();\n    this.primaryBChromaticity_y = stream.readUint16();\n    this.whitePointChromaticity_x = stream.readUint16();\n    this.whitePointChromaticity_y = stream.readUint16();\n    this.luminanceMax = stream.readUint32();\n    this.luminanceMin = stream.readUint32();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class sratBox extends FullBox {\n  static override readonly fourcc = 'srat' as const;\n  box_name = 'SamplingRateBox' as const;\n\n  sampling_rate: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.sampling_rate = stream.readUint32();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\ninterface Range {\n  level: number;\n  range_size: number;\n}\ninterface SubSegment {\n  ranges: Array<Range>;\n}\n\nexport class ssixBox extends FullBox {\n  static override readonly fourcc = 'ssix' as const;\n  box_name = 'CompressedSubsegmentIndexBox' as const;\n\n  subsegments: Array<SubSegment>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.subsegments = [];\n    const subsegment_count = stream.readUint32();\n    for (let i = 0; i < subsegment_count; i++) {\n      const subsegment = {} as SubSegment;\n      this.subsegments.push(subsegment);\n      subsegment.ranges = [];\n      const range_count = stream.readUint32();\n      for (let j = 0; j < range_count; j++) {\n        const range = {} as Range;\n        subsegment.ranges.push(range);\n        range.level = stream.readUint8();\n        range.range_size = stream.readUint24();\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class stdpBox extends FullBox {\n  static override readonly fourcc = 'stpd' as const;\n  box_name = 'DegradationPriorityBox' as const;\n\n  priority: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const count = (this.size - this.hdr_size) / 2;\n    this.priority = [];\n    for (let i = 0; i < count; i++) {\n      this.priority[i] = stream.readUint16();\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class striBox extends FullBox {\n  static override readonly fourcc = 'stri' as const;\n  box_name = 'SubTrackInformationBox' as const;\n\n  switch_group: number;\n  alternate_group: number;\n  sub_track_id: number;\n  attribute_list: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.switch_group = stream.readUint16();\n    this.alternate_group = stream.readUint16();\n    this.sub_track_id = stream.readUint32();\n    const count = (this.size - this.hdr_size - 8) / 4;\n    this.attribute_list = [];\n    for (let i = 0; i < count; i++) {\n      this.attribute_list[i] = stream.readUint32();\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class stsgBox extends FullBox {\n  static override readonly fourcc = 'stsg' as const;\n  box_name = 'SubTrackSampleGroupBox' as const;\n\n  grouping_type: number;\n  group_description_index: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.grouping_type = stream.readUint32();\n    const count = stream.readUint16();\n    this.group_description_index = [];\n    for (let i = 0; i < count; i++) {\n      this.group_description_index[i] = stream.readUint32();\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class stshBox extends FullBox {\n  static override readonly fourcc = 'stsh' as const;\n  box_name = 'ShadowSyncSampleBox' as const;\n\n  shadowed_sample_numbers: Array<number>;\n  sync_sample_numbers: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const entry_count = stream.readUint32();\n    this.shadowed_sample_numbers = [];\n    this.sync_sample_numbers = [];\n    if (this.version === 0) {\n      for (let i = 0; i < entry_count; i++) {\n        this.shadowed_sample_numbers.push(stream.readUint32());\n        this.sync_sample_numbers.push(stream.readUint32());\n      }\n    }\n  }\n\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 4 + 8 * this.shadowed_sample_numbers.length;\n    this.writeHeader(stream);\n    stream.writeUint32(this.shadowed_sample_numbers.length);\n    for (let i = 0; i < this.shadowed_sample_numbers.length; i++) {\n      stream.writeUint32(this.shadowed_sample_numbers[i]);\n      stream.writeUint32(this.sync_sample_numbers[i]);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class stssBox extends FullBox {\n  static override readonly fourcc = 'stss' as const;\n  box_name = 'SyncSampleBox' as const;\n\n  sample_numbers: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const entry_count = stream.readUint32();\n    if (this.version === 0) {\n      this.sample_numbers = [];\n      for (let i = 0; i < entry_count; i++) {\n        this.sample_numbers.push(stream.readUint32());\n      }\n    }\n  }\n\n  /** @bundle writing/stss.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = 4 + 4 * this.sample_numbers.length;\n    this.writeHeader(stream);\n    stream.writeUint32(this.sample_numbers.length);\n    stream.writeUint32Array(this.sample_numbers);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { OK } from '#/constants';\nimport { parseOneBox } from '#/parser';\nimport type { BoxKind } from '@types';\n\nexport class stviBox extends FullBox {\n  static override readonly fourcc = 'stvi' as const;\n  box_name = 'StereoVideoBox' as const;\n\n  single_view_allowed: number;\n  stereo_scheme: number;\n  stereo_indication_type: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const tmp32 = stream.readUint32();\n    this.single_view_allowed = tmp32 & 0x3;\n    this.stereo_scheme = stream.readUint32();\n    const length = stream.readUint32();\n    this.stereo_indication_type = stream.readString(length);\n    this.boxes = [];\n    while (stream.getPosition() < this.start + this.size) {\n      const ret = parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\n      if (ret.code === OK) {\n        const box = ret.box as BoxKind;\n        this.boxes.push(box);\n        this[box.type] = box;\n      } else {\n        return;\n      }\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class stypBox extends Box {\n  static override readonly fourcc = 'styp' as const;\n  box_name = 'SegmentTypeBox' as const;\n\n  major_brand: string;\n  minor_version: number;\n  compatible_brands: Array<string>;\n\n  parse(stream: MultiBufferStream) {\n    let toparse = this.size - this.hdr_size;\n    this.major_brand = stream.readString(4);\n    this.minor_version = stream.readUint32();\n    toparse -= 8;\n    this.compatible_brands = [];\n    let i = 0;\n    while (toparse >= 4) {\n      this.compatible_brands[i] = stream.readString(4);\n      toparse -= 4;\n      i++;\n    }\n  }\n\n  write(stream: MultiBufferStream) {\n    this.size = 8 + 4 * this.compatible_brands.length;\n    this.writeHeader(stream);\n    stream.writeString(this.major_brand, undefined, 4);\n    stream.writeUint32(this.minor_version);\n    for (let i = 0; i < this.compatible_brands.length; i++) {\n      stream.writeString(this.compatible_brands[i], undefined, 4);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\n\nexport class stz2Box extends FullBox {\n  static override readonly fourcc = 'stz2' as const;\n  box_name = 'CompactSampleSizeBox' as const;\n\n  sample_sizes: Array<number>;\n  reserved: number;\n  field_size: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.sample_sizes = [];\n    if (this.version === 0) {\n      this.reserved = stream.readUint24();\n      this.field_size = stream.readUint8();\n      const sample_count = stream.readUint32();\n      if (this.field_size === 4) {\n        for (let i = 0; i < sample_count; i += 2) {\n          const tmp = stream.readUint8();\n          this.sample_sizes[i] = (tmp >> 4) & 0xf;\n          this.sample_sizes[i + 1] = tmp & 0xf;\n        }\n      } else if (this.field_size === 8) {\n        for (let i = 0; i < sample_count; i++) {\n          this.sample_sizes[i] = stream.readUint8();\n        }\n      } else if (this.field_size === 16) {\n        for (let i = 0; i < sample_count; i++) {\n          this.sample_sizes[i] = stream.readUint16();\n        }\n      } else {\n        Log.error('BoxParser', 'Error in length field in stz2 box', stream.isofile);\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport type { SubSample } from '@types';\n\ninterface SampleInfo {\n  size: number;\n  sample_delta: number;\n  subsamples: Array<SubSample>;\n}\n\nexport class subsBox extends FullBox {\n  static override readonly fourcc = 'subs' as const;\n  box_name = 'SubSampleInformationBox' as const;\n\n  entries: Array<SampleInfo>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    const entry_count = stream.readUint32();\n    this.entries = [];\n    let subsample_count;\n    for (let i = 0; i < entry_count; i++) {\n      const sampleInfo = {} as SampleInfo;\n      this.entries[i] = sampleInfo;\n      sampleInfo.sample_delta = stream.readUint32();\n      sampleInfo.subsamples = [];\n      subsample_count = stream.readUint16();\n      if (subsample_count > 0) {\n        for (let j = 0; j < subsample_count; j++) {\n          const subsample = {} as SubSample;\n          sampleInfo.subsamples.push(subsample);\n          if (this.version === 1) {\n            subsample.size = stream.readUint32();\n          } else {\n            subsample.size = stream.readUint16();\n          }\n          subsample.priority = stream.readUint8();\n          subsample.discardable = stream.readUint8();\n          subsample.codec_specific_parameters = stream.readUint32();\n        }\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class taicBox extends FullBox {\n  static override readonly fourcc = 'taic' as const;\n  box_name = 'TAIClockInfoBox' as const;\n\n  time_uncertainty: number;\n  clock_resolution: number;\n  clock_drift_rate: number;\n  clock_type: number;\n\n  parse(stream: MultiBufferStream) {\n    this.time_uncertainty = stream.readUint64();\n    this.clock_resolution = stream.readUint32();\n    this.clock_drift_rate = stream.readInt32();\n    const reserved_byte = stream.readUint8();\n    this.clock_type = (reserved_byte & 0xc0) >> 6;\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { parseHex16 } from '#/parser';\n\nexport class tencBox extends FullBox {\n  static override readonly fourcc = 'tenc' as const;\n  box_name = 'TrackEncryptionBox' as const;\n\n  default_crypt_byte_block: number;\n  default_skip_byte_block: number;\n  default_isProtected: number;\n  default_Per_Sample_IV_Size: number;\n  default_KID: string;\n  default_constant_IV_size: number;\n  default_constant_IV: Uint8Array;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    stream.readUint8(); // reserved\n    if (this.version === 0) {\n      stream.readUint8();\n    } else {\n      const tmp = stream.readUint8();\n      this.default_crypt_byte_block = (tmp >> 4) & 0xf;\n      this.default_skip_byte_block = tmp & 0xf;\n    }\n    this.default_isProtected = stream.readUint8();\n    this.default_Per_Sample_IV_Size = stream.readUint8();\n    this.default_KID = parseHex16(stream);\n    if (this.default_isProtected === 1 && this.default_Per_Sample_IV_Size === 0) {\n      this.default_constant_IV_size = stream.readUint8();\n      this.default_constant_IV = stream.readUint8Array(this.default_constant_IV_size);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport type { SampleEntry } from './sampleentries/base';\n\nexport class tfraBox extends FullBox {\n  static override readonly fourcc = 'tfra' as const;\n  box_name = 'TrackFragmentRandomAccessBox' as const;\n\n  track_ID: number;\n  length_size_of_traf_num: number;\n  length_size_of_trun_num: number;\n  length_size_of_sample_num: number;\n  entries: Array<SampleEntry>;\n  time: number;\n  moof_offset: number;\n  traf_number: number;\n  trun_number: number;\n  sample_number: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.track_ID = stream.readUint32();\n    stream.readUint24();\n    const tmp_byte = stream.readUint8();\n    this.length_size_of_traf_num = (tmp_byte >> 4) & 0x3;\n    this.length_size_of_trun_num = (tmp_byte >> 2) & 0x3;\n    this.length_size_of_sample_num = tmp_byte & 0x3;\n    this.entries = [];\n    const number_of_entries = stream.readUint32();\n    for (let i = 0; i < number_of_entries; i++) {\n      if (this.version === 1) {\n        this.time = stream.readUint64();\n        this.moof_offset = stream.readUint64();\n      } else {\n        this.time = stream.readUint32();\n        this.moof_offset = stream.readUint32();\n      }\n      this.traf_number = stream['readUint' + 8 * (this.length_size_of_traf_num + 1)]();\n      this.trun_number = stream['readUint' + 8 * (this.length_size_of_trun_num + 1)]();\n      this.sample_number = stream['readUint' + 8 * (this.length_size_of_sample_num + 1)]();\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class tmaxBox extends Box {\n  static override readonly fourcc = 'tmax' as const;\n  box_name = 'hintmaxrelativetime' as const;\n\n  time: number;\n\n  parse(stream: MultiBufferStream) {\n    this.time = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class tminBox extends Box {\n  static override readonly fourcc = 'tmin' as const;\n  box_name = 'hintminrelativetime' as const;\n\n  time: number;\n\n  parse(stream: MultiBufferStream) {\n    this.time = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class totlBox extends Box {\n  static override readonly fourcc = 'totl' as const;\n  box_name = 'hintBytesSent' as const;\n\n  bytessent: number;\n\n  parse(stream: MultiBufferStream) {\n    this.bytessent = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class tpayBox extends Box {\n  static override readonly fourcc = 'tpay' as const;\n  box_name = 'hintBytesSent' as const;\n\n  bytessent: number;\n\n  parse(stream: MultiBufferStream) {\n    this.bytessent = stream.readUint32();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class tpylBox extends Box {\n  static override readonly fourcc = 'tpyl' as const;\n  box_name = 'hintBytesSent' as const;\n\n  bytessent: number;\n\n  parse(stream: MultiBufferStream) {\n    this.bytessent = stream.readUint64();\n  }\n}\n","import { TrackGroupTypeBox } from '#//box';\n\nexport class msrcTrackGroupTypeBox extends TrackGroupTypeBox {\n  static override readonly fourcc = 'msrc' as const;\n}\n","import { OK } from '#//constants';\nimport { Box, TrackReferenceTypeBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\nimport { parseOneBox } from '#/parser';\n\nexport class trefBox extends Box {\n  static override readonly fourcc = 'tref' as const;\n  box_name = 'TrackReferenceBox' as const;\n\n  static allowed_types = [\n    'hint',\n    'cdsc',\n    'font',\n    'hind',\n    'vdep',\n    'vplx',\n    'subt',\n    'thmb',\n    'auxl',\n    'cdtg',\n    'shsc',\n    'aest',\n  ] as const;\n\n  references: Array<TrackReferenceTypeBox> = [];\n\n  parse(stream: MultiBufferStream) {\n    while (stream.getPosition() < this.start + this.size) {\n      const ret = parseOneBox(stream, true, this.size - (stream.getPosition() - this.start));\n      if (ret.code === OK) {\n        if (!trefBox.allowed_types.includes(ret.type as (typeof trefBox.allowed_types)[number])) {\n          Log.warn('BoxParser', `Unknown track reference type: '${ret.type}'`);\n        }\n\n        const box = new TrackReferenceTypeBox(ret.type, ret.size, ret.hdr_size, ret.start);\n        if (box.write === Box.prototype.write && box.type !== 'mdat') {\n          Log.info(\n            'BoxParser',\n            'TrackReference ' +\n              box.type +\n              ' box writing not yet implemented, keeping unparsed data in memory for later write',\n          );\n          box.parseDataAndRewind(stream);\n        }\n        box.parse(stream);\n        this.references.push(box);\n      } else {\n        return;\n      }\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { OK } from '#/constants';\nimport { parseOneBox } from '#/parser';\n\nexport class trepBox extends FullBox {\n  static override readonly fourcc = 'trep' as const;\n  box_name = 'TrackExtensionPropertiesBox' as const;\n\n  track_ID: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.track_ID = stream.readUint32();\n    this.boxes = [];\n    while (stream.getPosition() < this.start + this.size) {\n      const ret = parseOneBox(stream, false, this.size - (stream.getPosition() - this.start));\n      if (ret.code === OK) {\n        const box = ret.box;\n        this.boxes.push(box);\n      } else {\n        return;\n      }\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class trpyBox extends Box {\n  static override readonly fourcc = 'trpy' as const;\n  box_name = 'hintBytesSent' as const;\n\n  bytessent: number;\n\n  parse(stream: MultiBufferStream) {\n    this.bytessent = stream.readUint64();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class tselBox extends FullBox {\n  static override readonly fourcc = 'tsel' as const;\n  box_name = 'TrackSelectionBox' as const;\n\n  switch_group: number;\n  attribute_list: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.switch_group = stream.readUint32();\n    const count = (this.size - this.hdr_size - 4) / 4;\n    this.attribute_list = [];\n    for (let i = 0; i < count; i++) {\n      this.attribute_list[i] = stream.readUint32();\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class txtcBox extends FullBox {\n  static override readonly fourcc = 'txtc' as const;\n  box_name = 'TextConfigBox' as const;\n\n  config: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.config = stream.readCString();\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class tycoBox extends Box {\n  static override readonly fourcc = 'tyco' as const;\n  box_name = 'TypeCombinationBox' as const;\n\n  compatible_brands: Array<string>;\n\n  parse(stream: MultiBufferStream) {\n    const count = (this.size - this.hdr_size) / 4;\n    this.compatible_brands = [];\n    for (let i = 0; i < count; i++) {\n      this.compatible_brands[i] = stream.readString(4);\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class udesBox extends FullBox {\n  static override readonly fourcc = 'udes' as const;\n  box_name = 'UserDescriptionProperty' as const;\n\n  lang: string;\n  name: string;\n  description: string;\n  tags: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.lang = stream.readCString();\n    this.name = stream.readCString();\n    this.description = stream.readCString();\n    this.tags = stream.readCString();\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class uncCBox extends FullBox {\n  static override readonly fourcc = 'uncC' as const;\n  box_name = 'UncompressedFrameConfigBox' as const;\n\n  profile: string;\n  component_count: number;\n  component_index: Array<number>;\n  component_bit_depth_minus_one: Array<number>;\n  component_format: Array<number>;\n  component_align_size: Array<number>;\n  sampling_type: number;\n  interleave_type: number;\n  block_size: number;\n  component_little_endian: number;\n  block_pad_lsb: number;\n  block_little_endian: number;\n  block_reversed: number;\n  pad_unknown: number;\n  pixel_size: number;\n  row_align_size: number;\n  tile_align_size: number;\n  num_tile_cols_minus_one: number;\n  num_tile_rows_minus_one: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.profile = stream.readString(4);\n    if (this.version === 1) {\n      // Nothing - just the profile\n    } else if (this.version === 0) {\n      this.component_count = stream.readUint32();\n      this.component_index = [];\n      this.component_bit_depth_minus_one = [];\n      this.component_format = [];\n      this.component_align_size = [];\n      for (let i = 0; i < this.component_count; i++) {\n        this.component_index.push(stream.readUint16());\n        this.component_bit_depth_minus_one.push(stream.readUint8());\n        this.component_format.push(stream.readUint8());\n        this.component_align_size.push(stream.readUint8());\n      }\n      this.sampling_type = stream.readUint8();\n      this.interleave_type = stream.readUint8();\n      this.block_size = stream.readUint8();\n      const flags = stream.readUint8();\n      this.component_little_endian = (flags >> 7) & 0x1;\n      this.block_pad_lsb = (flags >> 6) & 0x1;\n      this.block_little_endian = (flags >> 5) & 0x1;\n      this.block_reversed = (flags >> 4) & 0x1;\n      this.pad_unknown = (flags >> 3) & 0x1;\n      this.pixel_size = stream.readUint32();\n      this.row_align_size = stream.readUint32();\n      this.tile_align_size = stream.readUint32();\n      this.num_tile_cols_minus_one = stream.readUint32();\n      this.num_tile_rows_minus_one = stream.readUint32();\n    }\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class urnBox extends FullBox {\n  static override readonly fourcc = 'urn ' as const;\n  box_name = 'DataEntryUrnBox' as const;\n\n  name: string;\n  location: string;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    this.name = stream.readCString();\n    if (this.size - this.hdr_size - this.name.length - 1 > 0) {\n      this.location = stream.readCString();\n    }\n  }\n\n  /** @bundle writing/urn.js */\n  write(stream: MultiBufferStream) {\n    this.version = 0;\n    this.flags = 0;\n    this.size = this.name.length + 1 + (this.location ? this.location.length + 1 : 0);\n    this.writeHeader(stream);\n    stream.writeCString(this.name);\n    if (this.location) {\n      stream.writeCString(this.location);\n    }\n  }\n}\n","import { Box } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class vttCBox extends Box {\n  static override readonly fourcc = 'vttC' as const;\n  box_name = 'WebVTTConfigurationBox' as const;\n\n  text: string;\n\n  parse(stream: MultiBufferStream) {\n    this.text = stream.readString(this.size - this.hdr_size);\n  }\n}\n","import { FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class vvnCBox extends FullBox {\n  static override readonly fourcc = 'vvnC' as const;\n  box_name = 'VvcNALUConfigBox' as const;\n\n  lengthSizeMinusOne: number;\n\n  parse(stream: MultiBufferStream) {\n    this.parseFullHeader(stream);\n    // VvcNALUConfigBox\n    const tmp = stream.readUint8();\n    this.lengthSizeMinusOne = tmp & 0x3;\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class alstSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'alst' as const;\n\n  first_output_sample: number;\n  sample_offset: Array<number>;\n  num_output_samples: Array<number>;\n  num_total_samples: Array<number>;\n\n  parse(stream: MultiBufferStream) {\n    const roll_count = stream.readUint16();\n    this.first_output_sample = stream.readUint16();\n    this.sample_offset = [];\n    for (let i = 0; i < roll_count; i++) {\n      this.sample_offset[i] = stream.readUint32();\n    }\n    const remaining = this.description_length - 4 - 4 * roll_count;\n    this.num_output_samples = [];\n    this.num_total_samples = [];\n    for (let i = 0; i < remaining / 4; i++) {\n      this.num_output_samples[i] = stream.readUint16();\n      this.num_total_samples[i] = stream.readUint16();\n    }\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class avllSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'avll' as const;\n\n  layerNumber: number;\n  accurateStatisticsFlag: number;\n  avgBitRate: number;\n  avgFrameRate: number;\n\n  parse(stream: MultiBufferStream) {\n    this.layerNumber = stream.readUint8();\n    this.accurateStatisticsFlag = stream.readUint8();\n    this.avgBitRate = stream.readUint16();\n    this.avgFrameRate = stream.readUint16();\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class avssSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'avss' as const;\n\n  subSequenceIdentifier: number;\n  layerNumber: number;\n  durationFlag: number;\n  avgRateFlag: number;\n  duration: number;\n  accurateStatisticsFlag: number;\n  avgBitRate: number;\n  avgFrameRate: number;\n  dependency: Array<{\n    subSeqDirectionFlag: number;\n    layerNumber: number;\n    subSequenceIdentifier: number;\n  }>;\n\n  parse(stream: MultiBufferStream) {\n    this.subSequenceIdentifier = stream.readUint16();\n    this.layerNumber = stream.readUint8();\n    const tmp_byte = stream.readUint8();\n    this.durationFlag = tmp_byte >> 7;\n    this.avgRateFlag = (tmp_byte >> 6) & 0x1;\n    if (this.durationFlag) {\n      this.duration = stream.readUint32();\n    }\n    if (this.avgRateFlag) {\n      this.accurateStatisticsFlag = stream.readUint8();\n      this.avgBitRate = stream.readUint16();\n      this.avgFrameRate = stream.readUint16();\n    }\n    this.dependency = [];\n    const numReferences = stream.readUint8();\n    for (let i = 0; i < numReferences; i++) {\n      this.dependency.push({\n        subSeqDirectionFlag: stream.readUint8(),\n        layerNumber: stream.readUint8(),\n        subSequenceIdentifier: stream.readUint16(),\n      });\n    }\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\n\nexport class dtrtSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'dtrt' as const;\n\n  parse(_stream: MultiBufferStream) {\n    Log.warn('BoxParser', 'Sample Group type: ' + this.grouping_type + ' not fully parsed');\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\n\nexport class mvifSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'mvif' as const;\n\n  parse(_stream: MultiBufferStream) {\n    Log.warn('BoxParser', 'Sample Group type: ' + this.grouping_type + ' not fully parsed');\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class prolSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'prol' as const;\n\n  roll_distance: number;\n\n  parse(stream: MultiBufferStream) {\n    this.roll_distance = stream.readInt16();\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class rapSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'rap ' as const;\n\n  num_leading_samples_known: number;\n  num_leading_samples: number;\n\n  parse(stream: MultiBufferStream) {\n    const tmp_byte = stream.readUint8();\n    this.num_leading_samples_known = tmp_byte >> 7;\n    this.num_leading_samples = tmp_byte & 0x7f;\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\n\nexport class rashSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'rash' as const;\n\n  operation_point_count: number;\n  target_rate_share: number | Array<number>;\n  available_bitrate: Array<number>;\n  maximum_bitrate: number;\n  minimum_bitrate: number;\n  discard_priority: number;\n\n  parse(stream: MultiBufferStream) {\n    this.operation_point_count = stream.readUint16();\n    if (\n      this.description_length !==\n      2 + (this.operation_point_count === 1 ? 2 : this.operation_point_count * 6) + 9\n    ) {\n      Log.warn('BoxParser', 'Mismatch in ' + this.grouping_type + ' sample group length');\n      this.data = stream.readUint8Array(this.description_length - 2);\n    } else {\n      if (this.operation_point_count === 1) {\n        this.target_rate_share = stream.readUint16();\n      } else {\n        this.target_rate_share = [];\n        this.available_bitrate = [];\n        for (let i = 0; i < this.operation_point_count; i++) {\n          this.available_bitrate[i] = stream.readUint32();\n          this.target_rate_share[i] = stream.readUint16();\n        }\n      }\n      this.maximum_bitrate = stream.readUint32();\n      this.minimum_bitrate = stream.readUint32();\n      this.discard_priority = stream.readUint8();\n    }\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class rollSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'roll' as const;\n\n  roll_distance: number;\n\n  parse(stream: MultiBufferStream) {\n    this.roll_distance = stream.readInt16();\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\n\nexport class scifSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'scif' as const;\n\n  parse(_stream: MultiBufferStream) {\n    Log.warn('BoxParser', 'Sample Group type: ' + this.grouping_type + ' not fully parsed');\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { Log } from '#/log';\n\nexport class scnmSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'scnm' as const;\n\n  parse(_stream: MultiBufferStream) {\n    Log.warn('BoxParser', 'Sample Group type: ' + this.grouping_type + ' not fully parsed');\n  }\n}\n","import { SampleGroupEntry } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { parseHex16 } from '#/parser';\n\nexport class seigSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'seig' as const;\n\n  reserved: number;\n  crypt_byte_block: number;\n  skip_byte_block: number;\n  isProtected: number;\n  Per_Sample_IV_Size: number;\n  KID: string;\n  constant_IV_size: number;\n  constant_IV: number | Uint8Array;\n\n  parse(stream: MultiBufferStream) {\n    this.reserved = stream.readUint8();\n    const tmp = stream.readUint8();\n    this.crypt_byte_block = tmp >> 4;\n    this.skip_byte_block = tmp & 0xf;\n    this.isProtected = stream.readUint8();\n    this.Per_Sample_IV_Size = stream.readUint8();\n    this.KID = parseHex16(stream);\n    this.constant_IV_size = 0;\n    this.constant_IV = 0;\n    if (this.isProtected === 1 && this.Per_Sample_IV_Size === 0) {\n      this.constant_IV_size = stream.readUint8();\n      this.constant_IV = stream.readUint8Array(this.constant_IV_size);\n    }\n  }\n}\n","import { SampleGroupEntry } from '#//box';\nimport { Log } from '#//log';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class stsaSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'stsa' as const;\n\n  parse(_stream: MultiBufferStream) {\n    Log.warn('BoxParser', 'Sample Group type: ' + this.grouping_type + ' not fully parsed');\n  }\n}\n","import { SampleGroupEntry } from '#//box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class syncSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'sync' as const;\n\n  NAL_unit_type: number;\n\n  parse(stream: MultiBufferStream) {\n    const tmp_byte = stream.readUint8();\n    this.NAL_unit_type = tmp_byte & 0x3f;\n  }\n}\n","import { SampleGroupEntry } from '#//box';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class teleSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'tele' as const;\n\n  level_independently_decodable: number;\n\n  parse(stream: MultiBufferStream) {\n    const tmp_byte = stream.readUint8();\n    this.level_independently_decodable = tmp_byte >> 7;\n  }\n}\n","import { SampleGroupEntry } from '#//box';\nimport { Log } from '#//log';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class tsasSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'tsas' as const;\n\n  parse(_stream: MultiBufferStream) {\n    Log.warn('BoxParser', 'Sample Group type: ' + this.grouping_type + ' not fully parsed');\n  }\n}\n","import { SampleGroupEntry } from '#//box';\nimport { Log } from '#//log';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class tsclSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'tscl' as const;\n\n  parse(_stream: MultiBufferStream) {\n    Log.warn('BoxParser', 'Sample Group type: ' + this.grouping_type + ' not fully parsed');\n  }\n}\n","import { SampleGroupEntry } from '#//box';\nimport { Log } from '#//log';\nimport type { MultiBufferStream } from '#/buffer';\n\nexport class viprSampleGroupEntry extends SampleGroupEntry {\n  static grouping_type = 'vipr' as const;\n\n  parse(_stream: MultiBufferStream) {\n    Log.warn('BoxParser', 'Sample Group type: ' + this.grouping_type + ' not fully parsed');\n  }\n}\n","import { Box, FullBox } from '#/box';\nimport type { MultiBufferStream } from '#/buffer';\nimport { parseHex16 } from '#/parser';\n\nclass UUIDBox extends Box {\n  static override readonly fourcc = 'uuid' as const;\n  static uuid?: string;\n}\n\nclass UUIDFullBox extends FullBox {\n  static override readonly fourcc = 'uuid' as const;\n  static uuid?: string;\n}\n\n// piff\nexport class piffLsmBox extends UUIDFullBox {\n  static uuid = 'a5d40b30e81411ddba2f0800200c9a66' as const;\n  box_name = 'LiveServerManifestBox' as const;\n\n  LiveServerManifest: string;\n\n  parse(stream: MultiBufferStream): void {\n    this.parseFullHeader(stream);\n    this.LiveServerManifest = stream\n      .readString(this.size - this.hdr_size)\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n  }\n}\n\nexport class piffPsshBox extends UUIDFullBox {\n  static uuid = 'd08a4f1810f34a82b6c832d8aba183d3' as const;\n  box_name = 'PiffProtectionSystemSpecificHeaderBox' as const;\n\n  system_id: string;\n\n  parse(stream: MultiBufferStream): void {\n    this.parseFullHeader(stream);\n    this.system_id = parseHex16(stream);\n    const datasize = stream.readUint32();\n    if (datasize > 0) {\n      this.data = stream.readUint8Array(datasize);\n    }\n  }\n}\n\nexport class piffSencBox extends UUIDFullBox {\n  static uuid = 'a2394f525a9b4f14a2446c427c648df4' as const;\n  box_name = 'PiffSampleEncryptionBox' as const;\n}\n\nexport class piffTencBox extends UUIDFullBox {\n  static uuid = '8974dbce7be74c5184f97148f9882554' as const;\n  box_name = 'PiffTrackEncryptionBox' as const;\n\n  default_AlgorithmID: number;\n  default_IV_size: number;\n  default_KID: string;\n\n  parse(stream: MultiBufferStream): void {\n    this.parseFullHeader(stream);\n    this.default_AlgorithmID = stream.readUint24();\n    this.default_IV_size = stream.readUint8();\n    this.default_KID = parseHex16(stream);\n  }\n}\n\nexport class piffTfrfBox extends UUIDFullBox {\n  static uuid = 'd4807ef2ca3946958e5426cb9e46a79f' as const;\n  box_name = 'TfrfBox' as const;\n\n  fragment_count: number;\n  entries: Array<{ absolute_time: number; absolute_duration: number }>;\n\n  parse(stream: MultiBufferStream): void {\n    this.parseFullHeader(stream);\n    this.fragment_count = stream.readUint8();\n    this.entries = [];\n\n    for (let i = 0; i < this.fragment_count; i++) {\n      let absolute_time = 0;\n      let absolute_duration = 0;\n\n      if (this.version === 1) {\n        absolute_time = stream.readUint64();\n        absolute_duration = stream.readUint64();\n      } else {\n        absolute_time = stream.readUint32();\n        absolute_duration = stream.readUint32();\n      }\n\n      this.entries.push({\n        absolute_time,\n        absolute_duration,\n      });\n    }\n  }\n}\n\nexport class piffTfxdBox extends UUIDFullBox {\n  static uuid = '6d1d9b0542d544e680e2141daff757b2' as const;\n  box_name = 'TfxdBox' as const;\n\n  absolute_time: number;\n  duration: number;\n\n  parse(stream: MultiBufferStream): void {\n    this.parseFullHeader(stream);\n    if (this.version === 1) {\n      this.absolute_time = stream.readUint64();\n      this.duration = stream.readUint64();\n    } else {\n      this.absolute_time = stream.readUint32();\n      this.duration = stream.readUint32();\n    }\n  }\n}\n\n// GIMI\nexport class ItemContentIDPropertyBox extends UUIDBox {\n  static uuid = '261ef3741d975bbaacbd9d2c8ea73522' as const;\n  box_name = 'ItemContentIDProperty' as const;\n\n  content_id: string;\n\n  parse(stream: MultiBufferStream): void {\n    this.content_id = stream.readCString();\n  }\n}\n"],"mappings":"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AA,oBAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,yBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,yBAAAC,GAAA,oBAAAC,GAAA,yBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,EAAA,oBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,SAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,yBAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,oBAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,oBAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,YAAAC,GAAA,oB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","names":["all_exports","__export","AudioSampleEntry","Box","BoxParser","DIFF_BOXES_PROP_NAMES","DIFF_PRIMITIVE_ARRAY_PROP_NAMES","DataStream","Descriptor","ES_Descriptor","Endianness","FullBox","HintSampleEntry","ISOFile","Log","MP4BoxBuffer","MPEG4DescriptorParser","MetadataSampleEntry","MultiBufferStream","SampleEntry","SampleGroupEntry","SampleGroupInfo","SingleItemTypeReferenceBox","SingleItemTypeReferenceBoxLarge","SubtitleSampleEntry","SystemSampleEntry","TX3GParser","TextSampleEntry","Textin4Parser","TrackGroupTypeBox","TrackReferenceTypeBox","VTTin4Parser","VisualSampleEntry","XMLSubtitlein4Parser","boxEqual","boxEqualFields","createFile","loadMoovOnly","MAX_SIZE","MAX_UINT32","TKHD_FLAG_ENABLED","TKHD_FLAG_IN_MOVIE","TKHD_FLAG_IN_PREVIEW","TFHD_FLAG_BASE_DATA_OFFSET","TFHD_FLAG_SAMPLE_DESC","TFHD_FLAG_SAMPLE_DUR","TFHD_FLAG_SAMPLE_SIZE","TFHD_FLAG_SAMPLE_FLAGS","TFHD_FLAG_DEFAULT_BASE_IS_MOOF","TRUN_FLAGS_DATA_OFFSET","TRUN_FLAGS_FIRST_FLAG","TRUN_FLAGS_DURATION","TRUN_FLAGS_SIZE","TRUN_FLAGS_FLAGS","TRUN_FLAGS_CTS_OFFSET","ERR_INVALID_DATA","ERR_NOT_ENOUGH_DATA","OK","MP4BoxBuffer","_MP4BoxBuffer","byteLength","buffer","fileStart","mp4BoxBuffer","Endianness","_DataStream_instances","isTupleType_fn","_DataStream","arrayBuffer","byteOffset","endianness","__privateAdd","MP4BoxBuffer","extra","req","blen","buf","src","dst","value","pos","npos","length","arr","v","dstOffset","srcOffset","byteLength","dstU8","srcU8","typedArray","littleEndian","u8","j","k","tmp","encoding","fromCharCodeUint8","i","len","s","MAX_SIZE","filename","blob","url","a","offset","array","lengthOverride","structDefinition","struct","structName","structType","structValue","type","charset","parsedType","tp","__privateMethod","ta","h","position","p","t","tap","u","e","_endianness","DataStream","uint8arr","start","LOG_LEVEL_ERROR","LOG_LEVEL_WARNING","LOG_LEVEL_INFO","LOG_LEVEL_DEBUG","log_level","Log","level","module","msg","_msg","isofile","duration","_timescale","neg","pad","number","length","a","duration_sec","hours","minutes","msec","ranges","str","concatBuffers","buffer1","buffer2","Log","tmp","MultiBufferStream","DataStream","buffer","firstBuffer","offset","newLength","smallB","ab","to_add","b","info","ranges","bufferedString","range","used","total","i","log","next_buffer","oldLength","oldUsedBytes","oldFileStart","fromStart","filePosition","markAsUsed","index","abuffer","inputindex","currentBuf","nextBuf","pos","nbBytes","lastBuffer","_type","Box","size","__privateAdd","_a","__privateGet","value","__privateSet","box","prop","_prop","stream","msg","MAX_UINT32","Log","uuidBytes","i","buffer","u8","output","chars","stream_","MultiBufferStream","pos","end","FullBox","SampleGroupEntry","grouping_type","TrackGroupTypeBox","SingleItemTypeReferenceBox","fourcc","box_name","hdr_size","start","count","SingleItemTypeReferenceBoxLarge","TrackReferenceTypeBox","DIFF_BOXES_PROP_NAMES","DIFF_PRIMITIVE_ARRAY_PROP_NAMES","boxEqualFields","box_a","box_b","prop","name","Box","boxEqual","j","getRegistryId","boxClass","current","isSampleGroupEntry","value","symbol","isSampleEntry","isBox","BoxRegistry","registerBoxes","registry","localRegistry","key","groupingType","fourcc","uuid","__spreadValues","DescriptorRegistry","registerDescriptors","parseUUID","stream","parseHex16","hex16","i","hex","parseOneBox","headerOnly","parentSize","box","originalSize","start","hdr_size","uuid","Log","ERR_NOT_ENOUGH_DATA","size","type","ERR_INVALID_DATA","box_type","Box","OK","BoxRegistry","diff","ContainerBox","Box","stream","i","Log","output","prev_indent","ret","parseOneBox","OK","box","fourcc","box_type","SampleEntry","ContainerBox","size","hdr_size","start","stream","Log","HintSampleEntry","MetadataSampleEntry","SubtitleSampleEntry","TextSampleEntry","VisualSampleEntry","compressorname_length","AudioSampleEntry","_a","_b","SystemSampleEntry","ParameterSetArray","str","i","nalu","byte","avcCBox","Box","stream","toparse","ParameterSetArray","i","length","mdatBox","Box","idatBox","freeBox","skipBox","hmhdBox","FullBox","nmhdBox","iodsBox","xmlBox","bxmlBox","iproBox","moovBox","ContainerBox","trakBox","edtsBox","mdiaBox","minfBox","dinfBox","stblBox","mvexBox","moofBox","trafBox","vttcBox","mfraBox","mecoBox","hntiBox","hinfBox","strkBox","strdBox","sinfBox","rinfBox","schiBox","trgrBox","udtaBox","iprpBox","ipcoBox","grplBox","j2kHBox","etypBox","povdBox","drefBox","FullBox","stream","entry_count","i","ret","parseOneBox","OK","box","Log","elngBox","FullBox","stream","ftypBox","Box","stream","toparse","i","hdlrBox","FullBox","stream","name_size","end","Log","hvcCBox","Box","stream","tmp_byte","numOfArrays","i","nalu_array","numNalus","j","length","mdhdBox","FullBox","stream","useVersion1","MAX_UINT32","mehdBox","FullBox","stream","Log","useVersion1","MAX_UINT32","infeBox","FullBox","stream","Log","iinfBox","FullBox","stream","ret","parseOneBox","OK","box","Log","ilocBox","FullBox","stream","byte","item_count","i","item_ID","construction_method","base_offset","data_reference_index","extents","extent_count","j","extent_index","extent_offset","extent_length","REFERENCE_TYPE_NAMES","_irefBox","FullBox","stream","ret","parseOneBox","OK","name","Log","box","SingleItemTypeReferenceBox","SingleItemTypeReferenceBoxLarge","Box","irefBox","pitmBox","FullBox","stream","metaBox","FullBox","stream","pos","ContainerBox","mfhdBox","FullBox","stream","mvhdBox","FullBox","stream","useVersion1","MAX_UINT32","output","mettSampleEntry","MetadataSampleEntry","stream","metxSampleEntry","MetadataSampleEntry","stream","av1CBox","Box","stream","tmp","Log","configOBUs_length","esdsBox","FullBox","stream","esd_data","DescriptorRegistry","esd_parser","DataStream","vpcCBox","FullBox","stream","tmp","vvcCBox","FullBox","stream","bitReader","strm","num_bits","ret","i","cnstr1","cnstr2","j","val","VVC_NALU_OPI","VVC_NALU_DEC_PARAM","num_of_arrays","nalu_array","numNalus","len","colrBox","Box","stream","tmp","decimalToHex","d","padding","hex","avcCSampleEntryBase","VisualSampleEntry","baseCodec","avc1SampleEntry","avc2SampleEntry","avc3SampleEntry","avc4SampleEntry","av01SampleEntry","level_idx_0","level","bitdepth","dav1SampleEntry","hvcCSampleEntryBase","val","reversed","i","hasByte","constraint_string","hvc1SampleEntry","hvc2SampleEntry","hev1SampleEntry","hev2SampleEntry","hvt1SampleEntry","lhe1SampleEntry","lhv1SampleEntry","dvh1SampleEntry","dvheSampleEntry","vvcCSampleEntryBase","bytes","byte","last_nonzero","base32_chars","held_bits","num_held_bits","vvc1SampleEntry","vvi1SampleEntry","vvs1SampleEntry","vvcNSampleEntry","vpcCSampleEntryBase","bitDepth","vp08SampleEntry","vp09SampleEntry","avs3SampleEntry","j2kiSampleEntry","mjp2SampleEntry","mjpgSampleEntry","uncvSampleEntry","mp4vSampleEntry","mp4aSampleEntry","AudioSampleEntry","oti","dsi","m4aeSampleEntry","ac_3SampleEntry","ac_4SampleEntry","ec_3SampleEntry","OpusSampleEntry","mha1SampleEntry","mha2SampleEntry","mhm1SampleEntry","mhm2SampleEntry","fLaCSampleEntry","encvSampleEntry","encaSampleEntry","encuSampleEntry","SubtitleSampleEntry","encsSampleEntry","SystemSampleEntry","mp4sSampleEntry","enctSampleEntry","TextSampleEntry","encmSampleEntry","MetadataSampleEntry","resvSampleEntry","sbttSampleEntry","SubtitleSampleEntry","stream","stppSampleEntry","SubtitleSampleEntry","stream","stxtSampleEntry","SubtitleSampleEntry","stream","baseCodec","tx3gSampleEntry","SubtitleSampleEntry","stream","wvttSampleEntry","MetadataSampleEntry","stream","sbgpBox","FullBox","stream","entry_count","i","entry","sdtpBox","FullBox","stream","count","i","tmp_byte","sgpdBox","FullBox","stream","Log","entry_count","i","entry","BoxRegistry","SampleGroupEntry","sidxBox","FullBox","stream","count","i","type","subsegment_duration","sap","useVersion1","MAX_UINT32","ref","smhdBox","FullBox","stream","stcoBox","FullBox","stream","entry_count","i","samples","sthdBox","FullBox","stscBox","FullBox","stream","entry_count","i","samples","l","m","j","k","stsdBox","FullBox","stream","entryCount","i","ret","parseOneBox","OK","box","BoxRegistry","Log","SampleEntry","stszBox","FullBox","stream","constant","i","samples","sttsBox","FullBox","stream","entry_count","i","delta","Log","samples","k","j","tfdtBox","FullBox","stream","useVersion1","MAX_UINT32","tfhdBox","FullBox","stream","readBytes","TFHD_FLAG_BASE_DATA_OFFSET","TFHD_FLAG_SAMPLE_DESC","TFHD_FLAG_SAMPLE_DUR","TFHD_FLAG_SAMPLE_SIZE","TFHD_FLAG_SAMPLE_FLAGS","tkhdBox","FullBox","stream","_a","useVersion1","MAX_UINT32","output","trexBox","FullBox","stream","trunBox","FullBox","stream","readBytes","TRUN_FLAGS_DATA_OFFSET","TRUN_FLAGS_FIRST_FLAG","i","TRUN_FLAGS_DURATION","TRUN_FLAGS_SIZE","TRUN_FLAGS_FLAGS","TRUN_FLAGS_CTS_OFFSET","urlBox","FullBox","stream","vmhdBox","FullBox","stream","SampleGroupInfo","grouping_type","grouping_type_parameter","sbgp","ISOFile","_ISOFile","stream","discardMdatData","MultiBufferStream","id","user","opts","_a","_b","_c","sizePerSegment","rapAlignement","nbSamples","nbSamplesPerFragment","Log","track","trak","fragTrack","index","boundarySamples","normalized","v","b","nb_samples","ret","parseOneBox","ERR_NOT_ENOUGH_DATA","OK","box","ERR_INVALID_DATA","ab","last","nextFileStart","mvex","traks","maximum","duration","timescale","_1904","isFragmented","movie","i","sample_desc","size","track_timescale","samples_duration","bitrate","j","AudioSampleEntry","VisualSampleEntry","SubtitleSampleEntry","HintSampleEntry","MetadataSampleEntry","sample","consumedTracks","fragTrak","sampleNum","usesExternalBoundaries","boundaryIndex","nextExternalBoundary","isExternalBoundary","isFragmentOverdue","isSegmentOverdue","isFragmentBoundary","isSegmentBoundary","isSizeBoundary","isRAP","isFlush","result","extractTrak","type","returnEarly","sweep","root","Box","inner","track_id","number","time","useRap","rap_seek_sample_num","seek_sample_num","seek_offset","moov","seek_info","trak_seek_info","box_index","a_box","b_box","boxEqual","outstream","sampleStart","sampleEnd","existingStream","samples","DataStream","moof","mdat","mdatBox","offset","mp4Buffer","MP4BoxBuffer","ftyp","total_duration","mvexBox","mehd","mehdBox","trex","trexBox","name","moovBox","trackId","fragmentedTrack","stco","stsc","stsz","stts","ctts","stss","k","traf","sbgps","trak_sgpds","traf_sgpds","sample_group_key","sample_group_info","l","sample_number","sample_groups_info","description","sdtp","chunk_run_index","chunk_index","last_chunk_in_run","offset_in_chunk","last_sample_in_chunk","stsd","subs","stdp","sgpds","last_sample_in_stts_run","stts_run_index","last_sample_in_ctts_run","ctts_run_index","last_stss_index","subs_entry_index","last_subs_sample_index","default_sample_description_index","default_sample_duration","default_sample_size","default_sample_flags","last_run_position","TFHD_FLAG_SAMPLE_DESC","TFHD_FLAG_SAMPLE_DUR","TFHD_FLAG_SAMPLE_SIZE","TFHD_FLAG_SAMPLE_FLAGS","trun","description_index","sample_flags","TRUN_FLAGS_FLAGS","TRUN_FLAGS_FIRST_FLAG","TRUN_FLAGS_SIZE","TRUN_FLAGS_DURATION","dts","cts","TRUN_FLAGS_CTS_OFFSET","bdop","TFHD_FLAG_BASE_DATA_OFFSET","dbim","TFHD_FLAG_DEFAULT_BASE_IS_MOOF","dop","TRUN_FLAGS_DATA_OFFSET","bdo","number_in_traf","sample_index","buffer","fileStart","lengthAfterStart","codecs","items","entity_groups","meta","entityGroup","itemloc","item","ref","ipma","association","propEntry","propbox","item_id","extent","callback","itemId","file","trackOptions","inMdat","startBufferIndex","endBufferIndex","startOffset","endOffset","transferSize","newBuffer","lastPosition","_ret","options","ftypBox","mvhd","mvhdBox","_options","trakBox","tkhd","tkhdBox","TKHD_FLAG_ENABLED","TKHD_FLAG_IN_MOVIE","TKHD_FLAG_IN_PREVIEW","mdia","mdiaBox","mdhd","mdhdBox","hdlr","hdlrBox","elng","elngBox","minf","minfBox","sampleEntry","BoxRegistry","sample_description_entry","sde","vmhd","vmhdBox","avcCBox","hvcCBox","smhd","smhdBox","hmhdBox","sthdBox","stppSampleEntry","nmhdBox","SystemSampleEntry","dref","dinfBox","drefBox","url","urlBox","stbl","stblBox","stsdBox","sttsBox","stscBox","stcoBox","stszBox","data","sample_description_index","is_sync","is_leading","depends_on","is_depended_on","has_redundancy","degradation_priority","subsamples","descriptionIndex","s","moofBox","mfhd","mfhdBox","trafBox","tfhd","tfhdBox","tfdt","tfdtBox","trunBox","output","createFile","keepMdatData","stream","ISOFile","descriptor_exports","__export","Descriptor","ES_Descriptor","MPEG4DescriptorParser","ES_DescrTag","DecoderConfigDescrTag","DecSpecificInfoTag","SLConfigDescrTag","Descriptor","_Descriptor","tag","size","stream","i","byteRead","Log","descTagToName","desc","DESCRIPTOR_CLASSES","_a","start","ES_Descriptor","l","dcd","dsi","audioObjectType","DecoderConfigDescriptor","DecoderSpecificInfo","SLConfigDescriptor","MPEG4DescriptorParser","VTTin4Parser","data","_a","cues","stream","MultiBufferStream","MP4BoxBuffer","cue","parseOneBox","OK","startTime","endTime","pad","value","width","string","secToTimestamp","insec","h","s","ms","i","cueIn4","XMLSubtitlein4Parser","sample","res","DataStream","Textin4Parser","TX3GParser","size","buildHeader","mp4","stream","DataStream","buffer","loadMoovOnly","options","_a","blob","fetchRange","chunkSize","probeSize","size","reader","start","end","createFile","info","movie","hasCompleteMoov","moov","moovEnd","offset","header","effectiveChunkSize","rangeEnd","suggestedNext","ab","data","MP4BoxBuffer","next","all_boxes_exports","__export","CoLLBox","ItemContentIDPropertyBox","OpusSampleEntry","SmDmBox","a1lxBox","a1opBox","ac_3SampleEntry","ac_4SampleEntry","aebrBox","afbrBox","albcBox","alstSampleGroupEntry","altrBox","auxCBox","av01SampleEntry","av1CBox","avc1SampleEntry","avc2SampleEntry","avc3SampleEntry","avc4SampleEntry","avcCBox","avllSampleGroupEntry","avs3SampleEntry","avssSampleGroupEntry","brstBox","btrtBox","bxmlBox","ccstBox","cdefBox","clapBox","clefBox","clliBox","cmexBox","cminBox","cmpdBox","co64Box","colrBox","coviBox","cprtBox","cschBox","cslgBox","cttsBox","dOpsBox","dac3Box","dataBox","dav1SampleEntry","dec3Box","dfLaBox","dimmBox","dinfBox","dmax","dmedBox","dobrBox","drefBox","drepBox","dtrtSampleGroupEntry","dvh1SampleEntry","dvheSampleEntry","ec_3SampleEntry","edtsBox","elngBox","elstBox","emsgBox","encaSampleEntry","encmSampleEntry","encsSampleEntry","enctSampleEntry","encuSampleEntry","encvSampleEntry","enofBox","eqivBox","esdsBox","etypBox","fLaCSampleEntry","favcBox","fielBox","fobrBox","freeBox","frmaBox","ftypBox","grplBox","hdlrBox","hev1SampleEntry","hev2SampleEntry","hinfBox","hmhdBox","hntiBox","hvc1SampleEntry","hvc2SampleEntry","hvcCBox","hvt1SampleEntry","iaugBox","idatBox","iinfBox","ilocBox","ilstBox","imirBox","infeBox","iodsBox","ipcoBox","ipmaBox","iproBox","iprpBox","irefBox","irotBox","ispeBox","itaiBox","j2kHBox","j2kiSampleEntry","keysBox","kindBox","levaBox","lhe1SampleEntry","lhv1SampleEntry","lhvCBox","lselBox","m4aeSampleEntry","maxrBox","mdatBox","mdcvBox","mdhdBox","mdiaBox","mecoBox","mehdBox","metaBox","mettSampleEntry","metxSampleEntry","mfhdBox","mfraBox","mfroBox","mha1SampleEntry","mha2SampleEntry","mhm1SampleEntry","mhm2SampleEntry","minfBox","mjp2SampleEntry","mjpgSampleEntry","moofBox","moovBox","mp4aSampleEntry","mp4sSampleEntry","mp4vSampleEntry","mskCBox","msrcTrackGroupTypeBox","mvexBox","mvhdBox","mvifSampleGroupEntry","nmhdBox","npckBox","numpBox","padbBox","panoBox","paspBox","paylBox","paytBox","pdinBox","piffLsmBox","piffPsshBox","piffSencBox","piffTencBox","piffTfrfBox","piffTfxdBox","pitmBox","pixiBox","pmaxBox","povdBox","prdiBox","prfrBox","prftBox","prgrBox","profBox","prolSampleGroupEntry","psshBox","pymdBox","rapSampleGroupEntry","rashSampleGroupEntry","resvSampleEntry","rinfBox","rollSampleGroupEntry","rtp_Box","saioBox","saizBox","sbgpBox","sbpmBox","sbttSampleEntry","schiBox","schmBox","scifSampleGroupEntry","scnmSampleGroupEntry","sdp_Box","sdtpBox","seigSampleGroupEntry","sencBox","sgpdBox","sidxBox","sinfBox","skipBox","slidBox","smhdBox","sratBox","ssixBox","stblBox","stcoBox","stdpBox","sterBox","sthdBox","stppSampleEntry","strdBox","striBox","strkBox","stsaSampleGroupEntry","stscBox","stsdBox","stsgBox","stshBox","stssBox","stszBox","sttsBox","stviBox","stxtSampleEntry","stypBox","stz2Box","subsBox","syncSampleGroupEntry","taicBox","taptBox","teleSampleGroupEntry","tencBox","tfdtBox","tfhdBox","tfraBox","tkhdBox","tmaxBox","tminBox","totlBox","tpayBox","tpylBox","trafBox","trakBox","trefBox","trepBox","trexBox","trgrBox","trpyBox","trunBox","tsasSampleGroupEntry","tsclSampleGroupEntry","tselBox","tsynBox","tx3gSampleEntry","txtcBox","tycoBox","udesBox","udtaBox","uncCBox","uncvSampleEntry","urlBox","urnBox","viprSampleGroupEntry","vmhdBox","vp08SampleEntry","vp09SampleEntry","vpcCBox","vttCBox","vttcBox","vvc1SampleEntry","vvcCBox","vvcNSampleEntry","vvi1SampleEntry","vvnCBox","vvs1SampleEntry","waveBox","wbbrBox","wvttSampleEntry","xmlBox","a1lxBox","Box","stream","FieldLength","i","a1opBox","Box","stream","auxCBox","FullBox","stream","aux_subtype_length","btrtBox","Box","stream","ccstBox","FullBox","stream","flags","cdefBox","Box","stream","clapBox","Box","stream","clliBox","Box","stream","cmexBox","Box","stream","cminBox","Box","stream","cmpdBox","Box","stream","component_type","co64Box","FullBox","stream","entry_count","i","CoLLBox","FullBox","stream","SphereRegion","s","CoverageSphereRegion","coviBox","FullBox","stream","num_regions","f","view_idc_presence_flag","i","region","range_included_flag","interpolate_included_flag","sphere_region","cprtBox","FullBox","stream","cschBox","FullBox","stream","INT32_MAX","cslgBox","FullBox","stream","cttsBox","FullBox","stream","entry_count","i","value","Log","offset","samples","k","j","dac3Box","Box","stream","tmp_byte1","tmp_byte2","tmp_byte3","dec3Box","Box","stream","tmp_16","i","tmp_byte1","tmp_byte2","tmp_byte3","ind_sub","dfLaBox","FullBox","stream","BLOCKTYPE_MASK","LASTMETADATABLOCKFLAG_MASK","boxesFound","knownBlockTypes","flagAndType","type","dimmBox","Box","stream","dmax","Box","stream","dmedBox","Box","stream","dOpsBox","Box","stream","drepBox","Box","stream","elstBox","FullBox","stream","entry_count","i","entry","useVersion1","MAX_UINT32","emsgBox","FullBox","stream","message_size","EntityToGroup","FullBox","stream","i","entity_id","aebrBox","EntityToGroup","afbrBox","albcBox","altrBox","brstBox","dobrBox","eqivBox","favcBox","fobrBox","iaugBox","panoBox","slidBox","sterBox","tsynBox","wbbrBox","prgrBox","pymdBox","stream","entity_id","fielBox","Box","stream","frmaBox","Box","stream","imirBox","Box","stream","tmp","ipmaBox","FullBox","stream","entry_count","i","id","props","association_count","j","tmp","irotBox","Box","stream","ispeBox","FullBox","stream","itaiBox","FullBox","stream","status_bits","kindBox","FullBox","stream","levaBox","FullBox","stream","count","i","level","tmp_byte","Log","lhvCBox","Box","stream","tmp_byte","numOfArrays","i","nalu_array","numNalus","j","length","lselBox","Box","stream","maxrBox","Box","stream","ColorPoint","x","y","mdcvBox","Box","stream","ColorPoint","mfroBox","FullBox","stream","mskCBox","FullBox","stream","npckBox","Box","stream","numpBox","Box","stream","PaddingBit","pad1","pad2","padbBox","FullBox","stream","sample_count","i","bits","paspBox","Box","stream","paylBox","Box","stream","paytBox","Box","stream","count","pdinBox","FullBox","stream","count","i","pixiBox","FullBox","stream","pmaxBox","Box","stream","prdiBox","FullBox","stream","prfrBox","FullBox","stream","prftBox","FullBox","stream","psshBox","FullBox","stream","parseHex16","count","i","datasize","clefBox","FullBox","stream","parseItifData","type","data","dataBox","view","Log","Box","stream","enofBox","FullBox","stream","ilstBox","Box","stream","total","size","index","res","parseOneBox","OK","keysBox","FullBox","stream","len","profBox","FullBox","stream","taptBox","ContainerBox","waveBox","ContainerBox","rtp_Box","Box","stream","saioBox","FullBox","stream","count","i","saizBox","FullBox","stream","Pixel","bad_pixel_row","bad_pixel_column","sbpmBox","FullBox","stream","i","flags","row","col","Pixel","schmBox","FullBox","stream","sdp_Box","Box","stream","sencBox","FullBox","SmDmBox","FullBox","stream","sratBox","FullBox","stream","ssixBox","FullBox","stream","subsegment_count","i","subsegment","range_count","j","range","stdpBox","FullBox","stream","count","i","striBox","FullBox","stream","count","i","stsgBox","FullBox","stream","count","i","stshBox","FullBox","stream","entry_count","i","stssBox","FullBox","stream","entry_count","i","stviBox","FullBox","stream","tmp32","length","ret","parseOneBox","OK","box","stypBox","Box","stream","toparse","i","stz2Box","FullBox","stream","sample_count","i","tmp","Log","subsBox","FullBox","stream","entry_count","subsample_count","i","sampleInfo","j","subsample","taicBox","FullBox","stream","reserved_byte","tencBox","FullBox","stream","tmp","parseHex16","tfraBox","FullBox","stream","tmp_byte","number_of_entries","i","tmaxBox","Box","stream","tminBox","Box","stream","totlBox","Box","stream","tpayBox","Box","stream","tpylBox","Box","stream","msrcTrackGroupTypeBox","TrackGroupTypeBox","_trefBox","Box","stream","ret","parseOneBox","OK","Log","box","TrackReferenceTypeBox","trefBox","trepBox","FullBox","stream","ret","parseOneBox","OK","box","trpyBox","Box","stream","tselBox","FullBox","stream","count","i","txtcBox","FullBox","stream","tycoBox","Box","stream","count","i","udesBox","FullBox","stream","uncCBox","FullBox","stream","i","flags","urnBox","FullBox","stream","vttCBox","Box","stream","vvnCBox","FullBox","stream","tmp","alstSampleGroupEntry","SampleGroupEntry","stream","roll_count","i","remaining","avllSampleGroupEntry","SampleGroupEntry","stream","avssSampleGroupEntry","SampleGroupEntry","stream","tmp_byte","numReferences","i","dtrtSampleGroupEntry","SampleGroupEntry","_stream","Log","mvifSampleGroupEntry","SampleGroupEntry","_stream","Log","prolSampleGroupEntry","SampleGroupEntry","stream","rapSampleGroupEntry","SampleGroupEntry","stream","tmp_byte","rashSampleGroupEntry","SampleGroupEntry","stream","Log","i","rollSampleGroupEntry","SampleGroupEntry","stream","scifSampleGroupEntry","SampleGroupEntry","_stream","Log","scnmSampleGroupEntry","SampleGroupEntry","_stream","Log","seigSampleGroupEntry","SampleGroupEntry","stream","tmp","parseHex16","stsaSampleGroupEntry","SampleGroupEntry","_stream","Log","syncSampleGroupEntry","SampleGroupEntry","stream","tmp_byte","teleSampleGroupEntry","SampleGroupEntry","stream","tmp_byte","tsasSampleGroupEntry","SampleGroupEntry","_stream","Log","tsclSampleGroupEntry","SampleGroupEntry","_stream","Log","viprSampleGroupEntry","SampleGroupEntry","_stream","Log","UUIDBox","Box","UUIDFullBox","FullBox","piffLsmBox","stream","piffPsshBox","parseHex16","datasize","piffSencBox","piffTencBox","piffTfrfBox","absolute_time","absolute_duration","piffTfxdBox","ItemContentIDPropertyBox","BoxParser","registerBoxes","all_boxes_exports","registerDescriptors","descriptor_exports"]}